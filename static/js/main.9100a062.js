/*! For license information please see main.9100a062.js.LICENSE.txt */
!function(){var t={7276:function(t,e,i){var n=i(1588).default,s=i(3808).default,r=i(1655).default,o=i(6389).default,a=i(6690).default,l=i(9728).default,u=i(3515).default;!function(t){"use strict";function e(t){if(!t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];throw u(Error,i)}}function i(t,e){return void 0!==t?t:e}var h=1e37,m=1e-5,c=m*m,_=3.14159265359,f=2,d=8,v=.1,y=2,p=.008,x=2/180*_,g=2*p,b=8,S=32,B=1,w=.2,A=8/180*_,C=2,M=C*C,V=.5*_,k=V*V,P=.2,I=.75,T=-1,G=2147483647,L=.75,D=1,R=.25,F=.5,E=2,O=E*E,z=256,j=2.5,q=.5,N=.01,X=2/180*_;function J(t){return null}function W(t){}function U(t){}var H=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;a(this,t),this.major=0,this.minor=0,this.revision=0,this.major=e,this.minor=i,this.revision=n}return l(t,[{key:"toString",value:function(){return this.major+"."+this.minor+"."+this.revision}}]),t}(),Z=new H(2,3,2),Y="master",K="fbf51801d80fc389d43dc46524520e89043b6faf";function Q(t){return parseInt(t,10)}function $(t){return Math.abs(parseInt(t,10))}function tt(t,e){for(var i=[],n=0;n<t;++n)i.push(e(n));return i}function et(t){for(var e=[],i=0;i<t;++i)e.push(null);return e}function it(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=[],n=0;n<t;++n)i.push(e);return i}var nt=_/180,st=180/_,rt=2*_,ot=Math.abs,at=Math.min,lt=Math.max;function ut(t,e,i){return t<e?e:t>i?i:t}function ht(t,e){var i=t[0];t[0]=e[0],e[0]=i}var mt=isFinite;function ct(t){return t*t}function _t(t){return 1/Math.sqrt(t)}var ft=Math.sqrt,dt=Math.pow;function vt(t){return t*nt}function yt(t){return t*st}var pt=Math.cos,xt=Math.sin,gt=Math.acos,bt=Math.asin,St=Math.atan2;function Bt(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,1+(t|=t>>16&65535)}function wt(t){return t>0&&0===(t&t-1)}function At(){return 2*Math.random()-1}function Ct(t,e){return(e-t)*Math.random()+t}var Mt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;a(this,t),this.x=e,this.y=i}return l(t,[{key:"Clone",value:function(){return new t(this.x,this.y)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this}},{key:"Set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"SelfAddXY",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"SelfSubXY",value:function(t,e){return this.x-=t,this.y-=e,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this}},{key:"SelfMulAdd",value:function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this}},{key:"SelfMulSub",value:function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this}},{key:"Dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"Cross",value:function(t){return this.x*t.y-this.y*t.x}},{key:"Length",value:function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}},{key:"LengthSquared",value:function(){var t=this.x,e=this.y;return t*t+e*e}},{key:"Normalize",value:function(){var t=this.Length();if(t>=m){var e=1/t;this.x*=e,this.y*=e}return t}},{key:"SelfNormalize",value:function(){var t=this.Length();if(t>=m){var e=1/t;this.x*=e,this.y*=e}return this}},{key:"SelfRotate",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.x;return this.x=e*n-i*this.y,this.y=i*n+e*this.y,this}},{key:"IsValid",value:function(){return isFinite(this.x)&&isFinite(this.y)}},{key:"SelfCrossVS",value:function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this}},{key:"SelfCrossSV",value:function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this}},{key:"SelfMinV",value:function(t){return this.x=at(this.x,t.x),this.y=at(this.y,t.y),this}},{key:"SelfMaxV",value:function(t){return this.x=lt(this.x,t.x),this.y=lt(this.y,t.y),this}},{key:"SelfAbs",value:function(){return this.x=ot(this.x),this.y=ot(this.y),this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"SelfSkew",value:function(){var t=this.x;return this.x=-this.y,this.y=t,this}}],[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}},{key:"AbsV",value:function(t,e){return e.x=ot(t.x),e.y=ot(t.y),e}},{key:"MinV",value:function(t,e,i){return i.x=at(t.x,e.x),i.y=at(t.y,e.y),i}},{key:"MaxV",value:function(t,e,i){return i.x=lt(t.x,e.x),i.y=lt(t.y,e.y),i}},{key:"ClampV",value:function(t,e,i,n){return n.x=ut(t.x,e.x,i.x),n.y=ut(t.y,e.y,i.y),n}},{key:"RotateV",value:function(t,e,i){var n=t.x,s=t.y,r=Math.cos(e),o=Math.sin(e);return i.x=r*n-o*s,i.y=o*n+r*s,i}},{key:"DotVV",value:function(t,e){return t.x*e.x+t.y*e.y}},{key:"CrossVV",value:function(t,e){return t.x*e.y-t.y*e.x}},{key:"CrossVS",value:function(t,e,i){var n=t.x;return i.x=e*t.y,i.y=-e*n,i}},{key:"CrossVOne",value:function(t,e){var i=t.x;return e.x=t.y,e.y=-i,e}},{key:"CrossSV",value:function(t,e,i){var n=e.x;return i.x=-t*e.y,i.y=t*n,i}},{key:"CrossOneV",value:function(t,e){var i=t.x;return e.x=-t.y,e.y=i,e}},{key:"AddVV",value:function(t,e,i){return i.x=t.x+e.x,i.y=t.y+e.y,i}},{key:"SubVV",value:function(t,e,i){return i.x=t.x-e.x,i.y=t.y-e.y,i}},{key:"MulSV",value:function(t,e,i){return i.x=e.x*t,i.y=e.y*t,i}},{key:"MulVS",value:function(t,e,i){return i.x=t.x*e,i.y=t.y*e,i}},{key:"AddVMulSV",value:function(t,e,i,n){return n.x=t.x+e*i.x,n.y=t.y+e*i.y,n}},{key:"SubVMulSV",value:function(t,e,i,n){return n.x=t.x-e*i.x,n.y=t.y-e*i.y,n}},{key:"AddVCrossSV",value:function(t,e,i,n){var s=i.x;return n.x=t.x-e*i.y,n.y=t.y+e*s,n}},{key:"MidVV",value:function(t,e,i){return i.x=.5*(t.x+e.x),i.y=.5*(t.y+e.y),i}},{key:"ExtVV",value:function(t,e,i){return i.x=.5*(e.x-t.x),i.y=.5*(e.y-t.y),i}},{key:"IsEqualToV",value:function(t,e){return t.x===e.x&&t.y===e.y}},{key:"DistanceVV",value:function(t,e){var i=t.x-e.x,n=t.y-e.y;return Math.sqrt(i*i+n*n)}},{key:"DistanceSquaredVV",value:function(t,e){var i=t.x-e.x,n=t.y-e.y;return i*i+n*n}},{key:"NegV",value:function(t,e){return e.x=-t.x,e.y=-t.y,e}}]),t}();Mt.ZERO=new Mt(0,0),Mt.UNITX=new Mt(1,0),Mt.UNITY=new Mt(0,1),Mt.s_t0=new Mt,Mt.s_t1=new Mt,Mt.s_t2=new Mt,Mt.s_t3=new Mt;var Vt=new Mt(0,0),kt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;a(this,t),this.x=e,this.y=i,this.z=n}return l(t,[{key:"Clone",value:function(){return new t(this.x,this.y,this.z)}},{key:"SetZero",value:function(){return this.x=0,this.y=0,this.z=0,this}},{key:"SetXYZ",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"Copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"SelfNeg",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"SelfAdd",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"SelfAddXYZ",value:function(t,e,i){return this.x+=t,this.y+=e,this.z+=i,this}},{key:"SelfSub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"SelfSubXYZ",value:function(t,e,i){return this.x-=t,this.y-=e,this.z-=i,this}},{key:"SelfMul",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}}],[{key:"DotV3V3",value:function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}},{key:"CrossV3V3",value:function(t,e,i){var n=t.x,s=t.y,r=t.z,o=e.x,a=e.y,l=e.z;return i.x=s*l-r*a,i.y=r*o-n*l,i.z=n*a-s*o,i}}]),t}();kt.ZERO=new kt(0,0,0),kt.s_t0=new kt;var Pt=function(){function t(){a(this,t),this.ex=new Mt(1,0),this.ey=new Mt(0,1)}return l(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"SetSSSS",value:function(t,e,i,n){return this.ex.Set(t,i),this.ey.Set(e,n),this}},{key:"SetVV",value:function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this}},{key:"SetAngle",value:function(t){var e=Math.cos(t),i=Math.sin(t);return this.ex.Set(e,i),this.ey.Set(-i,e),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this}},{key:"SetIdentity",value:function(){return this.ex.Set(1,0),this.ey.Set(0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this}},{key:"GetAngle",value:function(){return Math.atan2(this.ex.y,this.ex.x)}},{key:"GetInverse",value:function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,s=this.ey.y,r=e*s-i*n;return 0!==r&&(r=1/r),t.ex.x=r*s,t.ey.x=-r*i,t.ex.y=-r*n,t.ey.y=r*e,t}},{key:"Solve",value:function(t,e,i){var n=this.ex.x,s=this.ey.x,r=this.ex.y,o=this.ey.y,a=n*o-s*r;return 0!==a&&(a=1/a),i.x=a*(o*t-s*e),i.y=a*(n*e-r*t),i}},{key:"SelfAbs",value:function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this}},{key:"SelfInv",value:function(){return this.GetInverse(this),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this}},{key:"SelfSubM",value:function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this}}],[{key:"FromVV",value:function(e,i){return(new t).SetVV(e,i)}},{key:"FromSSSS",value:function(e,i,n,s){return(new t).SetSSSS(e,i,n,s)}},{key:"FromAngle",value:function(e){return(new t).SetAngle(e)}},{key:"AbsM",value:function(t,e){var i=t.ex,n=t.ey;return e.ex.x=ot(i.x),e.ex.y=ot(i.y),e.ey.x=ot(n.x),e.ey.y=ot(n.y),e}},{key:"MulMV",value:function(t,e,i){var n=t.ex,s=t.ey,r=e.x,o=e.y;return i.x=n.x*r+s.x*o,i.y=n.y*r+s.y*o,i}},{key:"MulTMV",value:function(t,e,i){var n=t.ex,s=t.ey,r=e.x,o=e.y;return i.x=n.x*r+n.y*o,i.y=s.x*r+s.y*o,i}},{key:"AddMM",value:function(t,e,i){var n=t.ex,s=t.ey,r=e.ex,o=e.ey;return i.ex.x=n.x+r.x,i.ex.y=n.y+r.y,i.ey.x=s.x+o.x,i.ey.y=s.y+o.y,i}},{key:"MulMM",value:function(t,e,i){var n=t.ex.x,s=t.ex.y,r=t.ey.x,o=t.ey.y,a=e.ex.x,l=e.ex.y,u=e.ey.x,h=e.ey.y;return i.ex.x=n*a+r*l,i.ex.y=s*a+o*l,i.ey.x=n*u+r*h,i.ey.y=s*u+o*h,i}},{key:"MulTMM",value:function(t,e,i){var n=t.ex.x,s=t.ex.y,r=t.ey.x,o=t.ey.y,a=e.ex.x,l=e.ex.y,u=e.ey.x,h=e.ey.y;return i.ex.x=n*a+s*l,i.ex.y=r*a+o*l,i.ey.x=n*u+s*h,i.ey.y=r*u+o*h,i}}]),t}();Pt.IDENTITY=new Pt;var It=function(){function t(){a(this,t),this.ex=new kt(1,0,0),this.ey=new kt(0,1,0),this.ez=new kt(0,0,1)}return l(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"SetVVV",value:function(t,e,i){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(i),this}},{key:"Copy",value:function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this}},{key:"SetIdentity",value:function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this}},{key:"SetZero",value:function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this}},{key:"SelfAddM",value:function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this}},{key:"Solve33",value:function(t,e,i,n){var s=this.ex.x,r=this.ex.y,o=this.ex.z,a=this.ey.x,l=this.ey.y,u=this.ey.z,h=this.ez.x,m=this.ez.y,c=this.ez.z,_=s*(l*c-u*m)+r*(u*h-a*c)+o*(a*m-l*h);return 0!==_&&(_=1/_),n.x=_*(t*(l*c-u*m)+e*(u*h-a*c)+i*(a*m-l*h)),n.y=_*(s*(e*c-i*m)+r*(i*h-t*c)+o*(t*m-e*h)),n.z=_*(s*(l*i-u*e)+r*(u*t-a*i)+o*(a*e-l*t)),n}},{key:"Solve22",value:function(t,e,i){var n=this.ex.x,s=this.ey.x,r=this.ex.y,o=this.ey.y,a=n*o-s*r;return 0!==a&&(a=1/a),i.x=a*(o*t-s*e),i.y=a*(n*e-r*t),i}},{key:"GetInverse22",value:function(t){var e=this.ex.x,i=this.ey.x,n=this.ex.y,s=this.ey.y,r=e*s-i*n;0!==r&&(r=1/r),t.ex.x=r*s,t.ey.x=-r*i,t.ex.z=0,t.ex.y=-r*n,t.ey.y=r*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}},{key:"GetSymInverse33",value:function(t){var e=kt.DotV3V3(this.ex,kt.CrossV3V3(this.ey,this.ez,kt.s_t0));0!==e&&(e=1/e);var i=this.ex.x,n=this.ey.x,s=this.ez.x,r=this.ey.y,o=this.ez.y,a=this.ez.z;t.ex.x=e*(r*a-o*o),t.ex.y=e*(s*o-n*a),t.ex.z=e*(n*o-s*r),t.ey.x=t.ex.y,t.ey.y=e*(i*a-s*s),t.ey.z=e*(s*n-i*o),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*r-n*n)}}],[{key:"MulM33V3",value:function(t,e,i){var n=e.x,s=e.y,r=e.z;return i.x=t.ex.x*n+t.ey.x*s+t.ez.x*r,i.y=t.ex.y*n+t.ey.y*s+t.ez.y*r,i.z=t.ex.z*n+t.ey.z*s+t.ez.z*r,i}},{key:"MulM33XYZ",value:function(t,e,i,n,s){return s.x=t.ex.x*e+t.ey.x*i+t.ez.x*n,s.y=t.ex.y*e+t.ey.y*i+t.ez.y*n,s.z=t.ex.z*e+t.ey.z*i+t.ez.z*n,s}},{key:"MulM33V2",value:function(t,e,i){var n=e.x,s=e.y;return i.x=t.ex.x*n+t.ey.x*s,i.y=t.ex.y*n+t.ey.y*s,i}},{key:"MulM33XY",value:function(t,e,i,n){return n.x=t.ex.x*e+t.ey.x*i,n.y=t.ex.y*e+t.ey.y*i,n}}]),t}();It.IDENTITY=new It;var Tt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;a(this,t),this.s=0,this.c=1,e&&(this.s=Math.sin(e),this.c=Math.cos(e))}return l(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.s=t.s,this.c=t.c,this}},{key:"SetAngle",value:function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this}},{key:"SetIdentity",value:function(){return this.s=0,this.c=1,this}},{key:"GetAngle",value:function(){return Math.atan2(this.s,this.c)}},{key:"GetXAxis",value:function(t){return t.x=this.c,t.y=this.s,t}},{key:"GetYAxis",value:function(t){return t.x=-this.s,t.y=this.c,t}}],[{key:"MulRR",value:function(t,e,i){var n=t.c,s=t.s,r=e.c,o=e.s;return i.s=s*r+n*o,i.c=n*r-s*o,i}},{key:"MulTRR",value:function(t,e,i){var n=t.c,s=t.s,r=e.c,o=e.s;return i.s=n*o-s*r,i.c=n*r+s*o,i}},{key:"MulRV",value:function(t,e,i){var n=t.c,s=t.s,r=e.x,o=e.y;return i.x=n*r-s*o,i.y=s*r+n*o,i}},{key:"MulTRV",value:function(t,e,i){var n=t.c,s=t.s,r=e.x,o=e.y;return i.x=n*r+s*o,i.y=-s*r+n*o,i}}]),t}();Tt.IDENTITY=new Tt;var Gt=function(){function t(){a(this,t),this.p=new Mt,this.q=new Tt}return l(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this}},{key:"SetIdentity",value:function(){return this.p.SetZero(),this.q.SetIdentity(),this}},{key:"SetPositionRotation",value:function(t,e){return this.p.Copy(t),this.q.Copy(e),this}},{key:"SetPositionAngle",value:function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this}},{key:"SetPosition",value:function(t){return this.p.Copy(t),this}},{key:"SetPositionXY",value:function(t,e){return this.p.Set(t,e),this}},{key:"SetRotation",value:function(t){return this.q.Copy(t),this}},{key:"SetRotationAngle",value:function(t){return this.q.SetAngle(t),this}},{key:"GetPosition",value:function(){return this.p}},{key:"GetRotation",value:function(){return this.q}},{key:"GetRotationAngle",value:function(){return this.q.GetAngle()}},{key:"GetAngle",value:function(){return this.q.GetAngle()}}],[{key:"MulXV",value:function(t,e,i){var n=t.q.c,s=t.q.s,r=e.x,o=e.y;return i.x=n*r-s*o+t.p.x,i.y=s*r+n*o+t.p.y,i}},{key:"MulTXV",value:function(t,e,i){var n=t.q.c,s=t.q.s,r=e.x-t.p.x,o=e.y-t.p.y;return i.x=n*r+s*o,i.y=-s*r+n*o,i}},{key:"MulXX",value:function(t,e,i){return Tt.MulRR(t.q,e.q,i.q),Mt.AddVV(Tt.MulRV(t.q,e.p,i.p),t.p,i.p),i}},{key:"MulTXX",value:function(t,e,i){return Tt.MulTRR(t.q,e.q,i.q),Tt.MulTRV(t.q,Mt.SubVV(e.p,t.p,i.p),i.p),i}}]),t}();Gt.IDENTITY=new Gt;var Lt,Dt=function(){function t(){a(this,t),this.localCenter=new Mt,this.c0=new Mt,this.c=new Mt,this.a0=0,this.a=0,this.alpha0=0}return l(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this}},{key:"GetTransform",value:function(t,e){var i=1-e;t.p.x=i*this.c0.x+e*this.c.x,t.p.y=i*this.c0.y+e*this.c.y;var n=i*this.a0+e*this.a;return t.q.SetAngle(n),t.p.SelfSub(Tt.MulRV(t.q,this.localCenter,Mt.s_t0)),t}},{key:"Advance",value:function(t){var e=(t-this.alpha0)/(1-this.alpha0),i=1-e;this.c0.x=i*this.c0.x+e*this.c.x,this.c0.y=i*this.c0.y+e*this.c.y,this.a0=i*this.a0+e*this.a,this.alpha0=t}},{key:"Normalize",value:function(){var t=rt*Math.floor(this.a0/rt);this.a0-=t,this.a-=t}}]),t}(),Rt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;a(this,t),this.r=e,this.g=i,this.b=n,this.a=s}return l(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"IsEqual",value:function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a}},{key:"IsZero",value:function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a}},{key:"Set",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.a;this.SetRGBA(t,e,i,n)}},{key:"SetByteRGB",value:function(t,e,i){return this.r=t/255,this.g=e/255,this.b=i/255,this}},{key:"SetByteRGBA",value:function(t,e,i,n){return this.r=t/255,this.g=e/255,this.b=i/255,this.a=n/255,this}},{key:"SetRGB",value:function(t,e,i){return this.r=t,this.g=e,this.b=i,this}},{key:"SetRGBA",value:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this}},{key:"SelfAdd",value:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this}},{key:"Add",value:function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e}},{key:"SelfSub",value:function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this}},{key:"Sub",value:function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e}},{key:"SelfMul",value:function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this}},{key:"Mul",value:function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e}},{key:"Mix",value:function(e,i){t.MixColors(this,e,i)}},{key:"MakeStyleString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.a;return t.MakeStyleString(this.r,this.g,this.b,e)}}],[{key:"MixColors",value:function(t,e,i){var n=i*(e.r-t.r),s=i*(e.g-t.g),r=i*(e.b-t.b),o=i*(e.a-t.a);t.r+=n,t.g+=s,t.b+=r,t.a+=o,e.r-=n,e.g-=s,e.b-=r,e.a-=o}},{key:"MakeStyleString",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return t*=255,e*=255,i*=255,n<1?"rgba(".concat(t,",").concat(e,",").concat(i,",").concat(n,")"):"rgb(".concat(t,",").concat(e,",").concat(i,")")}}]),t}();Rt.ZERO=new Rt(0,0,0,0),Rt.RED=new Rt(1,0,0),Rt.GREEN=new Rt(0,1,0),Rt.BLUE=new Rt(0,0,1),(Lt=t.b2DrawFlags||(t.b2DrawFlags={}))[Lt.e_none=0]="e_none",Lt[Lt.e_shapeBit=1]="e_shapeBit",Lt[Lt.e_jointBit=2]="e_jointBit",Lt[Lt.e_aabbBit=4]="e_aabbBit",Lt[Lt.e_pairBit=8]="e_pairBit",Lt[Lt.e_centerOfMassBit=16]="e_centerOfMassBit",Lt[Lt.e_particleBit=32]="e_particleBit",Lt[Lt.e_controllerBit=64]="e_controllerBit",Lt[Lt.e_all=63]="e_all";var Ft=function(){function t(){a(this,t),this.m_drawFlags=0}return l(t,[{key:"SetFlags",value:function(t){this.m_drawFlags=t}},{key:"GetFlags",value:function(){return this.m_drawFlags}},{key:"AppendFlags",value:function(t){this.m_drawFlags|=t}},{key:"ClearFlags",value:function(t){this.m_drawFlags&=~t}}]),t}(),Et=function(){function t(){a(this,t),this.m_start=Date.now()}return l(t,[{key:"Reset",value:function(){return this.m_start=Date.now(),this}},{key:"GetMilliseconds",value:function(){return Date.now()-this.m_start}}]),t}(),Ot=function(){function t(){a(this,t),this.m_count=0,this.m_min_count=0,this.m_max_count=0}return l(t,[{key:"GetCount",value:function(){return this.m_count}},{key:"GetMinCount",value:function(){return this.m_min_count}},{key:"GetMaxCount",value:function(){return this.m_max_count}},{key:"ResetCount",value:function(){var t=this.m_count;return this.m_count=0,t}},{key:"ResetMinCount",value:function(){this.m_min_count=0}},{key:"ResetMaxCount",value:function(){this.m_max_count=0}},{key:"Increment",value:function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)}},{key:"Decrement",value:function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)}}]),t}(),zt=function(){function t(e){a(this,t),this.m_stack=[],this.m_count=0,this.m_stack=tt(e,(function(t){return null})),this.m_count=0}return l(t,[{key:"Reset",value:function(){return this.m_count=0,this}},{key:"Push",value:function(t){this.m_stack[this.m_count]=t,this.m_count++}},{key:"Pop",value:function(){this.m_count--;var t=this.m_stack[this.m_count];if(this.m_stack[this.m_count]=null,null===t)throw new Error;return t}},{key:"GetCount",value:function(){return this.m_count}}]),t}(),jt=l((function t(){a(this,t)})),qt=l((function t(){a(this,t)})),Nt=function(){function t(){a(this,t),this.m_buffer=Mt.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}return l(t,[{key:"Copy",value:function(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this}},{key:"Reset",value:function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this}},{key:"SetShape",value:function(t,e){t.SetupDistanceProxy(this,e)}},{key:"SetVerticesRadius",value:function(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i}},{key:"GetSupport",value:function(t){for(var e=0,i=Mt.DotVV(this.m_vertices[0],t),n=1;n<this.m_count;++n){var s=Mt.DotVV(this.m_vertices[n],t);s>i&&(e=n,i=s)}return e}},{key:"GetSupportVertex",value:function(t){for(var e=0,i=Mt.DotVV(this.m_vertices[0],t),n=1;n<this.m_count;++n){var s=Mt.DotVV(this.m_vertices[n],t);s>i&&(e=n,i=s)}return this.m_vertices[e]}},{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertex",value:function(t){return this.m_vertices[t]}}]),t}(),Xt=function(){function t(){a(this,t),this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}return l(t,[{key:"Reset",value:function(){return this.metric=0,this.count=0,this}}]),t}(),Jt=function(){function t(){a(this,t),this.proxyA=new Nt,this.proxyB=new Nt,this.transformA=new Gt,this.transformB=new Gt,this.useRadii=!1}return l(t,[{key:"Reset",value:function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this}}]),t}(),Wt=function(){function t(){a(this,t),this.pointA=new Mt,this.pointB=new Mt,this.distance=0,this.iterations=0}return l(t,[{key:"Reset",value:function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this}}]),t}(),Ut=l((function t(){a(this,t),this.proxyA=new Nt,this.proxyB=new Nt,this.transformA=new Gt,this.transformB=new Gt,this.translationB=new Mt})),Ht=l((function t(){a(this,t),this.point=new Mt,this.normal=new Mt,this.lambda=0,this.iterations=0}));function Zt(){t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0}t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0;var Yt=function(){function t(){a(this,t),this.wA=new Mt,this.wB=new Mt,this.w=new Mt,this.a=0,this.indexA=0,this.indexB=0}return l(t,[{key:"Copy",value:function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this}}]),t}(),Kt=function(){function t(){a(this,t),this.m_v1=new Yt,this.m_v2=new Yt,this.m_v3=new Yt,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}return l(t,[{key:"ReadCache",value:function(t,e,i,n,s){this.m_count=t.count;for(var r=this.m_vertices,o=0;o<this.m_count;++o){var a=r[o];a.indexA=t.indexA[o],a.indexB=t.indexB[o];var l=e.GetVertex(a.indexA),u=n.GetVertex(a.indexB);Gt.MulXV(i,l,a.wA),Gt.MulXV(s,u,a.wB),Mt.SubVV(a.wB,a.wA,a.w),a.a=0}if(this.m_count>1){var h=t.metric,c=this.GetMetric();(c<.5*h||2*h<c||c<m)&&(this.m_count=0)}if(0===this.m_count){var _=r[0];_.indexA=0,_.indexB=0;var f=e.GetVertex(0),d=n.GetVertex(0);Gt.MulXV(i,f,_.wA),Gt.MulXV(s,d,_.wB),Mt.SubVV(_.wB,_.wA,_.w),_.a=1,this.m_count=1}}},{key:"WriteCache",value:function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,i=0;i<this.m_count;++i)t.indexA[i]=e[i].indexA,t.indexB[i]=e[i].indexB}},{key:"GetSearchDirection",value:function(t){switch(this.m_count){case 1:return Mt.NegV(this.m_v1.w,t);case 2:var e=Mt.SubVV(this.m_v2.w,this.m_v1.w,t);return Mt.CrossVV(e,Mt.NegV(this.m_v1.w,Mt.s_t0))>0?Mt.CrossOneV(e,t):Mt.CrossVOne(e,t);default:return t.SetZero()}}},{key:"GetClosestPoint",value:function(t){switch(this.m_count){case 0:case 3:default:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y)}}},{key:"GetWitnessPoints",value:function(t,e){switch(this.m_count){case 0:default:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}}},{key:"GetMetric",value:function(){switch(this.m_count){case 0:case 1:default:return 0;case 2:return Mt.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return Mt.CrossVV(Mt.SubVV(this.m_v2.w,this.m_v1.w,Mt.s_t0),Mt.SubVV(this.m_v3.w,this.m_v1.w,Mt.s_t1))}}},{key:"Solve2",value:function(){var e=this.m_v1.w,i=this.m_v2.w,n=Mt.SubVV(i,e,t.s_e12),s=-Mt.DotVV(e,n);if(s<=0)return this.m_v1.a=1,void(this.m_count=1);var r=Mt.DotVV(i,n);if(r<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var o=1/(r+s);this.m_v1.a=r*o,this.m_v2.a=s*o,this.m_count=2}},{key:"Solve3",value:function(){var e=this.m_v1.w,i=this.m_v2.w,n=this.m_v3.w,s=Mt.SubVV(i,e,t.s_e12),r=Mt.DotVV(e,s),o=Mt.DotVV(i,s),a=-r,l=Mt.SubVV(n,e,t.s_e13),u=Mt.DotVV(e,l),h=Mt.DotVV(n,l),m=-u,c=Mt.SubVV(n,i,t.s_e23),_=Mt.DotVV(i,c),f=Mt.DotVV(n,c),d=-_,v=Mt.CrossVV(s,l),y=v*Mt.CrossVV(i,n),p=v*Mt.CrossVV(n,e),x=v*Mt.CrossVV(e,i);if(a<=0&&m<=0)return this.m_v1.a=1,void(this.m_count=1);if(o>0&&a>0&&x<=0){var g=1/(o+a);return this.m_v1.a=o*g,this.m_v2.a=a*g,void(this.m_count=2)}if(h>0&&m>0&&p<=0){var b=1/(h+m);return this.m_v1.a=h*b,this.m_v3.a=m*b,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(o<=0&&d<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(h<=0&&f<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(f>0&&d>0&&y<=0){var S=1/(f+d);return this.m_v2.a=f*S,this.m_v3.a=d*S,this.m_count=2,void this.m_v1.Copy(this.m_v3)}var B=1/(y+p+x);this.m_v1.a=y*B,this.m_v2.a=p*B,this.m_v3.a=x*B,this.m_count=3}}]),t}();Kt.s_e12=new Mt,Kt.s_e13=new Mt,Kt.s_e23=new Mt;var Qt=new Kt,$t=[0,0,0],te=[0,0,0],ee=new Mt,ie=new Mt,ne=new Mt,se=new Mt,re=new Mt;function oe(e,i,n){++t.b2_gjkCalls;var s=n.proxyA,r=n.proxyB,o=n.transformA,a=n.transformB,l=Qt;l.ReadCache(i,s,o,r,a);for(var u=l.m_vertices,h=20,_=$t,f=te,d=0,v=0;v<h;){d=l.m_count;for(var y=0;y<d;++y)_[y]=u[y].indexA,f[y]=u[y].indexB;switch(l.m_count){case 1:default:break;case 2:l.Solve2();break;case 3:l.Solve3()}if(3===l.m_count)break;var p=l.GetSearchDirection(ie);if(p.LengthSquared()<c)break;var x=u[l.m_count];x.indexA=s.GetSupport(Tt.MulTRV(o.q,Mt.NegV(p,Mt.s_t0),se)),Gt.MulXV(o,s.GetVertex(x.indexA),x.wA),x.indexB=r.GetSupport(Tt.MulTRV(a.q,p,re)),Gt.MulXV(a,r.GetVertex(x.indexB),x.wB),Mt.SubVV(x.wB,x.wA,x.w),++v,++t.b2_gjkIters;for(var g=!1,b=0;b<d;++b)if(x.indexA===_[b]&&x.indexB===f[b]){g=!0;break}if(g)break;++l.m_count}if(t.b2_gjkMaxIters=lt(t.b2_gjkMaxIters,v),l.GetWitnessPoints(e.pointA,e.pointB),e.distance=Mt.DistanceVV(e.pointA,e.pointB),e.iterations=v,l.WriteCache(i),n.useRadii){var S=s.m_radius,B=r.m_radius;if(e.distance>S+B&&e.distance>m){e.distance-=S+B;var w=Mt.SubVV(e.pointB,e.pointA,ne);w.Normalize(),e.pointA.SelfMulAdd(S,w),e.pointB.SelfMulSub(B,w)}else{var A=Mt.MidVV(e.pointA,e.pointB,ee);e.pointA.Copy(A),e.pointB.Copy(A),e.distance=0}}}var ae,le=new Mt,ue=new Kt,he=new Mt,me=new Mt,ce=new Mt,_e=new Mt,fe=new Mt,de=new Mt;function ve(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();var i=e.proxyA,n=e.proxyB,s=lt(i.m_radius,g)+lt(n.m_radius,g),r=e.transformA,o=e.transformB,a=e.translationB,l=le.Set(0,0),u=0,h=ue;h.m_count=0;for(var m=h.m_vertices,c=i.GetSupport(Tt.MulTRV(r.q,Mt.NegV(a,Mt.s_t1),Mt.s_t0)),_=Gt.MulXV(r,i.GetVertex(c),he),f=n.GetSupport(Tt.MulTRV(o.q,a,Mt.s_t0)),d=Gt.MulXV(o,n.GetVertex(f),me),v=Mt.SubVV(_,d,ce),y=lt(g,s-g),x=.5*p,b=20,S=0;S<b&&ot(v.Length()-y)>x;){t.iterations+=1,c=i.GetSupport(Tt.MulTRV(r.q,Mt.NegV(v,Mt.s_t1),Mt.s_t0)),_=Gt.MulXV(r,i.GetVertex(c),he),f=n.GetSupport(Tt.MulTRV(o.q,v,Mt.s_t0)),d=Gt.MulXV(o,n.GetVertex(f),me);var B=Mt.SubVV(_,d,_e);v.Normalize();var w=Mt.DotVV(v,B),A=Mt.DotVV(v,a);if(w-y>u*A){if(A<=0)return!1;if((u=(w-y)/A)>1)return!1;l.Copy(v).SelfNeg(),h.m_count=0}var C=m[h.m_count];switch(C.indexA=f,C.wA.Copy(d).SelfMulAdd(u,a),C.indexB=c,C.wB.Copy(_),C.w.Copy(C.wB).SelfSub(C.wA),C.a=1,h.m_count+=1,h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3()}if(3===h.m_count)return!1;h.GetClosestPoint(v),++S}var M=fe,V=de;return h.GetWitnessPoints(M,V),v.LengthSquared()>0&&(l.Copy(v).SelfNeg(),l.Normalize()),t.normal.Copy(l),t.lambda=u,t.iterations=S,!0}(ae=t.b2ContactFeatureType||(t.b2ContactFeatureType={}))[ae.e_vertex=0]="e_vertex",ae[ae.e_face=1]="e_face";var ye,pe=function(){function t(){a(this,t),this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}return l(t,[{key:"key",get:function(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255}},{key:"indexA",get:function(){return this._indexA},set:function(t){this._indexA=t,this._key_invalid=!0}},{key:"indexB",get:function(){return this._indexB},set:function(t){this._indexB=t,this._key_invalid=!0}},{key:"typeA",get:function(){return this._typeA},set:function(t){this._typeA=t,this._key_invalid=!0}},{key:"typeB",get:function(){return this._typeB},set:function(t){this._typeB=t,this._key_invalid=!0}}]),t}(),xe=function(){function t(){a(this,t),this.cf=new pe}return l(t,[{key:"Copy",value:function(t){return this.key=t.key,this}},{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"key",get:function(){return this.cf.key},set:function(t){this.cf.key=t}}]),t}(),ge=function(){function t(){a(this,t),this.localPoint=new Mt,this.normalImpulse=0,this.tangentImpulse=0,this.id=new xe}return l(t,[{key:"Reset",value:function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0}},{key:"Copy",value:function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}();(ye=t.b2ManifoldType||(t.b2ManifoldType={}))[ye.e_unknown=-1]="e_unknown",ye[ye.e_circles=0]="e_circles",ye[ye.e_faceA=1]="e_faceA",ye[ye.e_faceB=2]="e_faceB";var be,Se=function(){function e(){a(this,e),this.points=ge.MakeArray(f),this.localNormal=new Mt,this.localPoint=new Mt,this.type=t.b2ManifoldType.e_unknown,this.pointCount=0}return l(e,[{key:"Reset",value:function(){for(var e=0;e<f;++e)this.points[e].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=t.b2ManifoldType.e_unknown,this.pointCount=0}},{key:"Copy",value:function(t){this.pointCount=t.pointCount;for(var e=0;e<f;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this}},{key:"Clone",value:function(){return(new e).Copy(this)}}]),e}(),Be=function(){function e(){a(this,e),this.normal=new Mt,this.points=Mt.MakeArray(f),this.separations=it(f)}return l(e,[{key:"Initialize",value:function(i,n,s,r,o){if(0!==i.pointCount)switch(i.type){case t.b2ManifoldType.e_circles:this.normal.Set(1,0);var a=Gt.MulXV(n,i.localPoint,e.Initialize_s_pointA),l=Gt.MulXV(r,i.points[0].localPoint,e.Initialize_s_pointB);Mt.DistanceSquaredVV(a,l)>c&&Mt.SubVV(l,a,this.normal).SelfNormalize();var u=Mt.AddVMulSV(a,s,this.normal,e.Initialize_s_cA),h=Mt.SubVMulSV(l,o,this.normal,e.Initialize_s_cB);Mt.MidVV(u,h,this.points[0]),this.separations[0]=Mt.DotVV(Mt.SubVV(h,u,Mt.s_t0),this.normal);break;case t.b2ManifoldType.e_faceA:Tt.MulRV(n.q,i.localNormal,this.normal);for(var m=Gt.MulXV(n,i.localPoint,e.Initialize_s_planePoint),_=0;_<i.pointCount;++_){var f=Gt.MulXV(r,i.points[_].localPoint,e.Initialize_s_clipPoint),d=s-Mt.DotVV(Mt.SubVV(f,m,Mt.s_t0),this.normal),v=Mt.AddVMulSV(f,d,this.normal,e.Initialize_s_cA),y=Mt.SubVMulSV(f,o,this.normal,e.Initialize_s_cB);Mt.MidVV(v,y,this.points[_]),this.separations[_]=Mt.DotVV(Mt.SubVV(y,v,Mt.s_t0),this.normal)}break;case t.b2ManifoldType.e_faceB:Tt.MulRV(r.q,i.localNormal,this.normal);for(var p=Gt.MulXV(r,i.localPoint,e.Initialize_s_planePoint),x=0;x<i.pointCount;++x){var g=Gt.MulXV(n,i.points[x].localPoint,e.Initialize_s_clipPoint),b=o-Mt.DotVV(Mt.SubVV(g,p,Mt.s_t0),this.normal),S=Mt.AddVMulSV(g,b,this.normal,e.Initialize_s_cB),B=Mt.SubVMulSV(g,s,this.normal,e.Initialize_s_cA);Mt.MidVV(B,S,this.points[x]),this.separations[x]=Mt.DotVV(Mt.SubVV(B,S,Mt.s_t0),this.normal)}this.normal.SelfNeg()}}}]),e}();function we(e,i,n,s){var r;for(r=0;r<n.pointCount;++r){var o=n.points[r].id.key;e[r]=t.b2PointState.b2_removeState;for(var a=0,l=s.pointCount;a<l;++a)if(s.points[a].id.key===o){e[r]=t.b2PointState.b2_persistState;break}}for(;r<f;++r)e[r]=t.b2PointState.b2_nullState;for(r=0;r<s.pointCount;++r){var u=s.points[r].id.key;i[r]=t.b2PointState.b2_addState;for(var h=0,m=n.pointCount;h<m;++h)if(n.points[h].id.key===u){i[r]=t.b2PointState.b2_persistState;break}}for(;r<f;++r)i[r]=t.b2PointState.b2_nullState}Be.Initialize_s_pointA=new Mt,Be.Initialize_s_pointB=new Mt,Be.Initialize_s_cA=new Mt,Be.Initialize_s_cB=new Mt,Be.Initialize_s_planePoint=new Mt,Be.Initialize_s_clipPoint=new Mt,(be=t.b2PointState||(t.b2PointState={}))[be.b2_nullState=0]="b2_nullState",be[be.b2_addState=1]="b2_addState",be[be.b2_persistState=2]="b2_persistState",be[be.b2_removeState=3]="b2_removeState";var Ae=function(){function t(){a(this,t),this.v=new Mt,this.id=new xe}return l(t,[{key:"Copy",value:function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this}}],[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),Ce=function(){function t(){a(this,t),this.p1=new Mt,this.p2=new Mt,this.maxFraction=1}return l(t,[{key:"Copy",value:function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this}}]),t}(),Me=function(){function t(){a(this,t),this.normal=new Mt,this.fraction=0}return l(t,[{key:"Copy",value:function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this}}]),t}(),Ve=function(){function t(){a(this,t),this.lowerBound=new Mt,this.upperBound=new Mt,this.m_cache_center=new Mt,this.m_cache_extent=new Mt}return l(t,[{key:"Copy",value:function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this}},{key:"IsValid",value:function(){var t=this.upperBound.x-this.lowerBound.x,e=this.upperBound.y-this.lowerBound.y,i=t>=0&&e>=0;return i=i&&this.lowerBound.IsValid()&&this.upperBound.IsValid()}},{key:"GetCenter",value:function(){return Mt.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)}},{key:"GetExtents",value:function(){return Mt.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)}},{key:"GetPerimeter",value:function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))}},{key:"Combine1",value:function(t){return this.lowerBound.x=at(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=at(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=lt(this.upperBound.x,t.upperBound.x),this.upperBound.y=lt(this.upperBound.y,t.upperBound.y),this}},{key:"Combine2",value:function(t,e){return this.lowerBound.x=at(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=at(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=lt(t.upperBound.x,e.upperBound.x),this.upperBound.y=lt(t.upperBound.y,e.upperBound.y),this}},{key:"Contains",value:function(t){var e=!0;return e=(e=(e=(e=e&&this.lowerBound.x<=t.lowerBound.x)&&this.lowerBound.y<=t.lowerBound.y)&&t.upperBound.x<=this.upperBound.x)&&t.upperBound.y<=this.upperBound.y}},{key:"RayCast",value:function(t,e){var i=-h,n=h,s=e.p1.x,r=e.p1.y,o=e.p2.x-e.p1.x,a=e.p2.y-e.p1.y,l=ot(o),u=ot(a),c=t.normal;if(l<m){if(s<this.lowerBound.x||this.upperBound.x<s)return!1}else{var _=1/o,f=(this.lowerBound.x-s)*_,d=(this.upperBound.x-s)*_,v=-1;if(f>d){var y=f;f=d,d=y,v=1}if(f>i&&(c.x=v,c.y=0,i=f),i>(n=at(n,d)))return!1}if(u<m){if(r<this.lowerBound.y||this.upperBound.y<r)return!1}else{var p=1/a,x=(this.lowerBound.y-r)*p,g=(this.upperBound.y-r)*p,b=-1;if(x>g){var S=x;x=g,g=S,b=1}if(x>i&&(c.x=0,c.y=b,i=x),i>(n=at(n,g)))return!1}return!(i<0||e.maxFraction<i)&&(t.fraction=i,!0)}},{key:"TestContain",value:function(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x)&&!(t.y<this.lowerBound.y||this.upperBound.y<t.y)}},{key:"TestOverlap",value:function(t){var e=t.lowerBound.x-this.upperBound.x,i=t.lowerBound.y-this.upperBound.y,n=this.lowerBound.x-t.upperBound.x,s=this.lowerBound.y-t.upperBound.y;return!(e>0||i>0)&&!(n>0||s>0)}}],[{key:"Combine",value:function(t,e,i){return i.Combine2(t,e),i}}]),t}();function ke(t,e){var i=e.lowerBound.x-t.upperBound.x,n=e.lowerBound.y-t.upperBound.y,s=t.lowerBound.x-e.upperBound.x,r=t.lowerBound.y-e.upperBound.y;return!(i>0||n>0)&&!(s>0||r>0)}function Pe(e,i,n,s,r){var o=0,a=i[0],l=i[1],u=Mt.DotVV(n,a.v)-s,h=Mt.DotVV(n,l.v)-s;if(u<=0&&e[o++].Copy(a),h<=0&&e[o++].Copy(l),u*h<0){var m=u/(u-h),c=e[o].v;c.x=a.v.x+m*(l.v.x-a.v.x),c.y=a.v.y+m*(l.v.y-a.v.y);var _=e[o].id;_.cf.indexA=r,_.cf.indexB=a.id.cf.indexB,_.cf.typeA=t.b2ContactFeatureType.e_vertex,_.cf.typeB=t.b2ContactFeatureType.e_face,++o}return o}var Ie=new Jt,Te=new Xt,Ge=new Wt;function Le(t,e,i,n,s,r){var o=Ie.Reset();o.proxyA.SetShape(t,e),o.proxyB.SetShape(i,n),o.transformA.Copy(s),o.transformB.Copy(r),o.useRadii=!0;var a=Te.Reset();a.count=0;var l=Ge.Reset();return oe(l,a,o),l.distance<10*m}function De(t){if(null===t)throw new Error;return t}var Re=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;a(this,t),this.m_id=0,this.aabb=new Ve,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=e}return l(t,[{key:"IsLeaf",value:function(){return null===this.child1}}]),t}(),Fe=function(){function t(){a(this,t),this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0,this.m_stack=new zt(256)}return l(t,[{key:"Query",value:function(t,e){if(null!==this.m_root){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var n=i.Pop();if(n.aabb.TestOverlap(t))if(n.IsLeaf()){if(!e(n))return}else i.Push(De(n.child1)),i.Push(De(n.child2))}}}},{key:"QueryPoint",value:function(t,e){if(null!==this.m_root){var i=this.m_stack.Reset();for(i.Push(this.m_root);i.GetCount()>0;){var n=i.Pop();if(n.aabb.TestContain(t))if(n.IsLeaf()){if(!e(n))return}else i.Push(De(n.child1)),i.Push(De(n.child2))}}}},{key:"RayCast",value:function(e,i){if(null!==this.m_root){var n=e.p1,s=e.p2,r=Mt.SubVV(s,n,t.s_r);r.Normalize();var o=Mt.CrossOneV(r,t.s_v),a=Mt.AbsV(o,t.s_abs_v),l=e.maxFraction,u=t.s_segmentAABB,h=n.x+l*(s.x-n.x),m=n.y+l*(s.y-n.y);u.lowerBound.x=at(n.x,h),u.lowerBound.y=at(n.y,m),u.upperBound.x=lt(n.x,h),u.upperBound.y=lt(n.y,m);var c=this.m_stack.Reset();for(c.Push(this.m_root);c.GetCount()>0;){var _=c.Pop();if(ke(_.aabb,u)){var f=_.aabb.GetCenter(),d=_.aabb.GetExtents();if(!(ot(Mt.DotVV(o,Mt.SubVV(n,f,Mt.s_t0)))-Mt.DotVV(a,d)>0))if(_.IsLeaf()){var v=t.s_subInput;v.p1.Copy(e.p1),v.p2.Copy(e.p2),v.maxFraction=l;var y=i(v,_);if(0===y)return;y>0&&(l=y,h=n.x+l*(s.x-n.x),m=n.y+l*(s.y-n.y),u.lowerBound.x=at(n.x,h),u.lowerBound.y=at(n.y,m),u.upperBound.x=lt(n.x,h),u.upperBound.y=lt(n.y,m))}else c.Push(De(_.child1)),c.Push(De(_.child2))}}}}},{key:"AllocateNode",value:function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e.height=0,delete e.userData,e}return new Re(t.s_node_id++)}},{key:"FreeNode",value:function(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,delete t.userData,this.m_freeList=t}},{key:"CreateProxy",value:function(t,e){var i=this.AllocateNode(),n=v,s=v;return i.aabb.lowerBound.x=t.lowerBound.x-n,i.aabb.lowerBound.y=t.lowerBound.y-s,i.aabb.upperBound.x=t.upperBound.x+n,i.aabb.upperBound.y=t.upperBound.y+s,i.userData=e,i.height=0,this.InsertLeaf(i),i}},{key:"DestroyProxy",value:function(t){this.RemoveLeaf(t),this.FreeNode(t)}},{key:"MoveProxy",value:function(t,e,i){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var n=v+y*(i.x>0?i.x:-i.x),s=v+y*(i.y>0?i.y:-i.y);return t.aabb.lowerBound.x=e.lowerBound.x-n,t.aabb.lowerBound.y=e.lowerBound.y-s,t.aabb.upperBound.x=e.upperBound.x+n,t.aabb.upperBound.y=e.upperBound.y+s,this.InsertLeaf(t),!0}},{key:"InsertLeaf",value:function(e){if(++this.m_insertionCount,null===this.m_root)return this.m_root=e,void(this.m_root.parent=null);for(var i=e.aabb,n=this.m_root;!n.IsLeaf();){var s=De(n.child1),r=De(n.child2),o=n.aabb.GetPerimeter(),a=t.s_combinedAABB;a.Combine2(n.aabb,i);var l=a.GetPerimeter(),u=2*l,h=2*(l-o),m=void 0,c=t.s_aabb,_=void 0;s.IsLeaf()?(c.Combine2(i,s.aabb),m=c.GetPerimeter()+h):(c.Combine2(i,s.aabb),_=s.aabb.GetPerimeter(),m=c.GetPerimeter()-_+h);var f=void 0;if(r.IsLeaf()?(c.Combine2(i,r.aabb),f=c.GetPerimeter()+h):(c.Combine2(i,r.aabb),_=r.aabb.GetPerimeter(),f=c.GetPerimeter()-_+h),u<m&&u<f)break;n=m<f?s:r}var d=n,v=d.parent,y=this.AllocateNode();y.parent=v,delete y.userData,y.aabb.Combine2(i,d.aabb),y.height=d.height+1,v?(v.child1===d?v.child1=y:v.child2=y,y.child1=d,y.child2=e,d.parent=y,e.parent=y):(y.child1=d,y.child2=e,d.parent=y,e.parent=y,this.m_root=y);for(var p=e.parent;null!==p;){var x=De((p=this.Balance(p)).child1),g=De(p.child2);p.height=1+lt(x.height,g.height),p.aabb.Combine2(x.aabb,g.aabb),p=p.parent}}},{key:"RemoveLeaf",value:function(t){if(t!==this.m_root){var e,i=De(t.parent),n=i&&i.parent;if(e=i.child1===t?De(i.child2):De(i.child1),n){n.child1===i?n.child1=e:n.child2=e,e.parent=n,this.FreeNode(i);for(var s=n;s;){var r=De((s=this.Balance(s)).child1),o=De(s.child2);s.aabb.Combine2(r.aabb,o.aabb),s.height=1+lt(r.height,o.height),s=s.parent}}else this.m_root=e,e.parent=null,this.FreeNode(i)}else this.m_root=null}},{key:"Balance",value:function(t){if(t.IsLeaf()||t.height<2)return t;var e=De(t.child1),i=De(t.child2),n=i.height-e.height;if(n>1){var s=De(i.child1),r=De(i.child2);return i.child1=t,i.parent=t.parent,t.parent=i,null!==i.parent?i.parent.child1===t?i.parent.child1=i:i.parent.child2=i:this.m_root=i,s.height>r.height?(i.child2=s,t.child2=r,r.parent=t,t.aabb.Combine2(e.aabb,r.aabb),i.aabb.Combine2(t.aabb,s.aabb),t.height=1+lt(e.height,r.height),i.height=1+lt(t.height,s.height)):(i.child2=r,t.child2=s,s.parent=t,t.aabb.Combine2(e.aabb,s.aabb),i.aabb.Combine2(t.aabb,r.aabb),t.height=1+lt(e.height,s.height),i.height=1+lt(t.height,r.height)),i}if(n<-1){var o=De(e.child1),a=De(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,o.height>a.height?(e.child2=o,t.child1=a,a.parent=t,t.aabb.Combine2(i.aabb,a.aabb),e.aabb.Combine2(t.aabb,o.aabb),t.height=1+lt(i.height,a.height),e.height=1+lt(t.height,o.height)):(e.child2=a,t.child1=o,o.parent=t,t.aabb.Combine2(i.aabb,o.aabb),e.aabb.Combine2(t.aabb,a.aabb),t.height=1+lt(i.height,o.height),e.height=1+lt(t.height,a.height)),e}return t}},{key:"GetHeight",value:function(){return null===this.m_root?0:this.m_root.height}},{key:"GetAreaRatio",value:function(){if(null===this.m_root)return 0;var e=this.m_root.aabb.GetPerimeter();return t.GetAreaNode(this.m_root)/e}},{key:"ComputeHeightNode",value:function(t){if(!t||t.IsLeaf())return 0;var e=this.ComputeHeightNode(t.child1),i=this.ComputeHeightNode(t.child2);return 1+lt(e,i)}},{key:"ComputeHeight",value:function(){return this.ComputeHeightNode(this.m_root)}},{key:"ValidateStructure",value:function(t){if(null!==t){this.m_root;var e=t;if(!e.IsLeaf()){var i=De(e.child1),n=De(e.child2);this.ValidateStructure(i),this.ValidateStructure(n)}}}},{key:"ValidateMetrics",value:function(e){if(null!==e){var i=e;if(!i.IsLeaf()){var n=De(i.child1),s=De(i.child2);t.s_aabb.Combine2(n.aabb,s.aabb),this.ValidateMetrics(n),this.ValidateMetrics(s)}}}},{key:"Validate",value:function(){}},{key:"GetMaxBalance",value:function(){return t.GetMaxBalanceNode(this.m_root,0)}},{key:"RebuildBottomUp",value:function(){this.Validate()}},{key:"ShiftOrigin",value:function(e){t.ShiftOriginNode(this.m_root,e)}}],[{key:"GetAreaNode",value:function(e){if(null===e)return 0;if(e.IsLeaf())return 0;var i=e.aabb.GetPerimeter();return i+=t.GetAreaNode(e.child1),i+=t.GetAreaNode(e.child2)}},{key:"GetMaxBalanceNode",value:function(t,e){if(null===t)return e;if(t.height<=1)return e;var i=De(t.child1),n=De(t.child2),s=ot(n.height-i.height);return lt(e,s)}},{key:"ShiftOriginNode",value:function(e,i){if(null!==e&&!(e.height<=1)){var n=e.child1,s=e.child2;t.ShiftOriginNode(n,i),t.ShiftOriginNode(s,i),e.aabb.lowerBound.SelfSub(i),e.aabb.upperBound.SelfSub(i)}}}]),t}();Fe.s_r=new Mt,Fe.s_v=new Mt,Fe.s_abs_v=new Mt,Fe.s_segmentAABB=new Ve,Fe.s_subInput=new Ce,Fe.s_combinedAABB=new Ve,Fe.s_aabb=new Ve,Fe.s_node_id=0;var Ee=l((function t(e,i){a(this,t),this.proxyA=e,this.proxyB=i})),Oe=function(){function t(){a(this,t),this.m_tree=new Fe,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}return l(t,[{key:"CreateProxy",value:function(t,e){var i=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(i),i}},{key:"DestroyProxy",value:function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)}},{key:"MoveProxy",value:function(t,e,i){this.m_tree.MoveProxy(t,e,i)&&this.BufferMove(t)}},{key:"TouchProxy",value:function(t){this.BufferMove(t)}},{key:"GetProxyCount",value:function(){return this.m_proxyCount}},{key:"UpdatePairs",value:function(t){var e=this;this.m_pairCount=0;for(var i=function(t){var i=e.m_moveBuffer[t];if(null===i)return"continue";var n=i.aabb;e.m_tree.Query(n,(function(t){if(t.m_id===i.m_id)return!0;var n,s;if(t.m_id<i.m_id?(n=t,s=i):(n=i,s=t),e.m_pairCount===e.m_pairBuffer.length)e.m_pairBuffer[e.m_pairCount]=new Ee(n,s);else{var r=e.m_pairBuffer[e.m_pairCount];r.proxyA=n,r.proxyB=s}return++e.m_pairCount,!0}))},n=0;n<this.m_moveCount;++n)i(n);this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(ze);for(var s=0;s<this.m_pairCount;){var r=this.m_pairBuffer[s];for(t(r.proxyA.userData,r.proxyB.userData),++s;s<this.m_pairCount;){var o=this.m_pairBuffer[s];if(o.proxyA.m_id!==r.proxyA.m_id||o.proxyB.m_id!==r.proxyB.m_id)break;++s}}}},{key:"Query",value:function(t,e){this.m_tree.Query(t,e)}},{key:"QueryPoint",value:function(t,e){this.m_tree.QueryPoint(t,e)}},{key:"RayCast",value:function(t,e){this.m_tree.RayCast(t,e)}},{key:"GetTreeHeight",value:function(){return this.m_tree.GetHeight()}},{key:"GetTreeBalance",value:function(){return this.m_tree.GetMaxBalance()}},{key:"GetTreeQuality",value:function(){return this.m_tree.GetAreaRatio()}},{key:"ShiftOrigin",value:function(t){this.m_tree.ShiftOrigin(t)}},{key:"BufferMove",value:function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount}},{key:"UnBufferMove",value:function(t){var e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null}}]),t}();function ze(t,e){return t.proxyA.m_id===e.proxyA.m_id?t.proxyB.m_id-e.proxyB.m_id:t.proxyA.m_id-e.proxyA.m_id}function je(){t.b2_toiTime=0,t.b2_toiMaxTime=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0}t.b2_toiTime=0,t.b2_toiMaxTime=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0;var qe,Ne=new Gt,Xe=new Gt,Je=new Mt,We=new Mt,Ue=new Mt,He=new Mt,Ze=new Mt,Ye=l((function t(){a(this,t),this.proxyA=new Nt,this.proxyB=new Nt,this.sweepA=new Dt,this.sweepB=new Dt,this.tMax=0}));(qe=t.b2TOIOutputState||(t.b2TOIOutputState={}))[qe.e_unknown=0]="e_unknown",qe[qe.e_failed=1]="e_failed",qe[qe.e_overlapped=2]="e_overlapped",qe[qe.e_touching=3]="e_touching",qe[qe.e_separated=4]="e_separated";var Ke,Qe=l((function e(){a(this,e),this.state=t.b2TOIOutputState.e_unknown,this.t=0}));(Ke=t.b2SeparationFunctionType||(t.b2SeparationFunctionType={}))[Ke.e_unknown=-1]="e_unknown",Ke[Ke.e_points=0]="e_points",Ke[Ke.e_faceA=1]="e_faceA",Ke[Ke.e_faceB=2]="e_faceB";var $e=function(){function e(){a(this,e),this.m_sweepA=new Dt,this.m_sweepB=new Dt,this.m_type=t.b2SeparationFunctionType.e_unknown,this.m_localPoint=new Mt,this.m_axis=new Mt}return l(e,[{key:"Initialize",value:function(e,i,n,s,r,o){this.m_proxyA=i,this.m_proxyB=s;var a=e.count;this.m_sweepA.Copy(n),this.m_sweepB.Copy(r);var l=Ne,u=Xe;if(this.m_sweepA.GetTransform(l,o),this.m_sweepB.GetTransform(u,o),1===a){this.m_type=t.b2SeparationFunctionType.e_points;var h=this.m_proxyA.GetVertex(e.indexA[0]),m=this.m_proxyB.GetVertex(e.indexB[0]),c=Gt.MulXV(l,h,Je),_=Gt.MulXV(u,m,We);Mt.SubVV(_,c,this.m_axis);var f=this.m_axis.Normalize();return this.m_localPoint.SetZero(),f}if(e.indexA[0]===e.indexA[1]){this.m_type=t.b2SeparationFunctionType.e_faceB;var d=this.m_proxyB.GetVertex(e.indexB[0]),v=this.m_proxyB.GetVertex(e.indexB[1]);Mt.CrossVOne(Mt.SubVV(v,d,Mt.s_t0),this.m_axis).SelfNormalize();var y=Tt.MulRV(u.q,this.m_axis,Ue);Mt.MidVV(d,v,this.m_localPoint);var p=Gt.MulXV(u,this.m_localPoint,We),x=this.m_proxyA.GetVertex(e.indexA[0]),g=Gt.MulXV(l,x,Je),b=Mt.DotVV(Mt.SubVV(g,p,Mt.s_t0),y);return b<0&&(this.m_axis.SelfNeg(),b=-b),b}this.m_type=t.b2SeparationFunctionType.e_faceA;var S=this.m_proxyA.GetVertex(e.indexA[0]),B=this.m_proxyA.GetVertex(e.indexA[1]);Mt.CrossVOne(Mt.SubVV(B,S,Mt.s_t0),this.m_axis).SelfNormalize();var w=Tt.MulRV(l.q,this.m_axis,Ue);Mt.MidVV(S,B,this.m_localPoint);var A=Gt.MulXV(l,this.m_localPoint,Je),C=this.m_proxyB.GetVertex(e.indexB[0]),M=Gt.MulXV(u,C,We),V=Mt.DotVV(Mt.SubVV(M,A,Mt.s_t0),w);return V<0&&(this.m_axis.SelfNeg(),V=-V),V}},{key:"FindMinSeparation",value:function(e,i,n){var s=Ne,r=Xe;switch(this.m_sweepA.GetTransform(s,n),this.m_sweepB.GetTransform(r,n),this.m_type){case t.b2SeparationFunctionType.e_points:var o=Tt.MulTRV(s.q,this.m_axis,He),a=Tt.MulTRV(r.q,Mt.NegV(this.m_axis,Mt.s_t0),Ze);e[0]=this.m_proxyA.GetSupport(o),i[0]=this.m_proxyB.GetSupport(a);var l=this.m_proxyA.GetVertex(e[0]),u=this.m_proxyB.GetVertex(i[0]),h=Gt.MulXV(s,l,Je),m=Gt.MulXV(r,u,We);return Mt.DotVV(Mt.SubVV(m,h,Mt.s_t0),this.m_axis);case t.b2SeparationFunctionType.e_faceA:var c=Tt.MulRV(s.q,this.m_axis,Ue),_=Gt.MulXV(s,this.m_localPoint,Je),f=Tt.MulTRV(r.q,Mt.NegV(c,Mt.s_t0),Ze);e[0]=-1,i[0]=this.m_proxyB.GetSupport(f);var d=this.m_proxyB.GetVertex(i[0]),v=Gt.MulXV(r,d,We);return Mt.DotVV(Mt.SubVV(v,_,Mt.s_t0),c);case t.b2SeparationFunctionType.e_faceB:var y=Tt.MulRV(r.q,this.m_axis,Ue),p=Gt.MulXV(r,this.m_localPoint,We),x=Tt.MulTRV(s.q,Mt.NegV(y,Mt.s_t0),He);i[0]=-1,e[0]=this.m_proxyA.GetSupport(x);var g=this.m_proxyA.GetVertex(e[0]),b=Gt.MulXV(s,g,Je);return Mt.DotVV(Mt.SubVV(b,p,Mt.s_t0),y);default:return e[0]=-1,i[0]=-1,0}}},{key:"Evaluate",value:function(e,i,n){var s=Ne,r=Xe;switch(this.m_sweepA.GetTransform(s,n),this.m_sweepB.GetTransform(r,n),this.m_type){case t.b2SeparationFunctionType.e_points:var o=this.m_proxyA.GetVertex(e),a=this.m_proxyB.GetVertex(i),l=Gt.MulXV(s,o,Je),u=Gt.MulXV(r,a,We);return Mt.DotVV(Mt.SubVV(u,l,Mt.s_t0),this.m_axis);case t.b2SeparationFunctionType.e_faceA:var h=Tt.MulRV(s.q,this.m_axis,Ue),m=Gt.MulXV(s,this.m_localPoint,Je),c=this.m_proxyB.GetVertex(i),_=Gt.MulXV(r,c,We);return Mt.DotVV(Mt.SubVV(_,m,Mt.s_t0),h);case t.b2SeparationFunctionType.e_faceB:var f=Tt.MulRV(r.q,this.m_axis,Ue),d=Gt.MulXV(r,this.m_localPoint,We),v=this.m_proxyA.GetVertex(e),y=Gt.MulXV(s,v,Je);return Mt.DotVV(Mt.SubVV(y,d,Mt.s_t0),f);default:return 0}}}]),e}(),ti=new Et,ei=new Xt,ii=new Jt,ni=new Wt,si=new $e,ri=[0],oi=[0],ai=new Dt,li=new Dt;function ui(e,i){var n=ti.Reset();++t.b2_toiCalls,e.state=t.b2TOIOutputState.e_unknown,e.t=i.tMax;var s=i.proxyA,r=i.proxyB,o=lt(d,s.m_count,r.m_count),a=ai.Copy(i.sweepA),l=li.Copy(i.sweepB);a.Normalize(),l.Normalize();var u=i.tMax,h=s.m_radius+r.m_radius,m=lt(p,h-3*p),c=.25*p,_=0,f=20,v=0,y=ei;y.count=0;var x=ii;for(x.proxyA.Copy(i.proxyA),x.proxyB.Copy(i.proxyB),x.useRadii=!1;;){var g=Ne,b=Xe;a.GetTransform(g,_),l.GetTransform(b,_),x.transformA.Copy(g),x.transformB.Copy(b);var S=ni;if(oe(S,y,x),S.distance<=0){e.state=t.b2TOIOutputState.e_overlapped,e.t=0;break}if(S.distance<m+c){e.state=t.b2TOIOutputState.e_touching,e.t=_;break}var B=si;B.Initialize(y,s,a,r,l,_);for(var w=!1,A=u,C=0;;){var M=ri,V=oi,k=B.FindMinSeparation(M,V,A);if(k>m+c){e.state=t.b2TOIOutputState.e_separated,e.t=u,w=!0;break}if(k>m-c){_=A;break}var P=B.Evaluate(M[0],V[0],_);if(P<m-c){e.state=t.b2TOIOutputState.e_failed,e.t=_,w=!0;break}if(P<=m+c){e.state=t.b2TOIOutputState.e_touching,e.t=_,w=!0;break}for(var I=0,T=_,G=A;;){var L=0;L=1&I?T+(m-P)*(G-T)/(k-P):.5*(T+G),++I,++t.b2_toiRootIters;var D=B.Evaluate(M[0],V[0],L);if(ot(D-m)<c){A=L;break}if(D>m?(T=L,P=D):(G=L,k=D),50===I)break}if(t.b2_toiMaxRootIters=lt(t.b2_toiMaxRootIters,I),++C===o)break}if(++v,++t.b2_toiIters,w)break;if(v===f){e.state=t.b2TOIOutputState.e_failed,e.t=_;break}}t.b2_toiMaxIters=lt(t.b2_toiMaxIters,v);var R=n.GetMilliseconds();t.b2_toiMaxTime=lt(t.b2_toiMaxTime,R),t.b2_toiTime+=R}var hi=new Mt,mi=new Mt;function ci(e,i,n,s,r){e.pointCount=0;var o=Gt.MulXV(n,i.m_p,hi),a=Gt.MulXV(r,s.m_p,mi),l=Mt.DistanceSquaredVV(o,a),u=i.m_radius+s.m_radius;l>u*u||(e.type=t.b2ManifoldType.e_circles,e.localPoint.Copy(i.m_p),e.localNormal.SetZero(),e.pointCount=1,e.points[0].localPoint.Copy(s.m_p),e.points[0].id.key=0)}var _i=new Mt,fi=new Mt,di=new Mt;function vi(e,i,n,s,r){e.pointCount=0;for(var o=Gt.MulXV(r,s.m_p,_i),a=Gt.MulTXV(n,o,fi),l=0,u=-h,c=i.m_radius+s.m_radius,_=i.m_count,f=i.m_vertices,d=i.m_normals,v=0;v<_;++v){var y=Mt.DotVV(d[v],Mt.SubVV(a,f[v],Mt.s_t0));if(y>c)return;y>u&&(u=y,l=v)}var p=l,x=(p+1)%_,g=f[p],b=f[x];if(u<m)return e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(d[l]),Mt.MidVV(g,b,e.localPoint),e.points[0].localPoint.Copy(s.m_p),void(e.points[0].id.key=0);var S=Mt.DotVV(Mt.SubVV(a,g,Mt.s_t0),Mt.SubVV(b,g,Mt.s_t1)),B=Mt.DotVV(Mt.SubVV(a,b,Mt.s_t0),Mt.SubVV(g,b,Mt.s_t1));if(S<=0){if(Mt.DistanceSquaredVV(a,g)>c*c)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,Mt.SubVV(a,g,e.localNormal).SelfNormalize(),e.localPoint.Copy(g),e.points[0].localPoint.Copy(s.m_p),e.points[0].id.key=0}else if(B<=0){if(Mt.DistanceSquaredVV(a,b)>c*c)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,Mt.SubVV(a,b,e.localNormal).SelfNormalize(),e.localPoint.Copy(b),e.points[0].localPoint.Copy(s.m_p),e.points[0].id.key=0}else{var w=Mt.MidVV(g,b,di);if(Mt.DotVV(Mt.SubVV(a,w,Mt.s_t1),d[p])>c)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(d[p]).SelfNormalize(),e.localPoint.Copy(w),e.points[0].localPoint.Copy(s.m_p),e.points[0].id.key=0}}var yi=new Mt,pi=new Mt,xi=new Mt,gi=new Mt;function bi(t,e,i,n,s){for(var r=t.m_vertices,o=t.m_normals,a=n.m_count,l=n.m_vertices,u=Tt.MulRV(e.q,o[i],yi),m=Tt.MulTRV(s.q,u,pi),c=0,_=h,f=0;f<a;++f){var d=Mt.DotVV(l[f],m);d<_&&(_=d,c=f)}var v=Gt.MulXV(e,r[i],xi),y=Gt.MulXV(s,l[c],gi);return Mt.DotVV(Mt.SubVV(y,v,Mt.s_t0),u)}var Si=new Mt,Bi=new Mt;function wi(t,e,i,n,s){for(var r=e.m_count,o=e.m_normals,a=Mt.SubVV(Gt.MulXV(s,n.m_centroid,Mt.s_t0),Gt.MulXV(i,e.m_centroid,Mt.s_t1),Si),l=Tt.MulTRV(i.q,a,Bi),u=0,m=-h,c=0;c<r;++c){var _=Mt.DotVV(o[c],l);_>m&&(m=_,u=c)}var f=bi(e,i,u,n,s),d=(u+r-1)%r,v=bi(e,i,d,n,s),y=(u+1)%r,p=bi(e,i,y,n,s),x=0,g=0,b=0;if(v>f&&v>p)b=-1,x=d,g=v;else{if(!(p>f))return t[0]=u,f;b=1,x=y,g=p}for(;(f=bi(e,i,u=-1===b?(x+r-1)%r:(x+1)%r,n,s))>g;)x=u,g=f;return t[0]=x,g}var Ai=new Mt;function Ci(e,i,n,s,r,o){for(var a=i.m_normals,l=r.m_count,u=r.m_vertices,m=r.m_normals,c=Tt.MulTRV(o.q,Tt.MulRV(n.q,a[s],Mt.s_t0),Ai),_=0,f=h,d=0;d<l;++d){var v=Mt.DotVV(c,m[d]);v<f&&(f=v,_=d)}var y=_,p=(y+1)%l,x=e[0];Gt.MulXV(o,u[y],x.v);var g=x.id.cf;g.indexA=s,g.indexB=y,g.typeA=t.b2ContactFeatureType.e_face,g.typeB=t.b2ContactFeatureType.e_vertex;var b=e[1];Gt.MulXV(o,u[p],b.v);var S=b.id.cf;S.indexA=s,S.indexB=p,S.typeA=t.b2ContactFeatureType.e_face,S.typeB=t.b2ContactFeatureType.e_vertex}var Mi=Ae.MakeArray(2),Vi=Ae.MakeArray(2),ki=Ae.MakeArray(2),Pi=[0],Ii=[0],Ti=new Mt,Gi=new Mt,Li=new Mt,Di=new Mt,Ri=new Mt,Fi=new Mt,Ei=new Mt,Oi=new Mt;function zi(e,i,n,s,r){e.pointCount=0;var o=i.m_radius+s.m_radius,a=Pi;a[0]=0;var l=wi(a,i,n,s,r);if(!(l>o)){var u=Ii;u[0]=0;var h=wi(u,s,r,i,n);if(!(h>o)){var m,c,_,d,v=0,y=0;h>.98*l+.001?(m=s,c=i,_=r,d=n,v=u[0],e.type=t.b2ManifoldType.e_faceB,y=1):(m=i,c=s,_=n,d=r,v=a[0],e.type=t.b2ManifoldType.e_faceA,y=0);var p=Mi;Ci(p,m,_,v,c,d);var x=m.m_count,g=m.m_vertices,b=v,S=(v+1)%x,B=g[b],w=g[S],A=Mt.SubVV(w,B,Ti);A.Normalize();var C=Mt.CrossVOne(A,Gi),M=Mt.MidVV(B,w,Li),V=Tt.MulRV(_.q,A,Ri),k=Mt.CrossVOne(V,Di),P=Gt.MulXV(_,B,Ei),I=Gt.MulXV(_,w,Oi),T=Mt.DotVV(k,P),G=-Mt.DotVV(V,P)+o,L=Mt.DotVV(V,I)+o,D=Vi,R=ki;if(!(Pe(D,p,Mt.NegV(V,Fi),G,b)<2)&&!(Pe(R,D,V,L,S)<2)){e.localNormal.Copy(C),e.localPoint.Copy(M);for(var F=0,E=0;E<f;++E){var O=R[E];if(Mt.DotVV(k,O.v)-T<=o){var z=e.points[F];if(Gt.MulTXV(d,O.v,z.localPoint),z.id.Copy(O.id),y){var j=z.id.cf;z.id.cf.indexA=j.indexB,z.id.cf.indexB=j.indexA,z.id.cf.typeA=j.typeB,z.id.cf.typeB=j.typeA}++F}}e.pointCount=F}}}}var ji=new Mt,qi=new Mt,Ni=new Mt,Xi=new Mt,Ji=new Mt,Wi=new Mt,Ui=new Mt,Hi=new xe;function Zi(e,i,n,s,r){e.pointCount=0;var o=Gt.MulTXV(n,Gt.MulXV(r,s.m_p,Mt.s_t0),ji),a=i.m_vertex1,l=i.m_vertex2,u=Mt.SubVV(l,a,qi),h=Mt.DotVV(u,Mt.SubVV(l,o,Mt.s_t0)),m=Mt.DotVV(u,Mt.SubVV(o,a,Mt.s_t0)),c=i.m_radius+s.m_radius,_=Hi;if(_.cf.indexB=0,_.cf.typeB=t.b2ContactFeatureType.e_vertex,m<=0){var f=a,d=Mt.SubVV(o,f,Ni);if(Mt.DotVV(d,d)>c*c)return;if(i.m_hasVertex0){var v=i.m_vertex0,y=a,p=Mt.SubVV(y,v,Xi);if(Mt.DotVV(p,Mt.SubVV(y,o,Mt.s_t0))>0)return}return _.cf.indexA=0,_.cf.typeA=t.b2ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.b2ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(f),e.points[0].id.Copy(_),void e.points[0].localPoint.Copy(s.m_p)}if(h<=0){var x=l,g=Mt.SubVV(o,x,Ni);if(Mt.DotVV(g,g)>c*c)return;if(i.m_hasVertex3){var b=i.m_vertex3,S=l,B=Mt.SubVV(b,S,Ji);if(Mt.DotVV(B,Mt.SubVV(o,S,Mt.s_t0))>0)return}return _.cf.indexA=1,_.cf.typeA=t.b2ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.b2ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(x),e.points[0].id.Copy(_),void e.points[0].localPoint.Copy(s.m_p)}var w=Mt.DotVV(u,u),A=Wi;A.x=1/w*(h*a.x+m*l.x),A.y=1/w*(h*a.y+m*l.y);var C=Mt.SubVV(o,A,Ni);if(!(Mt.DotVV(C,C)>c*c)){var M=Ui.Set(-u.y,u.x);Mt.DotVV(M,Mt.SubVV(o,a,Mt.s_t0))<0&&M.Set(-M.x,-M.y),M.Normalize(),_.cf.indexA=0,_.cf.typeA=t.b2ContactFeatureType.e_face,e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(M),e.localPoint.Copy(a),e.points[0].id.Copy(_),e.points[0].localPoint.Copy(s.m_p)}}var Yi=l((function t(){a(this,t),this.type=0,this.index=0,this.separation=0})),Ki=l((function t(){a(this,t),this.vertices=[],this.normals=[],this.count=0})),Qi=l((function t(){a(this,t),this.i1=0,this.i2=0,this.v1=new Mt,this.v2=new Mt,this.normal=new Mt,this.sideNormal1=new Mt,this.sideOffset1=0,this.sideNormal2=new Mt,this.sideOffset2=0})),$i=function(){function e(){a(this,e),this.m_polygonB=new Ki,this.m_xf=new Gt,this.m_centroidB=new Mt,this.m_v0=new Mt,this.m_v1=new Mt,this.m_v2=new Mt,this.m_v3=new Mt,this.m_normal0=new Mt,this.m_normal1=new Mt,this.m_normal2=new Mt,this.m_normal=new Mt,this.m_type1=0,this.m_type2=0,this.m_lowerLimit=new Mt,this.m_upperLimit=new Mt,this.m_radius=0,this.m_front=!1}return l(e,[{key:"Collide",value:function(i,n,s,r,o){Gt.MulTXX(s,o,this.m_xf),Gt.MulXV(this.m_xf,r.m_centroid,this.m_centroidB),this.m_v0.Copy(n.m_vertex0),this.m_v1.Copy(n.m_vertex1),this.m_v2.Copy(n.m_vertex2),this.m_v3.Copy(n.m_vertex3);var a=n.m_hasVertex0,l=n.m_hasVertex3,u=Mt.SubVV(this.m_v2,this.m_v1,e.s_edge1);u.Normalize(),this.m_normal1.Set(u.y,-u.x);var h=Mt.DotVV(this.m_normal1,Mt.SubVV(this.m_centroidB,this.m_v1,Mt.s_t0)),m=0,c=0,_=!1,d=!1;if(a){var v=Mt.SubVV(this.m_v1,this.m_v0,e.s_edge0);v.Normalize(),this.m_normal0.Set(v.y,-v.x),_=Mt.CrossVV(v,u)>=0,m=Mt.DotVV(this.m_normal0,Mt.SubVV(this.m_centroidB,this.m_v0,Mt.s_t0))}if(l){var y=Mt.SubVV(this.m_v3,this.m_v2,e.s_edge2);y.Normalize(),this.m_normal2.Set(y.y,-y.x),d=Mt.CrossVV(u,y)>0,c=Mt.DotVV(this.m_normal2,Mt.SubVV(this.m_centroidB,this.m_v2,Mt.s_t0))}a&&l?_&&d?(this.m_front=m>=0||h>=0||c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):_?(this.m_front=m>=0||h>=0&&c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):d?(this.m_front=c>=0||m>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=m>=0&&h>=0&&c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):a?_?(this.m_front=m>=0||h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=m>=0&&h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):l?d?(this.m_front=h>=0||c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=h>=0&&c>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=h>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=r.m_count;for(var p=0;p<r.m_count;++p)this.m_polygonB.vertices.length<=p&&this.m_polygonB.vertices.push(new Mt),this.m_polygonB.normals.length<=p&&this.m_polygonB.normals.push(new Mt),Gt.MulXV(this.m_xf,r.m_vertices[p],this.m_polygonB.vertices[p]),Tt.MulRV(this.m_xf.q,r.m_normals[p],this.m_polygonB.normals[p]);this.m_radius=r.m_radius+n.m_radius,i.pointCount=0;var x=this.ComputeEdgeSeparation(e.s_edgeAxis);if(0!==x.type&&!(x.separation>this.m_radius)){var g=this.ComputePolygonSeparation(e.s_polygonAxis);if(!(0!==g.type&&g.separation>this.m_radius)){var b,S=.98,B=.001;b=0===g.type?x:g.separation>S*x.separation+B?g:x;var w=e.s_ie,A=e.s_rf;if(1===b.type){i.type=t.b2ManifoldType.e_faceA;for(var C=0,M=Mt.DotVV(this.m_normal,this.m_polygonB.normals[0]),V=1;V<this.m_polygonB.count;++V){var k=Mt.DotVV(this.m_normal,this.m_polygonB.normals[V]);k<M&&(M=k,C=V)}var P=C,I=(P+1)%this.m_polygonB.count,T=w[0];T.v.Copy(this.m_polygonB.vertices[P]),T.id.cf.indexA=0,T.id.cf.indexB=P,T.id.cf.typeA=t.b2ContactFeatureType.e_face,T.id.cf.typeB=t.b2ContactFeatureType.e_vertex;var G=w[1];G.v.Copy(this.m_polygonB.vertices[I]),G.id.cf.indexA=0,G.id.cf.indexB=I,G.id.cf.typeA=t.b2ContactFeatureType.e_face,G.id.cf.typeB=t.b2ContactFeatureType.e_vertex,this.m_front?(A.i1=0,A.i2=1,A.v1.Copy(this.m_v1),A.v2.Copy(this.m_v2),A.normal.Copy(this.m_normal1)):(A.i1=1,A.i2=0,A.v1.Copy(this.m_v2),A.v2.Copy(this.m_v1),A.normal.Copy(this.m_normal1).SelfNeg())}else{i.type=t.b2ManifoldType.e_faceB;var L=w[0];L.v.Copy(this.m_v1),L.id.cf.indexA=0,L.id.cf.indexB=b.index,L.id.cf.typeA=t.b2ContactFeatureType.e_vertex,L.id.cf.typeB=t.b2ContactFeatureType.e_face;var D=w[1];D.v.Copy(this.m_v2),D.id.cf.indexA=0,D.id.cf.indexB=b.index,D.id.cf.typeA=t.b2ContactFeatureType.e_vertex,D.id.cf.typeB=t.b2ContactFeatureType.e_face,A.i1=b.index,A.i2=(A.i1+1)%this.m_polygonB.count,A.v1.Copy(this.m_polygonB.vertices[A.i1]),A.v2.Copy(this.m_polygonB.vertices[A.i2]),A.normal.Copy(this.m_polygonB.normals[A.i1])}A.sideNormal1.Set(A.normal.y,-A.normal.x),A.sideNormal2.Copy(A.sideNormal1).SelfNeg(),A.sideOffset1=Mt.DotVV(A.sideNormal1,A.v1),A.sideOffset2=Mt.DotVV(A.sideNormal2,A.v2);var R=e.s_clipPoints1,F=e.s_clipPoints2;if(!(Pe(R,w,A.sideNormal1,A.sideOffset1,A.i1)<f)&&!(Pe(F,R,A.sideNormal2,A.sideOffset2,A.i2)<f)){1===b.type?(i.localNormal.Copy(A.normal),i.localPoint.Copy(A.v1)):(i.localNormal.Copy(r.m_normals[A.i1]),i.localPoint.Copy(r.m_vertices[A.i1]));for(var E=0,O=0;O<f;++O)if(Mt.DotVV(A.normal,Mt.SubVV(F[O].v,A.v1,Mt.s_t0))<=this.m_radius){var z=i.points[E];1===b.type?(Gt.MulTXV(this.m_xf,F[O].v,z.localPoint),z.id=F[O].id):(z.localPoint.Copy(F[O].v),z.id.cf.typeA=F[O].id.cf.typeB,z.id.cf.typeB=F[O].id.cf.typeA,z.id.cf.indexA=F[O].id.cf.indexB,z.id.cf.indexB=F[O].id.cf.indexA),++E}i.pointCount=E}}}}},{key:"ComputeEdgeSeparation",value:function(t){var e=t;e.type=1,e.index=this.m_front?0:1,e.separation=h;for(var i=0;i<this.m_polygonB.count;++i){var n=Mt.DotVV(this.m_normal,Mt.SubVV(this.m_polygonB.vertices[i],this.m_v1,Mt.s_t0));n<e.separation&&(e.separation=n)}return e}},{key:"ComputePolygonSeparation",value:function(t){var i=t;i.type=0,i.index=-1,i.separation=-h;for(var n=e.s_perp.Set(-this.m_normal.y,this.m_normal.x),s=0;s<this.m_polygonB.count;++s){var r=Mt.NegV(this.m_polygonB.normals[s],e.s_n),o=Mt.DotVV(r,Mt.SubVV(this.m_polygonB.vertices[s],this.m_v1,Mt.s_t0)),a=Mt.DotVV(r,Mt.SubVV(this.m_polygonB.vertices[s],this.m_v2,Mt.s_t0)),l=at(o,a);if(l>this.m_radius)return i.type=2,i.index=s,i.separation=l,i;if(Mt.DotVV(r,n)>=0){if(Mt.DotVV(Mt.SubVV(r,this.m_upperLimit,Mt.s_t0),this.m_normal)<-x)continue}else if(Mt.DotVV(Mt.SubVV(r,this.m_lowerLimit,Mt.s_t0),this.m_normal)<-x)continue;l>i.separation&&(i.type=2,i.index=s,i.separation=l)}return i}}]),e}();$i.s_edge1=new Mt,$i.s_edge0=new Mt,$i.s_edge2=new Mt,$i.s_ie=Ae.MakeArray(2),$i.s_rf=new Qi,$i.s_clipPoints1=Ae.MakeArray(2),$i.s_clipPoints2=Ae.MakeArray(2),$i.s_edgeAxis=new Yi,$i.s_polygonAxis=new Yi,$i.s_n=new Mt,$i.s_perp=new Mt;var tn=new $i;function en(t,e,i,n,s){tn.Collide(t,e,i,n,s)}var nn,sn=l((function t(){a(this,t),this.mass=0,this.center=new Mt(0,0),this.I=0}));(nn=t.b2ShapeType||(t.b2ShapeType={}))[nn.e_unknown=-1]="e_unknown",nn[nn.e_circleShape=0]="e_circleShape",nn[nn.e_edgeShape=1]="e_edgeShape",nn[nn.e_polygonShape=2]="e_polygonShape",nn[nn.e_chainShape=3]="e_chainShape",nn[nn.e_shapeTypeCount=4]="e_shapeTypeCount";var rn=function(){function e(i,n){a(this,e),this.m_type=t.b2ShapeType.e_unknown,this.m_radius=0,this.m_type=i,this.m_radius=n}return l(e,[{key:"Copy",value:function(t){return this.m_radius=t.m_radius,this}},{key:"GetType",value:function(){return this.m_type}}]),e}(),on=function(e){r(u,e);var i=o(u);function u(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return a(this,u),(e=i.call(this,t.b2ShapeType.e_circleShape,n)).m_p=new Mt,e}return l(u,[{key:"Set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.m_radius;return this.m_p.Copy(t),this.m_radius=e,this}},{key:"Clone",value:function(){return(new u).Copy(this)}},{key:"Copy",value:function(t){return n(s(u.prototype),"Copy",this).call(this,t),this.m_p.Copy(t.m_p),this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){var i=Gt.MulXV(t,this.m_p,u.TestPoint_s_center),n=Mt.SubVV(e,i,u.TestPoint_s_d);return Mt.DotVV(n,n)<=ct(this.m_radius)}},{key:"ComputeDistance",value:function(t,e,i,n){var s=Gt.MulXV(t,this.m_p,u.ComputeDistance_s_center);return Mt.SubVV(e,s,i),i.Normalize()-this.m_radius}},{key:"RayCast",value:function(t,e,i,n){var s=Gt.MulXV(i,this.m_p,u.RayCast_s_position),r=Mt.SubVV(e.p1,s,u.RayCast_s_s),o=Mt.DotVV(r,r)-ct(this.m_radius),a=Mt.SubVV(e.p2,e.p1,u.RayCast_s_r),l=Mt.DotVV(r,a),h=Mt.DotVV(a,a),c=l*l-h*o;if(c<0||h<m)return!1;var _=-(l+ft(c));return 0<=_&&_<=e.maxFraction*h&&(_/=h,t.fraction=_,Mt.AddVMulSV(r,_,a,t.normal).SelfNormalize(),!0)}},{key:"ComputeAABB",value:function(t,e,i){var n=Gt.MulXV(e,this.m_p,u.ComputeAABB_s_p);t.lowerBound.Set(n.x-this.m_radius,n.y-this.m_radius),t.upperBound.Set(n.x+this.m_radius,n.y+this.m_radius)}},{key:"ComputeMass",value:function(t,e){var i=ct(this.m_radius);t.mass=e*_*i,t.center.Copy(this.m_p),t.I=t.mass*(.5*i+Mt.DotVV(this.m_p,this.m_p))}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){var s=Gt.MulXV(i,this.m_p,new Mt),r=-(Mt.DotVV(t,s)-e);if(r<-this.m_radius+m)return 0;if(r>this.m_radius)return n.Copy(s),_*this.m_radius*this.m_radius;var o=this.m_radius*this.m_radius,a=r*r,l=o*(bt(r/this.m_radius)+_/2)+r*ft(o-a),u=-2/3*dt(o-a,1.5)/l;return n.x=s.x+t.x*u,n.y=s.y+t.y*u,l}},{key:"Dump",value:function(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)}}]),u}(rn);on.TestPoint_s_center=new Mt,on.TestPoint_s_d=new Mt,on.ComputeDistance_s_center=new Mt,on.RayCast_s_position=new Mt,on.RayCast_s_s=new Mt,on.RayCast_s_r=new Mt,on.ComputeAABB_s_p=new Mt;var an=function(e){r(u,e);var i=o(u);function u(){var e;return a(this,u),(e=i.call(this,t.b2ShapeType.e_polygonShape,g)).m_centroid=new Mt(0,0),e.m_vertices=[],e.m_normals=[],e.m_count=0,e}return l(u,[{key:"Clone",value:function(){return(new u).Copy(this)}},{key:"Copy",value:function(t){n(s(u.prototype),"Copy",this).call(this,t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=Mt.MakeArray(this.m_count),this.m_normals=Mt.MakeArray(this.m_count);for(var e=0;e<this.m_count;++e)this.m_vertices[e].Copy(t.m_vertices[e]),this.m_normals[e].Copy(t.m_normals[e]);return this}},{key:"GetChildCount",value:function(){return 1}},{key:"Set",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e<3)return this.SetAsBox(1,1);for(var n=e,s=[],r=0;r<n;++r){for(var o=t[i+r],a=!0,l=0;l<s.length;++l)if(Mt.DistanceSquaredVV(o,s[l])<.5*p*(.5*p)){a=!1;break}a&&s.push(o)}if((n=s.length)<3)return this.SetAsBox(1,1);for(var h=0,m=s[0].x,c=1;c<n;++c){var _=s[c].x;(_>m||_===m&&s[c].y<s[h].y)&&(h=c,m=_)}for(var f=[],d=0,v=h;;){f[d]=v;for(var y=0,x=1;x<n;++x)if(y!==v){var g=Mt.SubVV(s[y],s[f[d]],u.Set_s_r),b=Mt.SubVV(s[x],s[f[d]],u.Set_s_v),S=Mt.CrossVV(g,b);S<0&&(y=x),0===S&&b.LengthSquared()>g.LengthSquared()&&(y=x)}else y=x;if(++d,v=y,y===h)break}this.m_count=d,this.m_vertices=Mt.MakeArray(this.m_count),this.m_normals=Mt.MakeArray(this.m_count);for(var B=0;B<d;++B)this.m_vertices[B].Copy(s[f[B]]);for(var w=0;w<d;++w){var A=this.m_vertices[w],C=this.m_vertices[(w+1)%d],M=Mt.SubVV(C,A,Mt.s_t0);Mt.CrossVOne(M,this.m_normals[w]).SelfNormalize()}return u.ComputeCentroid(this.m_vertices,d,this.m_centroid),this}},{key:"SetAsArray",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length;return this.Set(t,e)}},{key:"SetAsBox",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(this.m_count=4,this.m_vertices=Mt.MakeArray(this.m_count),this.m_normals=Mt.MakeArray(this.m_count),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),i){this.m_centroid.Copy(i);var s=new Gt;s.SetPosition(i),s.SetRotationAngle(n);for(var r=0;r<this.m_count;++r)Gt.MulXV(s,this.m_vertices[r],this.m_vertices[r]),Tt.MulRV(s.q,this.m_normals[r],this.m_normals[r])}return this}},{key:"TestPoint",value:function(t,e){for(var i=Gt.MulTXV(t,e,u.TestPoint_s_pLocal),n=0;n<this.m_count;++n)if(Mt.DotVV(this.m_normals[n],Mt.SubVV(i,this.m_vertices[n],Mt.s_t0))>0)return!1;return!0}},{key:"ComputeDistance",value:function(t,e,i,n){for(var s=Gt.MulTXV(t,e,u.ComputeDistance_s_pLocal),r=-h,o=u.ComputeDistance_s_normalForMaxDistance.Copy(s),a=0;a<this.m_count;++a){var l=Mt.DotVV(this.m_normals[a],Mt.SubVV(s,this.m_vertices[a],Mt.s_t0));l>r&&(r=l,o.Copy(this.m_normals[a]))}if(r>0){for(var m=u.ComputeDistance_s_minDistance.Copy(o),c=r*r,_=0;_<this.m_count;++_){var f=Mt.SubVV(s,this.m_vertices[_],u.ComputeDistance_s_distance),d=f.LengthSquared();c>d&&(m.Copy(f),c=d)}return Tt.MulRV(t.q,m,i),i.Normalize(),Math.sqrt(c)}return Tt.MulRV(t.q,o,i),r}},{key:"RayCast",value:function(t,e,i,n){for(var s=Gt.MulTXV(i,e.p1,u.RayCast_s_p1),r=Gt.MulTXV(i,e.p2,u.RayCast_s_p2),o=Mt.SubVV(r,s,u.RayCast_s_d),a=0,l=e.maxFraction,h=-1,m=0;m<this.m_count;++m){var c=Mt.DotVV(this.m_normals[m],Mt.SubVV(this.m_vertices[m],s,Mt.s_t0)),_=Mt.DotVV(this.m_normals[m],o);if(0===_){if(c<0)return!1}else _<0&&c<a*_?(a=c/_,h=m):_>0&&c<l*_&&(l=c/_);if(l<a)return!1}return h>=0&&(t.fraction=a,Tt.MulRV(i.q,this.m_normals[h],t.normal),!0)}},{key:"ComputeAABB",value:function(t,e,i){for(var n=Gt.MulXV(e,this.m_vertices[0],t.lowerBound),s=t.upperBound.Copy(n),r=0;r<this.m_count;++r){var o=Gt.MulXV(e,this.m_vertices[r],u.ComputeAABB_s_v);Mt.MinV(o,n,n),Mt.MaxV(o,s,s)}var a=this.m_radius;n.SelfSubXY(a,a),s.SelfAddXY(a,a)}},{key:"ComputeMass",value:function(t,e){for(var i=u.ComputeMass_s_center.SetZero(),n=0,s=0,r=u.ComputeMass_s_s.SetZero(),o=0;o<this.m_count;++o)r.SelfAdd(this.m_vertices[o]);r.SelfMul(1/this.m_count);for(var a=1/3,l=0;l<this.m_count;++l){var h=Mt.SubVV(this.m_vertices[l],r,u.ComputeMass_s_e1),m=Mt.SubVV(this.m_vertices[(l+1)%this.m_count],r,u.ComputeMass_s_e2),c=Mt.CrossVV(h,m),_=.5*c;n+=_,i.SelfAdd(Mt.MulSV(_*a,Mt.AddVV(h,m,Mt.s_t0),Mt.s_t1));var f=h.x,d=h.y,v=m.x,y=m.y;s+=.25*a*c*(f*f+v*f+v*v+(d*d+y*d+y*y))}t.mass=e*n,i.SelfMul(1/n),Mt.AddVV(i,r,t.center),t.I=e*s,t.I+=t.mass*(Mt.DotVV(t.center,t.center)-Mt.DotVV(i,i))}},{key:"Validate",value:function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=(t+1)%this.m_count,n=this.m_vertices[e],s=Mt.SubVV(this.m_vertices[i],n,u.Validate_s_e),r=0;r<this.m_count;++r)if(r!==e&&r!==i){var o=Mt.SubVV(this.m_vertices[r],n,u.Validate_s_v);if(Mt.CrossVV(s,o)<0)return!1}return!0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){for(var s=Tt.MulTRV(i.q,t,u.ComputeSubmergedArea_s_normalL),r=e-Mt.DotVV(t,i.p),o=[],a=0,l=-1,h=-1,c=!1,_=0;_<this.m_count;++_){o[_]=Mt.DotVV(s,this.m_vertices[_])-r;var f=o[_]<-m;_>0&&(f?c||(l=_-1,a++):c&&(h=_-1,a++)),c=f}switch(a){case 0:if(c){var d=u.ComputeSubmergedArea_s_md;return this.ComputeMass(d,1),Gt.MulXV(i,d.center,n),d.mass}return 0;case 1:-1===l?l=this.m_count-1:h=this.m_count-1}for(var v,y=(l+1)%this.m_count,p=(h+1)%this.m_count,x=(0-o[l])/(o[y]-o[l]),g=(0-o[h])/(o[p]-o[h]),b=u.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[l].x*(1-x)+this.m_vertices[y].x*x,this.m_vertices[l].y*(1-x)+this.m_vertices[y].y*x),S=u.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[h].x*(1-g)+this.m_vertices[p].x*g,this.m_vertices[h].y*(1-g)+this.m_vertices[p].y*g),B=0,w=u.ComputeSubmergedArea_s_center.SetZero(),A=this.m_vertices[y],C=y;C!==p;){v=(C=(C+1)%this.m_count)===p?S:this.m_vertices[C];var M=.5*((A.x-b.x)*(v.y-b.y)-(A.y-b.y)*(v.x-b.x));B+=M,w.x+=M*(b.x+A.x+v.x)/3,w.y+=M*(b.y+A.y+v.y)/3,A=v}return w.SelfMul(1/B),Gt.MulXV(i,w,n),B}},{key:"Dump",value:function(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(var e=0;e<this.m_count;++e)t("    vs[%d] = new b2Vec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)}}],[{key:"ComputeCentroid",value:function(t,e,i){var n=i;n.SetZero();for(var s=0,r=u.ComputeCentroid_s_pRef.SetZero(),o=1/3,a=0;a<e;++a){var l=r,h=t[a],m=t[(a+1)%e],c=Mt.SubVV(h,l,u.ComputeCentroid_s_e1),_=Mt.SubVV(m,l,u.ComputeCentroid_s_e2),f=.5*Mt.CrossVV(c,_);s+=f,n.x+=f*o*(l.x+h.x+m.x),n.y+=f*o*(l.y+h.y+m.y)}return n.SelfMul(1/s),n}}]),u}(rn);an.Set_s_r=new Mt,an.Set_s_v=new Mt,an.TestPoint_s_pLocal=new Mt,an.ComputeDistance_s_pLocal=new Mt,an.ComputeDistance_s_normalForMaxDistance=new Mt,an.ComputeDistance_s_minDistance=new Mt,an.ComputeDistance_s_distance=new Mt,an.RayCast_s_p1=new Mt,an.RayCast_s_p2=new Mt,an.RayCast_s_d=new Mt,an.ComputeAABB_s_v=new Mt,an.ComputeMass_s_center=new Mt,an.ComputeMass_s_s=new Mt,an.ComputeMass_s_e1=new Mt,an.ComputeMass_s_e2=new Mt,an.Validate_s_e=new Mt,an.Validate_s_v=new Mt,an.ComputeSubmergedArea_s_normalL=new Mt,an.ComputeSubmergedArea_s_md=new sn,an.ComputeSubmergedArea_s_intoVec=new Mt,an.ComputeSubmergedArea_s_outoVec=new Mt,an.ComputeSubmergedArea_s_center=new Mt,an.ComputeCentroid_s_pRef=new Mt,an.ComputeCentroid_s_e1=new Mt,an.ComputeCentroid_s_e2=new Mt;var ln=function(e){r(u,e);var i=o(u);function u(){var e;return a(this,u),(e=i.call(this,t.b2ShapeType.e_edgeShape,g)).m_vertex1=new Mt,e.m_vertex2=new Mt,e.m_vertex0=new Mt,e.m_vertex3=new Mt,e.m_hasVertex0=!1,e.m_hasVertex3=!1,e}return l(u,[{key:"Set",value:function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this}},{key:"Clone",value:function(){return(new u).Copy(this)}},{key:"Copy",value:function(t){return n(s(u.prototype),"Copy",this).call(this,t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,e,i,n){var s=Gt.MulXV(t,this.m_vertex1,u.ComputeDistance_s_v1),r=Gt.MulXV(t,this.m_vertex2,u.ComputeDistance_s_v2),o=Mt.SubVV(e,s,u.ComputeDistance_s_d),a=Mt.SubVV(r,s,u.ComputeDistance_s_s),l=Mt.DotVV(o,a);if(l>0){var h=Mt.DotVV(a,a);l>h?Mt.SubVV(e,r,o):o.SelfMulSub(l/h,a)}return i.Copy(o),i.Normalize()}},{key:"RayCast",value:function(t,e,i,n){var s=Gt.MulTXV(i,e.p1,u.RayCast_s_p1),r=Gt.MulTXV(i,e.p2,u.RayCast_s_p2),o=Mt.SubVV(r,s,u.RayCast_s_d),a=this.m_vertex1,l=this.m_vertex2,h=Mt.SubVV(l,a,u.RayCast_s_e),m=t.normal.Set(h.y,-h.x).SelfNormalize(),c=Mt.DotVV(m,Mt.SubVV(a,s,Mt.s_t0)),_=Mt.DotVV(m,o);if(0===_)return!1;var f=c/_;if(f<0||e.maxFraction<f)return!1;var d=Mt.AddVMulSV(s,f,o,u.RayCast_s_q),v=Mt.SubVV(l,a,u.RayCast_s_r),y=Mt.DotVV(v,v);if(0===y)return!1;var p=Mt.DotVV(Mt.SubVV(d,a,Mt.s_t0),v)/y;return!(p<0||1<p)&&(t.fraction=f,Tt.MulRV(i.q,t.normal,t.normal),c>0&&t.normal.SelfNeg(),!0)}},{key:"ComputeAABB",value:function(t,e,i){var n=Gt.MulXV(e,this.m_vertex1,u.ComputeAABB_s_v1),s=Gt.MulXV(e,this.m_vertex2,u.ComputeAABB_s_v2);Mt.MinV(n,s,t.lowerBound),Mt.MaxV(n,s,t.upperBound);var r=this.m_radius;t.lowerBound.SelfSubXY(r,r),t.upperBound.SelfAddXY(r,r)}},{key:"ComputeMass",value:function(t,e){t.mass=0,Mt.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){return n.SetZero(),0}},{key:"Dump",value:function(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)}}]),u}(rn);ln.ComputeDistance_s_v1=new Mt,ln.ComputeDistance_s_v2=new Mt,ln.ComputeDistance_s_d=new Mt,ln.ComputeDistance_s_s=new Mt,ln.RayCast_s_p1=new Mt,ln.RayCast_s_p2=new Mt,ln.RayCast_s_d=new Mt,ln.RayCast_s_e=new Mt,ln.RayCast_s_q=new Mt,ln.RayCast_s_r=new Mt,ln.ComputeAABB_s_v1=new Mt,ln.ComputeAABB_s_v2=new Mt;var un=function(e){r(u,e);var i=o(u);function u(){var e;return a(this,u),(e=i.call(this,t.b2ShapeType.e_chainShape,g)).m_vertices=[],e.m_count=0,e.m_prevVertex=new Mt,e.m_nextVertex=new Mt,e.m_hasPrevVertex=!1,e.m_hasNextVertex=!1,e}return l(u,[{key:"CreateLoop",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e<3)return this;this.m_count=e+1,this.m_vertices=Mt.MakeArray(this.m_count);for(var n=0;n<e;++n)this.m_vertices[n].Copy(t[i+n]);return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}},{key:"CreateChain",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.length,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.m_count=e,this.m_vertices=Mt.MakeArray(e);for(var n=0;n<e;++n)this.m_vertices[n].Copy(t[i+n]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this}},{key:"SetPrevVertex",value:function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this}},{key:"SetNextVertex",value:function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this}},{key:"Clone",value:function(){return(new u).Copy(this)}},{key:"Copy",value:function(t){return n(s(u.prototype),"Copy",this).call(this,t),this.CreateChain(t.m_vertices,t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this}},{key:"GetChildCount",value:function(){return this.m_count-1}},{key:"GetChildEdge",value:function(e,i){e.m_type=t.b2ShapeType.e_edgeShape,e.m_radius=this.m_radius,e.m_vertex1.Copy(this.m_vertices[i]),e.m_vertex2.Copy(this.m_vertices[i+1]),i>0?(e.m_vertex0.Copy(this.m_vertices[i-1]),e.m_hasVertex0=!0):(e.m_vertex0.Copy(this.m_prevVertex),e.m_hasVertex0=this.m_hasPrevVertex),i<this.m_count-2?(e.m_vertex3.Copy(this.m_vertices[i+2]),e.m_hasVertex3=!0):(e.m_vertex3.Copy(this.m_nextVertex),e.m_hasVertex3=this.m_hasNextVertex)}},{key:"TestPoint",value:function(t,e){return!1}},{key:"ComputeDistance",value:function(t,e,i,n){var s=u.ComputeDistance_s_edgeShape;return this.GetChildEdge(s,n),s.ComputeDistance(t,e,i,0)}},{key:"RayCast",value:function(t,e,i,n){var s=u.RayCast_s_edgeShape;return s.m_vertex1.Copy(this.m_vertices[n]),s.m_vertex2.Copy(this.m_vertices[(n+1)%this.m_count]),s.RayCast(t,e,i,0)}},{key:"ComputeAABB",value:function(t,e,i){var n=this.m_vertices[i],s=this.m_vertices[(i+1)%this.m_count],r=Gt.MulXV(e,n,u.ComputeAABB_s_v1),o=Gt.MulXV(e,s,u.ComputeAABB_s_v2);Mt.MinV(r,o,t.lowerBound),Mt.MaxV(r,o,t.upperBound)}},{key:"ComputeMass",value:function(t,e){t.mass=0,t.center.SetZero(),t.I=0}},{key:"SetupDistanceProxy",value:function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){return n.SetZero(),0}},{key:"Dump",value:function(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(var e=0;e<this.m_count;++e)t("    vs[%d] = new bVec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")}}]),u}(rn);un.ComputeDistance_s_edgeShape=new ln,un.RayCast_s_edgeShape=new ln,un.ComputeAABB_s_v1=new Mt,un.ComputeAABB_s_v2=new Mt;var hn=function(){function t(){a(this,t),this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}return l(t,[{key:"Clone",value:function(){return(new t).Copy(this)}},{key:"Copy",value:function(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex||0,this}}]),t}();hn.DEFAULT=new hn;var mn,cn=l((function t(){a(this,t),this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new hn})),_n=l((function t(e){a(this,t),this.aabb=new Ve,this.childIndex=0,this.fixture=e})),fn=function(){function t(e,i){a(this,t),this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=[],this.m_proxyCount=0,this.m_filter=new hn,this.m_isSensor=!1,this.m_userData=null,this.m_body=i,this.m_shape=e.shape.Clone()}return l(t,[{key:"GetType",value:function(){return this.m_shape.GetType()}},{key:"GetShape",value:function(){return this.m_shape}},{key:"SetSensor",value:function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)}},{key:"IsSensor",value:function(){return this.m_isSensor}},{key:"SetFilterData",value:function(t){this.m_filter.Copy(t),this.Refilter()}},{key:"GetFilterData",value:function(){return this.m_filter}},{key:"Refilter",value:function(){for(var t=this.m_body.GetContactList();t;){var e=t.contact,i=e.GetFixtureA(),n=e.GetFixtureB();i!==this&&n!==this||e.FlagForFiltering(),t=t.next}var s=this.m_body.GetWorld();if(null!==s)for(var r=s.m_contactManager.m_broadPhase,o=0;o<this.m_proxyCount;++o)r.TouchProxy(this.m_proxies[o].treeNode)}},{key:"GetBody",value:function(){return this.m_body}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"TestPoint",value:function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)}},{key:"ComputeDistance",value:function(t,e,i){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,i)}},{key:"RayCast",value:function(t,e,i){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),i)}},{key:"GetMassData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new sn;return this.m_shape.ComputeMass(t,this.m_density),t}},{key:"SetDensity",value:function(t){this.m_density=t}},{key:"GetDensity",value:function(){return this.m_density}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetAABB",value:function(t){return this.m_proxies[t].aabb}},{key:"Dump",value:function(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)}},{key:"Create",value:function(t){var e=this;this.m_userData=t.userData,this.m_friction=i(t.friction,.2),this.m_restitution=i(t.restitution,0),this.m_next=null,this.m_filter.Copy(i(t.filter,hn.DEFAULT)),this.m_isSensor=i(t.isSensor,!1),this.m_proxies=tt(this.m_shape.GetChildCount(),(function(t){return new _n(e)})),this.m_proxyCount=0,this.m_density=i(t.density,0)}},{key:"Destroy",value:function(){}},{key:"CreateProxies",value:function(t){var e=this.m_body.m_world.m_contactManager.m_broadPhase;this.m_proxyCount=this.m_shape.GetChildCount();for(var i=0;i<this.m_proxyCount;++i){var n=this.m_proxies[i]=new _n(this);this.m_shape.ComputeAABB(n.aabb,t,i),n.treeNode=e.CreateProxy(n.aabb,n),n.childIndex=i}}},{key:"DestroyProxies",value:function(){for(var t=this.m_body.m_world.m_contactManager.m_broadPhase,e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];delete i.treeNode.userData,t.DestroyProxy(i.treeNode),delete i.treeNode}this.m_proxyCount=0}},{key:"TouchProxies",value:function(){for(var t=this.m_body.m_world.m_contactManager.m_broadPhase,e=this.m_proxyCount,i=0;i<e;++i)t.TouchProxy(this.m_proxies[i].treeNode)}},{key:"Synchronize",value:function(e,i){if(0!==this.m_proxyCount)for(var n=this.m_body.m_world.m_contactManager.m_broadPhase,s=0;s<this.m_proxyCount;++s){var r=this.m_proxies[s],o=t.Synchronize_s_aabb1,a=t.Synchronize_s_aabb2;this.m_shape.ComputeAABB(o,e,s),this.m_shape.ComputeAABB(a,i,s),r.aabb.Combine2(o,a);var l=Mt.SubVV(i.p,e.p,t.Synchronize_s_displacement);n.MoveProxy(r.treeNode,r.aabb,l)}}}]),t}();fn.Synchronize_s_aabb1=new Ve,fn.Synchronize_s_aabb2=new Ve,fn.Synchronize_s_displacement=new Mt,(mn=t.b2BodyType||(t.b2BodyType={}))[mn.b2_unknown=-1]="b2_unknown",mn[mn.b2_staticBody=0]="b2_staticBody",mn[mn.b2_kinematicBody=1]="b2_kinematicBody",mn[mn.b2_dynamicBody=2]="b2_dynamicBody";var dn,vn,yn=l((function e(){a(this,e),this.type=t.b2BodyType.b2_staticBody,this.position=new Mt(0,0),this.angle=0,this.linearVelocity=new Mt(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1})),pn=function(){function e(n,s){a(this,e),this.m_type=t.b2BodyType.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new Gt,this.m_xf0=new Gt,this.m_sweep=new Dt,this.m_linearVelocity=new Mt,this.m_angularVelocity=0,this.m_force=new Mt,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=i(n.bullet,!1),this.m_fixedRotationFlag=i(n.fixedRotation,!1),this.m_autoSleepFlag=i(n.allowSleep,!0),this.m_awakeFlag=i(n.awake,!0),this.m_activeFlag=i(n.active,!0),this.m_world=s,this.m_xf.p.Copy(i(n.position,Mt.ZERO)),this.m_xf.q.SetAngle(i(n.angle,0)),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(i(n.linearVelocity,Mt.ZERO)),this.m_angularVelocity=i(n.angularVelocity,0),this.m_linearDamping=i(n.linearDamping,0),this.m_angularDamping=i(n.angularDamping,0),this.m_gravityScale=i(n.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=i(n.type,t.b2BodyType.b2_staticBody),n.type===t.b2BodyType.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=n.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}return l(e,[{key:"CreateFixture",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t instanceof rn?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)}},{key:"CreateFixtureDef",value:function(t){if(this.m_world.IsLocked())throw new Error;var e=new fn(t,this);return e.Create(t),this.m_activeFlag&&e.CreateProxies(this.m_xf),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,e}},{key:"CreateFixtureShapeDensity",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.CreateFixtureShapeDensity_s_def;return n.shape=t,n.density=i,this.CreateFixtureDef(n)}},{key:"DestroyFixture",value:function(t){if(this.m_world.IsLocked())throw new Error;for(var e=this.m_fixtureList,i=null;null!==e;){if(e===t){i?i.m_next=t.m_next:this.m_fixtureList=t.m_next;break}i=e,e=e.m_next}for(var n=this.m_contactList;n;){var s=n.contact;n=n.next;var r=s.GetFixtureA(),o=s.GetFixtureB();t!==r&&t!==o||this.m_world.m_contactManager.Destroy(s)}this.m_activeFlag&&t.DestroyProxies(),t.m_next=null,t.Destroy(),--this.m_fixtureCount,this.ResetMassData()}},{key:"SetTransformVec",value:function(t,e){this.SetTransformXY(t.x,t.y,e)}},{key:"SetTransformXY",value:function(t,e,i){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(i),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),Gt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=i,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=i;for(var n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},{key:"SetTransform",value:function(t){this.SetTransformVec(t.p,t.GetAngle())}},{key:"GetTransform",value:function(){return this.m_xf}},{key:"GetPosition",value:function(){return this.m_xf.p}},{key:"SetPosition",value:function(t){this.SetTransformVec(t,this.GetAngle())}},{key:"SetPositionXY",value:function(t,e){this.SetTransformXY(t,e,this.GetAngle())}},{key:"GetAngle",value:function(){return this.m_sweep.a}},{key:"SetAngle",value:function(t){this.SetTransformVec(this.GetPosition(),t)}},{key:"GetWorldCenter",value:function(){return this.m_sweep.c}},{key:"GetLocalCenter",value:function(){return this.m_sweep.localCenter}},{key:"SetLinearVelocity",value:function(e){this.m_type!==t.b2BodyType.b2_staticBody&&(Mt.DotVV(e,e)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(e))}},{key:"GetLinearVelocity",value:function(){return this.m_linearVelocity}},{key:"SetAngularVelocity",value:function(e){this.m_type!==t.b2BodyType.b2_staticBody&&(e*e>0&&this.SetAwake(!0),this.m_angularVelocity=e)}},{key:"GetAngularVelocity",value:function(){return this.m_angularVelocity}},{key:"GetDefinition",value:function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t}},{key:"ApplyForce",value:function(e,i){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.m_type===t.b2BodyType.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(i.x-this.m_sweep.c.x)*e.y-(i.y-this.m_sweep.c.y)*e.x))}},{key:"ApplyForceToCenter",value:function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y))}},{key:"ApplyTorque",value:function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=e))}},{key:"ApplyLinearImpulse",value:function(e,i){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.m_type===t.b2BodyType.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((i.x-this.m_sweep.c.x)*e.y-(i.y-this.m_sweep.c.y)*e.x)))}},{key:"ApplyLinearImpulseToCenter",value:function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y))}},{key:"ApplyAngularImpulse",value:function(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*e))}},{key:"GetMass",value:function(){return this.m_mass}},{key:"GetInertia",value:function(){return this.m_I+this.m_mass*Mt.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)}},{key:"GetMassData",value:function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*Mt.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t}},{key:"SetMassData",value:function(i){if(this.m_world.IsLocked())throw new Error;if(this.m_type===t.b2BodyType.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=i.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,i.I>0&&!this.m_fixedRotationFlag&&(this.m_I=i.I-this.m_mass*Mt.DotVV(i.center,i.center),this.m_invI=1/this.m_I);var n=e.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(i.center),Gt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),Mt.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Mt.SubVV(this.m_sweep.c,n,Mt.s_t0),this.m_linearVelocity)}}},{key:"ResetMassData",value:function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===t.b2BodyType.b2_staticBody||this.m_type===t.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var i=e.ResetMassData_s_localCenter.SetZero(),n=this.m_fixtureList;n;n=n.m_next)if(0!==n.m_density){var s=n.GetMassData(e.ResetMassData_s_massData);this.m_mass+=s.mass,i.x+=s.center.x*s.mass,i.y+=s.center.y*s.mass,this.m_I+=s.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,i.x*=this.m_invMass,i.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*Mt.DotVV(i,i),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var r=e.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(i),Gt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),Mt.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Mt.SubVV(this.m_sweep.c,r,Mt.s_t0),this.m_linearVelocity)}},{key:"GetWorldPoint",value:function(t,e){return Gt.MulXV(this.m_xf,t,e)}},{key:"GetWorldVector",value:function(t,e){return Tt.MulRV(this.m_xf.q,t,e)}},{key:"GetLocalPoint",value:function(t,e){return Gt.MulTXV(this.m_xf,t,e)}},{key:"GetLocalVector",value:function(t,e){return Tt.MulTRV(this.m_xf.q,t,e)}},{key:"GetLinearVelocityFromWorldPoint",value:function(t,e){return Mt.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Mt.SubVV(t,this.m_sweep.c,Mt.s_t0),e)}},{key:"GetLinearVelocityFromLocalPoint",value:function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)}},{key:"GetLinearDamping",value:function(){return this.m_linearDamping}},{key:"SetLinearDamping",value:function(t){this.m_linearDamping=t}},{key:"GetAngularDamping",value:function(){return this.m_angularDamping}},{key:"SetAngularDamping",value:function(t){this.m_angularDamping=t}},{key:"GetGravityScale",value:function(){return this.m_gravityScale}},{key:"SetGravityScale",value:function(t){this.m_gravityScale=t}},{key:"SetType",value:function(e){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==e){this.m_type=e,this.ResetMassData(),this.m_type===t.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var i=this.m_contactList;i;){var n=i;i=i.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null;for(var s=this.m_fixtureList;s;s=s.m_next)s.TouchProxies()}}},{key:"GetType",value:function(){return this.m_type}},{key:"SetBullet",value:function(t){this.m_bulletFlag=t}},{key:"IsBullet",value:function(){return this.m_bulletFlag}},{key:"SetSleepingAllowed",value:function(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)}},{key:"IsSleepingAllowed",value:function(){return this.m_autoSleepFlag}},{key:"SetAwake",value:function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)}},{key:"IsAwake",value:function(){return this.m_awakeFlag}},{key:"SetActive",value:function(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsActive())if(this.m_activeFlag=t,t)for(var e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies(this.m_xf);else{for(var i=this.m_fixtureList;i;i=i.m_next)i.DestroyProxies();for(var n=this.m_contactList;n;){var s=n;n=n.next,this.m_world.m_contactManager.Destroy(s.contact)}this.m_contactList=null}}},{key:"IsActive",value:function(){return this.m_activeFlag}},{key:"SetFixedRotation",value:function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())}},{key:"IsFixedRotation",value:function(){return this.m_fixedRotationFlag}},{key:"GetFixtureList",value:function(){return this.m_fixtureList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetContactList",value:function(){return this.m_contactList}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"GetWorld",value:function(){return this.m_world}},{key:"Dump",value:function(e){var i=this.m_islandIndex;e("{\n"),e("  const bd: b2BodyDef = new b2BodyDef();\n");var n="";switch(this.m_type){case t.b2BodyType.b2_staticBody:n="b2BodyType.b2_staticBody";break;case t.b2BodyType.b2_kinematicBody:n="b2BodyType.b2_kinematicBody";break;case t.b2BodyType.b2_dynamicBody:n="b2BodyType.b2_dynamicBody"}e("  bd.type = %s;\n",n),e("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),e("  bd.angle = %.15f;\n",this.m_sweep.a),e("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),e("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),e("  bd.linearDamping = %.15f;\n",this.m_linearDamping),e("  bd.angularDamping = %.15f;\n",this.m_angularDamping),e("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),e("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),e("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),e("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),e("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),e("  bd.gravityScale = %.15f;\n",this.m_gravityScale),e("\n"),e("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),e("\n");for(var s=this.m_fixtureList;s;s=s.m_next)e("  {\n"),s.Dump(e,i),e("  }\n");e("}\n")}},{key:"SynchronizeFixtures",value:function(){var t=e.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),Tt.MulRV(t.q,this.m_sweep.localCenter,t.p),Mt.SubVV(this.m_sweep.c0,t.p,t.p);for(var i=this.m_fixtureList;i;i=i.m_next)i.Synchronize(t,this.m_xf)}},{key:"SynchronizeTransform",value:function(){this.m_xf.q.SetAngle(this.m_sweep.a),Tt.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),Mt.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"ShouldCollide",value:function(e){return(this.m_type!==t.b2BodyType.b2_staticBody||e.m_type!==t.b2BodyType.b2_staticBody)&&this.ShouldCollideConnected(e)}},{key:"ShouldCollideConnected",value:function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0}},{key:"Advance",value:function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),Tt.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),Mt.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)}},{key:"GetControllerList",value:function(){return this.m_controllerList}},{key:"GetControllerCount",value:function(){return this.m_controllerCount}}]),e}();pn.CreateFixtureShapeDensity_s_def=new cn,pn.SetMassData_s_oldCenter=new Mt,pn.ResetMassData_s_localCenter=new Mt,pn.ResetMassData_s_oldCenter=new Mt,pn.ResetMassData_s_massData=new sn,pn.SynchronizeFixtures_s_xf1=new Gt,(vn=t.b2JointType||(t.b2JointType={}))[vn.e_unknownJoint=0]="e_unknownJoint",vn[vn.e_revoluteJoint=1]="e_revoluteJoint",vn[vn.e_prismaticJoint=2]="e_prismaticJoint",vn[vn.e_distanceJoint=3]="e_distanceJoint",vn[vn.e_pulleyJoint=4]="e_pulleyJoint",vn[vn.e_mouseJoint=5]="e_mouseJoint",vn[vn.e_gearJoint=6]="e_gearJoint",vn[vn.e_wheelJoint=7]="e_wheelJoint",vn[vn.e_weldJoint=8]="e_weldJoint",vn[vn.e_frictionJoint=9]="e_frictionJoint",vn[vn.e_ropeJoint=10]="e_ropeJoint",vn[vn.e_motorJoint=11]="e_motorJoint",vn[vn.e_areaJoint=12]="e_areaJoint",(dn=t.b2LimitState||(t.b2LimitState={}))[dn.e_inactiveLimit=0]="e_inactiveLimit",dn[dn.e_atLowerLimit=1]="e_atLowerLimit",dn[dn.e_atUpperLimit=2]="e_atUpperLimit",dn[dn.e_equalLimits=3]="e_equalLimits";var xn=function(){function t(){a(this,t),this.linear=new Mt,this.angularA=0,this.angularB=0}return l(t,[{key:"SetZero",value:function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this}},{key:"Set",value:function(t,e,i){return this.linear.Copy(t),this.angularA=e,this.angularB=i,this}}]),t}(),gn=l((function t(e,i){a(this,t),this.prev=null,this.next=null,this.joint=e,this.other=i})),bn=l((function e(i){a(this,e),this.type=t.b2JointType.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=i})),Sn=function(){function e(n){a(this,e),this.m_type=t.b2JointType.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=n.type,this.m_edgeA=new gn(this,n.bodyB),this.m_edgeB=new gn(this,n.bodyA),this.m_bodyA=n.bodyA,this.m_bodyB=n.bodyB,this.m_collideConnected=i(n.collideConnected,!1),this.m_userData=n.userData}return l(e,[{key:"GetType",value:function(){return this.m_type}},{key:"GetBodyA",value:function(){return this.m_bodyA}},{key:"GetBodyB",value:function(){return this.m_bodyB}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"IsActive",value:function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()}},{key:"GetCollideConnected",value:function(){return this.m_collideConnected}},{key:"Dump",value:function(t){t("// Dump is not supported for this joint type.\n")}},{key:"ShiftOrigin",value:function(t){}}]),e}(),Bn=function(e){r(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_distanceJoint)).localAnchorA=new Mt,e.localAnchorB=new Mt,e.length=1,e.frequencyHz=0,e.dampingRatio=0,e}return l(n,[{key:"Initialize",value:function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.length=Mt.DistanceVV(i,n),this.frequencyHz=0,this.dampingRatio=0}}]),n}(bn),wn=function(t){r(n,t);var e=o(n);function n(t){var s;return a(this,n),(s=e.call(this,t)).m_frequencyHz=0,s.m_dampingRatio=0,s.m_bias=0,s.m_localAnchorA=new Mt,s.m_localAnchorB=new Mt,s.m_gamma=0,s.m_impulse=0,s.m_length=0,s.m_indexA=0,s.m_indexB=0,s.m_u=new Mt,s.m_rA=new Mt,s.m_rB=new Mt,s.m_localCenterA=new Mt,s.m_localCenterB=new Mt,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_mass=0,s.m_qA=new Tt,s.m_qB=new Tt,s.m_lalcA=new Mt,s.m_lalcB=new Mt,s.m_frequencyHz=i(t.frequencyHz,0),s.m_dampingRatio=i(t.dampingRatio,0),s.m_localAnchorA.Copy(t.localAnchorA),s.m_localAnchorB.Copy(t.localAnchorB),s.m_length=t.length,s}return l(n,[{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse*this.m_u.x,e.y=t*this.m_impulse*this.m_u.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetLength",value:function(t){this.m_length=t}},{key:"Length",value:function(){return this.m_length}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(i),m=this.m_qB.SetAngle(a);Mt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Tt.MulRV(h,this.m_lalcA,this.m_rA),Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Tt.MulRV(m,this.m_lalcB,this.m_rB),this.m_u.x=o.x+this.m_rB.x-e.x-this.m_rA.x,this.m_u.y=o.y+this.m_rB.y-e.y-this.m_rA.y;var c=this.m_u.Length();c>p?this.m_u.SelfMul(1/c):this.m_u.SetZero();var f=Mt.CrossVV(this.m_rA,this.m_u),d=Mt.CrossVV(this.m_rB,this.m_u),v=this.m_invMassA+this.m_invIA*f*f+this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=0!==v?1/v:0,this.m_frequencyHz>0){var y=c-this.m_length,x=2*_*this.m_frequencyHz,g=2*this.m_mass*this.m_dampingRatio*x,b=this.m_mass*x*x,S=t.step.dt;this.m_gamma=S*(g+S*b),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=y*S*b*this.m_gamma,v+=this.m_gamma,this.m_mass=0!==v?1/v:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var B=Mt.MulSV(this.m_impulse,this.m_u,n.InitVelocityConstraints_s_P);s.SelfMulSub(this.m_invMassA,B),r-=this.m_invIA*Mt.CrossVV(this.m_rA,B),l.SelfMulAdd(this.m_invMassB,B),u+=this.m_invIB*Mt.CrossVV(this.m_rB,B)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,o=Mt.AddVCrossSV(e,i,this.m_rA,n.SolveVelocityConstraints_s_vpA),a=Mt.AddVCrossSV(s,r,this.m_rB,n.SolveVelocityConstraints_s_vpB),l=Mt.DotVV(this.m_u,Mt.SubVV(a,o,Mt.s_t0)),u=-this.m_mass*(l+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=u;var h=Mt.MulSV(u,this.m_u,n.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,h),i-=this.m_invIA*Mt.CrossVV(this.m_rA,h),s.SelfMulAdd(this.m_invMassB,h),r+=this.m_invIB*Mt.CrossVV(this.m_rB,h),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){if(this.m_frequencyHz>0)return!0;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(r),l=Tt.MulRV(o,this.m_lalcA,this.m_rA),u=Tt.MulRV(a,this.m_lalcB,this.m_rB),h=this.m_u;h.x=s.x+u.x-e.x-l.x,h.y=s.y+u.y-e.y-l.y;var m=this.m_u.Normalize()-this.m_length;m=ut(m,-w,w);var c=-this.m_mass*m,_=Mt.MulSV(c,h,n.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,_),i-=this.m_invIA*Mt.CrossVV(l,_),s.SelfMulAdd(this.m_invMassB,_),r+=this.m_invIB*Mt.CrossVV(u,_),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,ot(m)<p}}]),n}(Sn);wn.InitVelocityConstraints_s_P=new Mt,wn.SolveVelocityConstraints_s_vpA=new Mt,wn.SolveVelocityConstraints_s_vpB=new Mt,wn.SolveVelocityConstraints_s_P=new Mt,wn.SolvePositionConstraints_s_P=new Mt;var An=function(e){r(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_areaJoint)).bodies=[],e.frequencyHz=0,e.dampingRatio=0,e}return l(n,[{key:"AddBody",value:function(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)}}]),n}(bn),Cn=function(t){r(n,t);var e=o(n);function n(t){var s;a(this,n),(s=e.call(this,t)).m_frequencyHz=0,s.m_dampingRatio=0,s.m_impulse=0,s.m_targetArea=0,s.m_bodies=t.bodies,s.m_frequencyHz=i(t.frequencyHz,0),s.m_dampingRatio=i(t.dampingRatio,0),s.m_targetLengths=it(t.bodies.length),s.m_normals=Mt.MakeArray(t.bodies.length),s.m_joints=[],s.m_deltas=Mt.MakeArray(t.bodies.length),s.m_delta=new Mt;var r=new Bn;r.frequencyHz=s.m_frequencyHz,r.dampingRatio=s.m_dampingRatio,s.m_targetArea=0;for(var o=0;o<s.m_bodies.length;++o){var l=s.m_bodies[o],u=s.m_bodies[(o+1)%s.m_bodies.length],h=l.GetWorldCenter(),m=u.GetWorldCenter();s.m_targetLengths[o]=Mt.DistanceVV(h,m),s.m_targetArea+=Mt.CrossVV(h,m),r.Initialize(l,u,h,m),s.m_joints[o]=l.GetWorld().CreateJoint(r)}return s.m_targetArea*=.5,s}return l(n,[{key:"GetAnchorA",value:function(t){return t}},{key:"GetAnchorB",value:function(t){return t}},{key:"GetReactionForce",value:function(t,e){return e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t)}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t)}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"Dump",value:function(t){t("Area joint dumping is not supported.\n")}},{key:"InitVelocityConstraints",value:function(t){for(var e=0;e<this.m_bodies.length;++e){var i=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],n=this.m_bodies[(e+1)%this.m_bodies.length],s=t.positions[i.m_islandIndex].c,r=t.positions[n.m_islandIndex].c,o=this.m_deltas[e];Mt.SubVV(r,s,o)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(var a=0;a<this.m_bodies.length;++a){var l=this.m_bodies[a],u=t.velocities[l.m_islandIndex].v,h=this.m_deltas[a];u.x+=l.m_invMass*h.y*.5*this.m_impulse,u.y+=l.m_invMass*-h.x*.5*this.m_impulse}}else this.m_impulse=0}},{key:"SolveVelocityConstraints",value:function(t){for(var e=0,i=0,n=0;n<this.m_bodies.length;++n){var s=this.m_bodies[n],r=t.velocities[s.m_islandIndex].v,o=this.m_deltas[n];e+=o.LengthSquared()/s.GetMass(),i+=Mt.CrossVV(r,o)}var a=-2*i/e;this.m_impulse+=a;for(var l=0;l<this.m_bodies.length;++l){var u=this.m_bodies[l],h=t.velocities[u.m_islandIndex].v,m=this.m_deltas[l];h.x+=u.m_invMass*m.y*.5*a,h.y+=u.m_invMass*-m.x*.5*a}}},{key:"SolvePositionConstraints",value:function(t){for(var e=0,i=0,n=0;n<this.m_bodies.length;++n){var s=this.m_bodies[n],r=this.m_bodies[(n+1)%this.m_bodies.length],o=t.positions[s.m_islandIndex].c,a=t.positions[r.m_islandIndex].c,l=Mt.SubVV(a,o,this.m_delta),u=l.Length();u<m&&(u=1),this.m_normals[n].x=l.y/u,this.m_normals[n].y=-l.x/u,e+=u,i+=Mt.CrossVV(o,a)}i*=.5;for(var h=.5*(this.m_targetArea-i)/e,c=!0,_=0;_<this.m_bodies.length;++_){var f=this.m_bodies[_],d=t.positions[f.m_islandIndex].c,v=(_+1)%this.m_bodies.length,y=Mt.AddVV(this.m_normals[_],this.m_normals[v],this.m_delta);y.SelfMul(h);var x=y.LengthSquared();x>ct(w)&&y.SelfMul(w/ft(x)),x>ct(p)&&(c=!1),d.x+=y.x,d.y+=y.y}return c}}]),n}(Sn),Mn=function(e){r(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_frictionJoint)).localAnchorA=new Mt,e.localAnchorB=new Mt,e.maxForce=0,e.maxTorque=0,e}return l(n,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB)}}]),n}(bn),Vn=function(t){r(n,t);var e=o(n);function n(t){var s;return a(this,n),(s=e.call(this,t)).m_localAnchorA=new Mt,s.m_localAnchorB=new Mt,s.m_linearImpulse=new Mt,s.m_angularImpulse=0,s.m_maxForce=0,s.m_maxTorque=0,s.m_indexA=0,s.m_indexB=0,s.m_rA=new Mt,s.m_rB=new Mt,s.m_localCenterA=new Mt,s.m_localCenterB=new Mt,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_linearMass=new Pt,s.m_angularMass=0,s.m_qA=new Tt,s.m_qB=new Tt,s.m_lalcA=new Mt,s.m_lalcB=new Mt,s.m_K=new Pt,s.m_localAnchorA.Copy(t.localAnchorA),s.m_localAnchorB.Copy(t.localAnchorB),s.m_linearImpulse.SetZero(),s.m_maxForce=i(t.maxForce,0),s.m_maxTorque=i(t.maxTorque,0),s.m_linearMass.SetZero(),s}return l(n,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].a,r=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,a=this.m_qA.SetAngle(e),l=this.m_qB.SetAngle(s);Mt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var u=Tt.MulRV(a,this.m_lalcA,this.m_rA);Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var h=Tt.MulRV(l,this.m_lalcB,this.m_rB),m=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,f=this.m_invIB,d=this.m_K;if(d.ex.x=m+c+_*u.y*u.y+f*h.y*h.y,d.ex.y=-_*u.x*u.y-f*h.x*h.y,d.ey.x=d.ex.y,d.ey.y=m+c+_*u.x*u.x+f*h.x*h.x,d.GetInverse(this.m_linearMass),this.m_angularMass=_+f,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var v=this.m_linearImpulse;i.SelfMulSub(m,v),n-=_*(Mt.CrossVV(this.m_rA,v)+this.m_angularImpulse),r.SelfMulAdd(c,v),o+=f*(Mt.CrossVV(this.m_rB,v)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=o}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,h=t.step.dt,m=r-i,c=-this.m_angularMass*m,_=this.m_angularImpulse,f=h*this.m_maxTorque;this.m_angularImpulse=ut(this.m_angularImpulse+c,-f,f),i-=l*(c=this.m_angularImpulse-_),r+=u*c;var d=Mt.SubVV(Mt.AddVCrossSV(s,r,this.m_rB,Mt.s_t0),Mt.AddVCrossSV(e,i,this.m_rA,Mt.s_t1),n.SolveVelocityConstraints_s_Cdot_v2),v=Pt.MulMV(this.m_linearMass,d,n.SolveVelocityConstraints_s_impulseV).SelfNeg(),y=n.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(v);var p=h*this.m_maxForce;this.m_linearImpulse.LengthSquared()>p*p&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(p)),Mt.SubVV(this.m_linearImpulse,y,v),e.SelfMulSub(o,v),i-=l*Mt.CrossVV(this.m_rA,v),s.SelfMulAdd(a,v),r+=u*Mt.CrossVV(this.m_rB,v),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),n}(Sn);Vn.SolveVelocityConstraints_s_Cdot_v2=new Mt,Vn.SolveVelocityConstraints_s_impulseV=new Mt,Vn.SolveVelocityConstraints_s_oldImpulseV=new Mt;var kn=function(e){r(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_gearJoint)).ratio=1,e}return l(n)}(bn),Pn=function(e){r(s,e);var n=o(s);function s(e){var r,o,l;a(this,s),(r=n.call(this,e)).m_typeA=t.b2JointType.e_unknownJoint,r.m_typeB=t.b2JointType.e_unknownJoint,r.m_localAnchorA=new Mt,r.m_localAnchorB=new Mt,r.m_localAnchorC=new Mt,r.m_localAnchorD=new Mt,r.m_localAxisC=new Mt,r.m_localAxisD=new Mt,r.m_referenceAngleA=0,r.m_referenceAngleB=0,r.m_constant=0,r.m_ratio=0,r.m_impulse=0,r.m_indexA=0,r.m_indexB=0,r.m_indexC=0,r.m_indexD=0,r.m_lcA=new Mt,r.m_lcB=new Mt,r.m_lcC=new Mt,r.m_lcD=new Mt,r.m_mA=0,r.m_mB=0,r.m_mC=0,r.m_mD=0,r.m_iA=0,r.m_iB=0,r.m_iC=0,r.m_iD=0,r.m_JvAC=new Mt,r.m_JvBD=new Mt,r.m_JwA=0,r.m_JwB=0,r.m_JwC=0,r.m_JwD=0,r.m_mass=0,r.m_qA=new Tt,r.m_qB=new Tt,r.m_qC=new Tt,r.m_qD=new Tt,r.m_lalcA=new Mt,r.m_lalcB=new Mt,r.m_lalcC=new Mt,r.m_lalcD=new Mt,r.m_joint1=e.joint1,r.m_joint2=e.joint2,r.m_typeA=r.m_joint1.GetType(),r.m_typeB=r.m_joint2.GetType(),r.m_bodyC=r.m_joint1.GetBodyA(),r.m_bodyA=r.m_joint1.GetBodyB();var u=r.m_bodyA.m_xf,h=r.m_bodyA.m_sweep.a,m=r.m_bodyC.m_xf,c=r.m_bodyC.m_sweep.a;if(r.m_typeA===t.b2JointType.e_revoluteJoint){var _=e.joint1;r.m_localAnchorC.Copy(_.m_localAnchorA),r.m_localAnchorA.Copy(_.m_localAnchorB),r.m_referenceAngleA=_.m_referenceAngle,r.m_localAxisC.SetZero(),o=h-c-r.m_referenceAngleA}else{var f=e.joint1;r.m_localAnchorC.Copy(f.m_localAnchorA),r.m_localAnchorA.Copy(f.m_localAnchorB),r.m_referenceAngleA=f.m_referenceAngle,r.m_localAxisC.Copy(f.m_localXAxisA);var d=r.m_localAnchorC,v=Tt.MulTRV(m.q,Mt.AddVV(Tt.MulRV(u.q,r.m_localAnchorA,Mt.s_t0),Mt.SubVV(u.p,m.p,Mt.s_t1),Mt.s_t0),Mt.s_t0);o=Mt.DotVV(Mt.SubVV(v,d,Mt.s_t0),r.m_localAxisC)}r.m_bodyD=r.m_joint2.GetBodyA(),r.m_bodyB=r.m_joint2.GetBodyB();var y=r.m_bodyB.m_xf,p=r.m_bodyB.m_sweep.a,x=r.m_bodyD.m_xf,g=r.m_bodyD.m_sweep.a;if(r.m_typeB===t.b2JointType.e_revoluteJoint){var b=e.joint2;r.m_localAnchorD.Copy(b.m_localAnchorA),r.m_localAnchorB.Copy(b.m_localAnchorB),r.m_referenceAngleB=b.m_referenceAngle,r.m_localAxisD.SetZero(),l=p-g-r.m_referenceAngleB}else{var S=e.joint2;r.m_localAnchorD.Copy(S.m_localAnchorA),r.m_localAnchorB.Copy(S.m_localAnchorB),r.m_referenceAngleB=S.m_referenceAngle,r.m_localAxisD.Copy(S.m_localXAxisA);var B=r.m_localAnchorD,w=Tt.MulTRV(x.q,Mt.AddVV(Tt.MulRV(y.q,r.m_localAnchorB,Mt.s_t0),Mt.SubVV(y.p,x.p,Mt.s_t1),Mt.s_t0),Mt.s_t0);l=Mt.DotVV(Mt.SubVV(w,B,Mt.s_t0),r.m_localAxisD)}return r.m_ratio=i(e.ratio,1),r.m_constant=o+r.m_ratio*l,r.m_impulse=0,r}return l(s,[{key:"InitVelocityConstraints",value:function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var i=e.positions[this.m_indexA].a,n=e.velocities[this.m_indexA].v,r=e.velocities[this.m_indexA].w,o=e.positions[this.m_indexB].a,a=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,u=e.positions[this.m_indexC].a,h=e.velocities[this.m_indexC].v,m=e.velocities[this.m_indexC].w,c=e.positions[this.m_indexD].a,_=e.velocities[this.m_indexD].v,f=e.velocities[this.m_indexD].w,d=this.m_qA.SetAngle(i),v=this.m_qB.SetAngle(o),y=this.m_qC.SetAngle(u),p=this.m_qD.SetAngle(c);if(this.m_mass=0,this.m_typeA===t.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var x=Tt.MulRV(y,this.m_localAxisC,s.InitVelocityConstraints_s_u);Mt.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var g=Tt.MulRV(y,this.m_lalcC,s.InitVelocityConstraints_s_rC);Mt.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var b=Tt.MulRV(d,this.m_lalcA,s.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(x),this.m_JwC=Mt.CrossVV(g,x),this.m_JwA=Mt.CrossVV(b,x),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===t.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var S=Tt.MulRV(p,this.m_localAxisD,s.InitVelocityConstraints_s_u);Mt.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var B=Tt.MulRV(p,this.m_lalcD,s.InitVelocityConstraints_s_rD);Mt.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var w=Tt.MulRV(v,this.m_lalcB,s.InitVelocityConstraints_s_rB);Mt.MulSV(this.m_ratio,S,this.m_JvBD),this.m_JwD=this.m_ratio*Mt.CrossVV(B,S),this.m_JwB=this.m_ratio*Mt.CrossVV(w,S),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.step.warmStarting?(n.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),r+=this.m_iA*this.m_impulse*this.m_JwA,a.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),l+=this.m_iB*this.m_impulse*this.m_JwB,h.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),m-=this.m_iC*this.m_impulse*this.m_JwC,_.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),f-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,e.velocities[this.m_indexA].w=r,e.velocities[this.m_indexB].w=l,e.velocities[this.m_indexC].w=m,e.velocities[this.m_indexD].w=f}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=t.velocities[this.m_indexC].v,o=t.velocities[this.m_indexC].w,a=t.velocities[this.m_indexD].v,l=t.velocities[this.m_indexD].w,u=Mt.DotVV(this.m_JvAC,Mt.SubVV(e,r,Mt.s_t0))+Mt.DotVV(this.m_JvBD,Mt.SubVV(n,a,Mt.s_t0));u+=this.m_JwA*i-this.m_JwC*o+(this.m_JwB*s-this.m_JwD*l);var h=-this.m_mass*u;this.m_impulse+=h,e.SelfMulAdd(this.m_mA*h,this.m_JvAC),i+=this.m_iA*h*this.m_JwA,n.SelfMulAdd(this.m_mB*h,this.m_JvBD),s+=this.m_iB*h*this.m_JwB,r.SelfMulSub(this.m_mC*h,this.m_JvAC),o-=this.m_iC*h*this.m_JwC,a.SelfMulSub(this.m_mD*h,this.m_JvBD),l-=this.m_iD*h*this.m_JwD,t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=s,t.velocities[this.m_indexC].w=o,t.velocities[this.m_indexD].w=l}},{key:"SolvePositionConstraints",value:function(e){var i,n,r,o,a,l,u=e.positions[this.m_indexA].c,h=e.positions[this.m_indexA].a,m=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,_=e.positions[this.m_indexC].c,f=e.positions[this.m_indexC].a,d=e.positions[this.m_indexD].c,v=e.positions[this.m_indexD].a,y=this.m_qA.SetAngle(h),x=this.m_qB.SetAngle(c),g=this.m_qC.SetAngle(f),b=this.m_qD.SetAngle(v),S=0,B=this.m_JvAC,w=this.m_JvBD,A=0;if(this.m_typeA===t.b2JointType.e_revoluteJoint)B.SetZero(),r=1,a=1,A+=this.m_iA+this.m_iC,i=h-f-this.m_referenceAngleA;else{var C=Tt.MulRV(g,this.m_localAxisC,s.SolvePositionConstraints_s_u),M=Tt.MulRV(g,this.m_lalcC,s.SolvePositionConstraints_s_rC),V=Tt.MulRV(y,this.m_lalcA,s.SolvePositionConstraints_s_rA);B.Copy(C),a=Mt.CrossVV(M,C),r=Mt.CrossVV(V,C),A+=this.m_mC+this.m_mA+this.m_iC*a*a+this.m_iA*r*r;var k=this.m_lalcC,P=Tt.MulTRV(g,Mt.AddVV(V,Mt.SubVV(u,_,Mt.s_t0),Mt.s_t0),Mt.s_t0);i=Mt.DotVV(Mt.SubVV(P,k,Mt.s_t0),this.m_localAxisC)}if(this.m_typeB===t.b2JointType.e_revoluteJoint)w.SetZero(),o=this.m_ratio,l=this.m_ratio,A+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),n=c-v-this.m_referenceAngleB;else{var I=Tt.MulRV(b,this.m_localAxisD,s.SolvePositionConstraints_s_u),T=Tt.MulRV(b,this.m_lalcD,s.SolvePositionConstraints_s_rD),G=Tt.MulRV(x,this.m_lalcB,s.SolvePositionConstraints_s_rB);Mt.MulSV(this.m_ratio,I,w),l=this.m_ratio*Mt.CrossVV(T,I),o=this.m_ratio*Mt.CrossVV(G,I),A+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*l*l+this.m_iB*o*o;var L=this.m_lalcD,D=Tt.MulTRV(b,Mt.AddVV(G,Mt.SubVV(m,d,Mt.s_t0),Mt.s_t0),Mt.s_t0);n=Mt.DotVV(Mt.SubVV(D,L,Mt.s_t0),this.m_localAxisD)}var R=i+this.m_ratio*n-this.m_constant,F=0;return A>0&&(F=-R/A),u.SelfMulAdd(this.m_mA*F,B),h+=this.m_iA*F*r,m.SelfMulAdd(this.m_mB*F,w),c+=this.m_iB*F*o,_.SelfMulSub(this.m_mC*F,B),f-=this.m_iC*F*a,d.SelfMulSub(this.m_mD*F,w),v-=this.m_iD*F*l,e.positions[this.m_indexA].a=h,e.positions[this.m_indexB].a=c,e.positions[this.m_indexC].a=f,e.positions[this.m_indexD].a=v,S<p}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return Mt.MulSV(t*this.m_impulse,this.m_JvAC,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse*this.m_JwA}},{key:"GetJoint1",value:function(){return this.m_joint1}},{key:"GetJoint2",value:function(){return this.m_joint2}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"SetRatio",value:function(t){this.m_ratio=t}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex,n=this.m_joint1.m_index,s=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",n),t("  jd.joint2 = joints[%d];\n",s),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),s}(Sn);Pn.InitVelocityConstraints_s_u=new Mt,Pn.InitVelocityConstraints_s_rA=new Mt,Pn.InitVelocityConstraints_s_rB=new Mt,Pn.InitVelocityConstraints_s_rC=new Mt,Pn.InitVelocityConstraints_s_rD=new Mt,Pn.SolvePositionConstraints_s_u=new Mt,Pn.SolvePositionConstraints_s_rA=new Mt,Pn.SolvePositionConstraints_s_rB=new Mt,Pn.SolvePositionConstraints_s_rC=new Mt,Pn.SolvePositionConstraints_s_rD=new Mt;var In=function(e){r(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_motorJoint)).linearOffset=new Mt(0,0),e.angularOffset=0,e.maxForce=1,e.maxTorque=1,e.correctionFactor=.3,e}return l(n,[{key:"Initialize",value:function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var i=this.bodyA.GetAngle(),n=this.bodyB.GetAngle();this.angularOffset=n-i}}]),n}(bn),Tn=function(t){r(n,t);var e=o(n);function n(t){var s;return a(this,n),(s=e.call(this,t)).m_linearOffset=new Mt,s.m_angularOffset=0,s.m_linearImpulse=new Mt,s.m_angularImpulse=0,s.m_maxForce=0,s.m_maxTorque=0,s.m_correctionFactor=.3,s.m_indexA=0,s.m_indexB=0,s.m_rA=new Mt,s.m_rB=new Mt,s.m_localCenterA=new Mt,s.m_localCenterB=new Mt,s.m_linearError=new Mt,s.m_angularError=0,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_linearMass=new Pt,s.m_angularMass=0,s.m_qA=new Tt,s.m_qB=new Tt,s.m_K=new Pt,s.m_linearOffset.Copy(i(t.linearOffset,Mt.ZERO)),s.m_linearImpulse.SetZero(),s.m_maxForce=i(t.maxForce,0),s.m_maxTorque=i(t.maxTorque,0),s.m_correctionFactor=i(t.correctionFactor,.3),s}return l(n,[{key:"GetAnchorA",value:function(t){var e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetAnchorB",value:function(t){var e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t}},{key:"GetReactionForce",value:function(t,e){return Mt.MulSV(t,this.m_linearImpulse,e)}},{key:"GetReactionTorque",value:function(t){return t*this.m_angularImpulse}},{key:"SetLinearOffset",value:function(t){Mt.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))}},{key:"GetLinearOffset",value:function(){return this.m_linearOffset}},{key:"SetAngularOffset",value:function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)}},{key:"GetAngularOffset",value:function(){return this.m_angularOffset}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetMaxTorque",value:function(t){this.m_maxTorque=t}},{key:"GetMaxTorque",value:function(){return this.m_maxTorque}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(o),m=Tt.MulRV(u,Mt.SubVV(this.m_linearOffset,this.m_localCenterA,Mt.s_t0),this.m_rA),c=Tt.MulRV(h,Mt.NegV(this.m_localCenterB,Mt.s_t0),this.m_rB),_=this.m_invMassA,f=this.m_invMassB,d=this.m_invIA,v=this.m_invIB,y=this.m_K;if(y.ex.x=_+f+d*m.y*m.y+v*c.y*c.y,y.ex.y=-d*m.x*m.y-v*c.x*c.y,y.ey.x=y.ex.y,y.ey.y=_+f+d*m.x*m.x+v*c.x*c.x,y.GetInverse(this.m_linearMass),this.m_angularMass=d+v,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),Mt.SubVV(Mt.AddVV(r,c,Mt.s_t0),Mt.AddVV(e,m,Mt.s_t1),this.m_linearError),this.m_angularError=o-i-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var p=this.m_linearImpulse;n.SelfMulSub(_,p),s-=d*(Mt.CrossVV(m,p)+this.m_angularImpulse),a.SelfMulAdd(f,p),l+=v*(Mt.CrossVV(c,p)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,u=this.m_invIB,h=t.step.dt,m=t.step.inv_dt,c=r-i+m*this.m_correctionFactor*this.m_angularError,_=-this.m_angularMass*c,f=this.m_angularImpulse,d=h*this.m_maxTorque;this.m_angularImpulse=ut(this.m_angularImpulse+_,-d,d),i-=l*(_=this.m_angularImpulse-f),r+=u*_;var v=this.m_rA,y=this.m_rB,p=Mt.AddVV(Mt.SubVV(Mt.AddVV(s,Mt.CrossSV(r,y,Mt.s_t0),Mt.s_t0),Mt.AddVV(e,Mt.CrossSV(i,v,Mt.s_t1),Mt.s_t1),Mt.s_t2),Mt.MulSV(m*this.m_correctionFactor,this.m_linearError,Mt.s_t3),n.SolveVelocityConstraints_s_Cdot_v2),x=Pt.MulMV(this.m_linearMass,p,n.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),g=n.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(x);var b=h*this.m_maxForce;this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(b)),Mt.SubVV(this.m_linearImpulse,g,x),e.SelfMulSub(o,x),i-=l*Mt.CrossVV(v,x),s.SelfMulAdd(a,x),r+=u*Mt.CrossVV(y,x),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),n}(Sn);Tn.SolveVelocityConstraints_s_Cdot_v2=new Mt,Tn.SolveVelocityConstraints_s_impulse_v2=new Mt,Tn.SolveVelocityConstraints_s_oldImpulse_v2=new Mt;var Gn=function(e){r(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_mouseJoint)).target=new Mt,e.maxForce=0,e.frequencyHz=5,e.dampingRatio=.7,e}return l(n)}(bn),Ln=function(t){r(n,t);var e=o(n);function n(t){var s;return a(this,n),(s=e.call(this,t)).m_localAnchorB=new Mt,s.m_targetA=new Mt,s.m_frequencyHz=0,s.m_dampingRatio=0,s.m_beta=0,s.m_impulse=new Mt,s.m_maxForce=0,s.m_gamma=0,s.m_indexA=0,s.m_indexB=0,s.m_rB=new Mt,s.m_localCenterB=new Mt,s.m_invMassB=0,s.m_invIB=0,s.m_mass=new Pt,s.m_C=new Mt,s.m_qB=new Tt,s.m_lalcB=new Mt,s.m_K=new Pt,s.m_targetA.Copy(i(t.target,Mt.ZERO)),Gt.MulTXV(s.m_bodyB.GetTransform(),s.m_targetA,s.m_localAnchorB),s.m_maxForce=i(t.maxForce,0),s.m_impulse.SetZero(),s.m_frequencyHz=i(t.frequencyHz,0),s.m_dampingRatio=i(t.dampingRatio,0),s.m_beta=0,s.m_gamma=0,s}return l(n,[{key:"SetTarget",value:function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)}},{key:"GetTarget",value:function(){return this.m_targetA}},{key:"SetMaxForce",value:function(t){this.m_maxForce=t}},{key:"GetMaxForce",value:function(){return this.m_maxForce}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,i=t.positions[this.m_indexB].a,n=t.velocities[this.m_indexB].v,s=t.velocities[this.m_indexB].w,r=this.m_qB.SetAngle(i),o=this.m_bodyB.GetMass(),a=2*_*this.m_frequencyHz,l=2*o*this.m_dampingRatio*a,u=o*(a*a),h=t.step.dt;this.m_gamma=h*(l+h*u),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=h*u*this.m_gamma,Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Tt.MulRV(r,this.m_lalcB,this.m_rB);var m=this.m_K;m.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,m.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,m.ey.x=m.ex.y,m.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,m.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),s*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),n.x+=this.m_invMassB*this.m_impulse.x,n.y+=this.m_invMassB*this.m_impulse.y,s+=this.m_invIB*Mt.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=s}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexB].v,i=t.velocities[this.m_indexB].w,s=Mt.AddVCrossSV(e,i,this.m_rB,n.SolveVelocityConstraints_s_Cdot),r=Pt.MulMV(this.m_mass,Mt.AddVV(s,Mt.AddVV(this.m_C,Mt.MulSV(this.m_gamma,this.m_impulse,Mt.s_t0),Mt.s_t0),Mt.s_t0).SelfNeg(),n.SolveVelocityConstraints_s_impulse),o=n.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(r);var a=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.SelfMul(a/this.m_impulse.Length()),Mt.SubVV(this.m_impulse,o,r),e.SelfMulAdd(this.m_invMassB,r),i+=this.m_invIB*Mt.CrossVV(this.m_rB,r),t.velocities[this.m_indexB].w=i}},{key:"SolvePositionConstraints",value:function(t){return!0}},{key:"GetAnchorA",value:function(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return Mt.MulSV(t,this.m_impulse,e)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"Dump",value:function(t){t("Mouse joint dumping is not supported.\n")}},{key:"ShiftOrigin",value:function(t){this.m_targetA.SelfSub(t)}}]),n}(Sn);Ln.SolveVelocityConstraints_s_Cdot=new Mt,Ln.SolveVelocityConstraints_s_impulse=new Mt,Ln.SolveVelocityConstraints_s_oldImpulse=new Mt;var Dn=function(e){r(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_prismaticJoint)).localAnchorA=new Mt,e.localAnchorB=new Mt,e.localAxisA=new Mt(1,0),e.referenceAngle=0,e.enableLimit=!1,e.lowerTranslation=0,e.upperTranslation=0,e.enableMotor=!1,e.maxMotorForce=0,e.motorSpeed=0,e}return l(n,[{key:"Initialize",value:function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(n,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),n}(bn),Rn=function(e){r(s,e);var n=o(s);function s(e){var r;return a(this,s),(r=n.call(this,e)).m_localAnchorA=new Mt,r.m_localAnchorB=new Mt,r.m_localXAxisA=new Mt,r.m_localYAxisA=new Mt,r.m_referenceAngle=0,r.m_impulse=new kt(0,0,0),r.m_motorImpulse=0,r.m_lowerTranslation=0,r.m_upperTranslation=0,r.m_maxMotorForce=0,r.m_motorSpeed=0,r.m_enableLimit=!1,r.m_enableMotor=!1,r.m_limitState=t.b2LimitState.e_inactiveLimit,r.m_indexA=0,r.m_indexB=0,r.m_localCenterA=new Mt,r.m_localCenterB=new Mt,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_axis=new Mt(0,0),r.m_perp=new Mt(0,0),r.m_s1=0,r.m_s2=0,r.m_a1=0,r.m_a2=0,r.m_K=new It,r.m_K3=new It,r.m_K2=new Pt,r.m_motorMass=0,r.m_qA=new Tt,r.m_qB=new Tt,r.m_lalcA=new Mt,r.m_lalcB=new Mt,r.m_rA=new Mt,r.m_rB=new Mt,r.m_localAnchorA.Copy(i(e.localAnchorA,Mt.ZERO)),r.m_localAnchorB.Copy(i(e.localAnchorB,Mt.ZERO)),r.m_localXAxisA.Copy(i(e.localAxisA,new Mt(1,0))).SelfNormalize(),Mt.CrossOneV(r.m_localXAxisA,r.m_localYAxisA),r.m_referenceAngle=i(e.referenceAngle,0),r.m_lowerTranslation=i(e.lowerTranslation,0),r.m_upperTranslation=i(e.upperTranslation,0),r.m_maxMotorForce=i(e.maxMotorForce,0),r.m_motorSpeed=i(e.motorSpeed,0),r.m_enableLimit=i(e.enableLimit,!1),r.m_enableMotor=i(e.enableMotor,!1),r}return l(s,[{key:"InitVelocityConstraints",value:function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=e.positions[this.m_indexA].c,n=e.positions[this.m_indexA].a,r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,u=e.velocities[this.m_indexB].v,h=e.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(n),c=this.m_qB.SetAngle(l);Mt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var _=Tt.MulRV(m,this.m_lalcA,this.m_rA);Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var f=Tt.MulRV(c,this.m_lalcB,this.m_rB),d=Mt.AddVV(Mt.SubVV(a,i,Mt.s_t0),Mt.SubVV(f,_,Mt.s_t1),s.InitVelocityConstraints_s_d),v=this.m_invMassA,y=this.m_invMassB,x=this.m_invIA,g=this.m_invIB;if(Tt.MulRV(m,this.m_localXAxisA,this.m_axis),this.m_a1=Mt.CrossVV(Mt.AddVV(d,_,Mt.s_t0),this.m_axis),this.m_a2=Mt.CrossVV(f,this.m_axis),this.m_motorMass=v+y+x*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),Tt.MulRV(m,this.m_localYAxisA,this.m_perp),this.m_s1=Mt.CrossVV(Mt.AddVV(d,_,Mt.s_t0),this.m_perp),this.m_s2=Mt.CrossVV(f,this.m_perp),this.m_K.ex.x=v+y+x*this.m_s1*this.m_s1+g*this.m_s2*this.m_s2,this.m_K.ex.y=x*this.m_s1+g*this.m_s2,this.m_K.ex.z=x*this.m_s1*this.m_a1+g*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=x+g,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=x*this.m_a1+g*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=v+y+x*this.m_a1*this.m_a1+g*this.m_a2*this.m_a2,this.m_enableLimit){var b=Mt.DotVV(this.m_axis,d);ot(this.m_upperTranslation-this.m_lowerTranslation)<2*p?this.m_limitState=t.b2LimitState.e_equalLimits:b<=this.m_lowerTranslation?this.m_limitState!==t.b2LimitState.e_atLowerLimit&&(this.m_limitState=t.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):b>=this.m_upperTranslation?this.m_limitState!==t.b2LimitState.e_atUpperLimit&&(this.m_limitState=t.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),e.step.warmStarting){this.m_impulse.SelfMul(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio;var S=Mt.AddVV(Mt.MulSV(this.m_impulse.x,this.m_perp,Mt.s_t0),Mt.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,Mt.s_t1),s.InitVelocityConstraints_s_P),B=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,w=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;r.SelfMulSub(v,S),o-=x*B,u.SelfMulAdd(y,S),h+=g*w}else this.m_impulse.SetZero(),this.m_motorImpulse=0;e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=h}},{key:"SolveVelocityConstraints",value:function(e){var i=e.velocities[this.m_indexA].v,n=e.velocities[this.m_indexA].w,r=e.velocities[this.m_indexB].v,o=e.velocities[this.m_indexB].w,a=this.m_invMassA,l=this.m_invMassB,u=this.m_invIA,h=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!==t.b2LimitState.e_equalLimits){var m=Mt.DotVV(this.m_axis,Mt.SubVV(r,i,Mt.s_t0))+this.m_a2*o-this.m_a1*n,c=this.m_motorMass*(this.m_motorSpeed-m),_=this.m_motorImpulse,f=e.step.dt*this.m_maxMotorForce;this.m_motorImpulse=ut(this.m_motorImpulse+c,-f,f),c=this.m_motorImpulse-_;var d=Mt.MulSV(c,this.m_axis,s.SolveVelocityConstraints_s_P),v=c*this.m_a1,y=c*this.m_a2;i.SelfMulSub(a,d),n-=u*v,r.SelfMulAdd(l,d),o+=h*y}var p=Mt.DotVV(this.m_perp,Mt.SubVV(r,i,Mt.s_t0))+this.m_s2*o-this.m_s1*n,x=o-n;if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit){var g=Mt.DotVV(this.m_axis,Mt.SubVV(r,i,Mt.s_t0))+this.m_a2*o-this.m_a1*n,b=s.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),S=this.m_K.Solve33(-p,-x,-g,s.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(S),this.m_limitState===t.b2LimitState.e_atLowerLimit?this.m_impulse.z=lt(this.m_impulse.z,0):this.m_limitState===t.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=at(this.m_impulse.z,0));var B=-p-(this.m_impulse.z-b.z)*this.m_K.ez.x,w=-x-(this.m_impulse.z-b.z)*this.m_K.ez.y,A=this.m_K.Solve22(B,w,s.SolveVelocityConstraints_s_f2r);A.x+=b.x,A.y+=b.y,this.m_impulse.x=A.x,this.m_impulse.y=A.y,S.x=this.m_impulse.x-b.x,S.y=this.m_impulse.y-b.y,S.z=this.m_impulse.z-b.z;var C=Mt.AddVV(Mt.MulSV(S.x,this.m_perp,Mt.s_t0),Mt.MulSV(S.z,this.m_axis,Mt.s_t1),s.SolveVelocityConstraints_s_P),M=S.x*this.m_s1+S.y+S.z*this.m_a1,V=S.x*this.m_s2+S.y+S.z*this.m_a2;i.SelfMulSub(a,C),n-=u*M,r.SelfMulAdd(l,C),o+=h*V}else{var k=this.m_K.Solve22(-p,-x,s.SolveVelocityConstraints_s_df2);this.m_impulse.x+=k.x,this.m_impulse.y+=k.y;var P=Mt.MulSV(k.x,this.m_perp,s.SolveVelocityConstraints_s_P),I=k.x*this.m_s1+k.y,T=k.x*this.m_s2+k.y;i.SelfMulSub(a,P),n-=u*I,r.SelfMulAdd(l,P),o+=h*T}e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].w=o}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(r),l=this.m_invMassA,u=this.m_invMassB,h=this.m_invIA,m=this.m_invIB,c=Tt.MulRV(o,this.m_lalcA,this.m_rA),_=Tt.MulRV(a,this.m_lalcB,this.m_rB),f=Mt.SubVV(Mt.AddVV(n,_,Mt.s_t0),Mt.AddVV(e,c,Mt.s_t1),s.SolvePositionConstraints_s_d),d=Tt.MulRV(o,this.m_localXAxisA,this.m_axis),v=Mt.CrossVV(Mt.AddVV(f,c,Mt.s_t0),d),y=Mt.CrossVV(_,d),g=Tt.MulRV(o,this.m_localYAxisA,this.m_perp),b=Mt.CrossVV(Mt.AddVV(f,c,Mt.s_t0),g),S=Mt.CrossVV(_,g),B=s.SolvePositionConstraints_s_impulse,A=Mt.DotVV(g,f),C=r-i-this.m_referenceAngle,M=ot(A),V=ot(C),k=!1,P=0;if(this.m_enableLimit){var I=Mt.DotVV(d,f);ot(this.m_upperTranslation-this.m_lowerTranslation)<2*p?(P=ut(I,-w,w),M=lt(M,ot(I)),k=!0):I<=this.m_lowerTranslation?(P=ut(I-this.m_lowerTranslation+p,-w,0),M=lt(M,this.m_lowerTranslation-I),k=!0):I>=this.m_upperTranslation&&(P=ut(I-this.m_upperTranslation-p,0,w),M=lt(M,I-this.m_upperTranslation),k=!0)}if(k){var T=l+u+h*b*b+m*S*S,G=h*b+m*S,L=h*b*v+m*S*y,D=h+m;0===D&&(D=1);var R=h*v+m*y,F=l+u+h*v*v+m*y*y,E=this.m_K3;E.ex.SetXYZ(T,G,L),E.ey.SetXYZ(G,D,R),E.ez.SetXYZ(L,R,F),B=E.Solve33(-A,-C,-P,B)}else{var O=l+u+h*b*b+m*S*S,z=h*b+m*S,j=h+m;0===j&&(j=1);var q=this.m_K2;q.ex.Set(O,z),q.ey.Set(z,j);var N=q.Solve(-A,-C,s.SolvePositionConstraints_s_impulse1);B.x=N.x,B.y=N.y,B.z=0}var X=Mt.AddVV(Mt.MulSV(B.x,g,Mt.s_t0),Mt.MulSV(B.z,d,Mt.s_t1),s.SolvePositionConstraints_s_P),J=B.x*b+B.y+B.z*v,W=B.x*S+B.y+B.z*y;return e.SelfMulSub(l,X),i-=h*J,n.SelfMulAdd(u,X),r+=m*W,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,M<=p&&V<=x}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.y}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointTranslation",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,s.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,s.GetJointTranslation_s_pB),i=Mt.SubVV(e,t,s.GetJointTranslation_s_d),n=this.m_bodyA.GetWorldVector(this.m_localXAxisA,s.GetJointTranslation_s_axis);return Mt.DotVV(i,n)}},{key:"GetJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;Mt.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=Tt.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);Mt.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var n=Tt.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),s=Mt.AddVV(t.m_sweep.c,i,Mt.s_t0),r=Mt.AddVV(e.m_sweep.c,n,Mt.s_t1),o=Mt.SubVV(r,s,Mt.s_t2),a=t.GetWorldVector(this.m_localXAxisA,this.m_axis),l=t.m_linearVelocity,u=e.m_linearVelocity,h=t.m_angularVelocity,m=e.m_angularVelocity;return Mt.DotVV(o,Mt.CrossSV(h,a,Mt.s_t0))+Mt.DotVV(a,Mt.SubVV(Mt.AddVCrossSV(u,m,n,Mt.s_t0),Mt.AddVCrossSV(l,h,i,Mt.s_t1),Mt.s_t0))}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerTranslation}},{key:"GetUpperLimit",value:function(){return this.m_upperTranslation}},{key:"SetLimits",value:function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorForce",value:function(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)}},{key:"GetMaxMotorForce",value:function(){return this.m_maxMotorForce}},{key:"GetMotorForce",value:function(t){return t*this.m_motorImpulse}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),s}(Sn);Rn.InitVelocityConstraints_s_d=new Mt,Rn.InitVelocityConstraints_s_P=new Mt,Rn.SolveVelocityConstraints_s_P=new Mt,Rn.SolveVelocityConstraints_s_f2r=new Mt,Rn.SolveVelocityConstraints_s_f1=new kt,Rn.SolveVelocityConstraints_s_df3=new kt,Rn.SolveVelocityConstraints_s_df2=new Mt,Rn.SolvePositionConstraints_s_d=new Mt,Rn.SolvePositionConstraints_s_impulse=new kt,Rn.SolvePositionConstraints_s_impulse1=new Mt,Rn.SolvePositionConstraints_s_P=new Mt,Rn.GetJointTranslation_s_pA=new Mt,Rn.GetJointTranslation_s_pB=new Mt,Rn.GetJointTranslation_s_d=new Mt,Rn.GetJointTranslation_s_axis=new Mt;var Fn=2,En=function(e){r(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_pulleyJoint)).groundAnchorA=new Mt(-1,1),e.groundAnchorB=new Mt(1,1),e.localAnchorA=new Mt(-1,0),e.localAnchorB=new Mt(1,0),e.lengthA=0,e.lengthB=0,e.ratio=1,e.collideConnected=!0,e}return l(n,[{key:"Initialize",value:function(t,e,i,n,s,r,o){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(i),this.groundAnchorB.Copy(n),this.bodyA.GetLocalPoint(s,this.localAnchorA),this.bodyB.GetLocalPoint(r,this.localAnchorB),this.lengthA=Mt.DistanceVV(s,i),this.lengthB=Mt.DistanceVV(r,n),this.ratio=o}}]),n}(bn),On=function(t){r(n,t);var e=o(n);function n(t){var s;return a(this,n),(s=e.call(this,t)).m_groundAnchorA=new Mt,s.m_groundAnchorB=new Mt,s.m_lengthA=0,s.m_lengthB=0,s.m_localAnchorA=new Mt,s.m_localAnchorB=new Mt,s.m_constant=0,s.m_ratio=0,s.m_impulse=0,s.m_indexA=0,s.m_indexB=0,s.m_uA=new Mt,s.m_uB=new Mt,s.m_rA=new Mt,s.m_rB=new Mt,s.m_localCenterA=new Mt,s.m_localCenterB=new Mt,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_mass=0,s.m_qA=new Tt,s.m_qB=new Tt,s.m_lalcA=new Mt,s.m_lalcB=new Mt,s.m_groundAnchorA.Copy(i(t.groundAnchorA,new Mt(-1,1))),s.m_groundAnchorB.Copy(i(t.groundAnchorB,new Mt(1,0))),s.m_localAnchorA.Copy(i(t.localAnchorA,new Mt(-1,0))),s.m_localAnchorB.Copy(i(t.localAnchorB,new Mt(1,0))),s.m_lengthA=i(t.lengthA,0),s.m_lengthB=i(t.lengthB,0),s.m_ratio=i(t.ratio,1),s.m_constant=i(t.lengthA,0)+s.m_ratio*i(t.lengthB,0),s.m_impulse=0,s}return l(n,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(i),m=this.m_qB.SetAngle(a);Mt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Tt.MulRV(h,this.m_lalcA,this.m_rA),Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Tt.MulRV(m,this.m_lalcB,this.m_rB),this.m_uA.Copy(e).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(o).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var c=this.m_uA.Length(),_=this.m_uB.Length();c>10*p?this.m_uA.SelfMul(1/c):this.m_uA.SetZero(),_>10*p?this.m_uB.SelfMul(1/_):this.m_uB.SetZero();var f=Mt.CrossVV(this.m_rA,this.m_uA),d=Mt.CrossVV(this.m_rB,this.m_uB),v=this.m_invMassA+this.m_invIA*f*f,y=this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=v+this.m_ratio*this.m_ratio*y,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var x=Mt.MulSV(-this.m_impulse,this.m_uA,n.InitVelocityConstraints_s_PA),g=Mt.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,n.InitVelocityConstraints_s_PB);s.SelfMulAdd(this.m_invMassA,x),r+=this.m_invIA*Mt.CrossVV(this.m_rA,x),l.SelfMulAdd(this.m_invMassB,g),u+=this.m_invIB*Mt.CrossVV(this.m_rB,g)}else this.m_impulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=u}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,o=Mt.AddVCrossSV(e,i,this.m_rA,n.SolveVelocityConstraints_s_vpA),a=Mt.AddVCrossSV(s,r,this.m_rB,n.SolveVelocityConstraints_s_vpB),l=-Mt.DotVV(this.m_uA,o)-this.m_ratio*Mt.DotVV(this.m_uB,a),u=-this.m_mass*l;this.m_impulse+=u;var h=Mt.MulSV(-u,this.m_uA,n.SolveVelocityConstraints_s_PA),m=Mt.MulSV(-this.m_ratio*u,this.m_uB,n.SolveVelocityConstraints_s_PB);e.SelfMulAdd(this.m_invMassA,h),i+=this.m_invIA*Mt.CrossVV(this.m_rA,h),s.SelfMulAdd(this.m_invMassB,m),r+=this.m_invIB*Mt.CrossVV(this.m_rB,m),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(r);Mt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=Tt.MulRV(o,this.m_lalcA,this.m_rA);Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u=Tt.MulRV(a,this.m_lalcB,this.m_rB),h=this.m_uA.Copy(e).SelfAdd(l).SelfSub(this.m_groundAnchorA),m=this.m_uB.Copy(s).SelfAdd(u).SelfSub(this.m_groundAnchorB),c=h.Length(),_=m.Length();c>10*p?h.SelfMul(1/c):h.SetZero(),_>10*p?m.SelfMul(1/_):m.SetZero();var f=Mt.CrossVV(l,h),d=Mt.CrossVV(u,m),v=this.m_invMassA+this.m_invIA*f*f,y=this.m_invMassB+this.m_invIB*d*d,x=v+this.m_ratio*this.m_ratio*y;x>0&&(x=1/x);var g=this.m_constant-c-this.m_ratio*_,b=ot(g),S=-x*g,B=Mt.MulSV(-S,h,n.SolvePositionConstraints_s_PA),w=Mt.MulSV(-this.m_ratio*S,m,n.SolvePositionConstraints_s_PB);return e.SelfMulAdd(this.m_invMassA,B),i+=this.m_invIA*Mt.CrossVV(l,B),s.SelfMulAdd(this.m_invMassB,w),r+=this.m_invIB*Mt.CrossVV(u,w),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,b<p}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetGroundAnchorA",value:function(){return this.m_groundAnchorA}},{key:"GetGroundAnchorB",value:function(){return this.m_groundAnchorB}},{key:"GetLengthA",value:function(){return this.m_lengthA}},{key:"GetLengthB",value:function(){return this.m_lengthB}},{key:"GetRatio",value:function(){return this.m_ratio}},{key:"GetCurrentLengthA",value:function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,n.GetCurrentLengthA_s_p),e=this.m_groundAnchorA;return Mt.DistanceVV(t,e)}},{key:"GetCurrentLengthB",value:function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,n.GetCurrentLengthB_s_p),e=this.m_groundAnchorB;return Mt.DistanceVV(t,e)}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},{key:"ShiftOrigin",value:function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)}}]),n}(Sn);On.InitVelocityConstraints_s_PA=new Mt,On.InitVelocityConstraints_s_PB=new Mt,On.SolveVelocityConstraints_s_vpA=new Mt,On.SolveVelocityConstraints_s_vpB=new Mt,On.SolveVelocityConstraints_s_PA=new Mt,On.SolveVelocityConstraints_s_PB=new Mt,On.SolvePositionConstraints_s_PA=new Mt,On.SolvePositionConstraints_s_PB=new Mt,On.GetCurrentLengthA_s_p=new Mt,On.GetCurrentLengthB_s_p=new Mt;var zn=function(e){r(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_revoluteJoint)).localAnchorA=new Mt(0,0),e.localAnchorB=new Mt(0,0),e.referenceAngle=0,e.enableLimit=!1,e.lowerAngle=0,e.upperAngle=0,e.enableMotor=!1,e.motorSpeed=0,e.maxMotorTorque=0,e}return l(n,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),n}(bn),jn=function(e){r(s,e);var n=o(s);function s(e){var r;return a(this,s),(r=n.call(this,e)).m_localAnchorA=new Mt,r.m_localAnchorB=new Mt,r.m_impulse=new kt,r.m_motorImpulse=0,r.m_enableMotor=!1,r.m_maxMotorTorque=0,r.m_motorSpeed=0,r.m_enableLimit=!1,r.m_referenceAngle=0,r.m_lowerAngle=0,r.m_upperAngle=0,r.m_indexA=0,r.m_indexB=0,r.m_rA=new Mt,r.m_rB=new Mt,r.m_localCenterA=new Mt,r.m_localCenterB=new Mt,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_mass=new It,r.m_motorMass=0,r.m_limitState=t.b2LimitState.e_inactiveLimit,r.m_qA=new Tt,r.m_qB=new Tt,r.m_lalcA=new Mt,r.m_lalcB=new Mt,r.m_K=new Pt,r.m_localAnchorA.Copy(i(e.localAnchorA,Mt.ZERO)),r.m_localAnchorB.Copy(i(e.localAnchorB,Mt.ZERO)),r.m_referenceAngle=i(e.referenceAngle,0),r.m_impulse.SetZero(),r.m_motorImpulse=0,r.m_lowerAngle=i(e.lowerAngle,0),r.m_upperAngle=i(e.upperAngle,0),r.m_maxMotorTorque=i(e.maxMotorTorque,0),r.m_motorSpeed=i(e.motorSpeed,0),r.m_enableLimit=i(e.enableLimit,!1),r.m_enableMotor=i(e.enableMotor,!1),r.m_limitState=t.b2LimitState.e_inactiveLimit,r}return l(s,[{key:"InitVelocityConstraints",value:function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=e.positions[this.m_indexA].a,n=e.velocities[this.m_indexA].v,r=e.velocities[this.m_indexA].w,o=e.positions[this.m_indexB].a,a=e.velocities[this.m_indexB].v,l=e.velocities[this.m_indexB].w,u=this.m_qA.SetAngle(i),h=this.m_qB.SetAngle(o);Mt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Tt.MulRV(u,this.m_lalcA,this.m_rA),Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Tt.MulRV(h,this.m_lalcB,this.m_rB);var m=this.m_invMassA,c=this.m_invMassB,_=this.m_invIA,f=this.m_invIB,d=_+f===0;if(this.m_mass.ex.x=m+c+this.m_rA.y*this.m_rA.y*_+this.m_rB.y*this.m_rB.y*f,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*_-this.m_rB.y*this.m_rB.x*f,this.m_mass.ez.x=-this.m_rA.y*_-this.m_rB.y*f,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=m+c+this.m_rA.x*this.m_rA.x*_+this.m_rB.x*this.m_rB.x*f,this.m_mass.ez.y=this.m_rA.x*_+this.m_rB.x*f,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=_+f,this.m_motorMass=_+f,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!d||(this.m_motorImpulse=0),this.m_enableLimit&&!d){var v=o-i-this.m_referenceAngle;ot(this.m_upperAngle-this.m_lowerAngle)<2*x?this.m_limitState=t.b2LimitState.e_equalLimits:v<=this.m_lowerAngle?(this.m_limitState!==t.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=t.b2LimitState.e_atLowerLimit):v>=this.m_upperAngle?(this.m_limitState!==t.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=t.b2LimitState.e_atUpperLimit):(this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=t.b2LimitState.e_inactiveLimit;if(e.step.warmStarting){this.m_impulse.SelfMul(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio;var y=s.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);n.SelfMulSub(m,y),r-=_*(Mt.CrossVV(this.m_rA,y)+this.m_motorImpulse+this.m_impulse.z),a.SelfMulAdd(c,y),l+=f*(Mt.CrossVV(this.m_rB,y)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;e.velocities[this.m_indexA].w=r,e.velocities[this.m_indexB].w=l}},{key:"SolveVelocityConstraints",value:function(e){var i=e.velocities[this.m_indexA].v,n=e.velocities[this.m_indexA].w,r=e.velocities[this.m_indexB].v,o=e.velocities[this.m_indexB].w,a=this.m_invMassA,l=this.m_invMassB,u=this.m_invIA,h=this.m_invIB,m=u+h===0;if(this.m_enableMotor&&this.m_limitState!==t.b2LimitState.e_equalLimits&&!m){var c=o-n-this.m_motorSpeed,_=-this.m_motorMass*c,f=this.m_motorImpulse,d=e.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=ut(this.m_motorImpulse+_,-d,d),n-=u*(_=this.m_motorImpulse-f),o+=h*_}if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit&&!m){var v=Mt.SubVV(Mt.AddVCrossSV(r,o,this.m_rB,Mt.s_t0),Mt.AddVCrossSV(i,n,this.m_rA,Mt.s_t1),s.SolveVelocityConstraints_s_Cdot1),y=o-n,p=this.m_mass.Solve33(v.x,v.y,y,s.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(this.m_limitState===t.b2LimitState.e_equalLimits)this.m_impulse.SelfAdd(p);else if(this.m_limitState===t.b2LimitState.e_atLowerLimit)if(this.m_impulse.z+p.z<0){var x=-v.x+this.m_impulse.z*this.m_mass.ez.x,g=-v.y+this.m_impulse.z*this.m_mass.ez.y,b=this.m_mass.Solve22(x,g,s.SolveVelocityConstraints_s_reduced_v2);p.x=b.x,p.y=b.y,p.z=-this.m_impulse.z,this.m_impulse.x+=b.x,this.m_impulse.y+=b.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(p);else if(this.m_limitState===t.b2LimitState.e_atUpperLimit)if(this.m_impulse.z+p.z>0){var S=-v.x+this.m_impulse.z*this.m_mass.ez.x,B=-v.y+this.m_impulse.z*this.m_mass.ez.y,w=this.m_mass.Solve22(S,B,s.SolveVelocityConstraints_s_reduced_v2);p.x=w.x,p.y=w.y,p.z=-this.m_impulse.z,this.m_impulse.x+=w.x,this.m_impulse.y+=w.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(p);var A=s.SolveVelocityConstraints_s_P.Set(p.x,p.y);i.SelfMulSub(a,A),n-=u*(Mt.CrossVV(this.m_rA,A)+p.z),r.SelfMulAdd(l,A),o+=h*(Mt.CrossVV(this.m_rB,A)+p.z)}else{var C=Mt.SubVV(Mt.AddVCrossSV(r,o,this.m_rB,Mt.s_t0),Mt.AddVCrossSV(i,n,this.m_rA,Mt.s_t1),s.SolveVelocityConstraints_s_Cdot_v2),M=this.m_mass.Solve22(-C.x,-C.y,s.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=M.x,this.m_impulse.y+=M.y,i.SelfMulSub(a,M),n-=u*Mt.CrossVV(this.m_rA,M),r.SelfMulAdd(l,M),o+=h*Mt.CrossVV(this.m_rB,M)}e.velocities[this.m_indexA].w=n,e.velocities[this.m_indexB].w=o}},{key:"SolvePositionConstraints",value:function(e){var i=e.positions[this.m_indexA].c,n=e.positions[this.m_indexA].a,r=e.positions[this.m_indexB].c,o=e.positions[this.m_indexB].a,a=this.m_qA.SetAngle(n),l=this.m_qB.SetAngle(o),u=0,h=0,m=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit&&!m){var c=o-n-this.m_referenceAngle,_=0;if(this.m_limitState===t.b2LimitState.e_equalLimits){var f=ut(c-this.m_lowerAngle,-A,A);_=-this.m_motorMass*f,u=ot(f)}else if(this.m_limitState===t.b2LimitState.e_atLowerLimit){var d=c-this.m_lowerAngle;u=-d,d=ut(d+x,-A,0),_=-this.m_motorMass*d}else if(this.m_limitState===t.b2LimitState.e_atUpperLimit){var v=c-this.m_upperAngle;u=v,v=ut(v-x,0,A),_=-this.m_motorMass*v}n-=this.m_invIA*_,o+=this.m_invIB*_}a.SetAngle(n),l.SetAngle(o),Mt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var y=Tt.MulRV(a,this.m_lalcA,this.m_rA);Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var g=Tt.MulRV(l,this.m_lalcB,this.m_rB),b=Mt.SubVV(Mt.AddVV(r,g,Mt.s_t0),Mt.AddVV(i,y,Mt.s_t1),s.SolvePositionConstraints_s_C_v2);h=b.Length();var S=this.m_invMassA,B=this.m_invMassB,w=this.m_invIA,C=this.m_invIB,M=this.m_K;M.ex.x=S+B+w*y.y*y.y+C*g.y*g.y,M.ex.y=-w*y.x*y.y-C*g.x*g.y,M.ey.x=M.ex.y,M.ey.y=S+B+w*y.x*y.x+C*g.x*g.x;var V=M.Solve(b.x,b.y,s.SolvePositionConstraints_s_impulse).SelfNeg();return i.SelfMulSub(S,V),n-=w*Mt.CrossVV(y,V),r.SelfMulAdd(B,V),o+=C*Mt.CrossVV(g,V),e.positions[this.m_indexA].a=n,e.positions[this.m_indexB].a=o,h<=p&&u<=x}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"GetJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle}},{key:"GetJointSpeed",value:function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"IsLimitEnabled",value:function(){return this.m_enableLimit}},{key:"EnableLimit",value:function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}},{key:"GetLowerLimit",value:function(){return this.m_lowerAngle}},{key:"GetUpperLimit",value:function(){return this.m_upperAngle}},{key:"SetLimits",value:function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),s}(Sn);jn.InitVelocityConstraints_s_P=new Mt,jn.SolveVelocityConstraints_s_P=new Mt,jn.SolveVelocityConstraints_s_Cdot_v2=new Mt,jn.SolveVelocityConstraints_s_Cdot1=new Mt,jn.SolveVelocityConstraints_s_impulse_v3=new kt,jn.SolveVelocityConstraints_s_reduced_v2=new Mt,jn.SolveVelocityConstraints_s_impulse_v2=new Mt,jn.SolvePositionConstraints_s_C_v2=new Mt,jn.SolvePositionConstraints_s_impulse=new Mt;var qn=function(e){r(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_ropeJoint)).localAnchorA=new Mt(-1,0),e.localAnchorB=new Mt(1,0),e.maxLength=0,e}return l(n)}(bn),Nn=function(e){r(s,e);var n=o(s);function s(e){var r;return a(this,s),(r=n.call(this,e)).m_localAnchorA=new Mt,r.m_localAnchorB=new Mt,r.m_maxLength=0,r.m_length=0,r.m_impulse=0,r.m_indexA=0,r.m_indexB=0,r.m_u=new Mt,r.m_rA=new Mt,r.m_rB=new Mt,r.m_localCenterA=new Mt,r.m_localCenterB=new Mt,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_mass=0,r.m_state=t.b2LimitState.e_inactiveLimit,r.m_qA=new Tt,r.m_qB=new Tt,r.m_lalcA=new Mt,r.m_lalcB=new Mt,r.m_localAnchorA.Copy(i(e.localAnchorA,new Mt(-1,0))),r.m_localAnchorB.Copy(i(e.localAnchorB,new Mt(1,0))),r.m_maxLength=i(e.maxLength,0),r}return l(s,[{key:"InitVelocityConstraints",value:function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var i=e.positions[this.m_indexA].c,n=e.positions[this.m_indexA].a,r=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,a=e.positions[this.m_indexB].c,l=e.positions[this.m_indexB].a,u=e.velocities[this.m_indexB].v,h=e.velocities[this.m_indexB].w,m=this.m_qA.SetAngle(n),c=this.m_qB.SetAngle(l);Mt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Tt.MulRV(m,this.m_lalcA,this.m_rA),Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Tt.MulRV(c,this.m_lalcB,this.m_rB),this.m_u.Copy(a).SelfAdd(this.m_rB).SelfSub(i).SelfSub(this.m_rA),this.m_length=this.m_u.Length();var _=this.m_length-this.m_maxLength;if(this.m_state=_>0?t.b2LimitState.e_atUpperLimit:t.b2LimitState.e_inactiveLimit,!(this.m_length>p))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);var f=Mt.CrossVV(this.m_rA,this.m_u),d=Mt.CrossVV(this.m_rB,this.m_u),v=this.m_invMassA+this.m_invIA*f*f+this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=0!==v?1/v:0,e.step.warmStarting){this.m_impulse*=e.step.dtRatio;var y=Mt.MulSV(this.m_impulse,this.m_u,s.InitVelocityConstraints_s_P);r.SelfMulSub(this.m_invMassA,y),o-=this.m_invIA*Mt.CrossVV(this.m_rA,y),u.SelfMulAdd(this.m_invMassB,y),h+=this.m_invIB*Mt.CrossVV(this.m_rB,y)}else this.m_impulse=0;e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=h}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,n=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,o=Mt.AddVCrossSV(e,i,this.m_rA,s.SolveVelocityConstraints_s_vpA),a=Mt.AddVCrossSV(n,r,this.m_rB,s.SolveVelocityConstraints_s_vpB),l=this.m_length-this.m_maxLength,u=Mt.DotVV(this.m_u,Mt.SubVV(a,o,Mt.s_t0));l<0&&(u+=t.step.inv_dt*l);var h=-this.m_mass*u,m=this.m_impulse;this.m_impulse=at(0,this.m_impulse+h),h=this.m_impulse-m;var c=Mt.MulSV(h,this.m_u,s.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,c),i-=this.m_invIA*Mt.CrossVV(this.m_rA,c),n.SelfMulAdd(this.m_invMassB,c),r+=this.m_invIB*Mt.CrossVV(this.m_rB,c),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,n=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(r);Mt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=Tt.MulRV(o,this.m_lalcA,this.m_rA);Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u=Tt.MulRV(a,this.m_lalcB,this.m_rB),h=this.m_u.Copy(n).SelfAdd(u).SelfSub(e).SelfSub(l),m=h.Normalize(),c=m-this.m_maxLength;c=ut(c,0,w);var _=-this.m_mass*c,f=Mt.MulSV(_,h,s.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,f),i-=this.m_invIA*Mt.CrossVV(l,f),n.SelfMulAdd(this.m_invMassB,f),r+=this.m_invIB*Mt.CrossVV(u,f),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,m-this.m_maxLength<p}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return Mt.MulSV(t*this.m_impulse,this.m_u,e)}},{key:"GetReactionTorque",value:function(t){return 0}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"SetMaxLength",value:function(t){this.m_maxLength=t}},{key:"GetMaxLength",value:function(){return this.m_maxLength}},{key:"GetLimitState",value:function(){return this.m_state}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2RopeJointDef = new b2RopeJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),s}(Sn);Nn.InitVelocityConstraints_s_P=new Mt,Nn.SolveVelocityConstraints_s_vpA=new Mt,Nn.SolveVelocityConstraints_s_vpB=new Mt,Nn.SolveVelocityConstraints_s_P=new Mt,Nn.SolvePositionConstraints_s_P=new Mt;var Xn=function(e){r(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_weldJoint)).localAnchorA=new Mt,e.localAnchorB=new Mt,e.referenceAngle=0,e.frequencyHz=0,e.dampingRatio=0,e}return l(n,[{key:"Initialize",value:function(t,e,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}}]),n}(bn),Jn=function(t){r(n,t);var e=o(n);function n(t){var s;return a(this,n),(s=e.call(this,t)).m_frequencyHz=0,s.m_dampingRatio=0,s.m_bias=0,s.m_localAnchorA=new Mt,s.m_localAnchorB=new Mt,s.m_referenceAngle=0,s.m_gamma=0,s.m_impulse=new kt(0,0,0),s.m_indexA=0,s.m_indexB=0,s.m_rA=new Mt,s.m_rB=new Mt,s.m_localCenterA=new Mt,s.m_localCenterB=new Mt,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_mass=new It,s.m_qA=new Tt,s.m_qB=new Tt,s.m_lalcA=new Mt,s.m_lalcB=new Mt,s.m_K=new It,s.m_frequencyHz=i(t.frequencyHz,0),s.m_dampingRatio=i(t.dampingRatio,0),s.m_localAnchorA.Copy(i(t.localAnchorA,Mt.ZERO)),s.m_localAnchorB.Copy(i(t.localAnchorB,Mt.ZERO)),s.m_referenceAngle=i(t.referenceAngle,0),s.m_impulse.SetZero(),s}return l(n,[{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,o=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(e),u=this.m_qB.SetAngle(r);Mt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Tt.MulRV(l,this.m_lalcA,this.m_rA),Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Tt.MulRV(u,this.m_lalcB,this.m_rB);var h=this.m_invMassA,m=this.m_invMassB,c=this.m_invIA,f=this.m_invIB,d=this.m_K;if(d.ex.x=h+m+this.m_rA.y*this.m_rA.y*c+this.m_rB.y*this.m_rB.y*f,d.ey.x=-this.m_rA.y*this.m_rA.x*c-this.m_rB.y*this.m_rB.x*f,d.ez.x=-this.m_rA.y*c-this.m_rB.y*f,d.ex.y=d.ey.x,d.ey.y=h+m+this.m_rA.x*this.m_rA.x*c+this.m_rB.x*this.m_rB.x*f,d.ez.y=this.m_rA.x*c+this.m_rB.x*f,d.ex.z=d.ez.x,d.ey.z=d.ez.y,d.ez.z=c+f,this.m_frequencyHz>0){d.GetInverse22(this.m_mass);var v=c+f,y=v>0?1/v:0,p=r-e-this.m_referenceAngle,x=2*_*this.m_frequencyHz,g=2*y*this.m_dampingRatio*x,b=y*x*x,S=t.step.dt;this.m_gamma=S*(g+S*b),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=p*S*b*this.m_gamma,v+=this.m_gamma,this.m_mass.ez.z=0!==v?1/v:0}else d.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);var B=n.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(h,B),s-=c*(Mt.CrossVV(this.m_rA,B)+this.m_impulse.z),o.SelfMulAdd(m,B),a+=f*(Mt.CrossVV(this.m_rB,B)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=a}},{key:"SolveVelocityConstraints",value:function(t){var e=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,s=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,o=this.m_invMassA,a=this.m_invMassB,l=this.m_invIA,u=this.m_invIB;if(this.m_frequencyHz>0){var h=r-i,m=-this.m_mass.ez.z*(h+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=m,i-=l*m,r+=u*m;var c=Mt.SubVV(Mt.AddVCrossSV(s,r,this.m_rB,Mt.s_t0),Mt.AddVCrossSV(e,i,this.m_rA,Mt.s_t1),n.SolveVelocityConstraints_s_Cdot1),_=It.MulM33XY(this.m_mass,c.x,c.y,n.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=_.x,this.m_impulse.y+=_.y;var f=_;e.SelfMulSub(o,f),i-=l*Mt.CrossVV(this.m_rA,f),s.SelfMulAdd(a,f),r+=u*Mt.CrossVV(this.m_rB,f)}else{var d=Mt.SubVV(Mt.AddVCrossSV(s,r,this.m_rB,Mt.s_t0),Mt.AddVCrossSV(e,i,this.m_rA,Mt.s_t1),n.SolveVelocityConstraints_s_Cdot1),v=r-i,y=It.MulM33XYZ(this.m_mass,d.x,d.y,v,n.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(y);var p=n.SolveVelocityConstraints_s_P.Set(y.x,y.y);e.SelfMulSub(o,p),i-=l*(Mt.CrossVV(this.m_rA,p)+y.z),s.SelfMulAdd(a,p),r+=u*(Mt.CrossVV(this.m_rB,p)+y.z)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=r}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(r),l=this.m_invMassA,u=this.m_invMassB,h=this.m_invIA,m=this.m_invIB;Mt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var c=Tt.MulRV(o,this.m_lalcA,this.m_rA);Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var _,f,d=Tt.MulRV(a,this.m_lalcB,this.m_rB),v=this.m_K;if(v.ex.x=l+u+c.y*c.y*h+d.y*d.y*m,v.ey.x=-c.y*c.x*h-d.y*d.x*m,v.ez.x=-c.y*h-d.y*m,v.ex.y=v.ey.x,v.ey.y=l+u+c.x*c.x*h+d.x*d.x*m,v.ez.y=c.x*h+d.x*m,v.ex.z=v.ez.x,v.ey.z=v.ez.y,v.ez.z=h+m,this.m_frequencyHz>0){var y=Mt.SubVV(Mt.AddVV(s,d,Mt.s_t0),Mt.AddVV(e,c,Mt.s_t1),n.SolvePositionConstraints_s_C1);_=y.Length(),f=0;var g=v.Solve22(y.x,y.y,n.SolvePositionConstraints_s_P).SelfNeg();e.SelfMulSub(l,g),i-=h*Mt.CrossVV(c,g),s.SelfMulAdd(u,g),r+=m*Mt.CrossVV(d,g)}else{var b=Mt.SubVV(Mt.AddVV(s,d,Mt.s_t0),Mt.AddVV(e,c,Mt.s_t1),n.SolvePositionConstraints_s_C1),S=r-i-this.m_referenceAngle;_=b.Length(),f=ot(S);var B=v.Solve33(b.x,b.y,S,n.SolvePositionConstraints_s_impulse).SelfNeg(),w=n.SolvePositionConstraints_s_P.Set(B.x,B.y);e.SelfMulSub(l,w),i-=h*(Mt.CrossVV(this.m_rA,w)+B.z),s.SelfMulAdd(u,w),r+=m*(Mt.CrossVV(this.m_rB,w)+B.z)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,_<=p&&f<=x}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e}},{key:"GetReactionTorque",value:function(t){return t*this.m_impulse.z}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetReferenceAngle",value:function(){return this.m_referenceAngle}},{key:"SetFrequency",value:function(t){this.m_frequencyHz=t}},{key:"GetFrequency",value:function(){return this.m_frequencyHz}},{key:"SetDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetDampingRatio",value:function(){return this.m_dampingRatio}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),n}(Sn);Jn.InitVelocityConstraints_s_P=new Mt,Jn.SolveVelocityConstraints_s_Cdot1=new Mt,Jn.SolveVelocityConstraints_s_impulse1=new Mt,Jn.SolveVelocityConstraints_s_impulse=new kt,Jn.SolveVelocityConstraints_s_P=new Mt,Jn.SolvePositionConstraints_s_C1=new Mt,Jn.SolvePositionConstraints_s_P=new Mt,Jn.SolvePositionConstraints_s_impulse=new kt;var Wn=function(e){r(n,e);var i=o(n);function n(){var e;return a(this,n),(e=i.call(this,t.b2JointType.e_wheelJoint)).localAnchorA=new Mt(0,0),e.localAnchorB=new Mt(0,0),e.localAxisA=new Mt(1,0),e.enableMotor=!1,e.maxMotorTorque=0,e.motorSpeed=0,e.frequencyHz=2,e.dampingRatio=.7,e}return l(n,[{key:"Initialize",value:function(t,e,i,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(i,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.bodyA.GetLocalVector(n,this.localAxisA)}}]),n}(bn),Un=function(t){r(n,t);var e=o(n);function n(t){var s;return a(this,n),(s=e.call(this,t)).m_frequencyHz=0,s.m_dampingRatio=0,s.m_localAnchorA=new Mt,s.m_localAnchorB=new Mt,s.m_localXAxisA=new Mt,s.m_localYAxisA=new Mt,s.m_impulse=0,s.m_motorImpulse=0,s.m_springImpulse=0,s.m_maxMotorTorque=0,s.m_motorSpeed=0,s.m_enableMotor=!1,s.m_indexA=0,s.m_indexB=0,s.m_localCenterA=new Mt,s.m_localCenterB=new Mt,s.m_invMassA=0,s.m_invMassB=0,s.m_invIA=0,s.m_invIB=0,s.m_ax=new Mt,s.m_ay=new Mt,s.m_sAx=0,s.m_sBx=0,s.m_sAy=0,s.m_sBy=0,s.m_mass=0,s.m_motorMass=0,s.m_springMass=0,s.m_bias=0,s.m_gamma=0,s.m_qA=new Tt,s.m_qB=new Tt,s.m_lalcA=new Mt,s.m_lalcB=new Mt,s.m_rA=new Mt,s.m_rB=new Mt,s.m_frequencyHz=i(t.frequencyHz,2),s.m_dampingRatio=i(t.dampingRatio,.7),s.m_localAnchorA.Copy(i(t.localAnchorA,Mt.ZERO)),s.m_localAnchorB.Copy(i(t.localAnchorB,Mt.ZERO)),s.m_localXAxisA.Copy(i(t.localAxisA,Mt.UNITX)),Mt.CrossOneV(s.m_localXAxisA,s.m_localYAxisA),s.m_maxMotorTorque=i(t.maxMotorTorque,0),s.m_motorSpeed=i(t.motorSpeed,0),s.m_enableMotor=i(t.enableMotor,!1),s.m_ax.SetZero(),s.m_ay.SetZero(),s}return l(n,[{key:"GetMotorSpeed",value:function(){return this.m_motorSpeed}},{key:"GetMaxMotorTorque",value:function(){return this.m_maxMotorTorque}},{key:"SetSpringFrequencyHz",value:function(t){this.m_frequencyHz=t}},{key:"GetSpringFrequencyHz",value:function(){return this.m_frequencyHz}},{key:"SetSpringDampingRatio",value:function(t){this.m_dampingRatio=t}},{key:"GetSpringDampingRatio",value:function(){return this.m_dampingRatio}},{key:"InitVelocityConstraints",value:function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,r=this.m_invIB,o=t.positions[this.m_indexA].c,a=t.positions[this.m_indexA].a,l=t.velocities[this.m_indexA].v,u=t.velocities[this.m_indexA].w,h=t.positions[this.m_indexB].c,m=t.positions[this.m_indexB].a,c=t.velocities[this.m_indexB].v,f=t.velocities[this.m_indexB].w,d=this.m_qA.SetAngle(a),v=this.m_qB.SetAngle(m);Mt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var y=Tt.MulRV(d,this.m_lalcA,this.m_rA);Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var p=Tt.MulRV(v,this.m_lalcB,this.m_rB),x=Mt.SubVV(Mt.AddVV(h,p,Mt.s_t0),Mt.AddVV(o,y,Mt.s_t1),n.InitVelocityConstraints_s_d);if(Tt.MulRV(d,this.m_localYAxisA,this.m_ay),this.m_sAy=Mt.CrossVV(Mt.AddVV(x,y,Mt.s_t0),this.m_ay),this.m_sBy=Mt.CrossVV(p,this.m_ay),this.m_mass=e+i+s*this.m_sAy*this.m_sAy+r*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){Tt.MulRV(d,this.m_localXAxisA,this.m_ax),this.m_sAx=Mt.CrossVV(Mt.AddVV(x,y,Mt.s_t0),this.m_ax),this.m_sBx=Mt.CrossVV(p,this.m_ax);var g=e+i+s*this.m_sAx*this.m_sAx+r*this.m_sBx*this.m_sBx;if(g>0){this.m_springMass=1/g;var b=Mt.DotVV(x,this.m_ax),S=2*_*this.m_frequencyHz,B=2*this.m_springMass*this.m_dampingRatio*S,w=this.m_springMass*S*S,A=t.step.dt;this.m_gamma=A*(B+A*w),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=b*A*w*this.m_gamma,this.m_springMass=g+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=s+r,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var C=Mt.AddVV(Mt.MulSV(this.m_impulse,this.m_ay,Mt.s_t0),Mt.MulSV(this.m_springImpulse,this.m_ax,Mt.s_t1),n.InitVelocityConstraints_s_P),M=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,V=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;l.SelfMulSub(this.m_invMassA,C),u-=this.m_invIA*M,c.SelfMulAdd(this.m_invMassB,C),f+=this.m_invIB*V}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=u,t.velocities[this.m_indexB].w=f}},{key:"SolveVelocityConstraints",value:function(t){var e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,r=this.m_invIB,o=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,l=t.velocities[this.m_indexB].v,u=t.velocities[this.m_indexB].w,h=Mt.DotVV(this.m_ax,Mt.SubVV(l,o,Mt.s_t0))+this.m_sBx*u-this.m_sAx*a,m=-this.m_springMass*(h+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=m;var c=Mt.MulSV(m,this.m_ax,n.SolveVelocityConstraints_s_P),_=m*this.m_sAx,f=m*this.m_sBx;o.SelfMulSub(e,c),a-=s*_,l.SelfMulAdd(i,c);var d=(u+=r*f)-a-this.m_motorSpeed,v=-this.m_motorMass*d,y=this.m_motorImpulse,p=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=ut(this.m_motorImpulse+v,-p,p),a-=s*(v=this.m_motorImpulse-y),u+=r*v;var x=Mt.DotVV(this.m_ay,Mt.SubVV(l,o,Mt.s_t0))+this.m_sBy*u-this.m_sAy*a,g=-this.m_mass*x;this.m_impulse+=g;var b=Mt.MulSV(g,this.m_ay,n.SolveVelocityConstraints_s_P),S=g*this.m_sAy,B=g*this.m_sBy;o.SelfMulSub(e,b),a-=s*S,l.SelfMulAdd(i,b),u+=r*B,t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=u}},{key:"SolvePositionConstraints",value:function(t){var e=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,s=t.positions[this.m_indexB].c,r=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),a=this.m_qB.SetAngle(r);Mt.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=Tt.MulRV(o,this.m_lalcA,this.m_rA);Mt.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var u,h=Tt.MulRV(a,this.m_lalcB,this.m_rB),m=Mt.AddVV(Mt.SubVV(s,e,Mt.s_t0),Mt.SubVV(h,l,Mt.s_t1),n.SolvePositionConstraints_s_d),c=Tt.MulRV(o,this.m_localYAxisA,this.m_ay),_=Mt.CrossVV(Mt.AddVV(m,l,Mt.s_t0),c),f=Mt.CrossVV(h,c),d=Mt.DotVV(m,this.m_ay),v=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;u=0!==v?-d/v:0;var y=Mt.MulSV(u,c,n.SolvePositionConstraints_s_P),x=u*_,g=u*f;return e.SelfMulSub(this.m_invMassA,y),i-=this.m_invIA*x,s.SelfMulAdd(this.m_invMassB,y),r+=this.m_invIB*g,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=r,ot(d)<=p}},{key:"GetDefinition",value:function(t){return t}},{key:"GetAnchorA",value:function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)}},{key:"GetAnchorB",value:function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)}},{key:"GetReactionForce",value:function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e}},{key:"GetReactionTorque",value:function(t){return t*this.m_motorImpulse}},{key:"GetLocalAnchorA",value:function(){return this.m_localAnchorA}},{key:"GetLocalAnchorB",value:function(){return this.m_localAnchorB}},{key:"GetLocalAxisA",value:function(){return this.m_localXAxisA}},{key:"GetJointTranslation",value:function(){return this.GetPrismaticJointTranslation()}},{key:"GetJointLinearSpeed",value:function(){return this.GetPrismaticJointSpeed()}},{key:"GetJointAngle",value:function(){return this.GetRevoluteJointAngle()}},{key:"GetJointAngularSpeed",value:function(){return this.GetRevoluteJointSpeed()}},{key:"GetPrismaticJointTranslation",value:function(){var t=this.m_bodyA,e=this.m_bodyB,i=t.GetWorldPoint(this.m_localAnchorA,new Mt),n=e.GetWorldPoint(this.m_localAnchorB,new Mt),s=Mt.SubVV(n,i,new Mt),r=t.GetWorldVector(this.m_localXAxisA,new Mt);return Mt.DotVV(s,r)}},{key:"GetPrismaticJointSpeed",value:function(){var t=this.m_bodyA,e=this.m_bodyB;Mt.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var i=Tt.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);Mt.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var n=Tt.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),s=Mt.AddVV(t.m_sweep.c,i,Mt.s_t0),r=Mt.AddVV(e.m_sweep.c,n,Mt.s_t1),o=Mt.SubVV(r,s,Mt.s_t2),a=t.GetWorldVector(this.m_localXAxisA,new Mt),l=t.m_linearVelocity,u=e.m_linearVelocity,h=t.m_angularVelocity,m=e.m_angularVelocity;return Mt.DotVV(o,Mt.CrossSV(h,a,Mt.s_t0))+Mt.DotVV(a,Mt.SubVV(Mt.AddVCrossSV(u,m,n,Mt.s_t0),Mt.AddVCrossSV(l,h,i,Mt.s_t1),Mt.s_t0))}},{key:"GetRevoluteJointAngle",value:function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a}},{key:"GetRevoluteJointSpeed",value:function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}},{key:"IsMotorEnabled",value:function(){return this.m_enableMotor}},{key:"EnableMotor",value:function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)}},{key:"SetMotorSpeed",value:function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)}},{key:"SetMaxMotorTorque",value:function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)}},{key:"GetMotorTorque",value:function(t){return t*this.m_motorImpulse}},{key:"Dump",value:function(t){var e=this.m_bodyA.m_islandIndex,i=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",i),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}}]),n}(Sn);function Hn(t,e){return ft(t*e)}function Zn(t,e){return t>e?t:e}Un.InitVelocityConstraints_s_d=new Mt,Un.InitVelocityConstraints_s_P=new Mt,Un.SolveVelocityConstraints_s_P=new Mt,Un.SolvePositionConstraints_s_d=new Mt,Un.SolvePositionConstraints_s_P=new Mt;var Yn=l((function t(e){a(this,t),this.prev=null,this.next=null,this.contact=e})),Kn=function(){function t(){a(this,t),this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_indexA=0,this.m_indexB=0,this.m_manifold=new Se,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new Se,this.m_nodeA=new Yn(this),this.m_nodeB=new Yn(this)}return l(t,[{key:"GetManifold",value:function(){return this.m_manifold}},{key:"GetWorldManifold",value:function(t){var e=this.m_fixtureA.GetBody(),i=this.m_fixtureB.GetBody(),n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape();t.Initialize(this.m_manifold,e.GetTransform(),n.m_radius,i.GetTransform(),s.m_radius)}},{key:"IsTouching",value:function(){return this.m_touchingFlag}},{key:"SetEnabled",value:function(t){this.m_enabledFlag=t}},{key:"IsEnabled",value:function(){return this.m_enabledFlag}},{key:"GetNext",value:function(){return this.m_next}},{key:"GetFixtureA",value:function(){return this.m_fixtureA}},{key:"GetChildIndexA",value:function(){return this.m_indexA}},{key:"GetFixtureB",value:function(){return this.m_fixtureB}},{key:"GetChildIndexB",value:function(){return this.m_indexB}},{key:"FlagForFiltering",value:function(){this.m_filterFlag=!0}},{key:"SetFriction",value:function(t){this.m_friction=t}},{key:"GetFriction",value:function(){return this.m_friction}},{key:"ResetFriction",value:function(){this.m_friction=Hn(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)}},{key:"SetRestitution",value:function(t){this.m_restitution=t}},{key:"GetRestitution",value:function(){return this.m_restitution}},{key:"ResetRestitution",value:function(){this.m_restitution=Zn(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"SetTangentSpeed",value:function(t){this.m_tangentSpeed=t}},{key:"GetTangentSpeed",value:function(){return this.m_tangentSpeed}},{key:"Reset",value:function(t,e,i,n){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=n,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,delete this.m_nodeA.contact,this.m_nodeA.prev=null,this.m_nodeA.next=null,delete this.m_nodeA.other,delete this.m_nodeB.contact,this.m_nodeB.prev=null,this.m_nodeB.next=null,delete this.m_nodeB.other,this.m_toiCount=0,this.m_friction=Hn(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Zn(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}},{key:"Update",value:function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;var i=!1,n=this.m_touchingFlag,s=this.m_fixtureA.IsSensor(),r=this.m_fixtureB.IsSensor(),o=s||r,a=this.m_fixtureA.GetBody(),l=this.m_fixtureB.GetBody(),u=a.GetTransform(),h=l.GetTransform();if(o){var m=this.m_fixtureA.GetShape(),c=this.m_fixtureB.GetShape();i=Le(m,this.m_indexA,c,this.m_indexB,u,h),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,u,h),i=this.m_manifold.pointCount>0;for(var _=0;_<this.m_manifold.pointCount;++_){var f=this.m_manifold.points[_];f.normalImpulse=0,f.tangentImpulse=0;for(var d=f.id,v=0;v<this.m_oldManifold.pointCount;++v){var y=this.m_oldManifold.points[v];if(y.id.key===d.key){f.normalImpulse=y.normalImpulse,f.tangentImpulse=y.tangentImpulse;break}}}i!==n&&(a.SetAwake(!0),l.SetAwake(!0))}this.m_touchingFlag=i,!n&&i&&t&&t.BeginContact(this),n&&!i&&t&&t.EndContact(this),!o&&i&&t&&t.PreSolve(this,this.m_oldManifold)}},{key:"ComputeTOI",value:function(e,i){var n=t.ComputeTOI_s_input;n.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),n.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),n.sweepA.Copy(e),n.sweepB.Copy(i),n.tMax=p;var s=t.ComputeTOI_s_output;return ui(s,n),s.t}}]),t}();Kn.ComputeTOI_s_input=new Ye,Kn.ComputeTOI_s_output=new Qe;var Qn=function(t){r(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return l(i,[{key:"Reset",value:function(t,e,r,o){n(s(i.prototype),"Reset",this).call(this,t,e,r,o)}},{key:"Evaluate",value:function(t,e,i){ci(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Kn),$n=function(t){r(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return l(i,[{key:"Reset",value:function(t,e,r,o){n(s(i.prototype),"Reset",this).call(this,t,e,r,o)}},{key:"Evaluate",value:function(t,e,i){zi(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Kn),ts=function(t){r(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return l(i,[{key:"Reset",value:function(t,e,r,o){n(s(i.prototype),"Reset",this).call(this,t,e,r,o)}},{key:"Evaluate",value:function(t,e,i){vi(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Kn),es=function(t){r(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return l(i,[{key:"Reset",value:function(t,e,r,o){n(s(i.prototype),"Reset",this).call(this,t,e,r,o)}},{key:"Evaluate",value:function(t,e,i){Zi(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Kn),is=function(t){r(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return l(i,[{key:"Reset",value:function(t,e,r,o){n(s(i.prototype),"Reset",this).call(this,t,e,r,o)}},{key:"Evaluate",value:function(t,e,i){en(t,this.m_fixtureA.GetShape(),e,this.m_fixtureB.GetShape(),i)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Kn),ns=function(t){r(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return l(i,[{key:"Reset",value:function(t,e,r,o){n(s(i.prototype),"Reset",this).call(this,t,e,r,o)}},{key:"Evaluate",value:function(t,e,n){var s=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape(),o=s,a=i.Evaluate_s_edge;o.GetChildEdge(a,this.m_indexA),Zi(t,a,e,r,n)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Kn);ns.Evaluate_s_edge=new ln;var ss=function(t){r(i,t);var e=o(i);function i(){return a(this,i),e.call(this)}return l(i,[{key:"Reset",value:function(t,e,r,o){n(s(i.prototype),"Reset",this).call(this,t,e,r,o)}},{key:"Evaluate",value:function(t,e,n){var s=this.m_fixtureA.GetShape(),r=this.m_fixtureB.GetShape(),o=s,a=i.Evaluate_s_edge;o.GetChildEdge(a,this.m_indexA),en(t,a,e,r,n)}}],[{key:"Create",value:function(t){return new i}},{key:"Destroy",value:function(t,e){}}]),i}(Kn);ss.Evaluate_s_edge=new ln;var rs=l((function t(){a(this,t),this.createFcn=null,this.destroyFcn=null,this.primary=!1})),os=function(){function e(t){a(this,e),this.m_allocator=null,this.m_allocator=t,this.InitializeRegisters()}return l(e,[{key:"AddType",value:function(t,e,i,n){var s=this,r=tt(256,(function(e){return t(s.m_allocator)}));function o(e){return r.pop()||t(e)}function a(t,e){r.push(t)}this.m_registers[i][n].createFcn=o,this.m_registers[i][n].destroyFcn=a,this.m_registers[i][n].primary=!0,i!==n&&(this.m_registers[n][i].createFcn=o,this.m_registers[n][i].destroyFcn=a,this.m_registers[n][i].primary=!1)}},{key:"InitializeRegisters",value:function(){this.m_registers=[];for(var e=0;e<t.b2ShapeType.e_shapeTypeCount;e++){this.m_registers[e]=[];for(var i=0;i<t.b2ShapeType.e_shapeTypeCount;i++)this.m_registers[e][i]=new rs}this.AddType(Qn.Create,Qn.Destroy,t.b2ShapeType.e_circleShape,t.b2ShapeType.e_circleShape),this.AddType(ts.Create,ts.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_circleShape),this.AddType($n.Create,$n.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_polygonShape),this.AddType(es.Create,es.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_circleShape),this.AddType(is.Create,is.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_polygonShape),this.AddType(ns.Create,ns.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_circleShape),this.AddType(ss.Create,ss.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_polygonShape)}},{key:"Create",value:function(t,e,i,n){var s=t.GetType(),r=i.GetType(),o=this.m_registers[s][r];if(o.createFcn){var a=o.createFcn(this.m_allocator);return o.primary?a.Reset(t,e,i,n):a.Reset(i,n,t,e),a}return null}},{key:"Destroy",value:function(t){var e=t.m_fixtureA,i=t.m_fixtureB;t.m_manifold.pointCount>0&&!e.IsSensor()&&!i.IsSensor()&&(e.GetBody().SetAwake(!0),i.GetBody().SetAwake(!0));var n=e.GetType(),s=i.GetType(),r=this.m_registers[n][s];r.destroyFcn&&r.destroyFcn(t,this.m_allocator)}}]),e}(),as=function(){function t(){a(this,t)}return l(t,[{key:"SayGoodbyeJoint",value:function(t){}},{key:"SayGoodbyeFixture",value:function(t){}},{key:"SayGoodbyeParticleGroup",value:function(t){}},{key:"SayGoodbyeParticle",value:function(t,e){}}]),t}(),ls=function(){function e(){a(this,e)}return l(e,[{key:"ShouldCollide",value:function(e,i){var n=e.GetBody(),s=i.GetBody();if(s.GetType()===t.b2BodyType.b2_staticBody&&n.GetType()===t.b2BodyType.b2_staticBody)return!1;if(!s.ShouldCollideConnected(n))return!1;var r=e.GetFilterData(),o=i.GetFilterData();return r.groupIndex===o.groupIndex&&0!==r.groupIndex?r.groupIndex>0:0!==(r.maskBits&o.categoryBits)&&0!==(r.categoryBits&o.maskBits)}},{key:"ShouldCollideFixtureParticle",value:function(t,e,i){return!0}},{key:"ShouldCollideParticleParticle",value:function(t,e,i){return!0}}]),e}();ls.b2_defaultFilter=new ls;var us=l((function t(){a(this,t),this.normalImpulses=it(f),this.tangentImpulses=it(f),this.count=0})),hs=function(){function t(){a(this,t)}return l(t,[{key:"BeginContact",value:function(t){}},{key:"EndContact",value:function(t){}},{key:"BeginContactFixtureParticle",value:function(t,e){}},{key:"EndContactFixtureParticle",value:function(t,e){}},{key:"BeginContactParticleParticle",value:function(t,e){}},{key:"EndContactParticleParticle",value:function(t,e){}},{key:"PreSolve",value:function(t,e){}},{key:"PostSolve",value:function(t,e){}}]),t}();hs.b2_defaultListener=new hs;var ms=function(){function t(){a(this,t)}return l(t,[{key:"ReportFixture",value:function(t){return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),t}(),cs=function(){function t(){a(this,t)}return l(t,[{key:"ReportFixture",value:function(t,e,i,n){return n}},{key:"ReportParticle",value:function(t,e,i,n,s){return 0}},{key:"ShouldQueryParticleSystem",value:function(t){return!0}}]),t}(),_s=function(){function e(){a(this,e),this.m_broadPhase=new Oe,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=ls.b2_defaultFilter,this.m_contactListener=hs.b2_defaultListener,this.m_allocator=null,this.m_contactFactory=new os(this.m_allocator)}return l(e,[{key:"AddPair",value:function(t,e){var i=t.fixture,n=e.fixture,s=t.childIndex,r=e.childIndex,o=i.GetBody(),a=n.GetBody();if(o!==a){for(var l=a.GetContactList();l;){if(l.other===o){var u=l.contact.GetFixtureA(),h=l.contact.GetFixtureB(),m=l.contact.GetChildIndexA(),c=l.contact.GetChildIndexB();if(u===i&&h===n&&m===s&&c===r)return;if(u===n&&h===i&&m===r&&c===s)return}l=l.next}if(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(i,n)){var _=this.m_contactFactory.Create(i,s,n,r);null!==_&&(i=_.GetFixtureA(),n=_.GetFixtureB(),s=_.GetChildIndexA(),r=_.GetChildIndexB(),o=i.m_body,a=n.m_body,_.m_prev=null,_.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=_),this.m_contactList=_,_.m_nodeA.contact=_,_.m_nodeA.other=a,_.m_nodeA.prev=null,_.m_nodeA.next=o.m_contactList,null!==o.m_contactList&&(o.m_contactList.prev=_.m_nodeA),o.m_contactList=_.m_nodeA,_.m_nodeB.contact=_,_.m_nodeB.other=o,_.m_nodeB.prev=null,_.m_nodeB.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=_.m_nodeB),a.m_contactList=_.m_nodeB,i.IsSensor()||n.IsSensor()||(o.SetAwake(!0),a.SetAwake(!0)),++this.m_contactCount)}}}},{key:"FindNewContacts",value:function(){var t=this;this.m_broadPhase.UpdatePairs((function(e,i){t.AddPair(e,i)}))}},{key:"Destroy",value:function(t){var e=t.GetFixtureA(),i=t.GetFixtureB(),n=e.GetBody(),s=i.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===n.m_contactList&&(n.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===s.m_contactList&&(s.m_contactList=t.m_nodeB.next),this.m_contactFactory.Destroy(t),--this.m_contactCount}},{key:"Collide",value:function(){for(var e=this.m_contactList;e;){var i=e.GetFixtureA(),n=e.GetFixtureB(),s=e.GetChildIndexA(),r=e.GetChildIndexB(),o=i.GetBody(),a=n.GetBody();if(e.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(i,n)){var l=e;e=l.m_next,this.Destroy(l);continue}e.m_filterFlag=!1}var u=o.IsAwake()&&o.m_type!==t.b2BodyType.b2_staticBody,h=a.IsAwake()&&a.m_type!==t.b2BodyType.b2_staticBody;if(u||h){var m=i.m_proxies[s].treeNode,c=n.m_proxies[r].treeNode;if(ke(m.aabb,c.aabb))e.Update(this.m_contactListener),e=e.m_next;else{var _=e;e=_.m_next,this.Destroy(_)}}else e=e.m_next}}}]),e}(),fs=function(){function t(){a(this,t),this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}return l(t,[{key:"Reset",value:function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this}}]),t}(),ds=function(){function t(){a(this,t),this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}return l(t,[{key:"Copy",value:function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this}}]),t}(),vs=function(){function t(){a(this,t),this.c=new Mt,this.a=0}return l(t,null,[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),ys=function(){function t(){a(this,t),this.v=new Mt,this.w=0}return l(t,null,[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),ps=l((function t(){a(this,t),this.step=new ds})),xs=!1,gs=function(){function t(){a(this,t),this.rA=new Mt,this.rB=new Mt,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return l(t,null,[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),bs=function(){function t(){a(this,t),this.points=gs.MakeArray(f),this.normal=new Mt,this.tangent=new Mt,this.normalMass=new Pt,this.K=new Pt,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}return l(t,null,[{key:"MakeArray",value:function(e){return tt(e,(function(e){return new t}))}}]),t}(),Ss=function(){function e(){a(this,e),this.localPoints=Mt.MakeArray(f),this.localNormal=new Mt,this.localPoint=new Mt,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new Mt,this.localCenterB=new Mt,this.invIA=0,this.invIB=0,this.type=t.b2ManifoldType.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}return l(e,null,[{key:"MakeArray",value:function(t){return tt(t,(function(t){return new e}))}}]),e}(),Bs=l((function t(){a(this,t),this.step=new ds,this.count=0,this.allocator=null})),ws=function(){function e(){a(this,e),this.normal=new Mt,this.point=new Mt,this.separation=0}return l(e,[{key:"Initialize",value:function(i,n,s,r){var o=e.Initialize_s_pointA,a=e.Initialize_s_pointB,l=e.Initialize_s_planePoint,u=e.Initialize_s_clipPoint;switch(i.type){case t.b2ManifoldType.e_circles:Gt.MulXV(n,i.localPoint,o),Gt.MulXV(s,i.localPoints[0],a),Mt.SubVV(a,o,this.normal).SelfNormalize(),Mt.MidVV(o,a,this.point),this.separation=Mt.DotVV(Mt.SubVV(a,o,Mt.s_t0),this.normal)-i.radiusA-i.radiusB;break;case t.b2ManifoldType.e_faceA:Tt.MulRV(n.q,i.localNormal,this.normal),Gt.MulXV(n,i.localPoint,l),Gt.MulXV(s,i.localPoints[r],u),this.separation=Mt.DotVV(Mt.SubVV(u,l,Mt.s_t0),this.normal)-i.radiusA-i.radiusB,this.point.Copy(u);break;case t.b2ManifoldType.e_faceB:Tt.MulRV(s.q,i.localNormal,this.normal),Gt.MulXV(s,i.localPoint,l),Gt.MulXV(n,i.localPoints[r],u),this.separation=Mt.DotVV(Mt.SubVV(u,l,Mt.s_t0),this.normal)-i.radiusA-i.radiusB,this.point.Copy(u),this.normal.SelfNeg()}}}]),e}();ws.Initialize_s_pointA=new Mt,ws.Initialize_s_pointB=new Mt,ws.Initialize_s_planePoint=new Mt,ws.Initialize_s_clipPoint=new Mt;var As=function(){function t(){a(this,t),this.m_step=new ds,this.m_allocator=null,this.m_positionConstraints=Ss.MakeArray(1024),this.m_velocityConstraints=bs.MakeArray(1024),this.m_count=0}return l(t,[{key:"Initialize",value:function(t){if(this.m_step.Copy(t.step),this.m_allocator=t.allocator,this.m_count=t.count,this.m_positionConstraints.length<this.m_count)for(var e=lt(2*this.m_positionConstraints.length,this.m_count);this.m_positionConstraints.length<e;)this.m_positionConstraints[this.m_positionConstraints.length]=new Ss;if(this.m_velocityConstraints.length<this.m_count)for(var i=lt(2*this.m_velocityConstraints.length,this.m_count);this.m_velocityConstraints.length<i;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new bs;this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(var n=0;n<this.m_count;++n){var s=this.m_contacts[n],r=s.m_fixtureA,o=s.m_fixtureB,a=r.GetShape(),l=o.GetShape(),u=a.m_radius,h=l.m_radius,m=r.GetBody(),c=o.GetBody(),_=s.GetManifold(),f=_.pointCount,d=this.m_velocityConstraints[n];d.friction=s.m_friction,d.restitution=s.m_restitution,d.tangentSpeed=s.m_tangentSpeed,d.indexA=m.m_islandIndex,d.indexB=c.m_islandIndex,d.invMassA=m.m_invMass,d.invMassB=c.m_invMass,d.invIA=m.m_invI,d.invIB=c.m_invI,d.contactIndex=n,d.pointCount=f,d.K.SetZero(),d.normalMass.SetZero();var v=this.m_positionConstraints[n];v.indexA=m.m_islandIndex,v.indexB=c.m_islandIndex,v.invMassA=m.m_invMass,v.invMassB=c.m_invMass,v.localCenterA.Copy(m.m_sweep.localCenter),v.localCenterB.Copy(c.m_sweep.localCenter),v.invIA=m.m_invI,v.invIB=c.m_invI,v.localNormal.Copy(_.localNormal),v.localPoint.Copy(_.localPoint),v.pointCount=f,v.radiusA=u,v.radiusB=h,v.type=_.type;for(var y=0;y<f;++y){var p=_.points[y],x=d.points[y];this.m_step.warmStarting?(x.normalImpulse=this.m_step.dtRatio*p.normalImpulse,x.tangentImpulse=this.m_step.dtRatio*p.tangentImpulse):(x.normalImpulse=0,x.tangentImpulse=0),x.rA.SetZero(),x.rB.SetZero(),x.normalMass=0,x.tangentMass=0,x.velocityBias=0,v.localPoints[y].Copy(p.localPoint)}}return this}},{key:"InitializeVelocityConstraints",value:function(){for(var e=t.InitializeVelocityConstraints_s_xfA,i=t.InitializeVelocityConstraints_s_xfB,n=t.InitializeVelocityConstraints_s_worldManifold,s=1e3,r=0;r<this.m_count;++r){var o=this.m_velocityConstraints[r],a=this.m_positionConstraints[r],l=a.radiusA,u=a.radiusB,h=this.m_contacts[o.contactIndex].GetManifold(),m=o.indexA,c=o.indexB,_=o.invMassA,f=o.invMassB,d=o.invIA,v=o.invIB,y=a.localCenterA,p=a.localCenterB,x=this.m_positions[m].c,g=this.m_positions[m].a,b=this.m_velocities[m].v,S=this.m_velocities[m].w,w=this.m_positions[c].c,A=this.m_positions[c].a,C=this.m_velocities[c].v,M=this.m_velocities[c].w;e.q.SetAngle(g),i.q.SetAngle(A),Mt.SubVV(x,Tt.MulRV(e.q,y,Mt.s_t0),e.p),Mt.SubVV(w,Tt.MulRV(i.q,p,Mt.s_t0),i.p),n.Initialize(h,e,l,i,u),o.normal.Copy(n.normal),Mt.CrossVOne(o.normal,o.tangent);for(var V=o.pointCount,k=0;k<V;++k){var P=o.points[k];Mt.SubVV(n.points[k],x,P.rA),Mt.SubVV(n.points[k],w,P.rB);var I=Mt.CrossVV(P.rA,o.normal),T=Mt.CrossVV(P.rB,o.normal),G=_+f+d*I*I+v*T*T;P.normalMass=G>0?1/G:0;var L=o.tangent,D=Mt.CrossVV(P.rA,L),R=Mt.CrossVV(P.rB,L),F=_+f+d*D*D+v*R*R;P.tangentMass=F>0?1/F:0,P.velocityBias=0;var E=Mt.DotVV(o.normal,Mt.SubVV(Mt.AddVCrossSV(C,M,P.rB,Mt.s_t0),Mt.AddVCrossSV(b,S,P.rA,Mt.s_t1),Mt.s_t0));E<-B&&(P.velocityBias+=-o.restitution*E)}if(2===o.pointCount&&xs){var O=o.points[0],z=o.points[1],j=Mt.CrossVV(O.rA,o.normal),q=Mt.CrossVV(O.rB,o.normal),N=Mt.CrossVV(z.rA,o.normal),X=Mt.CrossVV(z.rB,o.normal),J=_+f+d*j*j+v*q*q,W=_+f+d*N*N+v*X*X,U=_+f+d*j*N+v*q*X;J*J<s*(J*W-U*U)?(o.K.ex.Set(J,U),o.K.ey.Set(U,W),o.K.GetInverse(o.normalMass)):o.pointCount=1}}}},{key:"WarmStart",value:function(){for(var e=t.WarmStart_s_P,i=0;i<this.m_count;++i){for(var n=this.m_velocityConstraints[i],s=n.indexA,r=n.indexB,o=n.invMassA,a=n.invIA,l=n.invMassB,u=n.invIB,h=n.pointCount,m=this.m_velocities[s].v,c=this.m_velocities[s].w,_=this.m_velocities[r].v,f=this.m_velocities[r].w,d=n.normal,v=n.tangent,y=0;y<h;++y){var p=n.points[y];Mt.AddVV(Mt.MulSV(p.normalImpulse,d,Mt.s_t0),Mt.MulSV(p.tangentImpulse,v,Mt.s_t1),e),c-=a*Mt.CrossVV(p.rA,e),m.SelfMulSub(o,e),f+=u*Mt.CrossVV(p.rB,e),_.SelfMulAdd(l,e)}this.m_velocities[s].w=c,this.m_velocities[r].w=f}}},{key:"SolveVelocityConstraints",value:function(){for(var e=t.SolveVelocityConstraints_s_dv,i=t.SolveVelocityConstraints_s_dv1,n=t.SolveVelocityConstraints_s_dv2,s=t.SolveVelocityConstraints_s_P,r=t.SolveVelocityConstraints_s_a,o=t.SolveVelocityConstraints_s_b,a=t.SolveVelocityConstraints_s_x,l=t.SolveVelocityConstraints_s_d,u=t.SolveVelocityConstraints_s_P1,h=t.SolveVelocityConstraints_s_P2,m=t.SolveVelocityConstraints_s_P1P2,c=0;c<this.m_count;++c){for(var _=this.m_velocityConstraints[c],f=_.indexA,d=_.indexB,v=_.invMassA,y=_.invIA,p=_.invMassB,x=_.invIB,g=_.pointCount,b=this.m_velocities[f].v,S=this.m_velocities[f].w,B=this.m_velocities[d].v,w=this.m_velocities[d].w,A=_.normal,C=_.tangent,M=_.friction,V=0;V<g;++V){var k=_.points[V];Mt.SubVV(Mt.AddVCrossSV(B,w,k.rB,Mt.s_t0),Mt.AddVCrossSV(b,S,k.rA,Mt.s_t1),e);var P=Mt.DotVV(e,C)-_.tangentSpeed,I=k.tangentMass*-P,T=M*k.normalImpulse,G=ut(k.tangentImpulse+I,-T,T);I=G-k.tangentImpulse,k.tangentImpulse=G,Mt.MulSV(I,C,s),b.SelfMulSub(v,s),S-=y*Mt.CrossVV(k.rA,s),B.SelfMulAdd(p,s),w+=x*Mt.CrossVV(k.rB,s)}if(1===_.pointCount||!1===xs)for(var L=0;L<g;++L){var D=_.points[L];Mt.SubVV(Mt.AddVCrossSV(B,w,D.rB,Mt.s_t0),Mt.AddVCrossSV(b,S,D.rA,Mt.s_t1),e);var R=Mt.DotVV(e,A),F=-D.normalMass*(R-D.velocityBias),E=lt(D.normalImpulse+F,0);F=E-D.normalImpulse,D.normalImpulse=E,Mt.MulSV(F,A,s),b.SelfMulSub(v,s),S-=y*Mt.CrossVV(D.rA,s),B.SelfMulAdd(p,s),w+=x*Mt.CrossVV(D.rB,s)}else{var O=_.points[0],z=_.points[1];r.Set(O.normalImpulse,z.normalImpulse),Mt.SubVV(Mt.AddVCrossSV(B,w,O.rB,Mt.s_t0),Mt.AddVCrossSV(b,S,O.rA,Mt.s_t1),i),Mt.SubVV(Mt.AddVCrossSV(B,w,z.rB,Mt.s_t0),Mt.AddVCrossSV(b,S,z.rA,Mt.s_t1),n);var j=Mt.DotVV(i,A),q=Mt.DotVV(n,A);for(o.x=j-O.velocityBias,o.y=q-z.velocityBias,o.SelfSub(Pt.MulMV(_.K,r,Mt.s_t0));;){if(Pt.MulMV(_.normalMass,o,a).SelfNeg(),a.x>=0&&a.y>=0){Mt.SubVV(a,r,l),Mt.MulSV(l.x,A,u),Mt.MulSV(l.y,A,h),Mt.AddVV(u,h,m),b.SelfMulSub(v,m),S-=y*(Mt.CrossVV(O.rA,u)+Mt.CrossVV(z.rA,h)),B.SelfMulAdd(p,m),w+=x*(Mt.CrossVV(O.rB,u)+Mt.CrossVV(z.rB,h)),O.normalImpulse=a.x,z.normalImpulse=a.y;break}if(a.x=-O.normalMass*o.x,a.y=0,j=0,q=_.K.ex.y*a.x+o.y,a.x>=0&&q>=0){Mt.SubVV(a,r,l),Mt.MulSV(l.x,A,u),Mt.MulSV(l.y,A,h),Mt.AddVV(u,h,m),b.SelfMulSub(v,m),S-=y*(Mt.CrossVV(O.rA,u)+Mt.CrossVV(z.rA,h)),B.SelfMulAdd(p,m),w+=x*(Mt.CrossVV(O.rB,u)+Mt.CrossVV(z.rB,h)),O.normalImpulse=a.x,z.normalImpulse=a.y;break}if(a.x=0,a.y=-z.normalMass*o.y,j=_.K.ey.x*a.y+o.x,q=0,a.y>=0&&j>=0){Mt.SubVV(a,r,l),Mt.MulSV(l.x,A,u),Mt.MulSV(l.y,A,h),Mt.AddVV(u,h,m),b.SelfMulSub(v,m),S-=y*(Mt.CrossVV(O.rA,u)+Mt.CrossVV(z.rA,h)),B.SelfMulAdd(p,m),w+=x*(Mt.CrossVV(O.rB,u)+Mt.CrossVV(z.rB,h)),O.normalImpulse=a.x,z.normalImpulse=a.y;break}if(a.x=0,a.y=0,j=o.x,q=o.y,j>=0&&q>=0){Mt.SubVV(a,r,l),Mt.MulSV(l.x,A,u),Mt.MulSV(l.y,A,h),Mt.AddVV(u,h,m),b.SelfMulSub(v,m),S-=y*(Mt.CrossVV(O.rA,u)+Mt.CrossVV(z.rA,h)),B.SelfMulAdd(p,m),w+=x*(Mt.CrossVV(O.rB,u)+Mt.CrossVV(z.rB,h)),O.normalImpulse=a.x,z.normalImpulse=a.y;break}break}}this.m_velocities[f].w=S,this.m_velocities[d].w=w}}},{key:"StoreImpulses",value:function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],i=this.m_contacts[e.contactIndex].GetManifold(),n=0;n<e.pointCount;++n)i.points[n].normalImpulse=e.points[n].normalImpulse,i.points[n].tangentImpulse=e.points[n].tangentImpulse}},{key:"SolvePositionConstraints",value:function(){for(var e=t.SolvePositionConstraints_s_xfA,i=t.SolvePositionConstraints_s_xfB,n=t.SolvePositionConstraints_s_psm,s=t.SolvePositionConstraints_s_rA,r=t.SolvePositionConstraints_s_rB,o=t.SolvePositionConstraints_s_P,a=0,l=0;l<this.m_count;++l){for(var u=this.m_positionConstraints[l],h=u.indexA,m=u.indexB,c=u.localCenterA,_=u.invMassA,f=u.invIA,d=u.localCenterB,v=u.invMassB,y=u.invIB,x=u.pointCount,g=this.m_positions[h].c,b=this.m_positions[h].a,S=this.m_positions[m].c,B=this.m_positions[m].a,A=0;A<x;++A){e.q.SetAngle(b),i.q.SetAngle(B),Mt.SubVV(g,Tt.MulRV(e.q,c,Mt.s_t0),e.p),Mt.SubVV(S,Tt.MulRV(i.q,d,Mt.s_t0),i.p),n.Initialize(u,e,i,A);var C=n.normal,M=n.point,V=n.separation;Mt.SubVV(M,g,s),Mt.SubVV(M,S,r),a=at(a,V);var k=ut(P*(V+p),-w,0),I=Mt.CrossVV(s,C),T=Mt.CrossVV(r,C),G=_+v+f*I*I+y*T*T,L=G>0?-k/G:0;Mt.MulSV(L,C,o),g.SelfMulSub(_,o),b-=f*Mt.CrossVV(s,o),S.SelfMulAdd(v,o),B+=y*Mt.CrossVV(r,o)}this.m_positions[h].a=b,this.m_positions[m].a=B}return a>-3*p}},{key:"SolveTOIPositionConstraints",value:function(e,i){for(var n=t.SolveTOIPositionConstraints_s_xfA,s=t.SolveTOIPositionConstraints_s_xfB,r=t.SolveTOIPositionConstraints_s_psm,o=t.SolveTOIPositionConstraints_s_rA,a=t.SolveTOIPositionConstraints_s_rB,l=t.SolveTOIPositionConstraints_s_P,u=0,h=0;h<this.m_count;++h){var m=this.m_positionConstraints[h],c=m.indexA,_=m.indexB,f=m.localCenterA,d=m.localCenterB,v=m.pointCount,y=0,x=0;c!==e&&c!==i||(y=m.invMassA,x=m.invIA);var g=0,b=0;_!==e&&_!==i||(g=m.invMassB,b=m.invIB);for(var S=this.m_positions[c].c,B=this.m_positions[c].a,A=this.m_positions[_].c,C=this.m_positions[_].a,M=0;M<v;++M){n.q.SetAngle(B),s.q.SetAngle(C),Mt.SubVV(S,Tt.MulRV(n.q,f,Mt.s_t0),n.p),Mt.SubVV(A,Tt.MulRV(s.q,d,Mt.s_t0),s.p),r.Initialize(m,n,s,M);var V=r.normal,k=r.point,P=r.separation;Mt.SubVV(k,S,o),Mt.SubVV(k,A,a),u=at(u,P);var T=ut(I*(P+p),-w,0),G=Mt.CrossVV(o,V),L=Mt.CrossVV(a,V),D=y+g+x*G*G+b*L*L,R=D>0?-T/D:0;Mt.MulSV(R,V,l),S.SelfMulSub(y,l),B-=x*Mt.CrossVV(o,l),A.SelfMulAdd(g,l),C+=b*Mt.CrossVV(a,l)}this.m_positions[c].a=B,this.m_positions[_].a=C}return u>=-1.5*p}}]),t}();As.InitializeVelocityConstraints_s_xfA=new Gt,As.InitializeVelocityConstraints_s_xfB=new Gt,As.InitializeVelocityConstraints_s_worldManifold=new Be,As.WarmStart_s_P=new Mt,As.SolveVelocityConstraints_s_dv=new Mt,As.SolveVelocityConstraints_s_dv1=new Mt,As.SolveVelocityConstraints_s_dv2=new Mt,As.SolveVelocityConstraints_s_P=new Mt,As.SolveVelocityConstraints_s_a=new Mt,As.SolveVelocityConstraints_s_b=new Mt,As.SolveVelocityConstraints_s_x=new Mt,As.SolveVelocityConstraints_s_d=new Mt,As.SolveVelocityConstraints_s_P1=new Mt,As.SolveVelocityConstraints_s_P2=new Mt,As.SolveVelocityConstraints_s_P1P2=new Mt,As.SolvePositionConstraints_s_xfA=new Gt,As.SolvePositionConstraints_s_xfB=new Gt,As.SolvePositionConstraints_s_psm=new ws,As.SolvePositionConstraints_s_rA=new Mt,As.SolvePositionConstraints_s_rB=new Mt,As.SolvePositionConstraints_s_P=new Mt,As.SolveTOIPositionConstraints_s_xfA=new Gt,As.SolveTOIPositionConstraints_s_xfB=new Gt,As.SolveTOIPositionConstraints_s_psm=new ws,As.SolveTOIPositionConstraints_s_rA=new Mt,As.SolveTOIPositionConstraints_s_rB=new Mt,As.SolveTOIPositionConstraints_s_P=new Mt;var Cs,Ms=function(){function e(){a(this,e),this.m_allocator=null,this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=vs.MakeArray(1024),this.m_velocities=ys.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}return l(e,[{key:"Initialize",value:function(t,e,i,n,s){if(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=n,this.m_listener=s,this.m_positions.length<t)for(var r=lt(2*this.m_positions.length,t);this.m_positions.length<r;)this.m_positions[this.m_positions.length]=new vs;if(this.m_velocities.length<t)for(var o=lt(2*this.m_velocities.length,t);this.m_velocities.length<o;)this.m_velocities[this.m_velocities.length]=new ys}},{key:"Clear",value:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0}},{key:"AddBody",value:function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t}},{key:"AddContact",value:function(t){this.m_contacts[this.m_contactCount++]=t}},{key:"AddJoint",value:function(t){this.m_joints[this.m_jointCount++]=t}},{key:"Solve",value:function(i,n,s,r){for(var o=e.s_timer.Reset(),a=n.dt,l=0;l<this.m_bodyCount;++l){var u=this.m_bodies[l];this.m_positions[l].c.Copy(u.m_sweep.c);var m=u.m_sweep.a,c=this.m_velocities[l].v.Copy(u.m_linearVelocity),_=u.m_angularVelocity;u.m_sweep.c0.Copy(u.m_sweep.c),u.m_sweep.a0=u.m_sweep.a,u.m_type===t.b2BodyType.b2_dynamicBody&&(c.x+=a*(u.m_gravityScale*s.x+u.m_invMass*u.m_force.x),c.y+=a*(u.m_gravityScale*s.y+u.m_invMass*u.m_force.y),_+=a*u.m_invI*u.m_torque,c.SelfMul(1/(1+a*u.m_linearDamping)),_*=1/(1+a*u.m_angularDamping)),this.m_positions[l].a=m,this.m_velocities[l].w=_}o.Reset();var f=e.s_solverData;f.step.Copy(n),f.positions=this.m_positions,f.velocities=this.m_velocities;var d=e.s_contactSolverDef;d.step.Copy(n),d.contacts=this.m_contacts,d.count=this.m_contactCount,d.positions=this.m_positions,d.velocities=this.m_velocities,d.allocator=this.m_allocator;var v=e.s_contactSolver.Initialize(d);v.InitializeVelocityConstraints(),n.warmStarting&&v.WarmStart();for(var y=0;y<this.m_jointCount;++y)this.m_joints[y].InitVelocityConstraints(f);i.solveInit=o.GetMilliseconds(),o.Reset();for(var p=0;p<n.velocityIterations;++p){for(var x=0;x<this.m_jointCount;++x)this.m_joints[x].SolveVelocityConstraints(f);v.SolveVelocityConstraints()}v.StoreImpulses(),i.solveVelocity=o.GetMilliseconds();for(var g=0;g<this.m_bodyCount;++g){var b=this.m_positions[g].c,S=this.m_positions[g].a,B=this.m_velocities[g].v,w=this.m_velocities[g].w,A=Mt.MulSV(a,B,e.s_translation);if(Mt.DotVV(A,A)>M){var P=C/A.Length();B.SelfMul(P)}var I=a*w;I*I>k&&(w*=V/ot(I)),b.x+=a*B.x,b.y+=a*B.y,S+=a*w,this.m_positions[g].a=S,this.m_velocities[g].w=w}o.Reset();for(var T=!1,G=0;G<n.positionIterations;++G){for(var L=v.SolvePositionConstraints(),D=!0,R=0;R<this.m_jointCount;++R){var F=this.m_joints[R].SolvePositionConstraints(f);D=D&&F}if(L&&D){T=!0;break}}for(var E=0;E<this.m_bodyCount;++E){var O=this.m_bodies[E];O.m_sweep.c.Copy(this.m_positions[E].c),O.m_sweep.a=this.m_positions[E].a,O.m_linearVelocity.Copy(this.m_velocities[E].v),O.m_angularVelocity=this.m_velocities[E].w,O.SynchronizeTransform()}if(i.solvePosition=o.GetMilliseconds(),this.Report(v.m_velocityConstraints),r){for(var z=h,j=N*N,J=X*X,W=0;W<this.m_bodyCount;++W){var U=this.m_bodies[W];U.GetType()!==t.b2BodyType.b2_staticBody&&(!U.m_autoSleepFlag||U.m_angularVelocity*U.m_angularVelocity>J||Mt.DotVV(U.m_linearVelocity,U.m_linearVelocity)>j?(U.m_sleepTime=0,z=0):(U.m_sleepTime+=a,z=at(z,U.m_sleepTime)))}if(z>=q&&T)for(var H=0;H<this.m_bodyCount;++H)this.m_bodies[H].SetAwake(!1)}}},{key:"SolveTOI",value:function(t,i,n){for(var s=0;s<this.m_bodyCount;++s){var r=this.m_bodies[s];this.m_positions[s].c.Copy(r.m_sweep.c),this.m_positions[s].a=r.m_sweep.a,this.m_velocities[s].v.Copy(r.m_linearVelocity),this.m_velocities[s].w=r.m_angularVelocity}var o=e.s_contactSolverDef;o.contacts=this.m_contacts,o.count=this.m_contactCount,o.allocator=this.m_allocator,o.step.Copy(t),o.positions=this.m_positions,o.velocities=this.m_velocities;for(var a=e.s_contactSolver.Initialize(o),l=0;l<t.positionIterations&&!a.SolveTOIPositionConstraints(i,n);++l);this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,this.m_bodies[n].m_sweep.c0.Copy(this.m_positions[n].c),this.m_bodies[n].m_sweep.a0=this.m_positions[n].a,a.InitializeVelocityConstraints();for(var u=0;u<t.velocityIterations;++u)a.SolveVelocityConstraints();for(var h=t.dt,m=0;m<this.m_bodyCount;++m){var c=this.m_positions[m].c,_=this.m_positions[m].a,f=this.m_velocities[m].v,d=this.m_velocities[m].w,v=Mt.MulSV(h,f,e.s_translation);if(Mt.DotVV(v,v)>M){var y=C/v.Length();f.SelfMul(y)}var p=h*d;p*p>k&&(d*=V/ot(p)),c.SelfMulAdd(h,f),_+=h*d,this.m_positions[m].a=_,this.m_velocities[m].w=d;var x=this.m_bodies[m];x.m_sweep.c.Copy(c),x.m_sweep.a=_,x.m_linearVelocity.Copy(f),x.m_angularVelocity=d,x.SynchronizeTransform()}this.Report(a.m_velocityConstraints)}},{key:"Report",value:function(t){if(null!==this.m_listener)for(var i=0;i<this.m_contactCount;++i){var n=this.m_contacts[i];if(n){var s=t[i],r=e.s_impulse;r.count=s.pointCount;for(var o=0;o<s.pointCount;++o)r.normalImpulses[o]=s.points[o].normalImpulse,r.tangentImpulses[o]=s.points[o].tangentImpulse;this.m_listener.PostSolve(n,r)}}}}]),e}();Ms.s_timer=new Et,Ms.s_solverData=new ps,Ms.s_contactSolverDef=new Bs,Ms.s_contactSolver=new As,Ms.s_translation=new Mt,Ms.s_impulse=new us,(Cs=t.b2ParticleFlag||(t.b2ParticleFlag={}))[Cs.b2_waterParticle=0]="b2_waterParticle",Cs[Cs.b2_zombieParticle=2]="b2_zombieParticle",Cs[Cs.b2_wallParticle=4]="b2_wallParticle",Cs[Cs.b2_springParticle=8]="b2_springParticle",Cs[Cs.b2_elasticParticle=16]="b2_elasticParticle",Cs[Cs.b2_viscousParticle=32]="b2_viscousParticle",Cs[Cs.b2_powderParticle=64]="b2_powderParticle",Cs[Cs.b2_tensileParticle=128]="b2_tensileParticle",Cs[Cs.b2_colorMixingParticle=256]="b2_colorMixingParticle",Cs[Cs.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",Cs[Cs.b2_barrierParticle=1024]="b2_barrierParticle",Cs[Cs.b2_staticPressureParticle=2048]="b2_staticPressureParticle",Cs[Cs.b2_reactiveParticle=4096]="b2_reactiveParticle",Cs[Cs.b2_repulsiveParticle=8192]="b2_repulsiveParticle",Cs[Cs.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",Cs[Cs.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",Cs[Cs.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",Cs[Cs.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle";var Vs=l((function t(){a(this,t),this.flags=0,this.position=new Mt,this.velocity=new Mt,this.color=new Rt(0,0,0,0),this.lifetime=0,this.userData=null,this.group=null}));function ks(t,e,i){var n=8,s=.01;return ut(Math.ceil(Math.sqrt(t/(s*e))*i),1,n)}var Ps,Is=function(){function t(){a(this,t),this.m_index=T}return l(t,[{key:"GetIndex",value:function(){return this.m_index}},{key:"SetIndex",value:function(t){this.m_index=t}}]),t}();(Ps=t.b2ParticleGroupFlag||(t.b2ParticleGroupFlag={}))[Ps.b2_solidParticleGroup=1]="b2_solidParticleGroup",Ps[Ps.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",Ps[Ps.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",Ps[Ps.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",Ps[Ps.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",Ps[Ps.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask";var Ts=l((function t(){a(this,t),this.flags=0,this.groupFlags=0,this.position=new Mt,this.angle=0,this.linearVelocity=new Mt,this.angularVelocity=0,this.color=new Rt,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null})),Gs=function(){function e(t){a(this,e),this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new Mt,this.m_linearVelocity=new Mt,this.m_angularVelocity=0,this.m_transform=new Gt,this.m_userData=null,this.m_system=t}return l(e,[{key:"GetNext",value:function(){return this.m_next}},{key:"GetParticleSystem",value:function(){return this.m_system}},{key:"GetParticleCount",value:function(){return this.m_lastIndex-this.m_firstIndex}},{key:"GetBufferIndex",value:function(){return this.m_firstIndex}},{key:"ContainsParticle",value:function(t){return this.m_firstIndex<=t&&t<this.m_lastIndex}},{key:"GetAllParticleFlags",value:function(){if(!this.m_system.m_flagsBuffer.data)throw new Error;for(var t=0,e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t}},{key:"GetGroupFlags",value:function(){return this.m_groupFlags}},{key:"SetGroupFlags",value:function(e){e|=this.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,e)}},{key:"GetMass",value:function(){return this.UpdateStatistics(),this.m_mass}},{key:"GetInertia",value:function(){return this.UpdateStatistics(),this.m_inertia}},{key:"GetCenter",value:function(){return this.UpdateStatistics(),this.m_center}},{key:"GetLinearVelocity",value:function(){return this.UpdateStatistics(),this.m_linearVelocity}},{key:"GetAngularVelocity",value:function(){return this.UpdateStatistics(),this.m_angularVelocity}},{key:"GetTransform",value:function(){return this.m_transform}},{key:"GetPosition",value:function(){return this.m_transform.p}},{key:"GetAngle",value:function(){return this.m_transform.q.GetAngle()}},{key:"GetLinearVelocityFromWorldPoint",value:function(t,i){var n=e.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),Mt.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Mt.SubVV(t,this.m_center,n),i)}},{key:"GetUserData",value:function(){return this.m_userData}},{key:"SetUserData",value:function(t){this.m_userData=t}},{key:"ApplyForce",value:function(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)}},{key:"ApplyLinearImpulse",value:function(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)}},{key:"DestroyParticles",value:function(t){if(this.m_system.m_world.IsLocked())throw new Error;for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)}},{key:"UpdateStatistics",value:function(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var t=new Mt,e=new Mt;if(this.m_timestamp!==this.m_system.m_timestamp){var i=this.m_system.GetParticleMass();this.m_mass=i*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var n=this.m_firstIndex;n<this.m_lastIndex;n++)this.m_center.SelfMulAdd(i,this.m_system.m_positionBuffer.data[n]),this.m_linearVelocity.SelfMulAdd(i,this.m_system.m_velocityBuffer.data[n]);if(this.m_mass>0){var s=1/this.m_mass;this.m_center.SelfMul(s),this.m_linearVelocity.SelfMul(s)}this.m_inertia=0,this.m_angularVelocity=0;for(var r=this.m_firstIndex;r<this.m_lastIndex;r++)Mt.SubVV(this.m_system.m_positionBuffer.data[r],this.m_center,t),Mt.SubVV(this.m_system.m_velocityBuffer.data[r],this.m_linearVelocity,e),this.m_inertia+=i*Mt.DotVV(t,t),this.m_angularVelocity+=i*Mt.CrossVV(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}}}]),e}();Gs.GetLinearVelocityFromWorldPoint_s_t0=new Mt;var Ls=function(){function t(e){a(this,t),this.m_front=0,this.m_back=0,this.m_capacity=0,this.m_buffer=tt(e,(function(t){return null})),this.m_capacity=e}return l(t,[{key:"Push",value:function(t){if(this.m_back>=this.m_capacity){for(var e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0,this.m_back>=this.m_capacity&&(this.m_capacity>0?(this.m_buffer.concat(tt(this.m_capacity,(function(t){return null}))),this.m_capacity*=2):(this.m_buffer.concat(tt(1,(function(t){return null}))),this.m_capacity=1))}this.m_buffer[this.m_back]=t,this.m_back++}},{key:"Pop",value:function(){this.m_buffer[this.m_front]=null,this.m_front++}},{key:"Empty",value:function(){return this.m_front===this.m_back}},{key:"Front",value:function(){var t=this.m_buffer[this.m_front];if(!t)throw new Error;return t}}]),t}(),Ds=function(){function t(e){a(this,t),this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=tt(e,(function(e){return new t.Generator})),this.m_generatorCapacity=e}return l(t,[{key:"AddGenerator",value:function(t,e,i){var n=this.m_generatorBuffer[this.m_generatorCount++];n.center.Copy(t),n.tag=e,n.necessary=i}},{key:"Generate",value:function(e,i){for(var n=1/e,s=new Mt(+h,+h),r=new Mt(-h,-h),o=0,a=0;a<this.m_generatorCount;a++){var l=this.m_generatorBuffer[a];l.necessary&&(Mt.MinV(s,l.center,s),Mt.MaxV(r,l.center,r),++o)}if(0===o)return this.m_countX=0,void(this.m_countY=0);s.x-=i,s.y-=i,r.x+=i,r.y+=i,this.m_countX=1+Math.floor(n*(r.x-s.x)),this.m_countY=1+Math.floor(n*(r.y-s.y)),this.m_diagram=[];for(var u=new Ls(4*this.m_countX*this.m_countY),m=0;m<this.m_generatorCount;m++){var c=this.m_generatorBuffer[m];c.center.SelfSub(s).SelfMul(n);var _=Math.floor(c.center.x),f=Math.floor(c.center.y);_>=0&&f>=0&&_<this.m_countX&&f<this.m_countY&&u.Push(new t.Task(_,f,_+f*this.m_countX,c))}for(;!u.Empty();){var d=u.Front(),v=d.m_x,y=d.m_y,p=d.m_i,x=d.m_generator;u.Pop(),this.m_diagram[p]||(this.m_diagram[p]=x,v>0&&u.Push(new t.Task(v-1,y,p-1,x)),y>0&&u.Push(new t.Task(v,y-1,p-this.m_countX,x)),v<this.m_countX-1&&u.Push(new t.Task(v+1,y,p+1,x)),y<this.m_countY-1&&u.Push(new t.Task(v,y+1,p+this.m_countX,x)))}for(var g=0;g<this.m_countY;g++)for(var b=0;b<this.m_countX-1;b++){var S=b+g*this.m_countX,B=this.m_diagram[S],w=this.m_diagram[S+1];B!==w&&(u.Push(new t.Task(b,g,S,w)),u.Push(new t.Task(b+1,g,S+1,B)))}for(var A=0;A<this.m_countY-1;A++)for(var C=0;C<this.m_countX;C++){var M=C+A*this.m_countX,V=this.m_diagram[M],k=this.m_diagram[M+this.m_countX];V!==k&&(u.Push(new t.Task(C,A,M,k)),u.Push(new t.Task(C,A+1,M+this.m_countX,V)))}for(;!u.Empty();){var P=u.Front(),I=P.m_x,T=P.m_y,G=P.m_i,L=P.m_generator;u.Pop();var D=this.m_diagram[G],R=L;if(D!==R){var F=D.center.x-I,E=D.center.y-T,O=R.center.x-I,z=R.center.y-T;F*F+E*E>O*O+z*z&&(this.m_diagram[G]=R,I>0&&u.Push(new t.Task(I-1,T,G-1,R)),T>0&&u.Push(new t.Task(I,T-1,G-this.m_countX,R)),I<this.m_countX-1&&u.Push(new t.Task(I+1,T,G+1,R)),T<this.m_countY-1&&u.Push(new t.Task(I,T+1,G+this.m_countX,R)))}}}},{key:"GetNodes",value:function(t){for(var e=0;e<this.m_countY-1;e++)for(var i=0;i<this.m_countX-1;i++){var n=i+e*this.m_countX,s=this.m_diagram[n],r=this.m_diagram[n+1],o=this.m_diagram[n+this.m_countX],a=this.m_diagram[n+1+this.m_countX];r!==o&&(s!==r&&s!==o&&(s.necessary||r.necessary||o.necessary)&&t(s.tag,r.tag,o.tag),a!==r&&a!==o&&(s.necessary||r.necessary||o.necessary)&&t(r.tag,a.tag,o.tag))}}}]),t}();function Rs(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function Fs(t,e){return t<e}function Es(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Fs,s=e,r=[],o=0;;){for(;s+1<i;i++){var a=t[s+Math.floor(Math.random()*(i-s))];r[o++]=i;for(var l=s-1;;){for(;n(t[++l],a););for(;n(a,t[--i]););if(l>=i)break;Rs(t,l,i)}}if(0===o)break;s=i,i=r[--o]}return t}function Os(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Es(t,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length-e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:Fs)}function zs(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length,n=0,s=0;s<i;++s)e(t[s])||(s!==n?Rs(t,n++,s):++n);return n}function js(t,e,i,n){for(var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Fs,r=i-e;r>0;){var o=Math.floor(r/2),a=e+o;s(t[a],n)?(e=++a,r-=o+1):r=o}return e}function qs(t,e,i,n){for(var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Fs,r=i-e;r>0;){var o=Math.floor(r/2),a=e+o;s(n,t[a])?r=o:(e=++a,r-=o+1)}return e}function Ns(t,e,i,n){for(var s=i;e!==s;)Rs(t,e++,s++),s===n?s=i:e===i&&(i=s)}function Xs(t,e,i,n){if(e===i)return i;for(var s=e;++e!==i;)n(t[s],t[e])||Rs(t,++s,e);return++s}!function(t){var e=l((function t(){a(this,t),this.center=new Mt,this.tag=0,this.necessary=!1}));t.Generator=e;var i=l((function t(e,i,n,s){a(this,t),this.m_x=e,this.m_y=i,this.m_i=n,this.m_generator=s}));t.Task=i}(Ds||(Ds={}));var Js=function(){function t(e){a(this,t),this.data=[],this.count=0,this.capacity=0,this.allocator=e}return l(t,[{key:"Append",value:function(){return this.count>=this.capacity&&this.Grow(),this.count++}},{key:"Reserve",value:function(t){if(!(this.capacity>=t)){for(var e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}}},{key:"Grow",value:function(){var t=this.capacity?2*this.capacity:z;this.Reserve(t)}},{key:"Free",value:function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)}},{key:"Shorten",value:function(t){}},{key:"Data",value:function(){return this.data}},{key:"GetCount",value:function(){return this.count}},{key:"SetCount",value:function(t){this.count=t}},{key:"GetCapacity",value:function(){return this.capacity}},{key:"RemoveIf",value:function(t){this.count=zs(this.data,t,this.count)}},{key:"Unique",value:function(t){this.count=Xs(this.data,0,this.count,t)}}]),t}(),Ws=function(t){r(i,t);var e=o(i);function i(t){var n;return a(this,i),(n=e.call(this)).m_system=t,n}return l(i,[{key:"ShouldQueryParticleSystem",value:function(t){return!1}},{key:"ReportFixture",value:function(t){if(t.IsSensor())return!0;for(var e=t.GetShape().GetChildCount(),i=0;i<e;i++)for(var n=t.GetAABB(i),s=this.m_system.GetInsideBoundsEnumerator(n),r=void 0;(r=s.GetNext())>=0;)this.ReportFixtureAndParticle(t,i,r);return!0}},{key:"ReportParticle",value:function(t,e){return!1}},{key:"ReportFixtureAndParticle",value:function(t,e,i){}}]),i}(ms),Us=function(){function t(){a(this,t),this.indexA=0,this.indexB=0,this.weight=0,this.normal=new Mt,this.flags=0}return l(t,[{key:"SetIndices",value:function(t,e){this.indexA=t,this.indexB=e}},{key:"SetWeight",value:function(t){this.weight=t}},{key:"SetNormal",value:function(t){this.normal.Copy(t)}},{key:"SetFlags",value:function(t){this.flags=t}},{key:"GetIndexA",value:function(){return this.indexA}},{key:"GetIndexB",value:function(){return this.indexB}},{key:"GetWeight",value:function(){return this.weight}},{key:"GetNormal",value:function(){return this.normal}},{key:"GetFlags",value:function(){return this.flags}},{key:"IsEqual",value:function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y}},{key:"IsNotEqual",value:function(t){return!this.IsEqual(t)}},{key:"ApproximatelyEqual",value:function(t){var e=.01,i=1e-4;return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&ot(this.weight-t.weight)<e&&Mt.DistanceSquaredVV(this.normal,t.normal)<i}}]),t}(),Hs=l((function t(){a(this,t),this.index=0,this.weight=0,this.normal=new Mt,this.mass=0})),Zs=l((function t(){a(this,t),this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0})),Ys=l((function t(){a(this,t),this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new Mt(0,0),this.pb=new Mt(0,0),this.pc=new Mt(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0})),Ks=function(){function t(){a(this,t),this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}return l(t,[{key:"Copy",value:function(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this}},{key:"Clone",value:function(){return(new t).Copy(this)}}]),t}(),Qs=function(){function e(t,i){a(this,e),this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new e.UserOverridableBuffer,this.m_flagsBuffer=new e.UserOverridableBuffer,this.m_positionBuffer=new e.UserOverridableBuffer,this.m_velocityBuffer=new e.UserOverridableBuffer,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new e.UserOverridableBuffer,this.m_groupBuffer=[],this.m_userDataBuffer=new e.UserOverridableBuffer,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new e.UserOverridableBuffer,this.m_bodyContactCountBuffer=new e.UserOverridableBuffer,this.m_consecutiveContactStepsBuffer=new e.UserOverridableBuffer,this.m_stuckParticleBuffer=new Js((function(){return 0})),this.m_proxyBuffer=new Js((function(){return new e.Proxy})),this.m_contactBuffer=new Js((function(){return new Us})),this.m_bodyContactBuffer=new Js((function(){return new Hs})),this.m_pairBuffer=new Js((function(){return new Zs})),this.m_triadBuffer=new Js((function(){return new Ys})),this.m_expirationTimeBuffer=new e.UserOverridableBuffer,this.m_indexByExpirationTimeBuffer=new e.UserOverridableBuffer,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new Ks,this.m_prev=null,this.m_next=null,this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),this.m_def=t.Clone(),this.m_world=i,this.SetDestructionByAge(this.m_def.destroyByAge)}return l(e,[{key:"Drop",value:function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)}},{key:"CreateParticle",value:function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity){var e=this.m_count?2*this.m_count:z;this.ReallocateInternalAllocatedBuffers(e)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return T;this.DestroyOldestParticle(0,!1),this.SolveZombie()}var n=this.m_count++;if(!this.m_flagsBuffer.data)throw new Error;if(this.m_flagsBuffer.data[n]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[n]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[n]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[n]=0),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;this.m_positionBuffer.data[n]=(this.m_positionBuffer.data[n]||new Mt).Copy(i(t.position,Mt.ZERO)),this.m_velocityBuffer.data[n]=(this.m_velocityBuffer.data[n]||new Mt).Copy(i(t.velocity,Mt.ZERO)),this.m_weightBuffer[n]=0,this.m_forceBuffer[n]=(this.m_forceBuffer[n]||new Mt).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[n]=0),this.m_depthBuffer&&(this.m_depthBuffer[n]=0);var s=(new Rt).Copy(i(t.color,Rt.ZERO));!this.m_colorBuffer.data&&s.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[n]=(this.m_colorBuffer.data[n]||new Rt).Copy(s)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[n]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[n]=null);var r=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],o=i(t.lifetime,0),a=o>0;if(this.m_expirationTimeBuffer.data||a){if(this.SetParticleLifetime(n,a?o:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_indexByExpirationTimeBuffer.data[n]=n}r.index=n;var l=i(t.group,null);return this.m_groupBuffer[n]=l,l&&(l.m_firstIndex<l.m_lastIndex?(this.RotateBuffer(l.m_firstIndex,l.m_lastIndex,n),l.m_lastIndex=n+1):(l.m_firstIndex=n,l.m_lastIndex=n+1)),this.SetParticleFlags(n,i(t.flags,0)),n}},{key:"GetParticleHandleFromIndex",value:function(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var e=this.m_handleIndexBuffer.data[t];return e||((e=new Is).SetIndex(t),this.m_handleIndexBuffer.data[t]=e,e)}},{key:"DestroyParticle",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.m_flagsBuffer.data)throw new Error;var n=t.b2ParticleFlag.b2_zombieParticle;i&&(n|=t.b2ParticleFlag.b2_destructionListenerParticle),this.SetParticleFlags(e,this.m_flagsBuffer.data[e]|n)}},{key:"DestroyOldestParticle",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;if(!this.m_expirationTimeBuffer.data)throw new Error;var n=this.m_indexByExpirationTimeBuffer.data[i-(t+1)],s=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[n]>0?n:s,e)}},{key:"DestroyParticlesInShape",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=e.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;var r=new e.DestroyParticlesInShapeCallback(this,t,i,n),o=s;return t.ComputeAABB(o,i,0),this.m_world.QueryAABB(r,o),r.Destroyed()}},{key:"CreateParticleGroup",value:function(t){var n=e.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;var s=n;s.SetPositionAngle(i(t.position,Mt.ZERO),i(t.angle,0));var r=this.m_count;if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,s),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,i(t.shapeCount,t.shapes.length),t,s),t.positionData)for(var o=i(t.particleCount,t.positionData.length),a=0;a<o;a++){var l=t.positionData[a];this.CreateParticleForGroup(t,s,l)}var u=this.m_count,h=new Gs(this);h.m_firstIndex=r,h.m_lastIndex=u,h.m_strength=i(t.strength,1),h.m_userData=t.userData,h.m_transform.Copy(s),h.m_prev=null,h.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=h),this.m_groupList=h,++this.m_groupCount;for(var m=r;m<u;m++)this.m_groupBuffer[m]=h;this.SetGroupFlags(h,i(t.groupFlags,0));var c=new e.ConnectionFilter;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(r,u,c),t.group&&(this.JoinParticleGroups(t.group,h),h=t.group),h}},{key:"JoinParticleGroups",value:function(t,i){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(i.m_firstIndex,i.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,i.m_firstIndex);var n=new e.JoinParticleGroupsFilter(i.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,i.m_lastIndex,n);for(var s=i.m_firstIndex;s<i.m_lastIndex;s++)this.m_groupBuffer[s]=t;var r=t.m_groupFlags|i.m_groupFlags;this.SetGroupFlags(t,r),t.m_lastIndex=i.m_lastIndex,i.m_firstIndex=i.m_lastIndex,this.DestroyParticleGroup(i)}},{key:"SplitParticleGroup",value:function(t){this.UpdateContacts(!0);var i=tt(t.GetParticleCount(),(function(t){return new e.ParticleListNode}));e.InitializeParticleLists(t,i),this.MergeParticleListsInContact(t,i);var n=e.FindLongestParticleList(t,i);this.MergeZombieParticleListNodes(t,i,n),this.CreateParticleGroupsFromParticleList(t,i,n),this.UpdatePairsAndTriadsWithParticleList(t,i)}},{key:"GetParticleGroupList",value:function(){return this.m_groupList}},{key:"GetParticleGroupCount",value:function(){return this.m_groupCount}},{key:"GetParticleCount",value:function(){return this.m_count}},{key:"GetMaxParticleCount",value:function(){return this.m_def.maxCount}},{key:"SetMaxParticleCount",value:function(t){this.m_def.maxCount=t}},{key:"GetAllParticleFlags",value:function(){return this.m_allParticleFlags}},{key:"GetAllGroupFlags",value:function(){return this.m_allGroupFlags}},{key:"SetPaused",value:function(t){this.m_paused=t}},{key:"GetPaused",value:function(){return this.m_paused}},{key:"SetDensity",value:function(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density}},{key:"GetDensity",value:function(){return this.m_def.density}},{key:"SetGravityScale",value:function(t){this.m_def.gravityScale=t}},{key:"GetGravityScale",value:function(){return this.m_def.gravityScale}},{key:"SetDamping",value:function(t){this.m_def.dampingStrength=t}},{key:"GetDamping",value:function(){return this.m_def.dampingStrength}},{key:"SetStaticPressureIterations",value:function(t){this.m_def.staticPressureIterations=t}},{key:"GetStaticPressureIterations",value:function(){return this.m_def.staticPressureIterations}},{key:"SetRadius",value:function(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter}},{key:"GetRadius",value:function(){return this.m_particleDiameter/2}},{key:"GetPositionBuffer",value:function(){if(!this.m_positionBuffer.data)throw new Error;return this.m_positionBuffer.data}},{key:"GetVelocityBuffer",value:function(){if(!this.m_velocityBuffer.data)throw new Error;return this.m_velocityBuffer.data}},{key:"GetColorBuffer",value:function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data}},{key:"GetGroupBuffer",value:function(){return this.m_groupBuffer}},{key:"GetWeightBuffer",value:function(){return this.m_weightBuffer}},{key:"GetUserDataBuffer",value:function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data}},{key:"GetFlagsBuffer",value:function(){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data}},{key:"SetParticleFlags",value:function(e,i){if(!this.m_flagsBuffer.data)throw new Error;this.m_flagsBuffer.data[e]&~i&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&i&&(i&t.b2ParticleFlag.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),i&t.b2ParticleFlag.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=i),this.m_flagsBuffer.data[e]=i}},{key:"GetParticleFlags",value:function(t){if(!this.m_flagsBuffer.data)throw new Error;return this.m_flagsBuffer.data[t]}},{key:"SetFlagsBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_flagsBuffer,t,e)}},{key:"SetPositionBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_positionBuffer,t,e)}},{key:"SetVelocityBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_velocityBuffer,t,e)}},{key:"SetColorBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_colorBuffer,t,e)}},{key:"SetUserDataBuffer",value:function(t,e){this.SetUserOverridableBuffer(this.m_userDataBuffer,t,e)}},{key:"GetContacts",value:function(){return this.m_contactBuffer.data}},{key:"GetContactCount",value:function(){return this.m_contactBuffer.count}},{key:"GetBodyContacts",value:function(){return this.m_bodyContactBuffer.data}},{key:"GetBodyContactCount",value:function(){return this.m_bodyContactBuffer.count}},{key:"GetPairs",value:function(){return this.m_pairBuffer.data}},{key:"GetPairCount",value:function(){return this.m_pairBuffer.count}},{key:"GetTriads",value:function(){return this.m_triadBuffer.data}},{key:"GetTriadCount",value:function(){return this.m_triadBuffer.count}},{key:"SetStuckThreshold",value:function(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))}},{key:"GetStuckCandidates",value:function(){return this.m_stuckParticleBuffer.Data()}},{key:"GetStuckCandidateCount",value:function(){return this.m_stuckParticleBuffer.GetCount()}},{key:"ComputeCollisionEnergy",value:function(){if(!this.m_velocityBuffer.data)throw new Error;for(var t=e.ComputeCollisionEnergy_s_v,i=this.m_velocityBuffer.data,n=0,s=0;s<this.m_contactBuffer.count;s++){var r=this.m_contactBuffer.data[s],o=r.indexA,a=r.indexB,l=r.normal,u=Mt.SubVV(i[a],i[o],t),h=Mt.DotVV(u,l);h<0&&(n+=h*h)}return.5*this.GetParticleMass()*n}},{key:"SetStrictContactCheck",value:function(t){this.m_def.strictContactCheck=t}},{key:"GetStrictContactCheck",value:function(){return this.m_def.strictContactCheck}},{key:"SetParticleLifetime",value:function(t,e){var i=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),i)for(var n=this.GetParticleCount(),s=0;s<n;++s)this.m_indexByExpirationTimeBuffer.data[s]=s;var r=e/this.m_def.lifetimeGranularity,o=r>0?this.GetQuantizedTimeElapsed()+r:r;o!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=o,this.m_expirationTimeBufferRequiresSorting=!0)}},{key:"GetParticleLifetime",value:function(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])}},{key:"SetDestructionByAge",value:function(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t}},{key:"GetDestructionByAge",value:function(){return this.m_def.destroyByAge}},{key:"GetExpirationTimeBuffer",value:function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data}},{key:"ExpirationTimeToLifetime",value:function(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity}},{key:"GetIndexByExpirationTimeBuffer",value:function(){if(this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),!this.m_indexByExpirationTimeBuffer.data)throw new Error;return this.m_indexByExpirationTimeBuffer.data}},{key:"ParticleApplyLinearImpulse",value:function(t,e){this.ApplyLinearImpulse(t,t+1,e)}},{key:"ApplyLinearImpulse",value:function(t,e,i){if(!this.m_velocityBuffer.data)throw new Error;for(var n=this.m_velocityBuffer.data,s=(e-t)*this.GetParticleMass(),r=(new Mt).Copy(i).SelfMul(1/s),o=t;o<e;o++)n[o].SelfAdd(r)}},{key:"ParticleApplyForce",value:function(t,i){if(!this.m_flagsBuffer.data)throw new Error;e.IsSignificantForce(i)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].SelfAdd(i))}},{key:"ApplyForce",value:function(t,i,n){var s=(new Mt).Copy(n).SelfMul(1/(i-t));if(e.IsSignificantForce(s)){this.PrepareForceBuffer();for(var r=t;r<i;r++)this.m_forceBuffer[r].SelfAdd(s)}}},{key:"GetNext",value:function(){return this.m_next}},{key:"QueryAABB",value:function(t,i){if(0!==this.m_proxyBuffer.count){var n=0,s=this.m_proxyBuffer.count,r=js(this.m_proxyBuffer.data,n,s,e.computeTag(this.m_inverseDiameter*i.lowerBound.x,this.m_inverseDiameter*i.lowerBound.y),e.Proxy.CompareProxyTag),o=qs(this.m_proxyBuffer.data,r,s,e.computeTag(this.m_inverseDiameter*i.upperBound.x,this.m_inverseDiameter*i.upperBound.y),e.Proxy.CompareTagProxy);if(!this.m_positionBuffer.data)throw new Error;for(var a=this.m_positionBuffer.data,l=r;l<o;++l){var u=this.m_proxyBuffer.data[l].index,h=a[u];if(i.lowerBound.x<h.x&&h.x<i.upperBound.x&&i.lowerBound.y<h.y&&h.y<i.upperBound.y&&!t.ReportParticle(this,u))break}}}},{key:"QueryShapeAABB",value:function(t,i,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=e.QueryShapeAABB_s_aabb;i.ComputeAABB(r,n,s),this.QueryAABB(t,r)}},{key:"QueryPointAABB",value:function(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:p,s=e.QueryPointAABB_s_aabb;s.lowerBound.Set(i.x-n,i.y-n),s.upperBound.Set(i.x+n,i.y+n),this.QueryAABB(t,s)}},{key:"RayCast",value:function(t,i,n){var s=e.RayCast_s_aabb,r=e.RayCast_s_p,o=e.RayCast_s_v,a=e.RayCast_s_n,l=e.RayCast_s_point;if(0!==this.m_proxyBuffer.count){if(!this.m_positionBuffer.data)throw new Error;var u=this.m_positionBuffer.data,h=s;Mt.MinV(i,n,h.lowerBound),Mt.MaxV(i,n,h.upperBound);for(var m,c=1,_=Mt.SubVV(n,i,o),f=Mt.DotVV(_,_),d=this.GetInsideBoundsEnumerator(h);(m=d.GetNext())>=0;){var v=Mt.SubVV(i,u[m],r),y=Mt.DotVV(v,_),p=y*y-f*(Mt.DotVV(v,v)-this.m_squaredDiameter);if(p>=0){var x=ft(p),g=(-y-x)/f;if(g>c)continue;if(g<0&&((g=(-y+x)/f)<0||g>c))continue;var b=Mt.AddVMulSV(v,g,_,a);b.Normalize();var S=t.ReportParticle(this,m,Mt.AddVMulSV(i,g,_,l),b,g);if((c=at(c,S))<=0)break}}}}},{key:"ComputeAABB",value:function(t){var e=this.GetParticleCount();if(t.lowerBound.x=+h,t.lowerBound.y=+h,t.upperBound.x=-h,t.upperBound.y=-h,!this.m_positionBuffer.data)throw new Error;for(var i=this.m_positionBuffer.data,n=0;n<e;n++){var s=i[n];Mt.MinV(t.lowerBound,s,t.lowerBound),Mt.MaxV(t.upperBound,s,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter}},{key:"FreeBuffer",value:function(t,e){null!==t&&(t.length=0)}},{key:"FreeUserOverridableBuffer",value:function(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)}},{key:"ReallocateBuffer3",value:function(t,e,i){if(i<=e)throw new Error;var n=t?t.slice():[];return n.length=i,n}},{key:"ReallocateBuffer5",value:function(t,e,i,n,s){if(n<=i)throw new Error;if(e&&!(n<=e))throw new Error;return s&&!t||e||(t=this.ReallocateBuffer3(t,i,n)),t}},{key:"ReallocateBuffer4",value:function(t,e,i,n){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,i,n)}},{key:"RequestBuffer",value:function(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(z),(t=[]).length=this.m_internalAllocatedCapacity),t}},{key:"ReallocateHandleBuffers",value:function(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)}},{key:"ReallocateInternalAllocatedBuffers",value:function(t){function e(t,e){return e&&t>e?e:t}if(t=e(t,this.m_def.maxCount),t=e(t,this.m_flagsBuffer.userSuppliedCapacity),t=e(t,this.m_positionBuffer.userSuppliedCapacity),t=e(t,this.m_velocityBuffer.userSuppliedCapacity),t=e(t,this.m_colorBuffer.userSuppliedCapacity),t=e(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);var i=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,i),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,i),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,i),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}}},{key:"CreateParticleForGroup",value:function(t,e,n){var s=new Vs;s.flags=i(t.flags,0),Gt.MulXV(e,n,s.position),Mt.AddVV(i(t.linearVelocity,Mt.ZERO),Mt.CrossSV(i(t.angularVelocity,0),Mt.SubVV(s.position,i(t.position,Mt.ZERO),Mt.s_t0),Mt.s_t0),s.velocity),s.color.Copy(i(t.color,Rt.ZERO)),s.lifetime=i(t.lifetime,0),s.userData=t.userData,this.CreateParticle(s)}},{key:"CreateParticlesStrokeShapeForGroup",value:function(n,s,r){var o=e.CreateParticlesStrokeShapeForGroup_s_edge,a=e.CreateParticlesStrokeShapeForGroup_s_d,l=e.CreateParticlesStrokeShapeForGroup_s_p,u=i(s.stride,0);0===u&&(u=this.GetParticleStride());for(var h=0,m=n.GetChildCount(),c=0;c<m;c++){var _=null;n.GetType()===t.b2ShapeType.e_edgeShape?_=n:(_=o,n.GetChildEdge(_,c));for(var f=Mt.SubVV(_.m_vertex2,_.m_vertex1,a),d=f.Length();h<d;){var v=Mt.AddVMulSV(_.m_vertex1,h/d,f,l);this.CreateParticleForGroup(s,r,v),h+=u}h-=d}}},{key:"CreateParticlesFillShapeForGroup",value:function(t,n,s){var r=e.CreateParticlesFillShapeForGroup_s_aabb,o=e.CreateParticlesFillShapeForGroup_s_p,a=i(n.stride,0);0===a&&(a=this.GetParticleStride());var l=Gt.IDENTITY,u=r;t.ComputeAABB(u,l,0);for(var h=Math.floor(u.lowerBound.y/a)*a;h<u.upperBound.y;h+=a)for(var m=Math.floor(u.lowerBound.x/a)*a;m<u.upperBound.x;m+=a){var c=o.Set(m,h);t.TestPoint(l,c)&&this.CreateParticleForGroup(n,s,c)}}},{key:"CreateParticlesWithShapeForGroup",value:function(e,i,n){switch(e.GetType()){case t.b2ShapeType.e_edgeShape:case t.b2ShapeType.e_chainShape:this.CreateParticlesStrokeShapeForGroup(e,i,n);break;case t.b2ShapeType.e_polygonShape:case t.b2ShapeType.e_circleShape:this.CreateParticlesFillShapeForGroup(e,i,n)}}},{key:"CreateParticlesWithShapesForGroup",value:function(t,i,n,s){var r=new e.CompositeShape(t,i);this.CreateParticlesFillShapeForGroup(r,n,s)}},{key:"CloneParticle",value:function(t,e){var i=new Vs;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;i.flags=this.m_flagsBuffer.data[t],i.position.Copy(this.m_positionBuffer.data[t]),i.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&i.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(i.userData=this.m_userDataBuffer.data[t]),i.group=e;var n=this.CreateParticle(i);if(this.m_handleIndexBuffer.data){var s=this.m_handleIndexBuffer.data[t];s&&s.SetIndex(n),this.m_handleIndexBuffer.data[n]=s,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[n]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[n]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[n]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[n].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[n]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[n]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[n]=this.m_expirationTimeBuffer.data[t]),n}},{key:"DestroyParticlesInGroup",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.m_firstIndex;i<t.m_lastIndex;i++)this.DestroyParticle(i,e)}},{key:"DestroyParticleGroup",value:function(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(var e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount}},{key:"UpdatePairsAndTriads",value:function(i,n,s){var r=e.UpdatePairsAndTriads_s_dab,o=e.UpdatePairsAndTriads_s_dbc,a=e.UpdatePairsAndTriads_s_dca;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var l=this.m_positionBuffer.data,u=0,h=i;h<n;h++)u|=this.m_flagsBuffer.data[h];if(u&e.k_pairFlags)for(var m=0;m<this.m_contactBuffer.count;m++){var c=this.m_contactBuffer.data[m],_=c.indexA,f=c.indexB,d=this.m_flagsBuffer.data[_],v=this.m_flagsBuffer.data[f],y=this.m_groupBuffer[_],p=this.m_groupBuffer[f];if(_>=i&&_<n&&f>=i&&f<n&&!((d|v)&t.b2ParticleFlag.b2_zombieParticle)&&(d|v)&e.k_pairFlags&&(s.IsNecessary(_)||s.IsNecessary(f))&&e.ParticleCanBeConnected(d,y)&&e.ParticleCanBeConnected(v,p)&&s.ShouldCreatePair(_,f)){var x=this.m_pairBuffer.data[this.m_pairBuffer.Append()];x.indexA=_,x.indexB=f,x.flags=c.flags,x.strength=at(y?y.m_strength:1,p?p.m_strength:1),x.distance=Mt.DistanceVV(l[_],l[f])}Os(this.m_pairBuffer.data,0,this.m_pairBuffer.count,e.ComparePairIndices),this.m_pairBuffer.Unique(e.MatchPairIndices)}if(u&e.k_triadFlags){for(var g=new Ds(n-i),b=i;b<n;b++){var S=this.m_flagsBuffer.data[b],B=this.m_groupBuffer[b];S&t.b2ParticleFlag.b2_zombieParticle||!e.ParticleCanBeConnected(S,B)||g.AddGenerator(l[b],b,s.IsNecessary(b))}var w=this.GetParticleStride();g.Generate(w/2,2*w);var A=this,C=function(t,i,n){if(!A.m_flagsBuffer.data)throw new Error;var u=A.m_flagsBuffer.data[t],h=A.m_flagsBuffer.data[i],m=A.m_flagsBuffer.data[n];if((u|h|m)&e.k_triadFlags&&s.ShouldCreateTriad(t,i,n)){var c=l[t],_=l[i],f=l[n],d=Mt.SubVV(c,_,r),v=Mt.SubVV(_,f,o),y=Mt.SubVV(f,c,a),p=O*A.m_squaredDiameter;if(Mt.DotVV(d,d)>p||Mt.DotVV(v,v)>p||Mt.DotVV(y,y)>p)return;var x=A.m_groupBuffer[t],g=A.m_groupBuffer[i],b=A.m_groupBuffer[n],S=A.m_triadBuffer.data[A.m_triadBuffer.Append()];S.indexA=t,S.indexB=i,S.indexC=n,S.flags=u|h|m,S.strength=at(at(x?x.m_strength:1,g?g.m_strength:1),b?b.m_strength:1);var B=(c.x+_.x+f.x)/3,w=(c.y+_.y+f.y)/3;S.pa.x=c.x-B,S.pa.y=c.y-w,S.pb.x=_.x-B,S.pb.y=_.y-w,S.pc.x=f.x-B,S.pc.y=f.y-w,S.ka=-Mt.DotVV(y,d),S.kb=-Mt.DotVV(d,v),S.kc=-Mt.DotVV(v,y),S.s=Mt.CrossVV(c,_)+Mt.CrossVV(_,f)+Mt.CrossVV(f,c)}};g.GetNodes(C),Os(this.m_triadBuffer.data,0,this.m_triadBuffer.count,e.CompareTriadIndices),this.m_triadBuffer.Unique(e.MatchTriadIndices)}}},{key:"UpdatePairsAndTriadsWithReactiveParticles",value:function(){var i=new e.ReactiveFilter(this.m_flagsBuffer);if(this.UpdatePairsAndTriads(0,this.m_count,i),!this.m_flagsBuffer.data)throw new Error;for(var n=0;n<this.m_count;n++)this.m_flagsBuffer.data[n]&=~t.b2ParticleFlag.b2_reactiveParticle;this.m_allParticleFlags&=~t.b2ParticleFlag.b2_reactiveParticle}},{key:"MergeParticleListsInContact",value:function(t,i){for(var n=t.GetBufferIndex(),s=0;s<this.m_contactBuffer.count;s++){var r=this.m_contactBuffer.data[s],o=r.indexA,a=r.indexB;if(t.ContainsParticle(o)&&t.ContainsParticle(a)){var l=i[o-n].list,u=i[a-n].list;if(l!==u){if(l.count<u.count){var h=l;l=u,u=h}e.MergeParticleLists(l,u)}}}}},{key:"MergeZombieParticleListNodes",value:function(i,n,s){if(!this.m_flagsBuffer.data)throw new Error;for(var r=i.GetParticleCount(),o=0;o<r;o++){var a=n[o];a!==s&&this.m_flagsBuffer.data[a.index]&t.b2ParticleFlag.b2_zombieParticle&&e.MergeParticleListAndNode(s,a)}}},{key:"CreateParticleGroupsFromParticleList",value:function(e,i,n){if(!this.m_flagsBuffer.data)throw new Error;var s=e.GetParticleCount(),r=new Ts;r.groupFlags=e.GetGroupFlags(),r.userData=e.GetUserData();for(var o=0;o<s;o++){var a=i[o];if(a.count&&a!==n)for(var l=this.CreateParticleGroup(r),u=a;u;u=u.next){var h=u.index,m=this.CloneParticle(h,l);this.m_flagsBuffer.data[h]|=t.b2ParticleFlag.b2_zombieParticle,u.index=m}}}},{key:"UpdatePairsAndTriadsWithParticleList",value:function(t,e){for(var i=t.GetBufferIndex(),n=0;n<this.m_pairBuffer.count;n++){var s=this.m_pairBuffer.data[n],r=s.indexA,o=s.indexB;t.ContainsParticle(r)&&(s.indexA=e[r-i].index),t.ContainsParticle(o)&&(s.indexB=e[o-i].index)}for(var a=0;a<this.m_triadBuffer.count;a++){var l=this.m_triadBuffer.data[a],u=l.indexA,h=l.indexB,m=l.indexC;t.ContainsParticle(u)&&(l.indexA=e[u-i].index),t.ContainsParticle(h)&&(l.indexB=e[h-i].index),t.ContainsParticle(m)&&(l.indexC=e[m-i].index)}}},{key:"ComputeDepth",value:function(){for(var e=[],i=0,n=0;n<this.m_contactBuffer.count;n++){var s=this.m_contactBuffer.data[n],r=s.indexA,o=s.indexB,a=this.m_groupBuffer[r],l=this.m_groupBuffer[o];a&&a===l&&a.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&(e[i++]=s)}for(var u=[],m=0,c=this.m_groupList;c;c=c.GetNext())if(c.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth){u[m++]=c,this.SetGroupFlags(c,c.m_groupFlags&~t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);for(var _=c.m_firstIndex;_<c.m_lastIndex;_++)this.m_accumulationBuffer[_]=0}for(var f=0;f<i;f++){var d=e[f],v=d.indexA,y=d.indexB,p=d.weight;this.m_accumulationBuffer[v]+=p,this.m_accumulationBuffer[y]+=p}for(var x=0;x<m;x++)for(var g=u[x],b=g.m_firstIndex;b<g.m_lastIndex;b++){var S=this.m_accumulationBuffer[b];this.m_depthBuffer[b]=S<.8?0:h}for(var B=ft(this.m_count)>>0,w=0;w<B;w++){for(var A=!1,C=0;C<i;C++){var M=e[C],V=M.indexA,k=M.indexB,P=1-M.weight,I=this.m_depthBuffer[V],T=this.m_depthBuffer[k],G=T+P,L=I+P;I>G&&(this.m_depthBuffer[V]=G,A=!0),T>L&&(this.m_depthBuffer[k]=L,A=!0)}if(!A)break}for(var D=0;D<m;D++)for(var R=u[D],F=R.m_firstIndex;F<R.m_lastIndex;F++)this.m_depthBuffer[F]<h?this.m_depthBuffer[F]*=this.m_particleDiameter:this.m_depthBuffer[F]=0}},{key:"GetInsideBoundsEnumerator",value:function(t){var i=e.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),n=e.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),s=0,r=this.m_proxyBuffer.count,o=js(this.m_proxyBuffer.data,s,r,i,e.Proxy.CompareProxyTag),a=qs(this.m_proxyBuffer.data,s,r,n,e.Proxy.CompareTagProxy);return new e.InsideBoundsEnumerator(this,i,n,o,a)}},{key:"UpdateAllParticleFlags",value:function(){if(!this.m_flagsBuffer.data)throw new Error;this.m_allParticleFlags=0;for(var t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1}},{key:"UpdateAllGroupFlags",value:function(){this.m_allGroupFlags=0;for(var t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1}},{key:"AddContact",value:function(t,i,n){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;var s=e.AddContact_s_d,r=this.m_positionBuffer.data,o=Mt.SubVV(r[i],r[t],s),a=Mt.DotVV(o,o);if(a<this.m_squaredDiameter){var l=_t(a);isFinite(l)||(l=198177537e11);var u=this.m_contactBuffer.data[this.m_contactBuffer.Append()];u.indexA=t,u.indexB=i,u.flags=this.m_flagsBuffer.data[t]|this.m_flagsBuffer.data[i],u.weight=1-a*l*this.m_inverseDiameter,Mt.MulSV(l,o,u.normal)}}},{key:"FindContacts_Reference",value:function(t){var i=0,n=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(var s=i,r=i;s<n;s++){for(var o=e.computeRelativeTag(this.m_proxyBuffer.data[s].tag,1,0),a=s+1;a<n&&!(o<this.m_proxyBuffer.data[a].tag);a++)this.AddContact(this.m_proxyBuffer.data[s].index,this.m_proxyBuffer.data[a].index,this.m_contactBuffer);for(var l=e.computeRelativeTag(this.m_proxyBuffer.data[s].tag,-1,1);r<n&&!(l<=this.m_proxyBuffer.data[r].tag);r++);for(var u=e.computeRelativeTag(this.m_proxyBuffer.data[s].tag,1,1),h=r;h<n&&!(u<this.m_proxyBuffer.data[h].tag);h++)this.AddContact(this.m_proxyBuffer.data[s].index,this.m_proxyBuffer.data[h].index,this.m_contactBuffer)}}},{key:"FindContacts",value:function(t){this.FindContacts_Reference(t)}},{key:"UpdateProxies_Reference",value:function(t){if(!this.m_positionBuffer.data)throw new Error;for(var i=this.m_positionBuffer.data,n=this.m_inverseDiameter,s=0;s<this.m_proxyBuffer.count;++s){var r=this.m_proxyBuffer.data[s],o=i[r.index];r.tag=e.computeTag(n*o.x,n*o.y)}}},{key:"UpdateProxies",value:function(t){this.UpdateProxies_Reference(t)}},{key:"SortProxies",value:function(t){Es(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,e.Proxy.CompareProxyProxy)}},{key:"FilterContacts",value:function(e){var i=this.GetParticleContactFilter();if(null!==i){var n=this,s=function(e){return 0!==(e.flags&t.b2ParticleFlag.b2_particleContactFilterParticle)&&!i.ShouldCollideParticleParticle(n,e.indexA,e.indexB)};this.m_contactBuffer.RemoveIf(s)}}},{key:"NotifyContactListenerPreContact",value:function(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error}},{key:"NotifyContactListenerPostContact",value:function(t){var e=this.GetParticleContactListener();if(null!==e){for(var i=0;i<this.m_contactBuffer.count;++i){var n=this.m_contactBuffer.data[i];e.BeginContactParticleParticle(this,n)}throw new Error}}},{key:"UpdateContacts",value:function(t){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);var i=new e.b2ParticlePairSet;this.NotifyContactListenerPreContact(i),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(i),t&&this.m_contactBuffer.RemoveIf(e.b2ParticleContactIsZombie)}},{key:"NotifyBodyContactListenerPreContact",value:function(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error}},{key:"NotifyBodyContactListenerPostContact",value:function(t){var e=this.GetFixtureContactListener();if(null!==e){for(var i=0;i<this.m_bodyContactBuffer.count;i++){var n=this.m_bodyContactBuffer.data[i];e.BeginContactFixtureParticle(this,n)}throw new Error}}},{key:"UpdateBodyContacts",value:function(){var t=e.UpdateBodyContacts_s_aabb,i=new e.FixtureParticleSet;if(this.NotifyBodyContactListenerPreContact(i),this.m_stuckThreshold>0){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;for(var n=this.GetParticleCount(),s=0;s<n;s++)this.m_bodyContactCountBuffer.data[s]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[s]+1&&(this.m_consecutiveContactStepsBuffer.data[s]=0)}this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);var r=t;this.ComputeAABB(r);var o=new e.UpdateBodyContactsCallback(this,this.GetFixtureContactFilter());this.m_world.QueryAABB(o,r),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(i)}},{key:"Solve",value:function(i){var n=e.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(i),this.m_allParticleFlags&t.b2ParticleFlag.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<i.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var s=n.Copy(i);if(s.dt/=i.particleIterations,s.inv_dt*=i.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&t.b2ParticleFlag.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(s),this.m_allParticleFlags&t.b2ParticleFlag.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&t.b2ParticleFlag.b2_repulsiveParticle&&this.SolveRepulsive(s),this.m_allParticleFlags&t.b2ParticleFlag.b2_powderParticle&&this.SolvePowder(s),this.m_allParticleFlags&t.b2ParticleFlag.b2_tensileParticle&&this.SolveTensile(s),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SolveSolid(s),this.m_allParticleFlags&t.b2ParticleFlag.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(s),this.m_allParticleFlags&t.b2ParticleFlag.b2_staticPressureParticle&&this.SolveStaticPressure(s),this.SolvePressure(s),this.SolveDamping(s),this.m_allParticleFlags&e.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&t.b2ParticleFlag.b2_elasticParticle&&this.SolveElastic(s),this.m_allParticleFlags&t.b2ParticleFlag.b2_springParticle&&this.SolveSpring(s),this.LimitVelocity(s),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&t.b2ParticleFlag.b2_barrierParticle&&this.SolveBarrier(s),this.SolveCollision(s),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigid(s),this.m_allParticleFlags&t.b2ParticleFlag.b2_wallParticle&&this.SolveWall(),!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var r=0;r<this.m_count;r++)this.m_positionBuffer.data[r].SelfMulAdd(s.dt,this.m_velocityBuffer.data[r])}}},{key:"SolveCollision",value:function(t){var i=e.SolveCollision_s_aabb;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;var n=this.m_positionBuffer.data,s=this.m_velocityBuffer.data,r=i;r.lowerBound.x=+h,r.lowerBound.y=+h,r.upperBound.x=-h,r.upperBound.y=-h;for(var o=0;o<this.m_count;o++){var a=s[o],l=n[o],u=l.x+t.dt*a.x,m=l.y+t.dt*a.y;r.lowerBound.x=at(r.lowerBound.x,at(l.x,u)),r.lowerBound.y=at(r.lowerBound.y,at(l.y,m)),r.upperBound.x=lt(r.upperBound.x,lt(l.x,u)),r.upperBound.y=lt(r.upperBound.y,lt(l.y,m))}var c=new e.SolveCollisionCallback(this,t);this.m_world.QueryAABB(c,r)}},{key:"LimitVelocity",value:function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,i=this.GetCriticalVelocitySquared(t),n=0;n<this.m_count;n++){var s=e[n],r=Mt.DotVV(s,s);r>i&&s.SelfMul(ft(i/r))}}},{key:"SolveGravity",value:function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var i=e.SolveGravity_s_gravity,n=this.m_velocityBuffer.data,s=Mt.MulSV(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),i),r=0;r<this.m_count;r++)n[r].SelfAdd(s)}},{key:"SolveBarrier",value:function(i){var n=e.SolveBarrier_s_aabb,s=e.SolveBarrier_s_va,r=e.SolveBarrier_s_vb,o=e.SolveBarrier_s_pba,a=e.SolveBarrier_s_vba,l=e.SolveBarrier_s_vc,u=e.SolveBarrier_s_pca,h=e.SolveBarrier_s_vca,m=e.SolveBarrier_s_qba,c=e.SolveBarrier_s_qca,_=e.SolveBarrier_s_dv,f=e.SolveBarrier_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var d=this.m_positionBuffer.data,v=this.m_velocityBuffer.data,y=0;y<this.m_count;y++)0!==(this.m_flagsBuffer.data[y]&e.k_barrierWallFlags)&&v[y].SetZero();for(var p=j*i.dt,x=this.GetParticleMass(),g=0;g<this.m_pairBuffer.count;g++){var b=this.m_pairBuffer.data[g];if(b.flags&t.b2ParticleFlag.b2_barrierParticle){var S=b.indexA,B=b.indexB,w=d[S],A=d[B],C=n;Mt.MinV(w,A,C.lowerBound),Mt.MaxV(w,A,C.upperBound);for(var M=this.m_groupBuffer[S],V=this.m_groupBuffer[B],k=this.GetLinearVelocity(M,S,w,s),P=this.GetLinearVelocity(V,B,A,r),I=Mt.SubVV(A,w,o),T=Mt.SubVV(P,k,a),G=this.GetInsideBoundsEnumerator(C),L=void 0;(L=G.GetNext())>=0;){var D=d[L],R=this.m_groupBuffer[L];if(M!==R&&V!==R){var F=this.GetLinearVelocity(R,L,D,l),E=Mt.SubVV(D,w,u),O=Mt.SubVV(F,k,h),z=Mt.CrossVV(T,O),q=Mt.CrossVV(I,O)-Mt.CrossVV(E,T),N=Mt.CrossVV(I,E),X=void 0,J=void 0,W=m,U=c;if(0===z){if(0===q)continue;if(!((J=-N/q)>=0&&J<p))continue;if(Mt.AddVMulSV(I,J,T,W),Mt.AddVMulSV(E,J,O,U),!((X=Mt.DotVV(W,U)/Mt.DotVV(W,W))>=0&&X<=1))continue}else{var H=q*q-4*N*z;if(H<0)continue;var Z=ft(H),Y=(-q-Z)/(2*z),K=(-q+Z)/(2*z);if(Y>K){var Q=Y;Y=K,K=Q}if(J=Y,Mt.AddVMulSV(I,J,T,W),Mt.AddVMulSV(E,J,O,U),X=Mt.DotVV(W,U)/Mt.DotVV(W,W),!(J>=0&&J<p&&X>=0&&X<=1)){if(!((J=K)>=0&&J<p))continue;if(Mt.AddVMulSV(I,J,T,W),Mt.AddVMulSV(E,J,O,U),!((X=Mt.DotVV(W,U)/Mt.DotVV(W,W))>=0&&X<=1))continue}}var $=_;$.x=k.x+X*T.x-F.x,$.y=k.y+X*T.y-F.y;var tt=Mt.MulSV(x,$,f);if(R&&this.IsRigidGroup(R)){var et=R.GetMass(),it=R.GetInertia();et>0&&R.m_linearVelocity.SelfMulAdd(1/et,tt),it>0&&(R.m_angularVelocity+=Mt.CrossVV(Mt.SubVV(D,R.GetCenter(),Mt.s_t0),tt)/it)}else v[L].SelfAdd($);this.ParticleApplyForce(L,tt.SelfMul(-i.inv_dt))}}}}}},{key:"SolveStaticPressure",value:function(e){if(!this.m_flagsBuffer.data)throw new Error;this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var i=this.GetCriticalPressure(e),n=this.m_def.staticPressureStrength*i,s=R*i,r=this.m_def.staticPressureRelaxation,o=0;o<this.m_def.staticPressureIterations;o++){for(var a=0;a<this.m_count;a++)this.m_accumulationBuffer[a]=0;for(var l=0;l<this.m_contactBuffer.count;l++){var u=this.m_contactBuffer.data[l];if(u.flags&t.b2ParticleFlag.b2_staticPressureParticle){var h=u.indexA,m=u.indexB,c=u.weight;this.m_accumulationBuffer[h]+=c*this.m_staticPressureBuffer[m],this.m_accumulationBuffer[m]+=c*this.m_staticPressureBuffer[h]}}for(var _=0;_<this.m_count;_++){var f=this.m_weightBuffer[_];if(this.m_flagsBuffer.data[_]&t.b2ParticleFlag.b2_staticPressureParticle){var d=(this.m_accumulationBuffer[_]+n*(f-D))/(f+r);this.m_staticPressureBuffer[_]=ut(d,0,s)}else this.m_staticPressureBuffer[_]=0}}}},{key:"ComputeWeight",value:function(){for(var t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(var e=0;e<this.m_bodyContactBuffer.count;e++){var i=this.m_bodyContactBuffer.data[e],n=i.index,s=i.weight;this.m_weightBuffer[n]+=s}for(var r=0;r<this.m_contactBuffer.count;r++){var o=this.m_contactBuffer.data[r],a=o.indexA,l=o.indexB,u=o.weight;this.m_weightBuffer[a]+=u,this.m_weightBuffer[l]+=u}}},{key:"SolvePressure",value:function(i){var n=e.SolvePressure_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var s=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,o=this.GetCriticalPressure(i),a=this.m_def.pressureStrength*o,l=R*o,u=0;u<this.m_count;u++){var h=this.m_weightBuffer[u],m=a*lt(0,h-D);this.m_accumulationBuffer[u]=at(m,l)}if(this.m_allParticleFlags&e.k_noPressureFlags)for(var c=0;c<this.m_count;c++)this.m_flagsBuffer.data[c]&e.k_noPressureFlags&&(this.m_accumulationBuffer[c]=0);if(this.m_allParticleFlags&t.b2ParticleFlag.b2_staticPressureParticle)for(var _=0;_<this.m_count;_++)this.m_flagsBuffer.data[_]&t.b2ParticleFlag.b2_staticPressureParticle&&(this.m_accumulationBuffer[_]+=this.m_staticPressureBuffer[_]);for(var f=i.dt/(this.m_def.density*this.m_particleDiameter),d=this.GetParticleInvMass(),v=0;v<this.m_bodyContactBuffer.count;v++){var y=this.m_bodyContactBuffer.data[v],p=y.index,x=y.body,g=y.weight,b=y.mass,S=y.normal,B=s[p],w=this.m_accumulationBuffer[p]+a*g,A=Mt.MulSV(f*g*b*w,S,n);r[p].SelfMulSub(d,A),x.ApplyLinearImpulse(A,B,!0)}for(var C=0;C<this.m_contactBuffer.count;C++){var M=this.m_contactBuffer.data[C],V=M.indexA,k=M.indexB,P=M.weight,I=M.normal,T=this.m_accumulationBuffer[V]+this.m_accumulationBuffer[k],G=Mt.MulSV(f*P*T,I,n);r[V].SelfSub(G),r[k].SelfAdd(G)}}},{key:"SolveDamping",value:function(t){var i=e.SolveDamping_s_v,n=e.SolveDamping_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var s=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,o=this.m_def.dampingStrength,a=1/this.GetCriticalVelocity(t),l=this.GetParticleInvMass(),u=0;u<this.m_bodyContactBuffer.count;u++){var h=this.m_bodyContactBuffer.data[u],m=h.index,c=h.body,_=h.weight,f=h.mass,d=h.normal,v=s[m],y=Mt.SubVV(c.GetLinearVelocityFromWorldPoint(v,Mt.s_t0),r[m],i),p=Mt.DotVV(y,d);if(p<0){var x=lt(o*_,at(-a*p,.5)),g=Mt.MulSV(x*f*p,d,n);r[m].SelfMulAdd(l,g),c.ApplyLinearImpulse(g.SelfNeg(),v,!0)}}for(var b=0;b<this.m_contactBuffer.count;b++){var S=this.m_contactBuffer.data[b],B=S.indexA,w=S.indexB,A=S.weight,C=S.normal,M=Mt.SubVV(r[w],r[B],i),V=Mt.DotVV(M,C);if(V<0){var k=lt(o*A,at(-a*V,.5)),P=Mt.MulSV(k*V,C,n);r[B].SelfAdd(P),r[w].SelfSub(P)}}}},{key:"SolveRigidDamping",value:function(){var t=e.SolveRigidDamping_s_t0,i=e.SolveRigidDamping_s_t1,n=e.SolveRigidDamping_s_p,s=e.SolveRigidDamping_s_v,r=[0],o=[0],a=[0],l=[0],u=[0],h=[0];if(!this.m_positionBuffer.data)throw new Error;for(var m=this.m_positionBuffer.data,c=this.m_def.dampingStrength,_=0;_<this.m_bodyContactBuffer.count;_++){var f=this.m_bodyContactBuffer.data[_],d=f.index,v=this.m_groupBuffer[d];if(v&&this.IsRigidGroup(v)){var y=f.body,p=f.normal,x=f.weight,g=m[d],b=Mt.SubVV(y.GetLinearVelocityFromWorldPoint(g,t),v.GetLinearVelocityFromWorldPoint(g,i),s),S=Mt.DotVV(b,p);if(S<0){this.InitDampingParameterWithRigidGroupOrParticle(r,o,a,!0,v,d,g,p),this.InitDampingParameter(l,u,h,y.GetMass(),y.GetInertia()-y.GetMass()*y.GetLocalCenter().LengthSquared(),y.GetWorldCenter(),g,p);var B=c*at(x,1)*this.ComputeDampingImpulse(r[0],o[0],a[0],l[0],u[0],h[0],S);this.ApplyDamping(r[0],o[0],a[0],!0,v,d,B,p),y.ApplyLinearImpulse(Mt.MulSV(-B,p,Mt.s_t0),g,!0)}}}for(var w=0;w<this.m_contactBuffer.count;w++){var A=this.m_contactBuffer.data[w],C=A.indexA,M=A.indexB,V=A.normal,k=A.weight,P=this.m_groupBuffer[C],I=this.m_groupBuffer[M],T=this.IsRigidGroup(P),G=this.IsRigidGroup(I);if(P!==I&&(T||G)){var L=Mt.MidVV(m[C],m[M],n),D=Mt.SubVV(this.GetLinearVelocity(I,M,L,t),this.GetLinearVelocity(P,C,L,i),s),R=Mt.DotVV(D,V);if(R<0){this.InitDampingParameterWithRigidGroupOrParticle(r,o,a,T,P,C,L,V),this.InitDampingParameterWithRigidGroupOrParticle(l,u,h,G,I,M,L,V);var F=c*k*this.ComputeDampingImpulse(r[0],o[0],a[0],l[0],u[0],h[0],R);this.ApplyDamping(r[0],o[0],a[0],T,P,C,F,V),this.ApplyDamping(l[0],u[0],h[0],G,I,M,-F,V)}}}}},{key:"SolveExtraDamping",value:function(){var t=e.SolveExtraDamping_s_v,i=e.SolveExtraDamping_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var n=this.m_velocityBuffer.data,s=this.m_positionBuffer.data,r=this.GetParticleInvMass(),o=0;o<this.m_bodyContactBuffer.count;o++){var a=this.m_bodyContactBuffer.data[o],l=a.index;if(this.m_flagsBuffer.data[l]&e.k_extraDampingFlags){var u=a.body,h=a.mass,m=a.normal,c=s[l],_=Mt.SubVV(u.GetLinearVelocityFromWorldPoint(c,Mt.s_t0),n[l],t),f=Mt.DotVV(_,m);if(f<0){var d=Mt.MulSV(.5*h*f,m,i);n[l].SelfMulAdd(r,d),u.ApplyLinearImpulse(d.SelfNeg(),c,!0)}}}}},{key:"SolveWall",value:function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,i=0;i<this.m_count;i++)this.m_flagsBuffer.data[i]&t.b2ParticleFlag.b2_wallParticle&&e[i].SetZero()}},{key:"SolveRigid",value:function(i){var n=e.SolveRigid_s_position,s=e.SolveRigid_s_rotation,r=e.SolveRigid_s_transform,o=e.SolveRigid_s_velocityTransform;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var a=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,u=this.m_groupList;u;u=u.GetNext())if(u.m_groupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup){u.UpdateStatistics();var h=s;h.SetAngle(i.dt*u.m_angularVelocity);var m=Mt.AddVV(u.m_center,Mt.SubVV(Mt.MulSV(i.dt,u.m_linearVelocity,Mt.s_t0),Tt.MulRV(h,u.m_center,Mt.s_t1),Mt.s_t0),n),c=r;c.SetPositionRotation(m,h),Gt.MulXX(c,u.m_transform,u.m_transform);var _=o;_.p.x=i.inv_dt*c.p.x,_.p.y=i.inv_dt*c.p.y,_.q.s=i.inv_dt*c.q.s,_.q.c=i.inv_dt*(c.q.c-1);for(var f=u.m_firstIndex;f<u.m_lastIndex;f++)Gt.MulXV(_,a[f],l[f])}}},{key:"SolveElastic",value:function(i){var n=e.SolveElastic_s_pa,s=e.SolveElastic_s_pb,r=e.SolveElastic_s_pc,o=e.SolveElastic_s_r,a=e.SolveElastic_s_t0;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var l=this.m_positionBuffer.data,u=this.m_velocityBuffer.data,h=i.inv_dt*this.m_def.elasticStrength,m=0;m<this.m_triadBuffer.count;m++){var c=this.m_triadBuffer.data[m];if(c.flags&t.b2ParticleFlag.b2_elasticParticle){var _=c.indexA,f=c.indexB,d=c.indexC,v=c.pa,y=c.pb,p=c.pc,x=n.Copy(l[_]),g=s.Copy(l[f]),b=r.Copy(l[d]),S=u[_],B=u[f],w=u[d];x.SelfMulAdd(i.dt,S),g.SelfMulAdd(i.dt,B),b.SelfMulAdd(i.dt,w);var A=(x.x+g.x+b.x)/3,C=(x.y+g.y+b.y)/3;x.x-=A,x.y-=C,g.x-=A,g.y-=C,b.x-=A,b.y-=C;var M=o;M.s=Mt.CrossVV(v,x)+Mt.CrossVV(y,g)+Mt.CrossVV(p,b),M.c=Mt.DotVV(v,x)+Mt.DotVV(y,g)+Mt.DotVV(p,b);var V=_t(M.s*M.s+M.c*M.c);isFinite(V)||(V=198177537e11),M.s*=V,M.c*=V;var k=h*c.strength;Tt.MulRV(M,v,a),Mt.SubVV(a,x,a),Mt.MulSV(k,a,a),S.SelfAdd(a),Tt.MulRV(M,y,a),Mt.SubVV(a,g,a),Mt.MulSV(k,a,a),B.SelfAdd(a),Tt.MulRV(M,p,a),Mt.SubVV(a,b,a),Mt.MulSV(k,a,a),w.SelfAdd(a)}}}},{key:"SolveSpring",value:function(i){var n=e.SolveSpring_s_pa,s=e.SolveSpring_s_pb,r=e.SolveSpring_s_d,o=e.SolveSpring_s_f;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var a=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,u=i.inv_dt*this.m_def.springStrength,h=0;h<this.m_pairBuffer.count;h++){var m=this.m_pairBuffer.data[h];if(m.flags&t.b2ParticleFlag.b2_springParticle){var c=m.indexA,_=m.indexB,f=n.Copy(a[c]),d=s.Copy(a[_]),v=l[c],y=l[_];f.SelfMulAdd(i.dt,v),d.SelfMulAdd(i.dt,y);var p=Mt.SubVV(d,f,r),x=m.distance,g=p.Length(),b=u*m.strength,S=Mt.MulSV(b*(x-g)/g,p,o);v.SelfSub(S),y.SelfAdd(S)}}}},{key:"SolveTensile",value:function(i){var n=e.SolveTensile_s_weightedNormal,s=e.SolveTensile_s_s,r=e.SolveTensile_s_f;if(!this.m_velocityBuffer.data)throw new Error;for(var o=this.m_velocityBuffer.data,a=0;a<this.m_count;a++)this.m_accumulation2Buffer[a]=new Mt,this.m_accumulation2Buffer[a].SetZero();for(var l=0;l<this.m_contactBuffer.count;l++){var u=this.m_contactBuffer.data[l];if(u.flags&t.b2ParticleFlag.b2_tensileParticle){var h=u.indexA,m=u.indexB,c=u.weight,_=u.normal,f=Mt.MulSV((1-c)*c,_,n);this.m_accumulation2Buffer[h].SelfSub(f),this.m_accumulation2Buffer[m].SelfAdd(f)}}for(var d=this.GetCriticalVelocity(i),v=this.m_def.surfaceTensionPressureStrength*d,y=this.m_def.surfaceTensionNormalStrength*d,p=F*d,x=0;x<this.m_contactBuffer.count;x++){var g=this.m_contactBuffer.data[x];if(g.flags&t.b2ParticleFlag.b2_tensileParticle){var b=g.indexA,S=g.indexB,B=g.weight,w=g.normal,A=this.m_weightBuffer[b]+this.m_weightBuffer[S],C=Mt.SubVV(this.m_accumulation2Buffer[S],this.m_accumulation2Buffer[b],s),M=at(v*(A-2)+y*Mt.DotVV(C,w),p)*B,V=Mt.MulSV(M,w,r);o[b].SelfSub(V),o[S].SelfAdd(V)}}}},{key:"SolveViscous",value:function(){var i=e.SolveViscous_s_v,n=e.SolveViscous_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var s=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,o=this.m_def.viscousStrength,a=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var u=this.m_bodyContactBuffer.data[l],h=u.index;if(this.m_flagsBuffer.data[h]&t.b2ParticleFlag.b2_viscousParticle){var m=u.body,c=u.weight,_=u.mass,f=s[h],d=Mt.SubVV(m.GetLinearVelocityFromWorldPoint(f,Mt.s_t0),r[h],i),v=Mt.MulSV(o*_*c,d,n);r[h].SelfMulAdd(a,v),m.ApplyLinearImpulse(v.SelfNeg(),f,!0)}}for(var y=0;y<this.m_contactBuffer.count;y++){var p=this.m_contactBuffer.data[y];if(p.flags&t.b2ParticleFlag.b2_viscousParticle){var x=p.indexA,g=p.indexB,b=p.weight,S=Mt.SubVV(r[g],r[x],i),B=Mt.MulSV(o*b,S,n);r[x].SelfAdd(B),r[g].SelfSub(B)}}}},{key:"SolveRepulsive",value:function(i){var n=e.SolveRepulsive_s_f;if(!this.m_velocityBuffer.data)throw new Error;for(var s=this.m_velocityBuffer.data,r=this.m_def.repulsiveStrength*this.GetCriticalVelocity(i),o=0;o<this.m_contactBuffer.count;o++){var a=this.m_contactBuffer.data[o];if(a.flags&t.b2ParticleFlag.b2_repulsiveParticle){var l=a.indexA,u=a.indexB;if(this.m_groupBuffer[l]!==this.m_groupBuffer[u]){var h=a.weight,m=a.normal,c=Mt.MulSV(r*h,m,n);s[l].SelfSub(c),s[u].SelfAdd(c)}}}}},{key:"SolvePowder",value:function(i){var n=e.SolvePowder_s_f;if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var s=this.m_positionBuffer.data,r=this.m_velocityBuffer.data,o=this.m_def.powderStrength*this.GetCriticalVelocity(i),a=1-L,l=this.GetParticleInvMass(),u=0;u<this.m_bodyContactBuffer.count;u++){var h=this.m_bodyContactBuffer.data[u],m=h.index;if(this.m_flagsBuffer.data[m]&t.b2ParticleFlag.b2_powderParticle){var c=h.weight;if(c>a){var _=h.body,f=h.mass,d=s[m],v=h.normal,y=Mt.MulSV(o*f*(c-a),v,n);r[m].SelfMulSub(l,y),_.ApplyLinearImpulse(y,d,!0)}}}for(var p=0;p<this.m_contactBuffer.count;p++){var x=this.m_contactBuffer.data[p];if(x.flags&t.b2ParticleFlag.b2_powderParticle){var g=x.weight;if(g>a){var b=x.indexA,S=x.indexB,B=x.normal,w=Mt.MulSV(o*(g-a),B,n);r[b].SelfSub(w),r[S].SelfAdd(w)}}}}},{key:"SolveSolid",value:function(t){var i=e.SolveSolid_s_f;if(!this.m_velocityBuffer.data)throw new Error;var n=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);for(var s=t.inv_dt*this.m_def.ejectionStrength,r=0;r<this.m_contactBuffer.count;r++){var o=this.m_contactBuffer.data[r],a=o.indexA,l=o.indexB;if(this.m_groupBuffer[a]!==this.m_groupBuffer[l]){var u=o.weight,h=o.normal,m=this.m_depthBuffer[a]+this.m_depthBuffer[l],c=Mt.MulSV(s*m*u,h,i);n[a].SelfSub(c),n[l].SelfAdd(c)}}}},{key:"SolveForce",value:function(t){if(!this.m_velocityBuffer.data)throw new Error;for(var e=this.m_velocityBuffer.data,i=t.dt*this.GetParticleInvMass(),n=0;n<this.m_count;n++)e[n].SelfMulAdd(i,this.m_forceBuffer[n]);this.m_hasForce=!1}},{key:"SolveColorMixing",value:function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_colorBuffer.data)throw new Error;var e=.5*this.m_def.colorMixingStrength;if(e)for(var i=0;i<this.m_contactBuffer.count;i++){var n=this.m_contactBuffer.data[i],s=n.indexA,r=n.indexB;if(this.m_flagsBuffer.data[s]&this.m_flagsBuffer.data[r]&t.b2ParticleFlag.b2_colorMixingParticle){var o=this.m_colorBuffer.data[s],a=this.m_colorBuffer.data[r];Rt.MixColors(o,a,e)}}}},{key:"SolveZombie",value:function(){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;for(var e=0,i=[],n=0;n<this.m_count;n++)i[n]=T;for(var s=0,r=0;r<this.m_count;r++){var o=this.m_flagsBuffer.data[r];if(o&t.b2ParticleFlag.b2_zombieParticle){var a=this.m_world.m_destructionListener;if(o&t.b2ParticleFlag.b2_destructionListenerParticle&&a&&a.SayGoodbyeParticle(this,r),this.m_handleIndexBuffer.data){var l=this.m_handleIndexBuffer.data[r];l&&(l.SetIndex(T),this.m_handleIndexBuffer.data[r]=null)}i[r]=T}else{if(i[r]=e,r!==e){if(this.m_handleIndexBuffer.data){var u=this.m_handleIndexBuffer.data[r];u&&u.SetIndex(e),this.m_handleIndexBuffer.data[e]=u}this.m_flagsBuffer.data[e]=this.m_flagsBuffer.data[r],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=this.m_lastBodyContactStepBuffer.data[r]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=this.m_bodyContactCountBuffer.data[r]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=this.m_consecutiveContactStepsBuffer.data[r]),this.m_positionBuffer.data[e].Copy(this.m_positionBuffer.data[r]),this.m_velocityBuffer.data[e].Copy(this.m_velocityBuffer.data[r]),this.m_groupBuffer[e]=this.m_groupBuffer[r],this.m_hasForce&&this.m_forceBuffer[e].Copy(this.m_forceBuffer[r]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=this.m_staticPressureBuffer[r]),this.m_depthBuffer&&(this.m_depthBuffer[e]=this.m_depthBuffer[r]),this.m_colorBuffer.data&&this.m_colorBuffer.data[e].Copy(this.m_colorBuffer.data[r]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[e]=this.m_userDataBuffer.data[r]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[e]=this.m_expirationTimeBuffer.data[r])}e++,s|=o}}for(var h={IsProxyInvalid:function(t){return t.index<0},IsContactInvalid:function(t){return t.indexA<0||t.indexB<0},IsBodyContactInvalid:function(t){return t.index<0},IsPairInvalid:function(t){return t.indexA<0||t.indexB<0},IsTriadInvalid:function(t){return t.indexA<0||t.indexB<0||t.indexC<0}},m=0;m<this.m_proxyBuffer.count;m++){var c=this.m_proxyBuffer.data[m];c.index=i[c.index]}this.m_proxyBuffer.RemoveIf(h.IsProxyInvalid);for(var _=0;_<this.m_contactBuffer.count;_++){var f=this.m_contactBuffer.data[_];f.indexA=i[f.indexA],f.indexB=i[f.indexB]}this.m_contactBuffer.RemoveIf(h.IsContactInvalid);for(var d=0;d<this.m_bodyContactBuffer.count;d++){var v=this.m_bodyContactBuffer.data[d];v.index=i[v.index]}this.m_bodyContactBuffer.RemoveIf(h.IsBodyContactInvalid);for(var y=0;y<this.m_pairBuffer.count;y++){var p=this.m_pairBuffer.data[y];p.indexA=i[p.indexA],p.indexB=i[p.indexB]}this.m_pairBuffer.RemoveIf(h.IsPairInvalid);for(var x=0;x<this.m_triadBuffer.count;x++){var g=this.m_triadBuffer.data[x];g.indexA=i[g.indexA],g.indexB=i[g.indexB],g.indexC=i[g.indexC]}if(this.m_triadBuffer.RemoveIf(h.IsTriadInvalid),this.m_indexByExpirationTimeBuffer.data)for(var b=0,S=0;S<this.m_count;S++){var B=i[this.m_indexByExpirationTimeBuffer.data[S]];B!==T&&(this.m_indexByExpirationTimeBuffer.data[b++]=B)}for(var w=this.m_groupList;w;w=w.GetNext()){for(var A=e,C=0,M=!1,V=w.m_firstIndex;V<w.m_lastIndex;V++){var k=i[V];k>=0?(A=at(A,k),C=lt(C,k+1)):M=!0}A<C?(w.m_firstIndex=A,w.m_lastIndex=C,M&&w.m_groupFlags&t.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SetGroupFlags(w,w.m_groupFlags|t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)):(w.m_firstIndex=0,w.m_lastIndex=0,w.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupCanBeEmpty||this.SetGroupFlags(w,w.m_groupFlags|t.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed))}this.m_count=e,this.m_allParticleFlags=s,this.m_needsUpdateAllParticleFlags=!1;for(var P=this.m_groupList;P;){var I=P.GetNext();P.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(P),P=I}}},{key:"SolveLifetimes",value:function(t){if(!this.m_expirationTimeBuffer.data)throw new Error;if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);var e=this.GetQuantizedTimeElapsed(),i=this.m_expirationTimeBuffer.data,n=this.m_indexByExpirationTimeBuffer.data,s=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(Es(n,0,s,(function(t,e){var n=i[t],s=i[e],r=n<=0;return r===s<=0?n>s:r})),this.m_expirationTimeBufferRequiresSorting=!1);for(var r=s-1;r>=0;--r){var o=n[r],a=i[o];if(e<a||a<=0)break;this.DestroyParticle(o)}}},{key:"RotateBuffer",value:function(t,e,i){if(t!==e&&e!==i){if(!this.m_flagsBuffer.data)throw new Error;if(!this.m_positionBuffer.data)throw new Error;if(!this.m_velocityBuffer.data)throw new Error;if(Ns(this.m_flagsBuffer.data,t,e,i),this.m_lastBodyContactStepBuffer.data&&Ns(this.m_lastBodyContactStepBuffer.data,t,e,i),this.m_bodyContactCountBuffer.data&&Ns(this.m_bodyContactCountBuffer.data,t,e,i),this.m_consecutiveContactStepsBuffer.data&&Ns(this.m_consecutiveContactStepsBuffer.data,t,e,i),Ns(this.m_positionBuffer.data,t,e,i),Ns(this.m_velocityBuffer.data,t,e,i),Ns(this.m_groupBuffer,t,e,i),this.m_hasForce&&Ns(this.m_forceBuffer,t,e,i),this.m_staticPressureBuffer&&Ns(this.m_staticPressureBuffer,t,e,i),this.m_depthBuffer&&Ns(this.m_depthBuffer,t,e,i),this.m_colorBuffer.data&&Ns(this.m_colorBuffer.data,t,e,i),this.m_userDataBuffer.data&&Ns(this.m_userDataBuffer.data,t,e,i),this.m_handleIndexBuffer.data){Ns(this.m_handleIndexBuffer.data,t,e,i);for(var n=t;n<i;++n){var s=this.m_handleIndexBuffer.data[n];s&&s.SetIndex(x(s.GetIndex()))}}if(this.m_expirationTimeBuffer.data){Ns(this.m_expirationTimeBuffer.data,t,e,i);var r=this.GetParticleCount();if(!this.m_indexByExpirationTimeBuffer.data)throw new Error;for(var o=this.m_indexByExpirationTimeBuffer.data,a=0;a<r;++a)o[a]=x(o[a])}for(var l=0;l<this.m_proxyBuffer.count;l++){var u=this.m_proxyBuffer.data[l];u.index=x(u.index)}for(var h=0;h<this.m_contactBuffer.count;h++){var m=this.m_contactBuffer.data[h];m.indexA=x(m.indexA),m.indexB=x(m.indexB)}for(var c=0;c<this.m_bodyContactBuffer.count;c++){var _=this.m_bodyContactBuffer.data[c];_.index=x(_.index)}for(var f=0;f<this.m_pairBuffer.count;f++){var d=this.m_pairBuffer.data[f];d.indexA=x(d.indexA),d.indexB=x(d.indexB)}for(var v=0;v<this.m_triadBuffer.count;v++){var y=this.m_triadBuffer.data[v];y.indexA=x(y.indexA),y.indexB=x(y.indexB),y.indexC=x(y.indexC)}for(var p=this.m_groupList;p;p=p.GetNext())p.m_firstIndex=x(p.m_firstIndex),p.m_lastIndex=x(p.m_lastIndex-1)+1}function x(n){return n<t?n:n<e?n+i-e:n<i?n+t-e:n}}},{key:"GetCriticalVelocity",value:function(t){return this.m_particleDiameter*t.inv_dt}},{key:"GetCriticalVelocitySquared",value:function(t){var e=this.GetCriticalVelocity(t);return e*e}},{key:"GetCriticalPressure",value:function(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)}},{key:"GetParticleStride",value:function(){return L*this.m_particleDiameter}},{key:"GetParticleMass",value:function(){var t=this.GetParticleStride();return this.m_def.density*t*t}},{key:"GetParticleInvMass",value:function(){var t=this.m_inverseDiameter*(1/L);return this.m_inverseDensity*t*t}},{key:"GetFixtureContactFilter",value:function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetParticleContactFilter",value:function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null}},{key:"GetFixtureContactListener",value:function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}},{key:"GetParticleContactListener",value:function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null}},{key:"SetUserOverridableBuffer",value:function(t,e,i){t.data=e,t.userSuppliedCapacity=i}},{key:"SetGroupFlags",value:function(e,i){var n=e.m_groupFlags;(n^i)&t.b2ParticleGroupFlag.b2_solidParticleGroup&&(i|=t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth),n&~i&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&i&&(i&t.b2ParticleGroupFlag.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=i),e.m_groupFlags=i}},{key:"RemoveSpuriousBodyContacts",value:function(){Es(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,e.BodyContactCompare);var t=e.RemoveSpuriousBodyContacts_s_n,i=e.RemoveSpuriousBodyContacts_s_pos,n=e.RemoveSpuriousBodyContacts_s_normal,s=3,r=this,o=-1,a=0,l=function(e){if(e.index!==o&&(a=0,o=e.index),a++>s)return!0;var l=t.Copy(e.normal);if(l.SelfMul(r.m_particleDiameter*(1-e.weight)),!r.m_positionBuffer.data)throw new Error;var u=Mt.AddVV(r.m_positionBuffer.data[e.index],l,i);if(!e.fixture.TestPoint(u)){for(var h=e.fixture.GetShape().GetChildCount(),m=0;m<h;m++){var c=n;if(e.fixture.ComputeDistance(u,c,m)<p)return!1}return!0}return!1};this.m_bodyContactBuffer.count=zs(this.m_bodyContactBuffer.data,l,this.m_bodyContactBuffer.count)}},{key:"DetectStuckParticle",value:function(t){if(!(this.m_stuckThreshold<=0)){if(!this.m_bodyContactCountBuffer.data)throw new Error;if(!this.m_consecutiveContactStepsBuffer.data)throw new Error;if(!this.m_lastBodyContactStepBuffer.data)throw new Error;++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp}}},{key:"ValidateParticleIndex",value:function(t){return t>=0&&t<this.GetParticleCount()&&t!==T}},{key:"GetQuantizedTimeElapsed",value:function(){return Math.floor(this.m_timeElapsed/4294967296)}},{key:"LifetimeToExpirationTime",value:function(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)}},{key:"ForceCanBeApplied",value:function(e){return!(e&t.b2ParticleFlag.b2_wallParticle)}},{key:"PrepareForceBuffer",value:function(){if(!this.m_hasForce){for(var t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}}},{key:"IsRigidGroup",value:function(e){return null!==e&&0!==(e.m_groupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup)}},{key:"GetLinearVelocity",value:function(t,e,i,n){if(t&&this.IsRigidGroup(t))return t.GetLinearVelocityFromWorldPoint(i,n);if(!this.m_velocityBuffer.data)throw new Error;return n.Copy(this.m_velocityBuffer.data[e])}},{key:"InitDampingParameter",value:function(t,e,i,n,s,r,o,a){t[0]=n>0?1/n:0,e[0]=s>0?1/s:0,i[0]=Mt.CrossVV(Mt.SubVV(o,r,Mt.s_t0),a)}},{key:"InitDampingParameterWithRigidGroupOrParticle",value:function(e,i,n,s,r,o,a,l){if(r&&s)this.InitDampingParameter(e,i,n,r.GetMass(),r.GetInertia(),r.GetCenter(),a,l);else{if(!this.m_flagsBuffer.data)throw new Error;var u=this.m_flagsBuffer.data[o];this.InitDampingParameter(e,i,n,u&t.b2ParticleFlag.b2_wallParticle?0:this.GetParticleMass(),0,a,a,l)}}},{key:"ComputeDampingImpulse",value:function(t,e,i,n,s,r,o){var a=t+e*i*i+n+s*r*r;return a>0?o/a:0}},{key:"ApplyDamping",value:function(t,e,i,n,s,r,o,a){if(s&&n)s.m_linearVelocity.SelfMulAdd(o*t,a),s.m_angularVelocity+=o*i*e;else{if(!this.m_velocityBuffer.data)throw new Error;this.m_velocityBuffer.data[r].SelfMulAdd(o*t,a)}}}],[{key:"computeTag",value:function(t,i){return(i+e.yOffset>>>0<<e.yShift)+(e.xScale*t+e.xOffset>>>0)>>>0}},{key:"computeRelativeTag",value:function(t,i,n){return t+(n<<e.yShift)+(i<<e.xShift)>>>0}},{key:"IsSignificantForce",value:function(t){return 0!==t.x||0!==t.y}},{key:"ParticleCanBeConnected",value:function(e,i){return 0!==(e&(t.b2ParticleFlag.b2_wallParticle|t.b2ParticleFlag.b2_springParticle|t.b2ParticleFlag.b2_elasticParticle))||null!==i&&0!==(i.GetGroupFlags()&t.b2ParticleGroupFlag.b2_rigidParticleGroup)}},{key:"ComparePairIndices",value:function(t,e){var i=t.indexA-e.indexA;return 0!==i?i<0:t.indexB<e.indexB}},{key:"MatchPairIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB}},{key:"CompareTriadIndices",value:function(t,e){var i=t.indexA-e.indexA;if(0!==i)return i<0;var n=t.indexB-e.indexB;return 0!==n?n<0:t.indexC<e.indexC}},{key:"MatchTriadIndices",value:function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC}},{key:"InitializeParticleLists",value:function(t,e){for(var i=t.GetBufferIndex(),n=t.GetParticleCount(),s=0;s<n;s++){var r=e[s];r.list=r,r.next=null,r.count=1,r.index=s+i}}},{key:"MergeParticleLists",value:function(t,e){for(var i=e;;){i.list=t;var n=i.next;if(!n){i.next=t.next;break}i=n}t.next=e,t.count+=e.count,e.count=0}},{key:"FindLongestParticleList",value:function(t,e){for(var i=t.GetParticleCount(),n=e[0],s=0;s<i;s++){var r=e[s];n.count<r.count&&(n=r)}return n}},{key:"MergeParticleListAndNode",value:function(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0}},{key:"b2ParticleContactIsZombie",value:function(e){return(e.flags&t.b2ParticleFlag.b2_zombieParticle)===t.b2ParticleFlag.b2_zombieParticle}},{key:"BodyContactCompare",value:function(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index}}]),e}();Qs.xTruncBits=12,Qs.yTruncBits=12,Qs.tagBits=32,Qs.yOffset=1<<Qs.yTruncBits-1,Qs.yShift=Qs.tagBits-Qs.yTruncBits,Qs.xShift=Qs.tagBits-Qs.yTruncBits-Qs.xTruncBits,Qs.xScale=1<<Qs.xShift,Qs.xOffset=Qs.xScale*(1<<Qs.xTruncBits-1),Qs.yMask=(1<<Qs.yTruncBits)-1<<Qs.yShift,Qs.xMask=~Qs.yMask,Qs.DestroyParticlesInShape_s_aabb=new Ve,Qs.CreateParticleGroup_s_transform=new Gt,Qs.ComputeCollisionEnergy_s_v=new Mt,Qs.QueryShapeAABB_s_aabb=new Ve,Qs.QueryPointAABB_s_aabb=new Ve,Qs.RayCast_s_aabb=new Ve,Qs.RayCast_s_p=new Mt,Qs.RayCast_s_v=new Mt,Qs.RayCast_s_n=new Mt,Qs.RayCast_s_point=new Mt,Qs.k_pairFlags=t.b2ParticleFlag.b2_springParticle,Qs.k_triadFlags=t.b2ParticleFlag.b2_elasticParticle,Qs.k_noPressureFlags=t.b2ParticleFlag.b2_powderParticle|t.b2ParticleFlag.b2_tensileParticle,Qs.k_extraDampingFlags=t.b2ParticleFlag.b2_staticPressureParticle,Qs.k_barrierWallFlags=t.b2ParticleFlag.b2_barrierParticle|t.b2ParticleFlag.b2_wallParticle,Qs.CreateParticlesStrokeShapeForGroup_s_edge=new ln,Qs.CreateParticlesStrokeShapeForGroup_s_d=new Mt,Qs.CreateParticlesStrokeShapeForGroup_s_p=new Mt,Qs.CreateParticlesFillShapeForGroup_s_aabb=new Ve,Qs.CreateParticlesFillShapeForGroup_s_p=new Mt,Qs.UpdatePairsAndTriads_s_dab=new Mt,Qs.UpdatePairsAndTriads_s_dbc=new Mt,Qs.UpdatePairsAndTriads_s_dca=new Mt,Qs.AddContact_s_d=new Mt,Qs.UpdateBodyContacts_s_aabb=new Ve,Qs.Solve_s_subStep=new ds,Qs.SolveCollision_s_aabb=new Ve,Qs.SolveGravity_s_gravity=new Mt,Qs.SolveBarrier_s_aabb=new Ve,Qs.SolveBarrier_s_va=new Mt,Qs.SolveBarrier_s_vb=new Mt,Qs.SolveBarrier_s_pba=new Mt,Qs.SolveBarrier_s_vba=new Mt,Qs.SolveBarrier_s_vc=new Mt,Qs.SolveBarrier_s_pca=new Mt,Qs.SolveBarrier_s_vca=new Mt,Qs.SolveBarrier_s_qba=new Mt,Qs.SolveBarrier_s_qca=new Mt,Qs.SolveBarrier_s_dv=new Mt,Qs.SolveBarrier_s_f=new Mt,Qs.SolvePressure_s_f=new Mt,Qs.SolveDamping_s_v=new Mt,Qs.SolveDamping_s_f=new Mt,Qs.SolveRigidDamping_s_t0=new Mt,Qs.SolveRigidDamping_s_t1=new Mt,Qs.SolveRigidDamping_s_p=new Mt,Qs.SolveRigidDamping_s_v=new Mt,Qs.SolveExtraDamping_s_v=new Mt,Qs.SolveExtraDamping_s_f=new Mt,Qs.SolveRigid_s_position=new Mt,Qs.SolveRigid_s_rotation=new Tt,Qs.SolveRigid_s_transform=new Gt,Qs.SolveRigid_s_velocityTransform=new Gt,Qs.SolveElastic_s_pa=new Mt,Qs.SolveElastic_s_pb=new Mt,Qs.SolveElastic_s_pc=new Mt,Qs.SolveElastic_s_r=new Tt,Qs.SolveElastic_s_t0=new Mt,Qs.SolveSpring_s_pa=new Mt,Qs.SolveSpring_s_pb=new Mt,Qs.SolveSpring_s_d=new Mt,Qs.SolveSpring_s_f=new Mt,Qs.SolveTensile_s_weightedNormal=new Mt,Qs.SolveTensile_s_s=new Mt,Qs.SolveTensile_s_f=new Mt,Qs.SolveViscous_s_v=new Mt,Qs.SolveViscous_s_f=new Mt,Qs.SolveRepulsive_s_f=new Mt,Qs.SolvePowder_s_f=new Mt,Qs.SolveSolid_s_f=new Mt,Qs.RemoveSpuriousBodyContacts_s_n=new Mt,Qs.RemoveSpuriousBodyContacts_s_pos=new Mt,Qs.RemoveSpuriousBodyContacts_s_normal=new Mt,function(e){var i=l((function t(){a(this,t),this.data=null,this.userSuppliedCapacity=0}));e.UserOverridableBuffer=i;var n=function(){function t(){a(this,t),this.index=T,this.tag=0}return l(t,null,[{key:"CompareProxyProxy",value:function(t,e){return t.tag<e.tag}},{key:"CompareTagProxy",value:function(t,e){return t<e.tag}},{key:"CompareProxyTag",value:function(t,e){return t.tag<e}}]),t}();e.Proxy=n;var s=function(){function t(i,n,s,r,o){a(this,t),this.m_system=i,this.m_xLower=(n&e.xMask)>>>0,this.m_xUpper=(s&e.xMask)>>>0,this.m_yLower=(n&e.yMask)>>>0,this.m_yUpper=(s&e.yMask)>>>0,this.m_first=r,this.m_last=o}return l(t,[{key:"GetNext",value:function(){for(;this.m_first<this.m_last;){var t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&e.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return T}}]),t}();e.InsideBoundsEnumerator=s;var u=l((function t(){a(this,t),this.next=null,this.count=0,this.index=0}));e.ParticleListNode=u;var m=function(){function t(){a(this,t)}return l(t,[{key:"Allocate",value:function(t,e){return e}},{key:"Clear",value:function(){}},{key:"GetCount",value:function(){return 0}},{key:"Invalidate",value:function(t){}},{key:"GetValidBuffer",value:function(){return[]}},{key:"GetBuffer",value:function(){return[]}},{key:"SetCount",value:function(t){}}]),t}();e.FixedSetAllocator=m;var c=l((function t(e,i){a(this,t),this.second=T,this.first=e,this.second=i}));e.FixtureParticle=c;var _=function(t){r(i,t);var e=o(i);function i(){return a(this,i),e.apply(this,arguments)}return l(i,[{key:"Initialize",value:function(t,e){}},{key:"Find",value:function(t){return T}}]),i}(e.FixedSetAllocator);e.FixtureParticleSet=_;var f=l((function t(e,i){a(this,t),this.first=T,this.second=T,this.first=e,this.second=i}));e.ParticlePair=f;var d=function(t){r(i,t);var e=o(i);function i(){return a(this,i),e.apply(this,arguments)}return l(i,[{key:"Initialize",value:function(t,e){}},{key:"Find",value:function(t){return T}}]),i}(e.FixedSetAllocator);e.b2ParticlePairSet=d;var v=function(){function t(){a(this,t)}return l(t,[{key:"IsNecessary",value:function(t){return!0}},{key:"ShouldCreatePair",value:function(t,e){return!0}},{key:"ShouldCreateTriad",value:function(t,e,i){return!0}}]),t}();e.ConnectionFilter=v;var y=function(t){r(i,t);var e=o(i);function i(t,n,s,r){var o;return a(this,i),(o=e.call(this)).m_callDestructionListener=!1,o.m_destroyed=0,o.m_system=t,o.m_shape=n,o.m_xf=s,o.m_callDestructionListener=r,o.m_destroyed=0,o}return l(i,[{key:"ReportFixture",value:function(t){return!1}},{key:"ReportParticle",value:function(t,e){if(t!==this.m_system)return!1;if(!this.m_system.m_positionBuffer.data)throw new Error;return this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0}},{key:"Destroyed",value:function(){return this.m_destroyed}}]),i}(ms);e.DestroyParticlesInShapeCallback=y;var x=function(t){r(i,t);var e=o(i);function i(t){var n;return a(this,i),(n=e.call(this)).m_threshold=0,n.m_threshold=t,n}return l(i,[{key:"ShouldCreatePair",value:function(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t}},{key:"ShouldCreateTriad",value:function(t,e,i){return(t<this.m_threshold||e<this.m_threshold||i<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=i)}}]),i}(e.ConnectionFilter);e.JoinParticleGroupsFilter=x;var g=function(e){r(n,e);var i=o(n);function n(e){var s,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;return a(this,n),(s=i.call(this,t.b2ShapeType.e_unknown,0)).m_shapeCount=0,s.m_shapes=e,s.m_shapeCount=r,s}return l(n,[{key:"Clone",value:function(){throw new Error}},{key:"GetChildCount",value:function(){return 1}},{key:"TestPoint",value:function(t,e){for(var i=0;i<this.m_shapeCount;i++)if(this.m_shapes[i].TestPoint(t,e))return!0;return!1}},{key:"ComputeDistance",value:function(t,e,i,n){return 0}},{key:"RayCast",value:function(t,e,i,n){return!1}},{key:"ComputeAABB",value:function(t,e,i){var n=new Ve;t.lowerBound.x=+h,t.lowerBound.y=+h,t.upperBound.x=-h,t.upperBound.y=-h;for(var s=0;s<this.m_shapeCount;s++)for(var r=this.m_shapes[s].GetChildCount(),o=0;o<r;o++){var a=n;this.m_shapes[s].ComputeAABB(a,e,o),t.Combine1(a)}}},{key:"ComputeMass",value:function(t,e){}},{key:"SetupDistanceProxy",value:function(t,e){}},{key:"ComputeSubmergedArea",value:function(t,e,i,n){return 0}},{key:"Dump",value:function(t){}}]),n}(rn);e.CompositeShape=g;var b=function(e){r(n,e);var i=o(n);function n(t){var e;return a(this,n),(e=i.call(this)).m_flagsBuffer=t,e}return l(n,[{key:"IsNecessary",value:function(e){if(!this.m_flagsBuffer.data)throw new Error;return 0!==(this.m_flagsBuffer.data[e]&t.b2ParticleFlag.b2_reactiveParticle)}}]),n}(e.ConnectionFilter);e.ReactiveFilter=b;var S=function(i){r(s,i);var n=o(s);function s(t,e){var i;return a(this,s),(i=n.call(this,t)).m_contactFilter=e,i}return l(s,[{key:"ShouldCollideFixtureParticle",value:function(e,i,n){return!(this.m_contactFilter&&this.m_system.GetFlagsBuffer()[n]&t.b2ParticleFlag.b2_fixtureContactFilterParticle)||this.m_contactFilter.ShouldCollideFixtureParticle(e,this.m_system,n)}},{key:"ReportFixtureAndParticle",value:function(i,n,s){var r=e.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_n,o=e.UpdateBodyContactsCallback.ReportFixtureAndParticle_s_rp;if(!this.m_system.m_flagsBuffer.data)throw new Error;if(!this.m_system.m_positionBuffer.data)throw new Error;var a=this.m_system.m_positionBuffer.data[s],l=r,u=i.ComputeDistance(a,l,n);if(u<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(i,this.m_system,s)){var h=i.GetBody(),m=h.GetWorldCenter(),c=h.GetMass(),_=h.GetInertia()-c*h.GetLocalCenter().LengthSquared(),f=c>0?1/c:0,d=_>0?1/_:0,v=this.m_system.m_flagsBuffer.data[s]&t.b2ParticleFlag.b2_wallParticle?0:this.m_system.GetParticleInvMass(),y=Mt.SubVV(a,m,o),p=Mt.CrossVV(y,l),x=v+f+d*p*p,g=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];g.index=s,g.body=h,g.fixture=i,g.weight=1-u*this.m_system.m_inverseDiameter,g.normal.Copy(l.SelfNeg()),g.mass=x>0?1/x:0,this.m_system.DetectStuckParticle(s)}}}]),s}(Ws);S.ReportFixtureAndParticle_s_n=new Mt,S.ReportFixtureAndParticle_s_rp=new Mt,e.UpdateBodyContactsCallback=S;var B=function(i){r(s,i);var n=o(s);function s(t,e){var i;return a(this,s),(i=n.call(this,t)).m_step=e,i}return l(s,[{key:"ReportFixtureAndParticle",value:function(i,n,s){var r=e.SolveCollisionCallback.ReportFixtureAndParticle_s_p1,o=e.SolveCollisionCallback.ReportFixtureAndParticle_s_output,a=e.SolveCollisionCallback.ReportFixtureAndParticle_s_input,l=e.SolveCollisionCallback.ReportFixtureAndParticle_s_p,u=e.SolveCollisionCallback.ReportFixtureAndParticle_s_v,h=e.SolveCollisionCallback.ReportFixtureAndParticle_s_f,m=i.GetBody();if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var c=this.m_system.m_positionBuffer.data[s],_=this.m_system.m_velocityBuffer.data[s],f=o,d=a;if(0===this.m_system.m_iterationIndex){var v=Gt.MulTXV(m.m_xf0,c,r);i.GetShape().GetType()===t.b2ShapeType.e_circleShape&&(v.SelfSub(m.GetLocalCenter()),Tt.MulRV(m.m_xf0.q,v,v),Tt.MulTRV(m.m_xf.q,v,v),v.SelfAdd(m.GetLocalCenter())),Gt.MulXV(m.m_xf,v,d.p1)}else d.p1.Copy(c);if(Mt.AddVMulSV(c,this.m_step.dt,_,d.p2),d.maxFraction=1,i.RayCast(f,d,n)){var y=f.normal,x=l;x.x=(1-f.fraction)*d.p1.x+f.fraction*d.p2.x+p*y.x,x.y=(1-f.fraction)*d.p1.y+f.fraction*d.p2.y+p*y.y;var g=u;g.x=this.m_step.inv_dt*(x.x-c.x),g.y=this.m_step.inv_dt*(x.y-c.y),this.m_system.m_velocityBuffer.data[s].Copy(g);var b=h;b.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(_.x-g.x),b.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(_.y-g.y),this.m_system.ParticleApplyForce(s,b)}}},{key:"ReportParticle",value:function(t,e){return!1}}]),s}(Ws);B.ReportFixtureAndParticle_s_p1=new Mt,B.ReportFixtureAndParticle_s_output=new Me,B.ReportFixtureAndParticle_s_input=new Ce,B.ReportFixtureAndParticle_s_p=new Mt,B.ReportFixtureAndParticle_s_v=new Mt,B.ReportFixtureAndParticle_s_f=new Mt,e.SolveCollisionCallback=B}(Qs||(Qs={}));var $s=function(){function e(t){a(this,e),this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new _s,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new Mt,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new fs,this.m_island=new Ms,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(t)}return l(e,[{key:"SetDestructionListener",value:function(t){this.m_destructionListener=t}},{key:"SetContactFilter",value:function(t){this.m_contactManager.m_contactFilter=t}},{key:"SetContactListener",value:function(t){this.m_contactManager.m_contactListener=t}},{key:"SetDebugDraw",value:function(t){this.m_debugDraw=t}},{key:"CreateBody",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.IsLocked())throw new Error;var e=new pn(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e}},{key:"DestroyBody",value:function(t){if(this.IsLocked())throw new Error;for(var e=t.m_jointList;e;){var i=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(i.joint),this.DestroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;for(var n=t.m_controllerList;n;){var s=n;n=n.nextController,s.controller.RemoveBody(t)}for(var r=t.m_contactList;r;){var o=r;r=r.next,this.m_contactManager.Destroy(o.contact)}t.m_contactList=null;for(var a=t.m_fixtureList;a;){var l=a;a=a.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(l),l.DestroyProxies(),l.Destroy(),t.m_fixtureList=a,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount}},{key:"CreateJoint",value:function(t){if(this.IsLocked())throw new Error;var i=e._Joint_Create(t,null);i.m_prev=null,i.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=i),this.m_jointList=i,++this.m_jointCount,i.m_edgeA.prev=null,i.m_edgeA.next=i.m_bodyA.m_jointList,i.m_bodyA.m_jointList&&(i.m_bodyA.m_jointList.prev=i.m_edgeA),i.m_bodyA.m_jointList=i.m_edgeA,i.m_edgeB.prev=null,i.m_edgeB.next=i.m_bodyB.m_jointList,i.m_bodyB.m_jointList&&(i.m_bodyB.m_jointList.prev=i.m_edgeB),i.m_bodyB.m_jointList=i.m_edgeB;var n=t.bodyA,s=t.bodyB;if(!t.collideConnected)for(var r=s.GetContactList();r;)r.other===n&&r.contact.FlagForFiltering(),r=r.next;return i}},{key:"DestroyJoint",value:function(t){if(this.IsLocked())throw new Error;var i=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);var n=t.m_bodyA,s=t.m_bodyB;if(n.SetAwake(!0),s.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===n.m_jointList&&(n.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===s.m_jointList&&(s.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,e._Joint_Destroy(t,null),--this.m_jointCount,!i)for(var r=s.GetContactList();r;)r.other===n&&r.contact.FlagForFiltering(),r=r.next}},{key:"CreateParticleSystem",value:function(t){if(this.IsLocked())throw new Error;var e=new Qs(t,this);return e.m_prev=null,e.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=e),this.m_particleSystemList=e,e}},{key:"DestroyParticleSystem",value:function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)}},{key:"CalculateReasonableParticleIterations",value:function(t){if(null===this.m_particleSystemList)return 1;function e(t){for(var e=h,i=t.GetParticleSystemList();null!==i;i=i.m_next)e=at(e,i.GetRadius());return e}return ks(this.m_gravity.Length(),e(this),t)}},{key:"Step",value:function(t,i,n){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.CalculateReasonableParticleIterations(t),r=e.Step_s_stepTimer.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;var o=e.Step_s_step;o.dt=t,o.velocityIterations=i,o.positionIterations=n,o.particleIterations=s,o.inv_dt=t>0?1/t:0,o.dtRatio=this.m_inv_dt0*t,o.warmStarting=this.m_warmStarting;var a=e.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=a.GetMilliseconds(),this.m_stepComplete&&o.dt>0){for(var l=e.Step_s_timer.Reset(),u=this.m_particleSystemList;u;u=u.m_next)u.Solve(o);this.Solve(o),this.m_profile.solve=l.GetMilliseconds()}if(this.m_continuousPhysics&&o.dt>0){var h=e.Step_s_timer.Reset();this.SolveTOI(o),this.m_profile.solveTOI=h.GetMilliseconds()}o.dt>0&&(this.m_inv_dt0=o.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=r.GetMilliseconds()}},{key:"ClearForces",value:function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0}},{key:"DrawParticleSystem",value:function(t){if(null!==this.m_debugDraw){var e=t.GetParticleCount();if(e){var i=t.GetRadius(),n=t.GetPositionBuffer();if(t.m_colorBuffer.data){var s=t.GetColorBuffer();this.m_debugDraw.DrawParticles(n,i,s,e)}else this.m_debugDraw.DrawParticles(n,i,null,e)}}}},{key:"DrawDebugData",value:function(){if(null!==this.m_debugDraw){var i=this.m_debugDraw.GetFlags(),n=e.DrawDebugData_s_color.SetRGB(0,0,0);if(i&t.b2DrawFlags.e_shapeBit)for(var s=this.m_bodyList;s;s=s.m_next){var r=s.m_xf;this.m_debugDraw.PushTransform(r);for(var o=s.GetFixtureList();o;o=o.m_next)s.IsActive()?s.GetType()===t.b2BodyType.b2_staticBody?(n.SetRGB(.5,.9,.5),this.DrawShape(o,n)):s.GetType()===t.b2BodyType.b2_kinematicBody?(n.SetRGB(.5,.5,.9),this.DrawShape(o,n)):s.IsAwake()?(n.SetRGB(.9,.7,.7),this.DrawShape(o,n)):(n.SetRGB(.6,.6,.6),this.DrawShape(o,n)):(n.SetRGB(.5,.5,.3),this.DrawShape(o,n));this.m_debugDraw.PopTransform(r)}if(i&t.b2DrawFlags.e_particleBit)for(var a=this.m_particleSystemList;a;a=a.m_next)this.DrawParticleSystem(a);if(i&t.b2DrawFlags.e_jointBit)for(var l=this.m_jointList;l;l=l.m_next)this.DrawJoint(l);if(i&t.b2DrawFlags.e_aabbBit){n.SetRGB(.9,.3,.9);for(var u=e.DrawDebugData_s_vs,h=this.m_bodyList;h;h=h.m_next)if(h.IsActive())for(var m=h.GetFixtureList();m;m=m.m_next)for(var c=0;c<m.m_proxyCount;++c){var _=m.m_proxies[c].treeNode.aabb;u[0].Set(_.lowerBound.x,_.lowerBound.y),u[1].Set(_.upperBound.x,_.lowerBound.y),u[2].Set(_.upperBound.x,_.upperBound.y),u[3].Set(_.lowerBound.x,_.upperBound.y),this.m_debugDraw.DrawPolygon(u,4,n)}}if(i&t.b2DrawFlags.e_centerOfMassBit)for(var f=this.m_bodyList;f;f=f.m_next){var d=e.DrawDebugData_s_xf;d.q.Copy(f.m_xf.q),d.p.Copy(f.GetWorldCenter()),this.m_debugDraw.DrawTransform(d)}if(i&t.b2DrawFlags.e_controllerBit)for(var v=this.m_controllerList;v;v=v.m_next)v.Draw(this.m_debugDraw)}}},{key:"QueryAABB",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.Query(e,(function(e){var n=e.userData.fixture;return t?t.ReportFixture(n):!i||i(n)})),t instanceof ms)for(var n=this.m_particleSystemList;n;n=n.m_next)t.ShouldQueryParticleSystem(n)&&n.QueryAABB(t,e)}},{key:"QueryAllAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryAABB(null,t,(function(t){return e.push(t),!0})),e}},{key:"QueryPointAABB",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(e){var n=e.userData.fixture;return t?t.ReportFixture(n):!i||i(n)})),t instanceof ms)for(var n=this.m_particleSystemList;n;n=n.m_next)t.ShouldQueryParticleSystem(n)&&n.QueryPointAABB(t,e)}},{key:"QueryAllPointAABB",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryPointAABB(null,t,(function(t){return e.push(t),!0})),e}},{key:"QueryFixtureShape",value:function(t,i,n,s,r){var o=e.QueryFixtureShape_s_aabb;if(i.ComputeAABB(o,s,n),this.m_contactManager.m_broadPhase.Query(o,(function(e){var o=e.userData,a=o.fixture;if(Le(i,n,a.GetShape(),o.childIndex,s,a.GetBody().GetTransform())){if(t)return t.ReportFixture(a);if(r)return r(a)}return!0})),t instanceof ms)for(var a=this.m_particleSystemList;a;a=a.m_next)t.ShouldQueryParticleSystem(a)&&a.QueryAABB(t,o)}},{key:"QueryAllFixtureShape",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return this.QueryFixtureShape(null,t,e,i,(function(t){return n.push(t),!0})),n}},{key:"QueryFixturePoint",value:function(t,e,i){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(n){var s=n.userData.fixture;if(s.TestPoint(e)){if(t)return t.ReportFixture(s);if(i)return i(s)}return!0})),t)for(var n=this.m_particleSystemList;n;n=n.m_next)t.ShouldQueryParticleSystem(n)&&n.QueryPointAABB(t,e)}},{key:"QueryAllFixturePoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return this.QueryFixturePoint(null,t,(function(t){return e.push(t),!0})),e}},{key:"RayCast",value:function(t,i,n,s){var r=e.RayCast_s_input;if(r.maxFraction=1,r.p1.Copy(i),r.p2.Copy(n),this.m_contactManager.m_broadPhase.RayCast(r,(function(r,o){var a=o.userData,l=a.fixture,u=a.childIndex,h=e.RayCast_s_output;if(l.RayCast(h,r,u)){var m=h.fraction,c=e.RayCast_s_point;if(c.Set((1-m)*i.x+m*n.x,(1-m)*i.y+m*n.y),t)return t.ReportFixture(l,c,h.normal,m);if(s)return s(l,c,h.normal,m)}return r.maxFraction})),t)for(var o=this.m_particleSystemList;o;o=o.m_next)t.ShouldQueryParticleSystem(o)&&o.RayCast(t,i,n)}},{key:"RayCastOne",value:function(t,e){var i=null,n=1;return this.RayCast(null,t,e,(function(t,e,s,r){return r<n&&(n=r,i=t),n})),i}},{key:"RayCastAll",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.RayCast(null,t,e,(function(t,e,n,s){return i.push(t),1})),i}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"GetJointList",value:function(){return this.m_jointList}},{key:"GetParticleSystemList",value:function(){return this.m_particleSystemList}},{key:"GetContactList",value:function(){return this.m_contactManager.m_contactList}},{key:"SetAllowSleeping",value:function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)}},{key:"GetAllowSleeping",value:function(){return this.m_allowSleep}},{key:"SetWarmStarting",value:function(t){this.m_warmStarting=t}},{key:"GetWarmStarting",value:function(){return this.m_warmStarting}},{key:"SetContinuousPhysics",value:function(t){this.m_continuousPhysics=t}},{key:"GetContinuousPhysics",value:function(){return this.m_continuousPhysics}},{key:"SetSubStepping",value:function(t){this.m_subStepping=t}},{key:"GetSubStepping",value:function(){return this.m_subStepping}},{key:"GetProxyCount",value:function(){return this.m_contactManager.m_broadPhase.GetProxyCount()}},{key:"GetBodyCount",value:function(){return this.m_bodyCount}},{key:"GetJointCount",value:function(){return this.m_jointCount}},{key:"GetContactCount",value:function(){return this.m_contactManager.m_contactCount}},{key:"GetTreeHeight",value:function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()}},{key:"GetTreeBalance",value:function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()}},{key:"GetTreeQuality",value:function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()}},{key:"SetGravity",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Mt.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var i=this.m_bodyList;i;i=i.m_next)i.SetAwake(!0)}},{key:"GetGravity",value:function(){return this.m_gravity}},{key:"IsLocked",value:function(){return this.m_locked}},{key:"SetAutoClearForces",value:function(t){this.m_clearForces=t}},{key:"GetAutoClearForces",value:function(){return this.m_clearForces}},{key:"ShiftOrigin",value:function(t){if(this.IsLocked())throw new Error;for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var i=this.m_jointList;i;i=i.m_next)i.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)}},{key:"GetContactManager",value:function(){return this.m_contactManager}},{key:"GetProfile",value:function(){return this.m_profile}},{key:"Dump",value:function(e){if(!this.m_locked){e("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),e("this.m_world.SetGravity(g);\n"),e("const bodies: b2Body[] = [];\n"),e("const joints: b2Joint[] = [];\n");for(var i=0,n=this.m_bodyList;n;n=n.m_next)n.m_islandIndex=i,n.Dump(e),++i;i=0;for(var s=this.m_jointList;s;s=s.m_next)s.m_index=i,++i;for(var r=this.m_jointList;r;r=r.m_next)r.m_type!==t.b2JointType.e_gearJoint&&(e("{\n"),r.Dump(e),e("}\n"));for(var o=this.m_jointList;o;o=o.m_next)o.m_type===t.b2JointType.e_gearJoint&&(e("{\n"),o.Dump(e),e("}\n"))}}},{key:"DrawJoint",value:function(i){if(null!==this.m_debugDraw){var n=i.GetBodyA(),s=i.GetBodyB(),r=n.m_xf,o=s.m_xf,a=r.p,l=o.p,u=i.GetAnchorA(e.DrawJoint_s_p1),h=i.GetAnchorB(e.DrawJoint_s_p2),m=e.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(i.m_type){case t.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(u,h,m);break;case t.b2JointType.e_pulleyJoint:var c=i,_=c.GetGroundAnchorA(),f=c.GetGroundAnchorB();this.m_debugDraw.DrawSegment(_,u,m),this.m_debugDraw.DrawSegment(f,h,m),this.m_debugDraw.DrawSegment(_,f,m);break;case t.b2JointType.e_mouseJoint:var d=e.DrawJoint_s_c;d.Set(0,1,0),this.m_debugDraw.DrawPoint(u,4,d),this.m_debugDraw.DrawPoint(h,4,d),d.Set(.8,.8,.8),this.m_debugDraw.DrawSegment(u,h,d);break;default:this.m_debugDraw.DrawSegment(a,u,m),this.m_debugDraw.DrawSegment(u,h,m),this.m_debugDraw.DrawSegment(l,h,m)}}}},{key:"DrawShape",value:function(i,n){if(null!==this.m_debugDraw){var s=i.GetShape();switch(s.m_type){case t.b2ShapeType.e_circleShape:var r=s,o=r.m_p,a=r.m_radius,l=Mt.UNITX;this.m_debugDraw.DrawSolidCircle(o,a,l,n);break;case t.b2ShapeType.e_edgeShape:var u=s,h=u.m_vertex1,m=u.m_vertex2;this.m_debugDraw.DrawSegment(h,m,n);break;case t.b2ShapeType.e_chainShape:var c=s,_=c.m_count,f=c.m_vertices,d=e.DrawShape_s_ghostColor.SetRGBA(.75*n.r,.75*n.g,.75*n.b,n.a),v=f[0];if(this.m_debugDraw.DrawPoint(v,4,n),c.m_hasPrevVertex){var y=c.m_prevVertex;this.m_debugDraw.DrawSegment(y,v,d),this.m_debugDraw.DrawCircle(y,.1,d)}for(var p=1;p<_;++p){var x=f[p];this.m_debugDraw.DrawSegment(v,x,n),this.m_debugDraw.DrawPoint(x,4,n),v=x}if(c.m_hasNextVertex){var g=c.m_nextVertex;this.m_debugDraw.DrawSegment(g,v,d),this.m_debugDraw.DrawCircle(g,.1,d)}break;case t.b2ShapeType.e_polygonShape:var b=s,S=b.m_count,B=b.m_vertices;this.m_debugDraw.DrawSolidPolygon(B,S,n)}}}},{key:"Solve",value:function(e){for(var i=this.m_bodyList;i;i=i.m_next)i.m_xf0.Copy(i.m_xf);for(var n=this.m_controllerList;n;n=n.m_next)n.Step(e);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var s=this.m_island;s.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(var r=this.m_bodyList;r;r=r.m_next)r.m_islandFlag=!1;for(var o=this.m_contactManager.m_contactList;o;o=o.m_next)o.m_islandFlag=!1;for(var a=this.m_jointList;a;a=a.m_next)a.m_islandFlag=!1;for(var l=this.s_stack,u=this.m_bodyList;u;u=u.m_next)if(!u.m_islandFlag&&u.IsAwake()&&u.IsActive()&&u.GetType()!==t.b2BodyType.b2_staticBody){s.Clear();var h=0;for(l[h++]=u,u.m_islandFlag=!0;h>0;){var m=l[--h];if(!m)throw new Error;if(s.AddBody(m),m.m_awakeFlag=!0,m.GetType()!==t.b2BodyType.b2_staticBody){for(var c=m.m_contactList;c;c=c.next){var _=c.contact;if(!_.m_islandFlag&&_.IsEnabled()&&_.IsTouching()){var f=_.m_fixtureA.m_isSensor,d=_.m_fixtureB.m_isSensor;if(!f&&!d){s.AddContact(_),_.m_islandFlag=!0;var v=c.other;if(!v)throw new Error;v.m_islandFlag||(l[h++]=v,v.m_islandFlag=!0)}}}for(var y=m.m_jointList;y;y=y.next)if(!y.joint.m_islandFlag){var p=y.other;p.IsActive()&&(s.AddJoint(y.joint),y.joint.m_islandFlag=!0,p.m_islandFlag||(l[h++]=p,p.m_islandFlag=!0))}}}var x=new fs;s.Solve(x,e,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=x.solveInit,this.m_profile.solveVelocity+=x.solveVelocity,this.m_profile.solvePosition+=x.solvePosition;for(var g=0;g<s.m_bodyCount;++g){var b=s.m_bodies[g];b.GetType()===t.b2BodyType.b2_staticBody&&(b.m_islandFlag=!1)}}for(var S=0;S<l.length&&l[S];++S)l[S]=null;for(var B=new Et,w=this.m_bodyList;w;w=w.m_next)w.m_islandFlag&&w.GetType()!==t.b2BodyType.b2_staticBody&&w.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=B.GetMilliseconds()}},{key:"SolveTOI",value:function(i){var n=this.m_island;if(n.Initialize(2*S,S,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var s=this.m_bodyList;s;s=s.m_next)s.m_islandFlag=!1,s.m_sweep.alpha0=0;for(var r=this.m_contactManager.m_contactList;r;r=r.m_next)r.m_toiFlag=!1,r.m_islandFlag=!1,r.m_toiCount=0,r.m_toi=1}for(;;){for(var o=null,a=1,l=this.m_contactManager.m_contactList;l;l=l.m_next)if(l.IsEnabled()&&!(l.m_toiCount>b)){var u=1;if(l.m_toiFlag)u=l.m_toi;else{var h=l.GetFixtureA(),c=l.GetFixtureB();if(h.IsSensor()||c.IsSensor())continue;var _=h.GetBody(),f=c.GetBody(),d=_.m_type,v=f.m_type,y=_.IsAwake()&&d!==t.b2BodyType.b2_staticBody,p=f.IsAwake()&&v!==t.b2BodyType.b2_staticBody;if(!y&&!p)continue;var x=_.IsBullet()||d!==t.b2BodyType.b2_dynamicBody,g=f.IsBullet()||v!==t.b2BodyType.b2_dynamicBody;if(!x&&!g)continue;var B=_.m_sweep.alpha0;_.m_sweep.alpha0<f.m_sweep.alpha0?(B=f.m_sweep.alpha0,_.m_sweep.Advance(B)):f.m_sweep.alpha0<_.m_sweep.alpha0&&(B=_.m_sweep.alpha0,f.m_sweep.Advance(B));var w=l.GetChildIndexA(),A=l.GetChildIndexB(),C=e.SolveTOI_s_toi_input;C.proxyA.SetShape(h.GetShape(),w),C.proxyB.SetShape(c.GetShape(),A),C.sweepA.Copy(_.m_sweep),C.sweepB.Copy(f.m_sweep),C.tMax=1;var M=e.SolveTOI_s_toi_output;ui(M,C);var V=M.t;u=M.state===t.b2TOIOutputState.e_touching?at(B+(1-B)*V,1):1,l.m_toi=u,l.m_toiFlag=!0}u<a&&(o=l,a=u)}if(null===o||1-10*m<a){this.m_stepComplete=!0;break}var k=o.GetFixtureA(),P=o.GetFixtureB(),I=k.GetBody(),T=P.GetBody(),G=e.SolveTOI_s_backup1.Copy(I.m_sweep),L=e.SolveTOI_s_backup2.Copy(T.m_sweep);if(I.Advance(a),T.Advance(a),o.Update(this.m_contactManager.m_contactListener),o.m_toiFlag=!1,++o.m_toiCount,o.IsEnabled()&&o.IsTouching()){I.SetAwake(!0),T.SetAwake(!0),n.Clear(),n.AddBody(I),n.AddBody(T),n.AddContact(o),I.m_islandFlag=!0,T.m_islandFlag=!0,o.m_islandFlag=!0;for(var D=0;D<2;++D){var R=0===D?I:T;if(R.m_type===t.b2BodyType.b2_dynamicBody)for(var F=R.m_contactList;F&&n.m_bodyCount!==n.m_bodyCapacity&&n.m_contactCount!==n.m_contactCapacity;F=F.next){var E=F.contact;if(!E.m_islandFlag){var O=F.other;if(O.m_type!==t.b2BodyType.b2_dynamicBody||R.IsBullet()||O.IsBullet()){var z=E.m_fixtureA.m_isSensor,j=E.m_fixtureB.m_isSensor;if(!z&&!j){var q=e.SolveTOI_s_backup.Copy(O.m_sweep);O.m_islandFlag||O.Advance(a),E.Update(this.m_contactManager.m_contactListener),E.IsEnabled()&&E.IsTouching()?(E.m_islandFlag=!0,n.AddContact(E),O.m_islandFlag||(O.m_islandFlag=!0,O.m_type!==t.b2BodyType.b2_staticBody&&O.SetAwake(!0),n.AddBody(O))):(O.m_sweep.Copy(q),O.SynchronizeTransform())}}}}}var N=e.SolveTOI_s_subStep;N.dt=(1-a)*i.dt,N.inv_dt=1/N.dt,N.dtRatio=1,N.positionIterations=20,N.velocityIterations=i.velocityIterations,N.particleIterations=i.particleIterations,N.warmStarting=!1,n.SolveTOI(N,I.m_islandIndex,T.m_islandIndex);for(var X=0;X<n.m_bodyCount;++X){var J=n.m_bodies[X];if(J.m_islandFlag=!1,J.m_type===t.b2BodyType.b2_dynamicBody){J.SynchronizeFixtures();for(var W=J.m_contactList;W;W=W.next)W.contact.m_toiFlag=!1,W.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else o.SetEnabled(!1),I.m_sweep.Copy(G),T.m_sweep.Copy(L),I.SynchronizeTransform(),T.SynchronizeTransform()}}},{key:"AddController",value:function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t}},{key:"RemoveController",value:function(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t}}],[{key:"_Joint_Create",value:function(e,i){switch(e.type){case t.b2JointType.e_distanceJoint:return new wn(e);case t.b2JointType.e_mouseJoint:return new Ln(e);case t.b2JointType.e_prismaticJoint:return new Rn(e);case t.b2JointType.e_revoluteJoint:return new jn(e);case t.b2JointType.e_pulleyJoint:return new On(e);case t.b2JointType.e_gearJoint:return new Pn(e);case t.b2JointType.e_wheelJoint:return new Un(e);case t.b2JointType.e_weldJoint:return new Jn(e);case t.b2JointType.e_frictionJoint:return new Vn(e);case t.b2JointType.e_ropeJoint:return new Nn(e);case t.b2JointType.e_motorJoint:return new Tn(e);case t.b2JointType.e_areaJoint:return new Cn(e)}throw new Error}},{key:"_Joint_Destroy",value:function(t,e){}}]),e}();$s.Step_s_step=new ds,$s.Step_s_stepTimer=new Et,$s.Step_s_timer=new Et,$s.DrawDebugData_s_color=new Rt(0,0,0),$s.DrawDebugData_s_vs=Mt.MakeArray(4),$s.DrawDebugData_s_xf=new Gt,$s.QueryFixtureShape_s_aabb=new Ve,$s.RayCast_s_input=new Ce,$s.RayCast_s_output=new Me,$s.RayCast_s_point=new Mt,$s.DrawJoint_s_p1=new Mt,$s.DrawJoint_s_p2=new Mt,$s.DrawJoint_s_color=new Rt(.5,.8,.8),$s.DrawJoint_s_c=new Rt,$s.DrawShape_s_ghostColor=new Rt,$s.SolveTOI_s_subStep=new ds,$s.SolveTOI_s_backup=new Dt,$s.SolveTOI_s_backup1=new Dt,$s.SolveTOI_s_backup2=new Dt,$s.SolveTOI_s_toi_input=new Ye,$s.SolveTOI_s_toi_output=new Qe;var tr=l((function t(e,i){a(this,t),this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=e,this.body=i})),er=function(){function t(){a(this,t),this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}return l(t,[{key:"GetNext",value:function(){return this.m_next}},{key:"GetPrev",value:function(){return this.m_prev}},{key:"GetBodyList",value:function(){return this.m_bodyList}},{key:"AddBody",value:function(t){var e=new tr(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount}},{key:"RemoveBody",value:function(t){if(this.m_bodyCount<=0)throw new Error;for(var e=this.m_bodyList;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount}},{key:"Clear",value:function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0}}]),t}(),ir=function(t){r(i,t);var e=o(i);function i(){var t;return a(this,i),(t=e.apply(this,arguments)).normal=new Mt(0,1),t.offset=0,t.density=0,t.velocity=new Mt(0,0),t.linearDrag=0,t.angularDrag=0,t.useDensity=!1,t.useWorldGravity=!0,t.gravity=new Mt(0,0),t}return l(i,[{key:"Step",value:function(t){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(i.IsAwake()){for(var n=new Mt,s=new Mt,r=0,o=0,a=i.GetFixtureList();a;a=a.m_next){var l=new Mt,u=a.GetShape().ComputeSubmergedArea(this.normal,this.offset,i.GetTransform(),l);r+=u,n.x+=u*l.x,n.y+=u*l.y;var h=0;o+=u*(h=this.useDensity?a.GetDensity():1),s.x+=u*l.x*h,s.y+=u*l.y*h}if(n.x/=r,n.y/=r,s.x/=o,s.y/=o,!(r<m)){var c=this.gravity.Clone().SelfNeg();c.SelfMul(this.density*r),i.ApplyForce(c,s);var _=i.GetLinearVelocityFromWorldPoint(n,new Mt);_.SelfSub(this.velocity),_.SelfMul(-this.linearDrag*r),i.ApplyForce(_,n),i.ApplyTorque(-i.GetInertia()/i.GetMass()*r*i.GetAngularVelocity()*this.angularDrag)}}}}}},{key:"Draw",value:function(t){var e=100,i=new Mt,n=new Mt;i.x=this.normal.x*this.offset+this.normal.y*e,i.y=this.normal.y*this.offset-this.normal.x*e,n.x=this.normal.x*this.offset-this.normal.y*e,n.y=this.normal.y*this.offset+this.normal.x*e;var s=new Rt(0,0,.8);t.DrawSegment(i,n,s)}}]),i}(er),nr=function(t){r(i,t);var e=o(i);function i(){var t;return a(this,i),(t=e.apply(this,arguments)).A=new Mt(0,0),t}return l(i,[{key:"Step",value:function(t){for(var e=Mt.MulSV(t.dt,this.A,i.Step_s_dtA),n=this.m_bodyList;n;n=n.nextBody){var s=n.body;s.IsAwake()&&s.SetLinearVelocity(Mt.AddVV(s.GetLinearVelocity(),e,Mt.s_t0))}}},{key:"Draw",value:function(t){}}]),i}(er);nr.Step_s_dtA=new Mt;var sr=function(t){r(i,t);var e=o(i);function i(){var t;return a(this,i),(t=e.apply(this,arguments)).F=new Mt(0,0),t}return l(i,[{key:"Step",value:function(t){for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;i.IsAwake()&&i.ApplyForce(this.F,i.GetWorldCenter())}}},{key:"Draw",value:function(t){}}]),i}(er),rr=function(t){r(i,t);var e=o(i);function i(){var t;return a(this,i),(t=e.apply(this,arguments)).G=1,t.invSqr=!0,t}return l(i,[{key:"Step",value:function(t){if(this.invSqr)for(var e=this.m_bodyList;e;e=e.nextBody)for(var n=e.body,s=n.GetWorldCenter(),r=n.GetMass(),o=this.m_bodyList;o&&o!==e;o=o.nextBody){var a=o.body,l=a.GetWorldCenter(),u=a.GetMass(),h=l.x-s.x,c=l.y-s.y,_=h*h+c*c;if(!(_<m)){var f=i.Step_s_f.Set(h,c);f.SelfMul(this.G/_/ft(_)*r*u),n.IsAwake()&&n.ApplyForce(f,s),a.IsAwake()&&a.ApplyForce(f.SelfMul(-1),l)}}else for(var d=this.m_bodyList;d;d=d.nextBody)for(var v=d.body,y=v.GetWorldCenter(),p=v.GetMass(),x=this.m_bodyList;x&&x!==d;x=x.nextBody){var g=x.body,b=g.GetWorldCenter(),S=g.GetMass(),B=b.x-y.x,w=b.y-y.y,A=B*B+w*w;if(!(A<m)){var C=i.Step_s_f.Set(B,w);C.SelfMul(this.G/A*p*S),v.IsAwake()&&v.ApplyForce(C,y),g.IsAwake()&&g.ApplyForce(C.SelfMul(-1),b)}}}},{key:"Draw",value:function(t){}}]),i}(er);rr.Step_s_f=new Mt;var or=function(t){r(i,t);var e=o(i);function i(){var t;return a(this,i),(t=e.apply(this,arguments)).T=new Pt,t.maxTimestep=0,t}return l(i,[{key:"Step",value:function(t){var e=t.dt;if(!(e<=m)){e>this.maxTimestep&&this.maxTimestep>0&&(e=this.maxTimestep);for(var n=this.m_bodyList;n;n=n.nextBody){var s=n.body;if(s.IsAwake()){var r=s.GetWorldVector(Pt.MulMV(this.T,s.GetLocalVector(s.GetLinearVelocity(),Mt.s_t0),Mt.s_t1),i.Step_s_damping);s.SetLinearVelocity(Mt.AddVV(s.GetLinearVelocity(),Mt.MulSV(e,r,Mt.s_t0),Mt.s_t1))}}}}},{key:"Draw",value:function(t){}},{key:"SetAxisAligned",value:function(t,e){this.T.ex.x=-t,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-e,this.maxTimestep=t>0||e>0?1/lt(t,e):0}}]),i}(er);or.Step_s_damping=new Mt;var ar=l((function t(){a(this,t),this.vertices=[],this.count=0,this.masses=[],this.gravity=new Mt(0,0),this.damping=.1,this.k2=.9,this.k3=.1})),lr=function(){function t(){a(this,t),this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new Mt,this.m_damping=0,this.m_k2=1,this.m_k3=.1}return l(t,[{key:"GetVertexCount",value:function(){return this.m_count}},{key:"GetVertices",value:function(){return this.m_ps}},{key:"Initialize",value:function(t){this.m_count=t.count,this.m_ps=Mt.MakeArray(this.m_count),this.m_p0s=Mt.MakeArray(this.m_count),this.m_vs=Mt.MakeArray(this.m_count),this.m_ims=it(this.m_count);for(var e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();var i=t.masses[e];this.m_ims[e]=i>0?1/i:0}var n=this.m_count-1,s=this.m_count-2;this.m_Ls=it(n),this.m_as=it(s);for(var r=0;r<n;++r){var o=this.m_ps[r],a=this.m_ps[r+1];this.m_Ls[r]=Mt.DistanceVV(o,a)}for(var l=0;l<s;++l){var u=this.m_ps[l],h=this.m_ps[l+1],m=this.m_ps[l+2],c=Mt.SubVV(h,u,Mt.s_t0),_=Mt.SubVV(m,h,Mt.s_t1),f=Mt.CrossVV(c,_),d=Mt.DotVV(c,_);this.m_as[l]=St(f,d)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3}},{key:"Step",value:function(t,e){if(0!==t){for(var i=Math.exp(-t*this.m_damping),n=0;n<this.m_count;++n)this.m_p0s[n].Copy(this.m_ps[n]),this.m_ims[n]>0&&this.m_vs[n].SelfMulAdd(t,this.m_gravity),this.m_vs[n].SelfMul(i),this.m_ps[n].SelfMulAdd(t,this.m_vs[n]);for(var s=0;s<e;++s)this.SolveC2(),this.SolveC3(),this.SolveC2();for(var r=1/t,o=0;o<this.m_count;++o)Mt.MulSV(r,Mt.SubVV(this.m_ps[o],this.m_p0s[o],Mt.s_t0),this.m_vs[o])}}},{key:"SolveC2",value:function(){for(var e=this.m_count-1,i=0;i<e;++i){var n=this.m_ps[i],s=this.m_ps[i+1],r=Mt.SubVV(s,n,t.s_d),o=r.Normalize(),a=this.m_ims[i],l=this.m_ims[i+1];if(a+l!==0){var u=a/(a+l),h=l/(a+l);n.SelfMulSub(this.m_k2*u*(this.m_Ls[i]-o),r),s.SelfMulAdd(this.m_k2*h*(this.m_Ls[i]-o),r)}}}},{key:"SetAngle",value:function(t){for(var e=this.m_count-2,i=0;i<e;++i)this.m_as[i]=t}},{key:"SolveC3",value:function(){for(var e=this.m_count-2,i=0;i<e;++i){var n=this.m_ps[i],s=this.m_ps[i+1],r=this.m_ps[i+2],o=this.m_ims[i],a=this.m_ims[i+1],l=this.m_ims[i+2],u=Mt.SubVV(s,n,t.s_d1),h=Mt.SubVV(r,s,t.s_d2),m=u.LengthSquared(),c=h.LengthSquared();if(m*c!==0){var f=Mt.CrossVV(u,h),d=Mt.DotVV(u,h),v=St(f,d),y=Mt.MulSV(-1/m,u.SelfSkew(),t.s_Jd1),p=Mt.MulSV(1/c,h.SelfSkew(),t.s_Jd2),x=Mt.NegV(y,t.s_J1),g=Mt.SubVV(y,p,t.s_J2),b=p,S=o*Mt.DotVV(x,x)+a*Mt.DotVV(g,g)+l*Mt.DotVV(b,b);if(0!==S){S=1/S;for(var B=v-this.m_as[i];B>_;)B=(v-=2*_)-this.m_as[i];for(;B<-_;)B=(v+=2*_)-this.m_as[i];var w=-this.m_k3*S*B;n.SelfMulAdd(o*w,x),s.SelfMulAdd(a*w,g),r.SelfMulAdd(l*w,b)}}}}},{key:"Draw",value:function(t){for(var e=new Rt(.4,.5,.7),i=0;i<this.m_count-1;++i)t.DrawSegment(this.m_ps[i],this.m_ps[i+1],e)}}]),t}();lr.s_d=new Mt,lr.s_d1=new Mt,lr.s_d2=new Mt,lr.s_Jd1=new Mt,lr.s_Jd2=new Mt,lr.s_J1=new Mt,lr.s_J2=new Mt,t.b2Assert=e,t.b2Maybe=i,t.b2_maxFloat=h,t.b2_epsilon=m,t.b2_epsilon_sq=c,t.b2_pi=_,t.b2_maxManifoldPoints=f,t.b2_maxPolygonVertices=d,t.b2_aabbExtension=v,t.b2_aabbMultiplier=y,t.b2_linearSlop=p,t.b2_angularSlop=x,t.b2_polygonRadius=g,t.b2_maxSubSteps=b,t.b2_maxTOIContacts=S,t.b2_velocityThreshold=B,t.b2_maxLinearCorrection=w,t.b2_maxAngularCorrection=A,t.b2_maxTranslation=C,t.b2_maxTranslationSquared=M,t.b2_maxRotation=V,t.b2_maxRotationSquared=k,t.b2_baumgarte=P,t.b2_toiBaumgarte=I,t.b2_invalidParticleIndex=T,t.b2_maxParticleIndex=G,t.b2_particleStride=L,t.b2_minParticleWeight=D,t.b2_maxParticlePressure=R,t.b2_maxParticleForce=F,t.b2_maxTriadDistance=E,t.b2_maxTriadDistanceSquared=O,t.b2_minParticleSystemBufferCapacity=z,t.b2_barrierCollisionTime=j,t.b2_timeToSleep=q,t.b2_linearSleepTolerance=N,t.b2_angularSleepTolerance=X,t.b2Alloc=J,t.b2Free=W,t.b2Log=U,t.b2Version=H,t.b2_version=Z,t.b2_branch=Y,t.b2_commit=K,t.b2ParseInt=Q,t.b2ParseUInt=$,t.b2MakeArray=tt,t.b2MakeNullArray=et,t.b2MakeNumberArray=it,t.b2_pi_over_180=nt,t.b2_180_over_pi=st,t.b2_two_pi=rt,t.b2Abs=ot,t.b2Min=at,t.b2Max=lt,t.b2Clamp=ut,t.b2Swap=ht,t.b2IsValid=mt,t.b2Sq=ct,t.b2InvSqrt=_t,t.b2Sqrt=ft,t.b2Pow=dt,t.b2DegToRad=vt,t.b2RadToDeg=yt,t.b2Cos=pt,t.b2Sin=xt,t.b2Acos=gt,t.b2Asin=bt,t.b2Atan2=St,t.b2NextPowerOfTwo=Bt,t.b2IsPowerOfTwo=wt,t.b2Random=At,t.b2RandomRange=Ct,t.b2Vec2=Mt,t.b2Vec2_zero=Vt,t.b2Vec3=kt,t.b2Mat22=Pt,t.b2Mat33=It,t.b2Rot=Tt,t.b2Transform=Gt,t.b2Sweep=Dt,t.b2Color=Rt,t.b2Draw=Ft,t.b2Timer=Et,t.b2Counter=Ot,t.b2GrowableStack=zt,t.b2BlockAllocator=jt,t.b2StackAllocator=qt,t.b2ContactFeature=pe,t.b2ContactID=xe,t.b2ManifoldPoint=ge,t.b2Manifold=Se,t.b2WorldManifold=Be,t.b2GetPointStates=we,t.b2ClipVertex=Ae,t.b2RayCastInput=Ce,t.b2RayCastOutput=Me,t.b2AABB=Ve,t.b2TestOverlapAABB=ke,t.b2ClipSegmentToLine=Pe,t.b2TestOverlapShape=Le,t.b2DistanceProxy=Nt,t.b2SimplexCache=Xt,t.b2DistanceInput=Jt,t.b2DistanceOutput=Wt,t.b2ShapeCastInput=Ut,t.b2ShapeCastOutput=Ht,t.b2_gjk_reset=Zt,t.b2SimplexVertex=Yt,t.b2Simplex=Kt,t.b2Distance=oe,t.b2ShapeCast=ve,t.b2Pair=Ee,t.b2BroadPhase=Oe,t.b2PairLessThan=ze,t.b2TreeNode=Re,t.b2DynamicTree=Fe,t.b2_toi_reset=je,t.b2TOIInput=Ye,t.b2TOIOutput=Qe,t.b2SeparationFunction=$e,t.b2TimeOfImpact=ui,t.b2CollideCircles=ci,t.b2CollidePolygonAndCircle=vi,t.b2CollidePolygons=zi,t.b2CollideEdgeAndCircle=Zi,t.b2CollideEdgeAndPolygon=en,t.b2MassData=sn,t.b2Shape=rn,t.b2CircleShape=on,t.b2PolygonShape=an,t.b2EdgeShape=ln,t.b2ChainShape=un,t.b2Filter=hn,t.b2FixtureDef=cn,t.b2FixtureProxy=_n,t.b2Fixture=fn,t.b2BodyDef=yn,t.b2Body=pn,t.b2World=$s,t.b2DestructionListener=as,t.b2ContactFilter=ls,t.b2ContactImpulse=us,t.b2ContactListener=hs,t.b2QueryCallback=ms,t.b2RayCastCallback=cs,t.b2Island=Ms,t.b2Profile=fs,t.b2TimeStep=ds,t.b2Position=vs,t.b2Velocity=ys,t.b2SolverData=ps,t.b2ContactManager=_s,t.b2MixFriction=Hn,t.b2MixRestitution=Zn,t.b2ContactEdge=Yn,t.b2Contact=Kn,t.b2ContactRegister=rs,t.b2ContactFactory=os,t.g_blockSolve=xs,t.b2VelocityConstraintPoint=gs,t.b2ContactVelocityConstraint=bs,t.b2ContactPositionConstraint=Ss,t.b2ContactSolverDef=Bs,t.b2PositionSolverManifold=ws,t.b2ContactSolver=As,t.b2CircleContact=Qn,t.b2PolygonContact=$n,t.b2PolygonAndCircleContact=ts,t.b2EdgeAndCircleContact=es,t.b2EdgeAndPolygonContact=is,t.b2ChainAndCircleContact=ns,t.b2ChainAndPolygonContact=ss,t.b2Jacobian=xn,t.b2JointEdge=gn,t.b2JointDef=bn,t.b2Joint=Sn,t.b2AreaJointDef=An,t.b2AreaJoint=Cn,t.b2DistanceJointDef=Bn,t.b2DistanceJoint=wn,t.b2FrictionJointDef=Mn,t.b2FrictionJoint=Vn,t.b2GearJointDef=kn,t.b2GearJoint=Pn,t.b2MotorJointDef=In,t.b2MotorJoint=Tn,t.b2MouseJointDef=Gn,t.b2MouseJoint=Ln,t.b2PrismaticJointDef=Dn,t.b2PrismaticJoint=Rn,t.b2_minPulleyLength=Fn,t.b2PulleyJointDef=En,t.b2PulleyJoint=On,t.b2RevoluteJointDef=zn,t.b2RevoluteJoint=jn,t.b2RopeJointDef=qn,t.b2RopeJoint=Nn,t.b2WeldJointDef=Xn,t.b2WeldJoint=Jn,t.b2WheelJointDef=Wn,t.b2WheelJoint=Un,t.b2ControllerEdge=tr,t.b2Controller=er,t.b2BuoyancyController=ir,t.b2ConstantAccelController=nr,t.b2ConstantForceController=sr,t.b2GravityController=rr,t.b2TensorDampingController=or,t.b2ParticleDef=Vs,t.b2CalculateParticleIterations=ks,t.b2ParticleHandle=Is,t.b2ParticleGroupDef=Ts,t.b2ParticleGroup=Gs,t.b2GrowableBuffer=Js,t.b2FixtureParticleQueryCallback=Ws,t.b2ParticleContact=Us,t.b2ParticleBodyContact=Hs,t.b2ParticlePair=Zs,t.b2ParticleTriad=Ys,t.b2ParticleSystemDef=Ks,t.b2ParticleSystem=Qs,t.b2RopeDef=ar,t.b2Rope=lr,Object.defineProperty(t,"__esModule",{value:!0})}(e)},8041:function(t){"use strict";var e,i="object"===typeof Reflect?Reflect:null,n=i&&"function"===typeof i.apply?i.apply:function(t,e,i){return Function.prototype.apply.call(t,e,i)};e=i&&"function"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var s=Number.isNaN||function(t){return t!==t};function r(){r.init.call(this)}t.exports=r,t.exports.once=function(t,e){return new Promise((function(i,n){function s(i){t.removeListener(e,r),n(i)}function r(){"function"===typeof t.removeListener&&t.removeListener("error",s),i([].slice.call(arguments))}d(t,e,r,{once:!0}),"error"!==e&&function(t,e,i){"function"===typeof t.on&&d(t,"error",e,i)}(t,s,{once:!0})}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var o=10;function a(t){if("function"!==typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?r.defaultMaxListeners:t._maxListeners}function u(t,e,i,n){var s,r,o,u;if(a(i),void 0===(r=t._events)?(r=t._events=Object.create(null),t._eventsCount=0):(void 0!==r.newListener&&(t.emit("newListener",e,i.listener?i.listener:i),r=t._events),o=r[e]),void 0===o)o=r[e]=i,++t._eventsCount;else if("function"===typeof o?o=r[e]=n?[i,o]:[o,i]:n?o.unshift(i):o.push(i),(s=l(t))>0&&o.length>s&&!o.warned){o.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=o.length,u=h,console&&console.warn&&console.warn(u)}return t}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function m(t,e,i){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:i},s=h.bind(n);return s.listener=i,n.wrapFn=s,s}function c(t,e,i){var n=t._events;if(void 0===n)return[];var s=n[e];return void 0===s?[]:"function"===typeof s?i?[s.listener||s]:[s]:i?function(t){for(var e=new Array(t.length),i=0;i<e.length;++i)e[i]=t[i].listener||t[i];return e}(s):f(s,s.length)}function _(t){var e=this._events;if(void 0!==e){var i=e[t];if("function"===typeof i)return 1;if(void 0!==i)return i.length}return 0}function f(t,e){for(var i=new Array(e),n=0;n<e;++n)i[n]=t[n];return i}function d(t,e,i,n){if("function"===typeof t.on)n.once?t.once(e,i):t.on(e,i);else{if("function"!==typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function s(r){n.once&&t.removeEventListener(e,s),i(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(t){if("number"!==typeof t||t<0||s(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");o=t}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(t){if("number"!==typeof t||t<0||s(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},r.prototype.getMaxListeners=function(){return l(this)},r.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e.push(arguments[i]);var s="error"===t,r=this._events;if(void 0!==r)s=s&&void 0===r.error;else if(!s)return!1;if(s){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=r[t];if(void 0===l)return!1;if("function"===typeof l)n(l,this,e);else{var u=l.length,h=f(l,u);for(i=0;i<u;++i)n(h[i],this,e)}return!0},r.prototype.addListener=function(t,e){return u(this,t,e,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(t,e){return u(this,t,e,!0)},r.prototype.once=function(t,e){return a(e),this.on(t,m(this,t,e)),this},r.prototype.prependOnceListener=function(t,e){return a(e),this.prependListener(t,m(this,t,e)),this},r.prototype.removeListener=function(t,e){var i,n,s,r,o;if(a(e),void 0===(n=this._events))return this;if(void 0===(i=n[t]))return this;if(i===e||i.listener===e)0===--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,i.listener||e));else if("function"!==typeof i){for(s=-1,r=i.length-1;r>=0;r--)if(i[r]===e||i[r].listener===e){o=i[r].listener,s=r;break}if(s<0)return this;0===s?i.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(i,s),1===i.length&&(n[t]=i[0]),void 0!==n.removeListener&&this.emit("removeListener",t,o||e)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(t){var e,i,n;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[t]&&(0===--this._eventsCount?this._events=Object.create(null):delete i[t]),this;if(0===arguments.length){var s,r=Object.keys(i);for(n=0;n<r.length;++n)"removeListener"!==(s=r[n])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(e=i[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},r.prototype.listeners=function(t){return c(this,t,!0)},r.prototype.rawListeners=function(t){return c(this,t,!1)},r.listenerCount=function(t,e){return"function"===typeof t.listenerCount?t.listenerCount(e):_.call(t,e)},r.prototype.listenerCount=_,r.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},9434:function(t,e,i){"use strict";var n=i(4704).default;function s(t){if(this.words=[],null!=(r=t)&&void 0!==r[Symbol.iterator]){var e,i=n(t);try{for(i.s();!(e=i.n()).done;){var s=e.value;this.add(s)}}catch(o){i.e(o)}finally{i.f()}}var r}s.prototype.add=function(t){this.resize(t),this.words[t>>>5]|=1<<t},s.prototype.flip=function(t){this.resize(t),this.words[t>>>5]^=1<<t},s.prototype.clear=function(){this.words=[]},s.prototype.remove=function(t){this.resize(t),this.words[t>>>5]&=~(1<<t)},s.prototype.isEmpty=function(t){for(var e=this.words.length,i=0;i<e;i++)if(0!==this.words[i])return!1;return!0},s.prototype.has=function(t){return 0!==(this.words[t>>>5]&1<<t)},s.prototype.checkedAdd=function(t){this.resize(t);var e=this.words[t>>>5],i=e|1<<t;return this.words[t>>>5]=i,(i^e)>>>t},s.prototype.trim=function(t){for(var e=this.words.length;e>0&&0===this.words[e-1];)e--;this.words=this.words.slice(0,e)},s.prototype.resize=function(t){for(var e=t+32>>>5,i=this.words.length;i<e;i++)this.words[i]=0},s.prototype.hammingWeight=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},s.prototype.hammingWeight4=function(t,e,i,n){return 16843009*((t=(t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)+(e=(e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)+(i=(i=(858993459&(i-=i>>>1&1431655765))+(i>>>2&858993459))+(i>>>4)&252645135)+(n=(n=(858993459&(n-=n>>>1&1431655765))+(n>>>2&858993459))+(n>>>4)&252645135))>>>24},s.prototype.size=function(){for(var t=0,e=this.words.length,i=this.words,n=0;n<e;n++)t+=this.hammingWeight(i[n]);return t},s.prototype.array=function(){for(var t=new Array(this.size()),e=0,i=this.words.length,n=0;n<i;++n)for(var s=this.words[n];0!=s;){var r=s&-s;t[e++]=(n<<5)+this.hammingWeight(r-1|0),s^=r}return t},s.prototype.forEach=function(t){for(var e=this.words.length,i=0;i<e;++i)for(var n=this.words[i];0!=n;){var s=n&-n;t((i<<5)+this.hammingWeight(s-1|0)),n^=s}},s.prototype.clone=function(){var t=Object.create(s.prototype);return t.words=this.words.slice(),t},s.prototype.intersects=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i<e;++i)if(0!==(this.words[i]&t.words[i]))return!0;return!1},s.prototype.intersection=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i+7<e;i+=8)this.words[i]&=t.words[i],this.words[i+1]&=t.words[i+1],this.words[i+2]&=t.words[i+2],this.words[i+3]&=t.words[i+3],this.words[i+4]&=t.words[i+4],this.words[i+5]&=t.words[i+5],this.words[i+6]&=t.words[i+6],this.words[i+7]&=t.words[i+7];for(;i<e;++i)this.words[i]&=t.words[i];var n=this.words.length;for(i=e;i<n;++i)this.words[i]=0;return this},s.prototype.intersection_size=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0,n=0;n<e;++n)i+=this.hammingWeight(this.words[n]&t.words[n]);return i},s.prototype.new_intersection=function(t){var e=Object.create(s.prototype),i=Math.min(this.words.length,t.words.length);e.words=new Array(i);for(var n=i,r=0;r+7<n;r+=8)e.words[r]=this.words[r]&t.words[r],e.words[r+1]=this.words[r+1]&t.words[r+1],e.words[r+2]=this.words[r+2]&t.words[r+2],e.words[r+3]=this.words[r+3]&t.words[r+3],e.words[r+4]=this.words[r+4]&t.words[r+4],e.words[r+5]=this.words[r+5]&t.words[r+5],e.words[r+6]=this.words[r+6]&t.words[r+6],e.words[r+7]=this.words[r+7]&t.words[r+7];for(;r<n;++r)e.words[r]=this.words[r]&t.words[r];return e},s.prototype.equals=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i<e;++i)if(this.words[i]!=t.words[i])return!1;if(this.words.length<t.words.length){var n=t.words.length;for(i=this.words.length;i<n;++i)if(0!=t.words[i])return!1}else if(t.words.length<this.words.length)for(n=this.words.length,i=t.words.length;i<n;++i)if(0!=this.words[i])return!1;return!0},s.prototype.difference=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i+7<e;i+=8)this.words[i]&=~t.words[i],this.words[i+1]&=~t.words[i+1],this.words[i+2]&=~t.words[i+2],this.words[i+3]&=~t.words[i+3],this.words[i+4]&=~t.words[i+4],this.words[i+5]&=~t.words[i+5],this.words[i+6]&=~t.words[i+6],this.words[i+7]&=~t.words[i+7];for(;i<e;++i)this.words[i]&=~t.words[i];return this},s.prototype.difference_size=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0,n=0;n<e;++n)i+=this.hammingWeight(this.words[n]&~t.words[n]);for(var s=this.words.length;n<s;++n)i+=this.hammingWeight(this.words[n]);return i},s.prototype.toString=function(){return"{"+this.array().join(",")+"}"},s.prototype.union=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0;i+7<e;i+=8)this.words[i]|=t.words[i],this.words[i+1]|=t.words[i+1],this.words[i+2]|=t.words[i+2],this.words[i+3]|=t.words[i+3],this.words[i+4]|=t.words[i+4],this.words[i+5]|=t.words[i+5],this.words[i+6]|=t.words[i+6],this.words[i+7]|=t.words[i+7];for(;i<e;++i)this.words[i]|=t.words[i];if(this.words.length<t.words.length){this.resize((t.words.length<<5)-1);var n=t.words.length;for(i=e;i<n;++i)this.words[i]=t.words[i]}return this},s.prototype.new_union=function(t){var e=Object.create(s.prototype),i=Math.max(this.words.length,t.words.length);e.words=new Array(i);for(var n=Math.min(this.words.length,t.words.length),r=0;r+7<n;r+=8)e.words[r]=this.words[r]|t.words[r],e.words[r+1]=this.words[r+1]|t.words[r+1],e.words[r+2]=this.words[r+2]|t.words[r+2],e.words[r+3]=this.words[r+3]|t.words[r+3],e.words[r+4]=this.words[r+4]|t.words[r+4],e.words[r+5]=this.words[r+5]|t.words[r+5],e.words[r+6]=this.words[r+6]|t.words[r+6],e.words[r+7]=this.words[r+7]|t.words[r+7];for(;r<n;++r)e.words[r]=this.words[r]|t.words[r];var o=this.words.length;for(r=n;r<o;++r)e.words[r]=this.words[r];var a=t.words.length;for(r=n;r<a;++r)e.words[r]=t.words[r];return e},s.prototype.new_difference=function(t){return this.clone().difference(t)},s.prototype.union_size=function(t){for(var e=Math.min(this.words.length,t.words.length),i=0,n=0;n<e;++n)i+=this.hammingWeight(this.words[n]|t.words[n]);if(this.words.length<t.words.length){var s=t.words.length;for(n=this.words.length;n<s;++n)i+=this.hammingWeight(0|t.words[n])}else for(s=this.words.length,n=t.words.length;n<s;++n)i+=this.hammingWeight(0|this.words[n]);return i},t.exports=s},1281:function(t,e,i){"use strict";var n=i(9728).default,s=i(6690).default,r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Archetype=void 0;var o=r(i(9434)),a=n((function t(e){s(this,t),this.componentBits=new o.default,this.componentBitsInitialized=!1,this.componentTypes=e}));e.Archetype=a},3713:function(t,e,i){"use strict";var n=i(9728).default,s=i(6690).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Component=void 0;var r=n((function t(){s(this,t)}));e.Component=r},9179:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.ComponentMapper=void 0;var r=function(){function t(){n(this,t),this.data=[]}return s(t,[{key:"add",value:function(t,e){this.data[t]=e}},{key:"get",value:function(t){return this.data[t]}},{key:"remove",value:function(t){delete this.data[t]}}]),t}();e.ComponentMapper=r},1218:function(t,e,i){"use strict";var n=i(4704).default,s=i(6690).default,r=i(9728).default,o=i(1588).default,a=i(3808).default,l=i(1655).default,u=i(6389).default,h=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.EntityIteratingSystem=void 0;var m=i(4905),c=h(i(9434)),_=function(t){l(i,t);var e=u(i);function i(t){var n;return s(this,i),(n=e.call(this)).componentBits=new c.default,n.types=t,n}return r(i,[{key:"setWorld",value:function(t){o(a(i.prototype),"setWorld",this).call(this,t);var e,s=n(this.types);try{for(s.s();!(e=s.n()).done;){var r=e.value;this.componentBits.add(t.getComponentIndex(r))}}catch(l){s.e(l)}finally{s.f()}}},{key:"process",value:function(){this.begin(),this.world.getEntities(this.componentBits,this.processEntity.bind(this)),this.end()}},{key:"begin",value:function(){}},{key:"end",value:function(){}}]),i}(m.System);e.EntityIteratingSystem=_},2645:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default,r=i(1655).default,o=i(6389).default;Object.defineProperty(e,"__esModule",{value:!0}),e.EntitySystem=void 0;var a=function(t){r(i,t);var e=o(i);function i(){var t;return n(this,i),(t=e.apply(this,arguments)).entities=[],t}return s(i,[{key:"process",value:function(){this.entities.length=0,this.begin(),this.world.getEntities(this.componentBits,this.processEntity.bind(this)),this.processEntities(this.entities),this.end()}},{key:"processEntity",value:function(t){this.entities.push(t)}}]),i}(i(1218).EntityIteratingSystem);e.EntitySystem=a},6310:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Inject=void 0,e.Inject=function(t){return function(e,i){var n=e.constructor;n.hasOwnProperty("__inject__")||(n.__inject__={}),n.__inject__[i]=t}}},1185:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InjectMapper=void 0,e.InjectMapper=function(t){return function(e,i){var n=e.constructor;n.hasOwnProperty("__injectMapper__")||(n.__injectMapper__={}),n.__injectMapper__[i]=t}}},4905:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.System=void 0;var r=function(){function t(){n(this,t)}return s(t,[{key:"setWorld",value:function(t){this.world=t}},{key:"initialized",value:function(){}},{key:"dispose",value:function(){}}]),t}();e.System=r},8293:function(t,e,i){"use strict";var n=i(4704).default,s=i(6690).default,r=i(9728).default,o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=o(i(9434)),l=i(9179),u=function(){function t(){s(this,t),this.index=0,this.mappers={},this.componentBitsMap=[],this.componentIndices=new Map,this.currentComponentIndex=0,this.activeSystems=[],this.passiveSystems=[],this.injectionRegistry={},this.delta=0}return r(t,[{key:"getNewId",value:function(){return this.index++}},{key:"createEntity",value:function(){return this.getNewId()}},{key:"getComponentBits",value:function(t){return this.componentBitsMap[t]||(this.componentBitsMap[t]=new a.default),this.componentBitsMap[t]}},{key:"getMapper",value:function(t){var e=this.getComponentIndex(t);return this.getMapperByIndex(e)}},{key:"getMapperByIndex",value:function(t){return this.mappers[t]||(this.mappers[t]=new l.ComponentMapper),this.mappers[t]}},{key:"getComponentIndex",value:function(t){var e=this.componentIndices.get(t);return void 0===e&&(e=this.currentComponentIndex++,this.componentIndices.set(t,e)),e}},{key:"createEntityByArchetype",value:function(t){var e=this,i=this.getNewId();return t.componentTypes.forEach((function(n){var s=new n;t.componentBitsInitialized||t.componentBits.add(e.getComponentIndex(n)),e.addComponent(i,s,!1)})),this.componentBitsMap[i]=t.componentBits,i}},{key:"addComponent",value:function(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=this.getComponentIndex(e.constructor),s=this.getMapperByIndex(n);return s.add(t,e),i&&this.getComponentBits(t).add(n),e}},{key:"getComponent",value:function(t,e){return this.getMapper(e).get(t)}},{key:"getEntities",value:function(t,e){for(var i=0;i<this.componentBitsMap.length;i++)if(this.componentBitsMap[i]){var n=this.componentBitsMap[i];t.union_size(n)===n.size()&&e(i)}}},{key:"addSystem",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e?this.activeSystems.push(t):this.passiveSystems.push(t),t.setWorld(this),this.injectMapper(t),this.inject(t),t.initialized()}},{key:"injectMapper",value:function(t){var e=t.constructor.__injectMapper__||{};for(var i in e){var n=e[i];t[i]=this.getMapper(n)}}},{key:"register",value:function(t,e){this.injectionRegistry[t]=e}},{key:"inject",value:function(t){var e=t.constructor.__inject__||{};for(var i in e){var n=e[i];t[i]=this.injectionRegistry[n]}}},{key:"dispose",value:function(){var t,e=n(this.activeSystems);try{for(e.s();!(t=e.n()).done;){t.value.dispose()}}catch(r){e.e(r)}finally{e.f()}var i,s=n(this.passiveSystems);try{for(s.s();!(i=s.n()).done;){i.value.dispose()}}catch(r){s.e(r)}finally{s.f()}}},{key:"setDelta",value:function(t){this.delta=t}},{key:"processActiveSystem",value:function(){var t,e=n(this.activeSystems);try{for(e.s();!(t=e.n()).done;){t.value.process()}}catch(i){e.e(i)}finally{e.f()}}},{key:"processPassiveSystem",value:function(){var t,e=n(this.passiveSystems);try{for(e.s();!(t=e.n()).done;){t.value.process()}}catch(i){e.e(i)}finally{e.f()}}},{key:"deleteEntity",value:function(t){for(var e in this.mappers)this.mappers[e].remove(t);delete this.componentBitsMap[t]}},{key:"isEntityActive",value:function(t){return!!this.componentBitsMap[t]}}]),t}();e.default=u},9997:function(t,e,i){"use strict";var n=i(8293);Object.defineProperty(e,"q3",{enumerable:!0,get:function(){return n.default}});var s=i(1281);var r=i(3713);var o=i(9179);var a=i(1218);var l=i(2645);var u=i(4905);Object.defineProperty(e,"xP",{enumerable:!0,get:function(){return u.System}});var h=i(1185);var m=i(6310);Object.defineProperty(e,"tB",{enumerable:!0,get:function(){return m.Inject}})},8656:function(t,e,i){"use strict";var n,s=i(4704).default,r=i(6690).default,o=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Animation=e.PlayMode=void 0,function(t){t[t.NORMAL=0]="NORMAL",t[t.LOOP=1]="LOOP",t[t.LOOP_PINGPONG=2]="LOOP_PINGPONG",t[t.REVERSED=3]="REVERSED",t[t.LOOP_REVERSED=4]="LOOP_REVERSED"}(n=e.PlayMode||(e.PlayMode={}));var a=function(){function t(e,i){r(this,t),this.totalDuration=0,this.keyFrames=e,Array.isArray(i)||(i=[i]);for(var n=i[i.length-1]||0;i.length<e.length;)i.push(n);var o,a=s(i);try{for(a.s();!(o=a.n()).done;){var l=o.value;this.totalDuration+=l}}catch(u){a.e(u)}finally{a.f()}this.frameDurations=i}return o(t,[{key:"getFrameNumber",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.frameDurations,n=e?i.length-1:0;!((t-=i[n])<0);)e?n--:n++;return n}},{key:"getKeyFrame",value:function(t,e){var i=this.keyFrames,s=this.frameDurations,r=this.totalDuration,o=Math.floor(t/r),a=t%r,l=0;switch(e){case n.NORMAL:l=0===o?this.getFrameNumber(a):s.length-1;break;case n.LOOP:l=this.getFrameNumber(a);break;case n.LOOP_PINGPONG:l=this.getFrameNumber(a,o%2===1);break;case n.REVERSED:l=0===o?this.getFrameNumber(a,!0):0;break;case n.LOOP_REVERSED:l=this.getFrameNumber(a,!0)}return i[l]}}]),t}();e.Animation=a},2121:function(t,e,i){"use strict";var n=i(861).default,s=i(7061).default,r=i(4704).default,o=i(6690).default,a=i(9728).default,l=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{l(n.next(t))}catch(e){r(e)}}function a(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.AssetManager=void 0;var u=i(7581),h=i(7139),m=i(9396),c=function(){function t(e){o(this,t),this.promises=[],this.atlases=new Map,this.textures=new Map,this.jsonData=new Map,this.binaryData=new Map,this.done=0,this.listeners=[],this.fonts=new Map,this.gl=e}return a(t,[{key:"addListener",value:function(t){this.listeners.push(t)}},{key:"reportDone",value:function(){this.done++;var t,e=r(this.listeners);try{for(e.s();!(t=e.n()).done;){(0,t.value)(this.done/this.getTotal()*100,this.done>=this.getTotal())}}catch(i){e.e(i)}finally{e.f()}}},{key:"loadAtlas",value:function(t,e){var i=this,n=m.TextureAtlas.load(this.gl,t,{}).then((function(t){return i.atlases.set(e,t),i.reportDone(),t}));return this.promises.push(n),n}},{key:"getAtlas",value:function(t){return this.atlases.get(t)}},{key:"loadJsonData",value:function(t,e){var i=this,n=fetch(t).then((function(t){return t.json()})).then((function(t){return i.jsonData.set(e,t),i.reportDone(),t}));return this.promises.push(n),n}},{key:"getJsonData",value:function(t){return this.jsonData.get(t)}},{key:"loadBinaryData",value:function(t,e){var i=this,n=fetch(t).then((function(t){return t.arrayBuffer()})).then((function(t){return i.binaryData.set(e,t),i.reportDone(),t}));return this.promises.push(n),n}},{key:"getBinaryData",value:function(t){return this.binaryData.get(t)}},{key:"loadFont",value:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=u.BitmapFont.load(this.gl,t,n).then((function(t){return i.fonts.set(e,t),i.reportDone(),t}));return this.promises.push(s),s}},{key:"getFont",value:function(t){return this.fonts.get(t)}},{key:"loadTexture",value:function(t,e){var i=this,n=h.Texture.load(this.gl,t).then((function(t){return i.textures.set(e,t),i.reportDone(),t}));return this.promises.push(n),n}},{key:"getTexture",value:function(t){return this.textures.get(t)}},{key:"finishLoading",value:function(){return l(this,void 0,void 0,s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(this.promises);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"getDone",value:function(){return this.done}},{key:"getTotal",value:function(){return this.promises.length}},{key:"disposeAll",value:function(){var t=this;n(this.atlases.keys()).forEach((function(e){var i;((null===(i=t.atlases.get(e))||void 0===i?void 0:i.getRegions())||[]).forEach((function(t){var e;null===(e=t.texture)||void 0===e||e.destroy()})),t.atlases.delete(e)})),n(this.textures.keys()).forEach((function(e){var i;null===(i=t.textures.get(e))||void 0===i||i.destroy(),t.textures.delete(e)})),n(this.fonts.keys()).forEach((function(e){var i;((null===(i=t.fonts.get(e))||void 0===i?void 0:i.getRegions())||[]).forEach((function(t){var e;null===(e=t.texture)||void 0===e||e.destroy()})),t.fonts.delete(e)}))}}]),t}();e.AssetManager=c,e.default=c},7581:function(t,e,i){"use strict";var n=i(7061).default,s=i(9728).default,r=i(6690).default,o=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{l(n.next(t))}catch(e){r(e)}}function a(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.BitmapFont=void 0;var a=i(3959),l=i(2791),u=i(8606),h=s((function t(e,i,n){var s=this;r(this,t),this.load=function(t){for(var e=Object.values(t.glyphs),i=0;i<e.length;i++){var n=e[i];if(n)for(var r=0;r<n.length;r++){var o=n[r];o&&t.setGlyphRegion(o,s.regions[o.page])}}null!=t.missingGlyph&&t.setGlyphRegion(t.missingGlyph,s.regions[t.missingGlyph.page])},this.draw=function(t,e,i,n,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:u.Align.left,a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:e.length,m=arguments.length>9?arguments[9]:void 0;s.cache.clear(),s.cache.addText(e,i,n,l,h,r,o,a,m),s.cache.draw(t)},this.getColor=function(){return s.cache.getColor()},this.getScaleX=function(){return s.data.scaleX},this.getScaleY=function(){return s.data.scaleY},this.getRegions=function(){return s.regions},this.getRegion=function(t){return s.regions[t]},this.getLineHeight=function(){return s.data.lineHeight},this.getSpaceXadvance=function(){return s.data.spaceXadvance},this.getXHeight=function(){return s.data.xHeight},this.getCapHeight=function(){return s.data.capHeight},this.getAscent=function(){return s.data.ascent},this.getDescent=function(){return s.data.descent},this.isFlipped=function(){return s.flipped},this.dispose=function(){if(s.ownsTexture)for(var t=0;t<s.regions.length;t++)s.regions[t].texture.dispose()},this.setFixedWidthGlyphs=function(t){for(var e=s.data,i=0,n=0,r=t.length;n<r;n++){var o=e.getGlyph(t.charAt(n));null!=o&&o.xadvance>i&&(i=o.xadvance)}for(var a=0,l=t.length;a<l;a++){var u=e.getGlyph(t.charAt(a));u&&(u.xoffset+=(i-u.xadvance)/2,u.xadvance=i,u.kerning=[],u.kerning=null,u.fixedWidth=!0)}},this.setUseIntegerPositions=function(t){s.integer=t,s.cache.setUseIntegerPositions(t)},this.usesIntegerPositions=function(){return s.integer},this.getCache=function(){return s.cache},this.getData=function(){return s.data},this.getOwnsTexture=function(){return s.ownsTexture},this.setOwnsTexture=function(t){s.ownsTexture=t},this.newFontCache=function(){return new a.BitmapFontCache(s,s.integer)},this.regions=i,this.flipped=e.flipped,this.data=e,this.integer=n,0!==this.regions.length?(this.ownsTexture=!1,this.cache=this.newFontCache(),this.load(e)):console.log("No texture region were found")}));e.BitmapFont=h,h.load=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return o(void 0,void 0,void 0,n().mark((function r(){var o;return n().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=new l.BitmapFontData(e,i),n.next=3,o.loadFont(t);case 3:return n.abrupt("return",new h(o,o.regions,s));case 4:case"end":return n.stop()}}),r)})))}},3959:function(t,e,i){"use strict";var n=i(861).default,s=i(6690).default,r=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.BitmapFontCache=void 0;var o=i(7712),a=i(9699),l=i(8606),u=function(){function t(e,i){var r=this;s(this,t),this.tempColor=new l.Color(1,1,1,1),this.drawingTexts=[],this.layouts=[],this.pooledLayouts=[],this.color=new l.Color(1,1,1,1),this.setPosition=function(t,e){r.translate(t-r.x,e-r.y)},this.translate=function(t,e){if(0!==t||0!==e){r.integer&&(t=Math.round(t),e=Math.round(e)),r.x+=t,r.y+=e;for(var i=r.pageVertices,n=0,s=i.length;n<s;n++)for(var o=i[n],a=0,l=r.idx[n];a<l;a+=5)o[a]+=t,o[a+1]+=e}},this.setColors=function(t,e,i,n){for(var s=255<<24|255*i<<16|255*e<<8|255*t,o=a.NumberUtil.intToFloatColor(s),l=0,u=r.pageVertices.length;l<u;l++)for(var h=r.pageVertices[l],m=2,c=r.idx[l];m<c;m+=5)h[m]=o},this.getColor=function(){return r.color},this.setColor=function(t,e,i,n){r.color.set(t,e,i,n)},this.clear=function(){r.x=0,r.y=0,l.Pools.freeAll("GlyphLayout",r.pooledLayouts),r.pooledLayouts.length=0,r.layouts.length=0;for(var t=0,e=r.idx.length;t<e;t++)null!=r.pageGlyphIndices&&(r.pageGlyphIndices[t].length=0),r.idx[t]=0},this.requireGlyphs=function(t){if(1===r.pageVertices.length)r.requirePageGlyphs(0,t.glyphCount);else{for(var e=r.tempGlyphCount,i=0;i<e.length;i++)e[i]=0;for(var n=0,s=t.runs.length;n<s;n++)for(var o=t.runs[n].glyphs,a=o,l=0,u=o.length;l<u;l++)e[a[l].page]++;for(var h=0,m=e.length;h<m;h++)r.requirePageGlyphs(h,e[h])}},this.requirePageGlyphs=function(t,e){var i=r.idx[t]+20*e,n=r.pageVertices[t];if(n){if(n.length<i){var s=new Array(i);l.Utils.arrayCopy(n,0,s,0,r.idx[t]),r.pageVertices[t]=s}}else r.pageVertices[t]=new Array(i)},this.setPageCount=function(t){var e=new Array(t).fill([]);l.Utils.arrayCopy(r.pageVertices,0,e,0,r.pageVertices.length),r.pageVertices=n(e);var i=new Array(t);l.Utils.arrayCopy(r.idx,0,i,0,r.idx.length),r.idx=i;var s=new Array(t),o=0;null!=r.pageGlyphIndices&&(o=r.pageGlyphIndices.length,l.Utils.arrayCopy(r.pageGlyphIndices,0,s,0,r.pageGlyphIndices.length));for(var a=o;a<t;a++)s[a]=[];r.pageGlyphIndices=s,r.tempGlyphCount=new Array(t)},this.addToCache=function(t,e,i){var n=t.runs.length;if(0!==n){r.pageVertices.length<r.font.regions.length&&r.setPageCount(r.font.regions.length),r.layouts.push(t),r.requireGlyphs(t);var s=t.colors,o=0,l=0,u=0,h=0;r.drawingTexts.length=0;for(var m=0;m<n;m++)for(var c=t.runs[m],_=c.glyphs,f=c.xAdvances,d=e+c.x,v=i+c.y,y=0,p=c.glyphs.length;y<p;y++)u++===l&&(h=a.NumberUtil.intToFloatColor(s[++o]),l=++o<s.length?s[o]:-1),d+=f[y],r.drawingTexts.push(_[y].id),r.addGlyph(_[y],d,v,h);r.currentTint=a.NumberUtil.intToFloatColor(-1)}},this.addGlyph=function(t,e,i,n){var s=r.font.data.scaleX,o=r.font.data.scaleY;e+=t.xoffset*s,i+=t.yoffset*o;var a=t.width*s,l=t.height*o,u=t.u,h=t.u2,m=t.v,c=t.v2;r.integer&&(e=Math.round(e),i=Math.round(i),a=Math.round(a),l=Math.round(l));var _=e+a,f=i+l,d=t.page,v=r.idx[d];r.idx[d]+=20,null!=r.pageGlyphIndices&&r.pageGlyphIndices[d].push(r.glyphCount++);var y=r.pageVertices[d];y[v++]=e,y[v++]=i,y[v++]=n,y[v++]=u,y[v++]=m,y[v++]=e,y[v++]=f,y[v++]=n,y[v++]=u,y[v++]=c,y[v++]=_,y[v++]=f,y[v++]=n,y[v++]=h,y[v++]=c,y[v++]=_,y[v++]=i,y[v++]=n,y[v++]=h,y[v]=m},this.setText=function(t,e,i,n,s,o,a,l,u){return r.clear(),r.addText(t,e,i,n,s,o,a,l,u)},this.setTextToCache=function(t,e,i){r.clear(),r.addTextToCache(t,e,i)},this.addText=function(t,e,i,n,s,o,a,u,h){var m=l.Pools.obtain("GlyphLayout");return r.pooledLayouts.push(m),m.setText(r.font,t,n,s,r.color,o,a,u,h),r.addTextToCache(m,e,i),m},this.addTextToCache=function(t,e,i){r.addToCache(t,e,i+r.font.data.ascent)},this.getX=function(){return r.x},this.getY=function(){return r.y},this.getFont=function(){return r.font},this.setUseIntegerPositions=function(t){r.integer=t},this.usesIntegerPositions=function(){return r.integer},this.getVertices=function(t){return r.pageVertices[t]},this.getVertexCount=function(t){return r.idx[t]},this.getLayouts=function(){return r.layouts},this.font=e,this.integer=i;var u=e.regions.length;if(0===u&&console.log("The specified font must contain at least one texture page."),this.pageVertices=new Array(u).fill([]),this.idx=new Array(u),u>1){this.pageGlyphIndices=new Array(u);for(var h=0,m=this.pageGlyphIndices.length;h<m;h++)this.pageGlyphIndices[h]=[]}this.tempGlyphCount=new Array(u),l.Pools.get("GlyphLayout",(function(){return new o.GlyphLayout(e,"",0,0,l.Color.WHITE,0,l.Align.left,!1)}))}return r(t,[{key:"draw",value:function(t){for(var e=this,i=this.font.getRegions(),n=0;n<this.pageVertices.length;n++)if(this.idx[n]>0)for(var s=this.pageVertices[n],r=function(n){var r=20*n,o=i.find((function(t){var i;return t.id===(null===(i=e.drawingTexts)||void 0===i?void 0:i[n])}));o&&o.draw(t,s[0+r],s[1+r],s[10+r]-s[0+r],s[11+r]-s[1+r])},o=0;o<this.idx[n]/20;o++)r(o)}}]),t}();e.BitmapFontCache=u},2791:function(t,e,i){"use strict";var n=i(861).default,s=i(7061).default,r=i(6690).default,o=i(9728).default,a=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{l(n.next(t))}catch(e){r(e)}}function a(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.BitmapFontData=void 0;var l=i(2013),u=i(7139),h=i(859);function m(t,e){for(var i=t.split("/"),n=e.split("/"),s=[],r=0,o=i.length;r<o;r++)if(".."===i[r])s.pop();else{if("."===i[r])continue;s.push(i[r])}for(var a=0,l=n.length;a<l;a++)if(".."===n[a])s.pop();else{if("."===n[a])continue;s.push(n[a])}return s.join("/")}var c=65535,_=function(){function t(e,i){var n=this;r(this,t),this.capHeight=1,this.blankLineScale=1,this.scaleX=1,this.scaleY=1,this.glyphs={},this.xHeight=1,this.xChars=["x","e","a","o","n","s","r","c","u","m","v","w","z"],this.capChars=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"],this.loadFont=function(t){return a(n,void 0,void 0,s().mark((function e(){var i,n,r,o,a,_,d,v,y,p,x,g,b,S,B,w,A,C,M,V,k,P,I,T,G,L,D,R,F,E,O,z,j,q,N,X,J,W,U,H,Z,Y,K,Q,$,tt,et,it,nt,st,rt,ot,at,lt,ut,ht,mt,ct,_t,ft,dt,vt,yt,pt,xt,gt;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.imagePaths){e.next=2;break}return e.abrupt("return");case 2:return i=0,e.next=5,fetch(this.fontFile);case 5:return r=e.sent,e.next=8,r.text();case 8:if(n=e.sent,o=n.split(/\r?\n/).map((function(t){return t.trim()})),e.prev=10,"string"===typeof(a=o[i])){e.next=14;break}throw new Error("File is empty.");case 14:if(a=a.substring(a.indexOf("padding=")+8),4===(_=a.substring(0,a.indexOf(" ")).split(",",4)).length){e.next=18;break}throw new Error("Invalid padding.");case 18:if(this.padTop=parseInt(_[0]),this.padRight=parseInt(_[1]),this.padBottom=parseInt(_[2]),this.padLeft=parseInt(_[3]),d=this.padTop+this.padBottom,i++,"string"===typeof(a=o[i])){e.next=27;break}throw new Error("Missing common header.");case 27:if(!((v=a.split(" ",9)).length<3)){e.next=30;break}throw new Error("Invalid common header.");case 30:if(v[1].startsWith("lineHeight=")){e.next=32;break}throw new Error("Missing: lineHeight");case 32:if(this.lineHeight=parseInt(v[1].substring(11)),v[2].startsWith("base=")){e.next=35;break}throw new Error("Missing: base");case 35:if(y=parseInt(v[2].substring(5)),p=1,v.length>=6&&null!=v[5]&&v[5].startsWith("pages="))try{p=Math.max(1,parseInt(v[5].substring(6)))}catch(s){}this.imagePaths=new Array(p),x=[],g=0;case 41:if(!(g<p)){e.next=65;break}if(i++,"string"===typeof(a=o[i])){e.next=46;break}throw new Error("Missing additional page definitions.");case 46:if(!((b=a.match(new RegExp(".*id=(\\d+)")))&&b.length>1)){e.next=57;break}if(S=b[1],e.prev=49,parseInt(S)===g){e.next=53;break}throw new Error("Page IDs must be indices starting at 0: "+S);case 53:e.next=57;break;case 55:e.prev=55,e.t0=e.catch(49);case 57:if((B=a.match(new RegExp('.*file="?([^"]+)"?')))&&!(B.length<=1)){e.next=60;break}throw new Error("Missing: file");case 60:w=B[1],x[g]=w;case 62:g++,e.next=41;break;case 65:this.descent=0;case 66:if(i++,a=o[i]){e.next=71;break}return e.abrupt("break",105);case 71:if(!a.startsWith("kernings ")){e.next=73;break}return e.abrupt("break",105);case 73:if(!a.startsWith("metrics ")){e.next=75;break}return e.abrupt("break",105);case 75:if(a.startsWith("char ")){e.next=77;break}return e.abrupt("continue",66);case 77:if(A=new l.Glyph,(C=new f(a,"=")).nextToken(),C.nextToken(),!((M=parseInt(C.nextToken()))>0&&M>c)){e.next=84;break}return e.abrupt("continue",66);case 84:if(A.id=M+"",C.nextToken(),A.srcX=parseInt(C.nextToken()),C.nextToken(),A.srcY=parseInt(C.nextToken()),C.nextToken(),A.width=parseInt(C.nextToken()),C.nextToken(),A.height=parseInt(C.nextToken()),C.nextToken(),A.xoffset=parseInt(C.nextToken()),C.nextToken(),this.flipped?A.yoffset=parseInt(C.nextToken()):A.yoffset=-(A.height+parseInt(C.nextToken())),C.nextToken(),A.xadvance=parseInt(C.nextToken()),C.hasMoreTokens()&&C.nextToken(),C.hasMoreTokens())try{A.page=parseInt(C.nextToken())}catch(bt){}A.width>0&&A.height>0&&(this.descent=Math.min(y+A.yoffset,this.descent)),M<=0?this.missingGlyph=A:M<=c&&this.setGlyph(M,A),e.next=66;break;case 105:this.descent+=this.padBottom;case 106:if(i++,"string"===typeof(a=o[i])){e.next=111;break}return e.abrupt("break",127);case 111:if(a.startsWith("kerning ")){e.next=113;break}return e.abrupt("break",127);case 113:if((V=new f(a,"=")).nextToken(),V.nextToken(),k=parseInt(V.nextToken()),V.nextToken(),P=parseInt(V.nextToken()),!(k<0||k>c||P<0||P>c)){e.next=121;break}return e.abrupt("continue",106);case 121:I=this.getGlyph(k+""),V.nextToken(),T=parseInt(V.nextToken()),I&&I.setKerning(P,T),e.next=106;break;case 127:G=!1,L=0,D=0,R=0,F=0,E=0,O=0,z=0,null!=a&&a.startsWith("metrics ")&&(G=!0,(j=new f(a,"=")).nextToken(),j.nextToken(),L=parseFloat(j.nextToken()),j.nextToken(),D=parseFloat(j.nextToken()),j.nextToken(),R=parseFloat(j.nextToken()),j.nextToken(),F=parseFloat(j.nextToken()),j.nextToken(),E=parseFloat(j.nextToken()),j.nextToken(),O=parseFloat(j.nextToken()),j.nextToken(),z=parseFloat(j.nextToken())),(q=this.getGlyph("32"))||((q=new l.Glyph).id="32",(N=this.getGlyph("l"))||(N=this.getFirstGlyph()),q.xadvance=N.xadvance,this.setGlyph(32,q)),0===q.width&&(q.width=this.padLeft+q.xadvance+this.padRight,q.xoffset=-this.padLeft),this.spaceXadvance=q.xadvance,J=0;case 141:if(!(J<this.xChars.length)){e.next=148;break}if(!(X=this.getGlyph(this.xChars[J]))){e.next=145;break}return e.abrupt("break",148);case 145:J++,e.next=141;break;case 148:X||(X=this.getFirstGlyph()),this.xHeight=X.height-d,U=0;case 151:if(!(U<this.capChars.length)){e.next=158;break}if(!(W=this.getGlyph(this.capChars[U]))){e.next=155;break}return e.abrupt("break",158);case 155:U++,e.next=151;break;case 158:if(W){e.next=178;break}H=Object.values(this.glyphs),Z=0;case 161:if(!(Z<H.length)){e.next=176;break}if(Y=H[Z]){e.next=165;break}return e.abrupt("continue",173);case 165:K=0;case 166:if(!(K<Y.length)){e.next=173;break}if(Y[K]&&0!==Y[K].height&&0!==Y[K].width){e.next=169;break}return e.abrupt("continue",170);case 169:this.capHeight=Math.max(this.capHeight,Y[K].height);case 170:K++,e.next=166;break;case 173:Z++,e.next=161;break;case 176:e.next=179;break;case 178:this.capHeight=W.height;case 179:for(this.capHeight-=d,this.ascent=y-this.capHeight,this.down=-this.lineHeight,this.flipped&&(this.ascent=-this.ascent,this.down=-this.down),G&&(this.ascent=L,this.descent=D,this.down=R,this.capHeight=F,this.lineHeight=E,this.spaceXadvance=O,this.xHeight=z),Q=[],$=Object.values(this.glyphs),tt=0;tt<$.length;tt++)for(et=Object.values($[tt]),it=0;it<et.length;it++)nt={id:et[it].id,left:et[it].srcX,top:et[it].srcY,width:et[it].width,height:et[it].height,xoffset:et[it].xoffset,yoffset:et[it].yoffset,xadvance:et[it].xadvance,page:x[et[it].page],pageId:et[it].page},Q.push(nt);st=[],rt=0;case 189:if(!(rt<p)){e.next=199;break}return e.next=192,u.Texture.load(t,m(this.fontFile,"../".concat(x[rt])));case 192:ot=e.sent,at=1/ot.width,lt=1/ot.height,st.push({texture:ot,invTexWidth:at,invTexHeight:lt});case 196:rt++,e.next=189;break;case 199:for(this.regions=[],ut=0,ht=Q;ut<ht.length;ut++)mt=ht[ut],ct=mt.left,_t=mt.top,ft=mt.width,dt=mt.height,vt=st[mt.pageId],yt=vt.texture,pt=vt.invTexWidth,xt=vt.invTexHeight,(gt=new h.TextureRegion(yt,ct,_t,ft,dt,mt,pt,xt)).originalWidth=ft,gt.originalHeight=dt,gt.offsetX=0,gt.offsetY=0,this.regions.push(gt);e.next=206;break;case 203:e.prev=203,e.t1=e.catch(10),console.error(e.t1);case 206:case"end":return e.stop()}}),e,this,[[10,203],[49,55]])})))},this.setGlyphRegion=function(t,e){var i=e.texture,s=1/i.width,r=1/i.height,o=e.u,a=e.v,l=(e.originalWidth,e.originalHeight,t.srcX),u=t.srcX+t.width,h=t.srcY,m=t.srcY+t.height;t.u=o+l*s,t.u2=o+u*s,n.flipped?(t.v=a+h*r,t.v2=a+m*r):(t.v2=a+h*r,t.v=a+m*r)},this.setLineHeight=function(t){n.lineHeight=t*n.scaleY,n.down=n.flipped?n.lineHeight:-n.lineHeight},this.setGlyph=function(t,e){var i=n.glyphs[t/l.PAGE_SIZE];i||(i=new Array(l.PAGE_SIZE),n.glyphs[t/l.PAGE_SIZE]=i),i[t&l.PAGE_SIZE-1]=e},this.getFirstGlyph=function(){for(var t=Object.values(n.glyphs),e=0;e<t.length;e++){var i=t[e];if(i)for(var s=0;s<i.length;s++){var r=i[s];if(r&&0!==r.height&&0!==r.width)return r}}},this.hasGlyph=function(t){return!!n.missingGlyph||null!=n.getGlyph(t)},this.getGlyph=function(t){var e=n.glyphs[t.charCodeAt(0)/l.PAGE_SIZE];if(null!=e)return e[t.charCodeAt(0)&l.PAGE_SIZE-1]},this.getGlyphs=function(t,e,i,s,r){if(0!==s-i){var o=n.markupEnabled,a=n.scaleX,l=t.glyphs,u=t.xAdvances;do{var h=e.charAt(i++);if("\r"!==h){var m=n.getGlyph(h);if(!m){if(!n.missingGlyph)continue;m=n.missingGlyph}l.push(m),u.push(r?(r.xadvance+r.getKerning(h))*a:m.fixedWidth?0:-m.xoffset*a-n.padLeft),r=m,o&&"["===h&&i<s&&"["===e.charAt(i)&&i++}}while(i<s);if(r){var c=r.fixedWidth?r.xadvance*a:(r.width+r.xoffset)*a-n.padRight;u.push(c)}}},this.getWrapIndex=function(t,e){var i=e-1,s=t,r=s[i].id;if(n.isWhitespace(r+""))return i;for(n.isBreakChar(r+"")&&i--;i>0;i--)if(r=s[i].id,n.isWhitespace(r+"")||n.isBreakChar(r+""))return i+1;return 0},this.isBreakChar=function(t){if(!n.breakChars)return!1;for(var e=String.fromCharCode(parseInt(t)),i=0;i<n.breakChars.length;i++)if(e===n.breakChars[i])return!0;return!1},this.isWhitespace=function(t){switch(String.fromCharCode(parseInt(t))){case"\n":case"\r":case"\t":case" ":return!0;default:return!1}},this.getImagePath=function(t){return n.imagePaths[t]},this.getImagePaths=function(){return n.imagePaths},this.setScale=function(t,e){if(0!==t&&0!==e){var i=t/n.scaleX,s=e/n.scaleY;n.lineHeight*=s,n.spaceXadvance*=i,n.xHeight*=s,n.capHeight*=s,n.ascent*=s,n.descent*=s,n.down*=s,n.padLeft*=i,n.padRight*=i,n.padTop*=s,n.padBottom*=s,n.scaleX=t,n.scaleY=e}},this.scale=function(t){n.setScale(n.scaleX+t,n.scaleY+t)},this.fontFile=e,this.flipped=i}return o(t,[{key:"setXYScale",value:function(t){this.setScale(t,t)}}]),t}();e.BitmapFontData=_;var f=function(){function t(e,i){r(this,t),this.strArray=[],this.currentIndex=0;for(var s=e.split(/\s+/),o=0;o<s.length;o++){var a,l=s[o];(a=this.strArray).push.apply(a,n(l.split(i)))}}return o(t,[{key:"hasMoreTokens",value:function(){return this.currentIndex>=this.strArray.length}},{key:"nextToken",value:function(){return this.strArray[this.currentIndex++]}}]),t}()},5477:function(t,e,i){"use strict";var n=i(4704).default,s=i(6690).default,r=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.BoundingBox=void 0;var o=i(7811),a=function(){function t(){s(this,t),this.min=new o.Vector3,this.max=new o.Vector3,this.cnt=new o.Vector3,this.dim=new o.Vector3,this.clr()}return r(t,[{key:"getCenter",value:function(t){return t.setFrom(this.cnt)}},{key:"getCenterX",value:function(){return this.cnt.x}},{key:"getCenterY",value:function(){return this.cnt.y}},{key:"getCenterZ",value:function(){return this.cnt.z}},{key:"getCorner000",value:function(t){return t.set(this.min.x,this.min.y,this.min.z)}},{key:"getCorner001",value:function(t){return t.set(this.min.x,this.min.y,this.max.z)}},{key:"getCorner010",value:function(t){return t.set(this.min.x,this.max.y,this.min.z)}},{key:"getCorner011",value:function(t){return t.set(this.min.x,this.max.y,this.max.z)}},{key:"getCorner100",value:function(t){return t.set(this.max.x,this.min.y,this.min.z)}},{key:"getCorner101",value:function(t){return t.set(this.max.x,this.min.y,this.max.z)}},{key:"getCorner110",value:function(t){return t.set(this.max.x,this.max.y,this.min.z)}},{key:"getCorner111",value:function(t){return t.set(this.max.x,this.max.y,this.max.z)}},{key:"getDimensions",value:function(t){return t.setFrom(this.dim)}},{key:"getWidth",value:function(){return this.dim.x}},{key:"getHeight",value:function(){return this.dim.y}},{key:"getDepth",value:function(){return this.dim.z}},{key:"getMin",value:function(t){return t.setFrom(this.min)}},{key:"getMax",value:function(t){return t.setFrom(this.max)}},{key:"setFromBounds",value:function(t){return this.set(t.min,t.max)}},{key:"set",value:function(t,e){return this.min.set(t.x<e.x?t.x:e.x,t.y<e.y?t.y:e.y,t.z<e.z?t.z:e.z),this.max.set(t.x>e.x?t.x:e.x,t.y>e.y?t.y:e.y,t.z>e.z?t.z:e.z),this.update(),this}},{key:"update",value:function(){this.cnt.setFrom(this.min).add(this.max).scale(.5),this.dim.setFrom(this.max).sub(this.min)}},{key:"setFromPoints",value:function(t){this.inf();var e,i=n(t);try{for(i.s();!(e=i.n()).done;){var s=e.value;this.extPoint(s)}}catch(r){i.e(r)}finally{i.f()}return this}},{key:"inf",value:function(){return this.min.set(1/0,1/0,1/0),this.max.set(-1/0,-1/0,-1/0),this.cnt.set(0,0,0),this.dim.set(0,0,0),this}},{key:"extPoint",value:function(t){return this.set(this.min.set(Math.min(this.min.x,t.x),Math.min(this.min.y,t.y),Math.min(this.min.z,t.z)),this.max.set(Math.max(this.max.x,t.x),Math.max(this.max.y,t.y),Math.max(this.max.z,t.z)))}},{key:"clr",value:function(){return this.set(this.min.set(0,0,0),this.max.set(0,0,0))}},{key:"isValid",value:function(){return this.min.x<=this.max.x&&this.min.y<=this.max.y&&this.min.z<=this.max.z}},{key:"extBounds",value:function(t){return this.set(this.min.set(Math.min(this.min.x,t.min.x),Math.min(this.min.y,t.min.y),Math.min(this.min.z,t.min.z)),this.max.set(Math.max(this.max.x,t.max.x),Math.max(this.max.y,t.max.y),Math.max(this.max.z,t.max.z)))}},{key:"extSphere",value:function(t,e){return this.set(this.min.set(Math.min(this.min.x,t.x-e),Math.min(this.min.y,t.y-e),Math.min(this.min.z,t.z-e)),this.max.set(Math.max(this.max.x,t.x+e),Math.max(this.max.y,t.y+e),Math.max(this.max.z,t.z+e)))}},{key:"extTransformedBox",value:function(e,i){return this.extPoint(t.tmpVector.set(e.min.x,e.min.y,e.min.z).multiply(i)),this.extPoint(t.tmpVector.set(e.min.x,e.min.y,e.max.z).multiply(i)),this.extPoint(t.tmpVector.set(e.min.x,e.max.y,e.min.z).multiply(i)),this.extPoint(t.tmpVector.set(e.min.x,e.max.y,e.max.z).multiply(i)),this.extPoint(t.tmpVector.set(e.max.x,e.min.y,e.min.z).multiply(i)),this.extPoint(t.tmpVector.set(e.max.x,e.min.y,e.max.z).multiply(i)),this.extPoint(t.tmpVector.set(e.max.x,e.max.y,e.min.z).multiply(i)),this.extPoint(t.tmpVector.set(e.max.x,e.max.y,e.max.z).multiply(i)),this}},{key:"mul",value:function(e){var i=this.min.x,n=this.min.y,s=this.min.z,r=this.max.x,o=this.max.y,a=this.max.z;return this.inf(),this.extPoint(t.tmpVector.set(i,n,s).multiply(e)),this.extPoint(t.tmpVector.set(i,n,a).multiply(e)),this.extPoint(t.tmpVector.set(i,o,s).multiply(e)),this.extPoint(t.tmpVector.set(i,o,a).multiply(e)),this.extPoint(t.tmpVector.set(r,n,s).multiply(e)),this.extPoint(t.tmpVector.set(r,n,a).multiply(e)),this.extPoint(t.tmpVector.set(r,o,s).multiply(e)),this.extPoint(t.tmpVector.set(r,o,a).multiply(e)),this}},{key:"containsBounds",value:function(t){return!this.isValid()||this.min.x<=t.min.x&&this.min.y<=t.min.y&&this.min.z<=t.min.z&&this.max.x>=t.max.x&&this.max.y>=t.max.y&&this.max.z>=t.max.z}},{key:"intersects",value:function(t){if(!this.isValid())return!1;var e=Math.abs(this.cnt.x-t.cnt.x),i=this.dim.x/2+t.dim.x/2,n=Math.abs(this.cnt.y-t.cnt.y),s=this.dim.y/2+t.dim.y/2,r=Math.abs(this.cnt.z-t.cnt.z),o=this.dim.z/2+t.dim.z/2;return e<=i&&n<=s&&r<=o}},{key:"containsPoint",value:function(t){return this.min.x<=t.x&&this.max.x>=t.x&&this.min.y<=t.y&&this.max.y>=t.y&&this.min.z<=t.z&&this.max.z>=t.z}},{key:"ext",value:function(t,e,i){return this.set(this.min.set(Math.min(this.min.x,t),Math.min(this.min.y,e),Math.min(this.min.z,i)),this.max.set(Math.max(this.max.x,t),Math.max(this.max.y,e),Math.max(this.max.z,i)))}}]),t}();e.BoundingBox=a,a.tmpVector=new o.Vector3},7459:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.OrthoCamera=void 0;var r=i(4995),o=i(7811),a=function(){function t(e,i,s,a){n(this,t),this.position=new o.Vector3(0,0,0),this.direction=new o.Vector3(0,0,-1),this.up=new o.Vector3(0,1,0),this.near=0,this.far=100,this.zoom=1,this.viewportWidth=0,this.viewportHeight=0,this.projectionView=new r.Matrix4,this.inverseProjectionView=new r.Matrix4,this.projection=new r.Matrix4,this.view=new r.Matrix4,this.tmp3=new o.Vector3,this.resize(e,i,s,a)}return s(t,[{key:"setYDown",value:function(t){t?(this.up.set(0,-1,0),this.direction.set(0,0,1)):(this.up.set(0,1,0),this.direction.set(0,0,-1)),this.update()}},{key:"resize",value:function(t,e,i,n){this.viewportWidth=t,this.viewportHeight=e,this.screenWidth=i,this.screenHeight=n,this.update()}},{key:"setPosition",value:function(t,e){this.position.set(t,e,this.position.z)}},{key:"update",value:function(){var t=this.projection,e=this.view,i=this.projectionView,n=this.inverseProjectionView,s=this.zoom,r=this.viewportWidth,o=this.viewportHeight;t.ortho(s*(-r/2),s*(r/2),s*(-o/2),s*(o/2),this.near,this.far),e.lookAt(this.position,this.direction,this.up),i.set(t.values),i.multiply(e),n.set(i.values).invert(),this.combined=i.values}},{key:"screenToWorld",value:function(t,e,i){e=e||this.screenWidth,i=i||this.screenHeight;var n=t.x,s=i-t.y-1;return t.x=2*n/e-1,t.y=2*s/i-1,t.z=2*t.z-1,t.project(this.inverseProjectionView),t}},{key:"worldToScreen",value:function(t,e,i){return e=e||this.screenWidth,i=i||this.screenHeight,t.project(this.projectionView),t.x=e*(t.x+1)/2,t.y=i*(t.y+1)/2,t.z=(t.z+1)/2,t}},{key:"unprojectVector2",value:function(t,e){this.tmp3.set(e.x,e.y,0),this.screenToWorld(this.tmp3),t.set(this.tmp3.x,this.tmp3.y)}},{key:"setViewport",value:function(t,e){this.viewportWidth=t,this.viewportHeight=e}}]),t}();e.OrthoCamera=a},6176:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0;var r=function(){function t(){n(this,t)}return s(t,[{key:"setScreen",value:function(t){this.currentScreen&&this.currentScreen.dispose&&this.currentScreen.dispose(),this.currentScreen=t,this.currentScreen&&this.currentScreen.init&&this.currentScreen.init(this)}},{key:"update",value:function(t){this.currentScreen&&this.currentScreen.update&&this.currentScreen.update(t,this)}}]),t}();e.Game=r,r.shared=new r},2013:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Glyph=e.PAGES=e.PAGE_SIZE=e.LOG2_PAGE_SIZE=void 0,e.LOG2_PAGE_SIZE=9,e.PAGE_SIZE=1<<e.LOG2_PAGE_SIZE,e.PAGES=65536/e.PAGE_SIZE;var r=function(){function t(){n(this,t),this.page=0}return s(t,[{key:"getKerning",value:function(t){if(this.kerning){var i=this.kerning[t.charCodeAt(0)>>>e.LOG2_PAGE_SIZE];if(null!=i)return i[t.charCodeAt(0)&e.PAGE_SIZE-1]}return 0}},{key:"setKerning",value:function(t,i){this.kerning||(this.kerning=[]);var n=this.kerning[t>>>e.LOG2_PAGE_SIZE];n||(this.kerning[t>>>e.LOG2_PAGE_SIZE]=n=new Uint32Array(new ArrayBuffer(e.PAGE_SIZE))),n[t&e.PAGE_SIZE-1]=i}}]),t}();e.Glyph=r},7712:function(t,e,i){"use strict";var n=i(861).default,s=i(6690).default,r=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.GlyphLayout=void 0;var o=i(9045),a=i(8606),l=function(){function t(e,i,r,l,u,h,m,c,_){var f=this;s(this,t),this.epsilon=1e-4,this.glyphRunPool=a.Pools.get("GlyphRun",(function(){return new o.GlyphRun})),this.colorStack=new Array(4),this.runs=[],this.colors=[],this.setText=function(t,e,i,n,s,r,o,a,l){f.reset();var u=t.data;if(i!==n){a&&(r=Math.max(r,3*u.spaceXadvance));var h=a||null!=l,m=s.toIntBits(),c=m;f.colors.shift();var _=u.markupEnabled;_&&f.colorStack.push(m);for(var d=!1,v=0,y=u.down,p=null,x=null,g=i;;){var b=void 0,S=!1;if(i===n){if(g===n)break;b=n,d=!0}else{if("\n"!==e.charAt(i++))continue;b=i-1,S=!0}t:{var B=f.glyphRunPool.obtain();if(B.x=0,B.y=v,u.getGlyphs(B,e,g,b,x),f.glyphCount+=B.glyphs.length,c!==m&&(f.colors[f.colors.length-2]===f.glyphCount?f.colors[f.colors.length-1]=c:(f.colors.push(f.glyphCount),f.colors.push(c)),m=c),0===B.glyphs.length){if(f.glyphRunPool.free(B),!p)break}else p?(p.appendRun(B),f.glyphRunPool.free(B)):(p=B,f.runs.push(p));if(S||d?(f.setLastGlyphXAdvance(u,p),x=null):x=p.glyphs[p.glyphs.length-1],h&&0!==p.glyphs.length&&(S||d))for(var w=p.xAdvances[0]+p.xAdvances[1],A=2;A<p.xAdvances.length;A++){var C=p.glyphs[A-1];if(w+f.getGlyphWidth(C,u)-f.epsilon<=r)w+=p.xAdvances[A];else{if(null!=l){f.truncate(u,p,r,l);break}var M=u.getWrapIndex(p.glyphs,A);if((0===M&&0===p.x||M>=p.glyphs.length)&&(M=A-1),!(p=f.wrap(u,p,M)))break t;f.runs.push(p),v+=y,p.x=0,p.y=v,w=p.xAdvances[0]+p.xAdvances[1],A=1}}}S&&(p=null,x=null,v+=b===g?y*u.blankLineScale:y),g=i}f.height=u.capHeight+Math.abs(v),f.calculateWidths(u),f.alignRuns(r,o),_&&(f.colorStack.length=0)}else f.height=u.capHeight},this.calculateWidths=function(t){for(var e,i=0,s=n(f.runs),r=0,o=f.runs.length;r<o;r++){for(var a=s[r],l=a.xAdvances,u=a.x+l[0],h=0,m=a.glyphs,c=0;c<a.glyphs.length;){var _=m[c],d=f.getGlyphWidth(_,t);h=Math.max(h,u+d),u+=null!==(e=l[++c])&&void 0!==e?e:0}a.width=Math.max(u,h)-a.x,i=Math.max(i,a.x+(isNaN(a.width)?u:a.width))}f.width=i},this.alignRuns=function(t,e){if(0===(e&a.Align.left))for(var i=0!==(e&a.Align.center),s=n(f.runs),r=0,o=f.runs.length;r<o;r++){var l=s[r];l.x+=i?.5*(t-l.width):t-l.width}},this.truncate=function(t,e,i,n){var s=e.glyphs.length,r=f.glyphRunPool.obtain();t.getGlyphs(r,n,0,n.length,null);var o=0;if(r.xAdvances.length>0){f.setLastGlyphXAdvance(t,r);for(var l=r.xAdvances,u=1;u<r.xAdvances.length;u++)o+=l[u]}i-=o;for(var h=0,m=e.x,c=e.xAdvances;h<e.xAdvances.length;){if((m+=c[h])>i)break;h++}if(h>1){if(h-1>=0&&e.glyphs.length>h-1)for(var _=h-1;_<e.glyphs.length;_++)e.glyphs.splice(_,1);if(h>=0&&e.xAdvances.length>h)for(var d=h;d<e.xAdvances.length;d++)e.xAdvances.splice(d,1);f.setLastGlyphXAdvance(t,e),r.xAdvances.length>0&&a.Utils.arrayCopy(r.xAdvances,1,e.xAdvances,e.xAdvances.length,r.xAdvances.length-1)}else e.glyphs.length=0,e.xAdvances.length=0,a.Utils.arrayCopy(r.xAdvances,0,e.xAdvances,e.xAdvances.length,r.xAdvances.length);var v=s-e.glyphs.length;if(v>0&&(f.glyphCount-=v,t.markupEnabled))for(;f.colors.length>2&&f.colors[f.colors.length-2]>=f.glyphCount;)f.colors.length-=2;a.Utils.arrayCopy(r.glyphs,0,e.glyphs,e.glyphs.length,r.glyphs.length),f.glyphCount+=n.length,f.glyphRunPool.free(r)},this.setLastGlyphXAdvance=function(t,e){var i=e.glyphs[e.glyphs.length-1];i.fixedWidth||(e.xAdvances[e.xAdvances.length-1]=f.getGlyphWidth(i,t))},this.getGlyphWidth=function(t,e){return(t.width+t.xoffset)*e.scaleX-e.padRight},this.getLineOffset=function(t,e){return-t[0].xoffset*e.scaleX-e.padLeft},this.reset=function(){f.glyphRunPool.freeAll(f.runs),f.runs.length=0,f.colors.length=0,f.glyphCount=0,f.width=0,f.height=0},this.setText(e,i,r,l,u,h,m,c,_)}return r(t,[{key:"wrap",value:function(t,e,i){for(var n=e.glyphs.length,s=e.glyphs,r=e.xAdvances,o=i;o>0&&t.isWhitespace(s[o-1].id);o--);for(var l,u=i;u<n&&t.isWhitespace(s[u].id);u++);if(u<n){var h=(l=this.glyphRunPool.obtain()).glyphs;a.Utils.arrayCopy(s,0,h,h.length,o),s.splice(0,u-1+1),e.glyphs=h,l.glyphs=s;var m=l.xAdvances;a.Utils.arrayCopy(r,0,m,m.length,o+1),r.splice(1,u),r[0]=this.getLineOffset(s,t),e.xAdvances=m,l.xAdvances=r;var c=e.glyphs.length,_=l.glyphs.length,f=n-c-_;if(this.glyphCount-=f,t.markupEnabled&&f>0)for(var d=this.glyphCount-_,v=this.colors.length-2;v>=2;v-=2){var y=this.colors[v];if(y<=d)break;this.colors[v]=y-f}}else{s=s.slice(0,o),r=r.slice(0,o+1);var p=u-o;if(p>0&&(this.glyphCount-=p,t.markupEnabled&&this.colors[this.colors.length-2]>this.glyphCount)){for(var x=this.colors[this.colors.length-1];this.colors[this.colors.length-2]>this.glyphCount;)this.colors.length-=2;this.colors[this.colors.length-2]=this.glyphCount,this.colors[this.colors.length-1]=x}}return 0===o?(this.glyphRunPool.free(e),this.runs.pop()):this.setLastGlyphXAdvance(t,e),l}}]),t}();e.GlyphLayout=l},9045:function(t,e,i){"use strict";var n=i(9728).default,s=i(6690).default;Object.defineProperty(e,"__esModule",{value:!0}),e.GlyphRun=void 0;var r=n((function t(){var e=this;s(this,t),this.glyphs=[],this.xAdvances=[],this.appendRun=function(t){e.glyphs.concat(t.glyphs),e.xAdvances.length||e.xAdvances.length--,e.xAdvances.concat(t.xAdvances)},this.reset=function(){e.glyphs.length=0,e.xAdvances.length=0}}));e.GlyphRun=r},6964:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.InputHandler=e.InputEvent=void 0;var r=i(8041),o=i(2283);!function(t){t.TouchStart="touchStart",t.TouchEnd="touchEnd",t.TouchMove="touchMove"}(e.InputEvent||(e.InputEvent={}));var a=function(){function t(e){var i=this;n(this,t),this.screenCoord=new o.Vector2,this.worldCoord=new o.Vector2,this.canvas=e,this.lastX=0,this.lastY=0,this.touched=!1;var s=this.emitter=new r.EventEmitter;this.mouseDownHandler=function(t){i.touched=!0,i.handleMove(t),s.emit("touchStart",i.getX(),i.getY())},this.mouseUpHandler=function(t){i.touched=!1,s.emit("touchEnd",i.getX(),i.getY())},this.mouseMoveHandler=function(t){i.handleMove(t),s.emit("touchMove",i.getX(),i.getY())},this.touchStartHandler=function(t){t.preventDefault();var e=t.touches[0];i.canvas.dispatchEvent(new MouseEvent("mousedown",{clientX:e.clientX,clientY:e.clientY}))},this.touchEndHandler=function(t){t.preventDefault(),i.canvas.dispatchEvent(new MouseEvent("mouseup"))},this.touchMoveHandler=function(t){t.preventDefault();var e=t.touches[0];i.canvas.dispatchEvent(new MouseEvent("mousemove",{clientX:e.clientX,clientY:e.clientY}))},this.canvas.addEventListener("mousedown",this.mouseDownHandler,!1),this.canvas.addEventListener("mouseup",this.mouseUpHandler,!1),this.canvas.addEventListener("mousemove",this.mouseMoveHandler,!1),this.canvas.addEventListener("touchstart",this.touchStartHandler,!1),this.canvas.addEventListener("touchend",this.touchEndHandler,!1),this.canvas.addEventListener("touchmove",this.touchMoveHandler,!1)}return s(t,[{key:"cleanup",value:function(){this.canvas.removeEventListener("mousedown",this.mouseDownHandler),this.canvas.removeEventListener("mouseup",this.mouseUpHandler),this.canvas.removeEventListener("mousemove",this.mouseMoveHandler),this.canvas.removeEventListener("touchstart",this.touchStartHandler),this.canvas.removeEventListener("touchend",this.touchEndHandler),this.canvas.removeEventListener("touchmove",this.touchMoveHandler)}},{key:"addEventListener",value:function(t,e){this.emitter.addListener(t,e)}},{key:"handleMove",value:function(t){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top;this.lastX=i,this.lastY=n}},{key:"getX",value:function(){return this.lastX}},{key:"getY",value:function(){return this.lastY}},{key:"isTouched",value:function(){return this.touched}},{key:"getTouchedWorldCoord",value:function(t){return this.screenCoord.set(this.getX(),this.getY()),t.unprojectVector2(this.worldCoord,this.screenCoord),this.worldCoord}}]),t}();e.InputHandler=a},4995:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Matrix4=e.M33=e.M32=e.M31=e.M30=e.M23=e.M22=e.M21=e.M20=e.M13=e.M12=e.M11=e.M10=e.M03=e.M02=e.M01=e.M00=void 0;var r=i(7811);e.M00=0,e.M01=4,e.M02=8,e.M03=12,e.M10=1,e.M11=5,e.M12=9,e.M13=13,e.M20=2,e.M21=6,e.M22=10,e.M23=14,e.M30=3,e.M31=7,e.M32=11,e.M33=15;var o=function(){function t(){n(this,t),this.temp=new Float32Array(16),this.values=new Float32Array(16);var i=this.values;i[e.M00]=1,i[e.M11]=1,i[e.M22]=1,i[e.M33]=1}return s(t,[{key:"set",value:function(t){return this.values.set(t),this}},{key:"transpose",value:function(){var t=this.temp,i=this.values;return t[e.M00]=i[e.M00],t[e.M01]=i[e.M10],t[e.M02]=i[e.M20],t[e.M03]=i[e.M30],t[e.M10]=i[e.M01],t[e.M11]=i[e.M11],t[e.M12]=i[e.M21],t[e.M13]=i[e.M31],t[e.M20]=i[e.M02],t[e.M21]=i[e.M12],t[e.M22]=i[e.M22],t[e.M23]=i[e.M32],t[e.M30]=i[e.M03],t[e.M31]=i[e.M13],t[e.M32]=i[e.M23],t[e.M33]=i[e.M33],this.set(t)}},{key:"identity",value:function(){var t=this.values;return t[e.M00]=1,t[e.M01]=0,t[e.M02]=0,t[e.M03]=0,t[e.M10]=0,t[e.M11]=1,t[e.M12]=0,t[e.M13]=0,t[e.M20]=0,t[e.M21]=0,t[e.M22]=1,t[e.M23]=0,t[e.M30]=0,t[e.M31]=0,t[e.M32]=0,t[e.M33]=1,this}},{key:"invert",value:function(){var t=this.values,i=this.temp,n=t[e.M30]*t[e.M21]*t[e.M12]*t[e.M03]-t[e.M20]*t[e.M31]*t[e.M12]*t[e.M03]-t[e.M30]*t[e.M11]*t[e.M22]*t[e.M03]+t[e.M10]*t[e.M31]*t[e.M22]*t[e.M03]+t[e.M20]*t[e.M11]*t[e.M32]*t[e.M03]-t[e.M10]*t[e.M21]*t[e.M32]*t[e.M03]-t[e.M30]*t[e.M21]*t[e.M02]*t[e.M13]+t[e.M20]*t[e.M31]*t[e.M02]*t[e.M13]+t[e.M30]*t[e.M01]*t[e.M22]*t[e.M13]-t[e.M00]*t[e.M31]*t[e.M22]*t[e.M13]-t[e.M20]*t[e.M01]*t[e.M32]*t[e.M13]+t[e.M00]*t[e.M21]*t[e.M32]*t[e.M13]+t[e.M30]*t[e.M11]*t[e.M02]*t[e.M23]-t[e.M10]*t[e.M31]*t[e.M02]*t[e.M23]-t[e.M30]*t[e.M01]*t[e.M12]*t[e.M23]+t[e.M00]*t[e.M31]*t[e.M12]*t[e.M23]+t[e.M10]*t[e.M01]*t[e.M32]*t[e.M23]-t[e.M00]*t[e.M11]*t[e.M32]*t[e.M23]-t[e.M20]*t[e.M11]*t[e.M02]*t[e.M33]+t[e.M10]*t[e.M21]*t[e.M02]*t[e.M33]+t[e.M20]*t[e.M01]*t[e.M12]*t[e.M33]-t[e.M00]*t[e.M21]*t[e.M12]*t[e.M33]-t[e.M10]*t[e.M01]*t[e.M22]*t[e.M33]+t[e.M00]*t[e.M11]*t[e.M22]*t[e.M33];if(0===n)throw new Error("non-invertible matrix");var s=1/n;return i[e.M00]=t[e.M12]*t[e.M23]*t[e.M31]-t[e.M13]*t[e.M22]*t[e.M31]+t[e.M13]*t[e.M21]*t[e.M32]-t[e.M11]*t[e.M23]*t[e.M32]-t[e.M12]*t[e.M21]*t[e.M33]+t[e.M11]*t[e.M22]*t[e.M33],i[e.M01]=t[e.M03]*t[e.M22]*t[e.M31]-t[e.M02]*t[e.M23]*t[e.M31]-t[e.M03]*t[e.M21]*t[e.M32]+t[e.M01]*t[e.M23]*t[e.M32]+t[e.M02]*t[e.M21]*t[e.M33]-t[e.M01]*t[e.M22]*t[e.M33],i[e.M02]=t[e.M02]*t[e.M13]*t[e.M31]-t[e.M03]*t[e.M12]*t[e.M31]+t[e.M03]*t[e.M11]*t[e.M32]-t[e.M01]*t[e.M13]*t[e.M32]-t[e.M02]*t[e.M11]*t[e.M33]+t[e.M01]*t[e.M12]*t[e.M33],i[e.M03]=t[e.M03]*t[e.M12]*t[e.M21]-t[e.M02]*t[e.M13]*t[e.M21]-t[e.M03]*t[e.M11]*t[e.M22]+t[e.M01]*t[e.M13]*t[e.M22]+t[e.M02]*t[e.M11]*t[e.M23]-t[e.M01]*t[e.M12]*t[e.M23],i[e.M10]=t[e.M13]*t[e.M22]*t[e.M30]-t[e.M12]*t[e.M23]*t[e.M30]-t[e.M13]*t[e.M20]*t[e.M32]+t[e.M10]*t[e.M23]*t[e.M32]+t[e.M12]*t[e.M20]*t[e.M33]-t[e.M10]*t[e.M22]*t[e.M33],i[e.M11]=t[e.M02]*t[e.M23]*t[e.M30]-t[e.M03]*t[e.M22]*t[e.M30]+t[e.M03]*t[e.M20]*t[e.M32]-t[e.M00]*t[e.M23]*t[e.M32]-t[e.M02]*t[e.M20]*t[e.M33]+t[e.M00]*t[e.M22]*t[e.M33],i[e.M12]=t[e.M03]*t[e.M12]*t[e.M30]-t[e.M02]*t[e.M13]*t[e.M30]-t[e.M03]*t[e.M10]*t[e.M32]+t[e.M00]*t[e.M13]*t[e.M32]+t[e.M02]*t[e.M10]*t[e.M33]-t[e.M00]*t[e.M12]*t[e.M33],i[e.M13]=t[e.M02]*t[e.M13]*t[e.M20]-t[e.M03]*t[e.M12]*t[e.M20]+t[e.M03]*t[e.M10]*t[e.M22]-t[e.M00]*t[e.M13]*t[e.M22]-t[e.M02]*t[e.M10]*t[e.M23]+t[e.M00]*t[e.M12]*t[e.M23],i[e.M20]=t[e.M11]*t[e.M23]*t[e.M30]-t[e.M13]*t[e.M21]*t[e.M30]+t[e.M13]*t[e.M20]*t[e.M31]-t[e.M10]*t[e.M23]*t[e.M31]-t[e.M11]*t[e.M20]*t[e.M33]+t[e.M10]*t[e.M21]*t[e.M33],i[e.M21]=t[e.M03]*t[e.M21]*t[e.M30]-t[e.M01]*t[e.M23]*t[e.M30]-t[e.M03]*t[e.M20]*t[e.M31]+t[e.M00]*t[e.M23]*t[e.M31]+t[e.M01]*t[e.M20]*t[e.M33]-t[e.M00]*t[e.M21]*t[e.M33],i[e.M22]=t[e.M01]*t[e.M13]*t[e.M30]-t[e.M03]*t[e.M11]*t[e.M30]+t[e.M03]*t[e.M10]*t[e.M31]-t[e.M00]*t[e.M13]*t[e.M31]-t[e.M01]*t[e.M10]*t[e.M33]+t[e.M00]*t[e.M11]*t[e.M33],i[e.M23]=t[e.M03]*t[e.M11]*t[e.M20]-t[e.M01]*t[e.M13]*t[e.M20]-t[e.M03]*t[e.M10]*t[e.M21]+t[e.M00]*t[e.M13]*t[e.M21]+t[e.M01]*t[e.M10]*t[e.M23]-t[e.M00]*t[e.M11]*t[e.M23],i[e.M30]=t[e.M12]*t[e.M21]*t[e.M30]-t[e.M11]*t[e.M22]*t[e.M30]-t[e.M12]*t[e.M20]*t[e.M31]+t[e.M10]*t[e.M22]*t[e.M31]+t[e.M11]*t[e.M20]*t[e.M32]-t[e.M10]*t[e.M21]*t[e.M32],i[e.M31]=t[e.M01]*t[e.M22]*t[e.M30]-t[e.M02]*t[e.M21]*t[e.M30]+t[e.M02]*t[e.M20]*t[e.M31]-t[e.M00]*t[e.M22]*t[e.M31]-t[e.M01]*t[e.M20]*t[e.M32]+t[e.M00]*t[e.M21]*t[e.M32],i[e.M32]=t[e.M02]*t[e.M11]*t[e.M30]-t[e.M01]*t[e.M12]*t[e.M30]-t[e.M02]*t[e.M10]*t[e.M31]+t[e.M00]*t[e.M12]*t[e.M31]+t[e.M01]*t[e.M10]*t[e.M32]-t[e.M00]*t[e.M11]*t[e.M32],i[e.M33]=t[e.M01]*t[e.M12]*t[e.M20]-t[e.M02]*t[e.M11]*t[e.M20]+t[e.M02]*t[e.M10]*t[e.M21]-t[e.M00]*t[e.M12]*t[e.M21]-t[e.M01]*t[e.M10]*t[e.M22]+t[e.M00]*t[e.M11]*t[e.M22],t[e.M00]=i[e.M00]*s,t[e.M01]=i[e.M01]*s,t[e.M02]=i[e.M02]*s,t[e.M03]=i[e.M03]*s,t[e.M10]=i[e.M10]*s,t[e.M11]=i[e.M11]*s,t[e.M12]=i[e.M12]*s,t[e.M13]=i[e.M13]*s,t[e.M20]=i[e.M20]*s,t[e.M21]=i[e.M21]*s,t[e.M22]=i[e.M22]*s,t[e.M23]=i[e.M23]*s,t[e.M30]=i[e.M30]*s,t[e.M31]=i[e.M31]*s,t[e.M32]=i[e.M32]*s,t[e.M33]=i[e.M33]*s,this}},{key:"determinant",value:function(){var t=this.values;return t[e.M30]*t[e.M21]*t[e.M12]*t[e.M03]-t[e.M20]*t[e.M31]*t[e.M12]*t[e.M03]-t[e.M30]*t[e.M11]*t[e.M22]*t[e.M03]+t[e.M10]*t[e.M31]*t[e.M22]*t[e.M03]+t[e.M20]*t[e.M11]*t[e.M32]*t[e.M03]-t[e.M10]*t[e.M21]*t[e.M32]*t[e.M03]-t[e.M30]*t[e.M21]*t[e.M02]*t[e.M13]+t[e.M20]*t[e.M31]*t[e.M02]*t[e.M13]+t[e.M30]*t[e.M01]*t[e.M22]*t[e.M13]-t[e.M00]*t[e.M31]*t[e.M22]*t[e.M13]-t[e.M20]*t[e.M01]*t[e.M32]*t[e.M13]+t[e.M00]*t[e.M21]*t[e.M32]*t[e.M13]+t[e.M30]*t[e.M11]*t[e.M02]*t[e.M23]-t[e.M10]*t[e.M31]*t[e.M02]*t[e.M23]-t[e.M30]*t[e.M01]*t[e.M12]*t[e.M23]+t[e.M00]*t[e.M31]*t[e.M12]*t[e.M23]+t[e.M10]*t[e.M01]*t[e.M32]*t[e.M23]-t[e.M00]*t[e.M11]*t[e.M32]*t[e.M23]-t[e.M20]*t[e.M11]*t[e.M02]*t[e.M33]+t[e.M10]*t[e.M21]*t[e.M02]*t[e.M33]+t[e.M20]*t[e.M01]*t[e.M12]*t[e.M33]-t[e.M00]*t[e.M21]*t[e.M12]*t[e.M33]-t[e.M10]*t[e.M01]*t[e.M22]*t[e.M33]+t[e.M00]*t[e.M11]*t[e.M22]*t[e.M33]}},{key:"translate",value:function(t,i,n){var s=this.values;return s[e.M03]+=t,s[e.M13]+=i,s[e.M23]+=n,this}},{key:"copy",value:function(){return(new t).set(this.values)}},{key:"projection",value:function(t,i,n,s){this.identity();var r=1/Math.tan(n*(Math.PI/180)/2),o=(i+t)/(t-i),a=2*i*t/(t-i),l=this.values;return l[e.M00]=r/s,l[e.M10]=0,l[e.M20]=0,l[e.M30]=0,l[e.M01]=0,l[e.M11]=r,l[e.M21]=0,l[e.M31]=0,l[e.M02]=0,l[e.M12]=0,l[e.M22]=o,l[e.M32]=-1,l[e.M03]=0,l[e.M13]=0,l[e.M23]=a,l[e.M33]=0,this}},{key:"ortho2d",value:function(t,e,i,n){return this.ortho(t,t+i,e,e+n,0,1)}},{key:"ortho",value:function(t,i,n,s,r,o){this.identity();var a=2/(i-t),l=2/(s-n),u=-2/(o-r),h=-(i+t)/(i-t),m=-(s+n)/(s-n),c=-(o+r)/(o-r),_=this.values;return _[e.M00]=a,_[e.M10]=0,_[e.M20]=0,_[e.M30]=0,_[e.M01]=0,_[e.M11]=l,_[e.M21]=0,_[e.M31]=0,_[e.M02]=0,_[e.M12]=0,_[e.M22]=u,_[e.M32]=0,_[e.M03]=h,_[e.M13]=m,_[e.M23]=c,_[e.M33]=1,this}},{key:"multiply",value:function(t){var i=this.temp,n=this.values,s=t.values;return i[e.M00]=n[e.M00]*s[e.M00]+n[e.M01]*s[e.M10]+n[e.M02]*s[e.M20]+n[e.M03]*s[e.M30],i[e.M01]=n[e.M00]*s[e.M01]+n[e.M01]*s[e.M11]+n[e.M02]*s[e.M21]+n[e.M03]*s[e.M31],i[e.M02]=n[e.M00]*s[e.M02]+n[e.M01]*s[e.M12]+n[e.M02]*s[e.M22]+n[e.M03]*s[e.M32],i[e.M03]=n[e.M00]*s[e.M03]+n[e.M01]*s[e.M13]+n[e.M02]*s[e.M23]+n[e.M03]*s[e.M33],i[e.M10]=n[e.M10]*s[e.M00]+n[e.M11]*s[e.M10]+n[e.M12]*s[e.M20]+n[e.M13]*s[e.M30],i[e.M11]=n[e.M10]*s[e.M01]+n[e.M11]*s[e.M11]+n[e.M12]*s[e.M21]+n[e.M13]*s[e.M31],i[e.M12]=n[e.M10]*s[e.M02]+n[e.M11]*s[e.M12]+n[e.M12]*s[e.M22]+n[e.M13]*s[e.M32],i[e.M13]=n[e.M10]*s[e.M03]+n[e.M11]*s[e.M13]+n[e.M12]*s[e.M23]+n[e.M13]*s[e.M33],i[e.M20]=n[e.M20]*s[e.M00]+n[e.M21]*s[e.M10]+n[e.M22]*s[e.M20]+n[e.M23]*s[e.M30],i[e.M21]=n[e.M20]*s[e.M01]+n[e.M21]*s[e.M11]+n[e.M22]*s[e.M21]+n[e.M23]*s[e.M31],i[e.M22]=n[e.M20]*s[e.M02]+n[e.M21]*s[e.M12]+n[e.M22]*s[e.M22]+n[e.M23]*s[e.M32],i[e.M23]=n[e.M20]*s[e.M03]+n[e.M21]*s[e.M13]+n[e.M22]*s[e.M23]+n[e.M23]*s[e.M33],i[e.M30]=n[e.M30]*s[e.M00]+n[e.M31]*s[e.M10]+n[e.M32]*s[e.M20]+n[e.M33]*s[e.M30],i[e.M31]=n[e.M30]*s[e.M01]+n[e.M31]*s[e.M11]+n[e.M32]*s[e.M21]+n[e.M33]*s[e.M31],i[e.M32]=n[e.M30]*s[e.M02]+n[e.M31]*s[e.M12]+n[e.M32]*s[e.M22]+n[e.M33]*s[e.M32],i[e.M33]=n[e.M30]*s[e.M03]+n[e.M31]*s[e.M13]+n[e.M32]*s[e.M23]+n[e.M33]*s[e.M33],this.set(this.temp)}},{key:"multiplyLeft",value:function(t){var i=this.temp,n=this.values,s=t.values;return i[e.M00]=s[e.M00]*n[e.M00]+s[e.M01]*n[e.M10]+s[e.M02]*n[e.M20]+s[e.M03]*n[e.M30],i[e.M01]=s[e.M00]*n[e.M01]+s[e.M01]*n[e.M11]+s[e.M02]*n[e.M21]+s[e.M03]*n[e.M31],i[e.M02]=s[e.M00]*n[e.M02]+s[e.M01]*n[e.M12]+s[e.M02]*n[e.M22]+s[e.M03]*n[e.M32],i[e.M03]=s[e.M00]*n[e.M03]+s[e.M01]*n[e.M13]+s[e.M02]*n[e.M23]+s[e.M03]*n[e.M33],i[e.M10]=s[e.M10]*n[e.M00]+s[e.M11]*n[e.M10]+s[e.M12]*n[e.M20]+s[e.M13]*n[e.M30],i[e.M11]=s[e.M10]*n[e.M01]+s[e.M11]*n[e.M11]+s[e.M12]*n[e.M21]+s[e.M13]*n[e.M31],i[e.M12]=s[e.M10]*n[e.M02]+s[e.M11]*n[e.M12]+s[e.M12]*n[e.M22]+s[e.M13]*n[e.M32],i[e.M13]=s[e.M10]*n[e.M03]+s[e.M11]*n[e.M13]+s[e.M12]*n[e.M23]+s[e.M13]*n[e.M33],i[e.M20]=s[e.M20]*n[e.M00]+s[e.M21]*n[e.M10]+s[e.M22]*n[e.M20]+s[e.M23]*n[e.M30],i[e.M21]=s[e.M20]*n[e.M01]+s[e.M21]*n[e.M11]+s[e.M22]*n[e.M21]+s[e.M23]*n[e.M31],i[e.M22]=s[e.M20]*n[e.M02]+s[e.M21]*n[e.M12]+s[e.M22]*n[e.M22]+s[e.M23]*n[e.M32],i[e.M23]=s[e.M20]*n[e.M03]+s[e.M21]*n[e.M13]+s[e.M22]*n[e.M23]+s[e.M23]*n[e.M33],i[e.M30]=s[e.M30]*n[e.M00]+s[e.M31]*n[e.M10]+s[e.M32]*n[e.M20]+s[e.M33]*n[e.M30],i[e.M31]=s[e.M30]*n[e.M01]+s[e.M31]*n[e.M11]+s[e.M32]*n[e.M21]+s[e.M33]*n[e.M31],i[e.M32]=s[e.M30]*n[e.M02]+s[e.M31]*n[e.M12]+s[e.M32]*n[e.M22]+s[e.M33]*n[e.M32],i[e.M33]=s[e.M30]*n[e.M03]+s[e.M31]*n[e.M13]+s[e.M32]*n[e.M23]+s[e.M33]*n[e.M33],this.set(this.temp)}},{key:"lookAt",value:function(i,n,s){t.initTemps();var r=t.xAxis,o=t.yAxis,a=t.zAxis;a.setFrom(n).normalize(),r.setFrom(n).normalize(),r.cross(s).normalize(),o.setFrom(r).cross(a).normalize(),this.identity();var l=this.values;return l[e.M00]=r.x,l[e.M01]=r.y,l[e.M02]=r.z,l[e.M10]=o.x,l[e.M11]=o.y,l[e.M12]=o.z,l[e.M20]=-a.x,l[e.M21]=-a.y,l[e.M22]=-a.z,t.tmpMatrix.identity(),t.tmpMatrix.values[e.M03]=-i.x,t.tmpMatrix.values[e.M13]=-i.y,t.tmpMatrix.values[e.M23]=-i.z,this.multiply(t.tmpMatrix),this}}],[{key:"initTemps",value:function(){null===t.xAxis&&(t.xAxis=new r.Vector3),null===t.yAxis&&(t.yAxis=new r.Vector3),null===t.zAxis&&(t.zAxis=new r.Vector3)}}]),t}();e.Matrix4=o,o.xAxis=null,o.yAxis=null,o.zAxis=null,o.tmpMatrix=new o},1514:function(t,e,i){"use strict";var n=i(1655).default,s=i(6389).default,r=i(6690).default,o=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Color2Attribute=e.ColorAttribute=e.TexCoordAttribute=e.Position3Attribute=e.Position2Attribute=e.VertexAttribute=e.VertexAttributeType=e.Mesh=void 0;var a,l=i(1858),u=function(){function t(e,i,n,s){r(this,t),this.attributes=i,this.verticesLength=0,this.dirtyVertices=!1,this.indicesLength=0,this.dirtyIndices=!1,this.elementsPerVertex=0,this.context=e,this.elementsPerVertex=0;for(var o=0;o<i.length;o++)this.elementsPerVertex+=i[o].numElements;this.vertices=new Float32Array(n*this.elementsPerVertex),this.indices=new Uint16Array(s)}return o(t,[{key:"getAttributes",value:function(){return this.attributes}},{key:"maxVertices",value:function(){return this.vertices.length/this.elementsPerVertex}},{key:"numVertices",value:function(){return this.verticesLength/this.elementsPerVertex}},{key:"setVerticesLength",value:function(t){this.dirtyVertices=!0,this.verticesLength=t}},{key:"getVertices",value:function(){return this.vertices}},{key:"maxIndices",value:function(){return this.indices.length}},{key:"numIndices",value:function(){return this.indicesLength}},{key:"setIndicesLength",value:function(t){this.dirtyIndices=!0,this.indicesLength=t}},{key:"getIndices",value:function(){return this.indices}},{key:"getVertexSizeInFloats",value:function(){for(var t=0,e=0;e<this.attributes.length;e++){t+=this.attributes[e].numElements}return t}},{key:"setVertices",value:function(t){if(this.dirtyVertices=!0,t.length>this.vertices.length)throw Error("Mesh can't store more than "+this.maxVertices()+" vertices");this.vertices.set(t,0),this.verticesLength=t.length}},{key:"setIndices",value:function(t){if(this.dirtyIndices=!0,t.length>this.indices.length)throw Error("Mesh can't store more than "+this.maxIndices()+" indices");this.indices.set(t,0),this.indicesLength=t.length}},{key:"draw",value:function(t,e){this.drawWithOffset(t,e,0,this.indicesLength>0?this.indicesLength:this.verticesLength/this.elementsPerVertex)}},{key:"drawWithOffset",value:function(t,e,i,n){var s=this.context;(this.dirtyVertices||this.dirtyIndices)&&this.update(),this.bind(t),this.indicesLength>0?s.drawElements(e,n,s.UNSIGNED_SHORT,2*i):s.drawArrays(e,i,n),this.unbind(t)}},{key:"bind",value:function(t){var e=this.context;e.bindBuffer(e.ARRAY_BUFFER,this.verticesBuffer);for(var i=0,n=0;n<this.attributes.length;n++){var s=this.attributes[n],r=t.getAttributeLocation(s.name);e.enableVertexAttribArray(r),e.vertexAttribPointer(r,s.numElements,e.FLOAT,!1,4*this.elementsPerVertex,4*i),i+=s.numElements}this.indicesLength>0&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indicesBuffer)}},{key:"unbind",value:function(t){for(var e=this.context,i=0;i<this.attributes.length;i++){var n=this.attributes[i],s=t.getAttributeLocation(n.name);e.disableVertexAttribArray(s)}e.bindBuffer(e.ARRAY_BUFFER,null),this.indicesLength>0&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}},{key:"update",value:function(){var t=this.context;this.dirtyVertices&&(this.verticesBuffer||(this.verticesBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.verticesBuffer),t.bufferData(t.ARRAY_BUFFER,this.vertices.subarray(0,this.verticesLength),t.DYNAMIC_DRAW),this.dirtyVertices=!1),this.dirtyIndices&&(this.indicesBuffer||(this.indicesBuffer=t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indicesBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices.subarray(0,this.indicesLength),t.DYNAMIC_DRAW),this.dirtyIndices=!1)}},{key:"restore",value:function(){this.verticesBuffer=null,this.indicesBuffer=null,this.update()}},{key:"dispose",value:function(){var t=this.context;t.deleteBuffer(this.verticesBuffer),t.deleteBuffer(this.indicesBuffer)}}]),t}();e.Mesh=u,function(t){t[t.Float=0]="Float"}(a=e.VertexAttributeType||(e.VertexAttributeType={}));var h=o((function t(e,i,n){r(this,t),this.name=e,this.type=i,this.numElements=n}));e.VertexAttribute=h;var m=function(t){n(i,t);var e=s(i);function i(){return r(this,i),e.call(this,l.Shader.POSITION,a.Float,2)}return o(i)}(h);e.Position2Attribute=m;var c=function(t){n(i,t);var e=s(i);function i(){return r(this,i),e.call(this,l.Shader.POSITION,a.Float,3)}return o(i)}(h);e.Position3Attribute=c;var _=function(t){n(i,t);var e=s(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return r(this,i),e.call(this,l.Shader.TEXCOORDS+(0===t?"":t),a.Float,2)}return o(i)}(h);e.TexCoordAttribute=_;var f=function(t){n(i,t);var e=s(i);function i(){return r(this,i),e.call(this,l.Shader.COLOR,a.Float,4)}return o(i)}(h);e.ColorAttribute=f;var d=function(t){n(i,t);var e=s(i);function i(){return r(this,i),e.call(this,l.Shader.COLOR2,a.Float,4)}return o(i)}(h);e.Color2Attribute=d},9699:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.NumberUtil=void 0;var r=new Int8Array(4),o=new Int32Array(r.buffer,0,1),a=new Float32Array(r.buffer,0,1),l=function(){function t(){n(this,t)}return s(t,null,[{key:"intBitsToFloat",value:function(t){return o[0]=t,a[0]}},{key:"floatToIntBits",value:function(t){return a[0]=t,o[0]}},{key:"intToFloatColor",value:function(e){return t.intBitsToFloat(4278190079&e)}},{key:"colorToFloat",value:function(e,i,n,s){var r=e<<24|i<<16|n<<8|s;return t.intToFloatColor(r)}},{key:"isPowerOfTwo",value:function(t){return 0===(t&t-1)}},{key:"nextPowerOfTwo",value:function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1}}]),t}();e.NumberUtil=l},1251:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.PolygonBatch=void 0;var r=i(8606),o=i(1514),a=i(1858),l=[0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0],u=new r.Color(1,1,1,1),h=function(){function t(e){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10920;if(n(this,t),this.isDrawing=!1,this.shader=null,this.lastTexture=null,this.verticesLength=0,this.indicesLength=0,this.projectionValues=new Float32Array(16),this.color=u,this.twoColorTint=!0,this.yDown=!1,s>10920)throw new Error("Can't have more than 10920 triangles per batch: "+s);this.context=e;var r=i?[new o.Position2Attribute,new o.ColorAttribute,new o.TexCoordAttribute,new o.Color2Attribute]:[new o.Position2Attribute,new o.ColorAttribute,new o.TexCoordAttribute];this.mesh=new o.Mesh(e,r,s,3*s),this.shader=a.Shader.newTwoColoredTextured(e);var l=this.context;this.srcColorBlend=l.SRC_ALPHA,this.srcAlphaBlend=l.ONE,this.dstBlend=l.ONE_MINUS_SRC_ALPHA,this.twoColorTint=i}return s(t,[{key:"setColor",value:function(t){this.color=t}},{key:"setShader",value:function(t){this.shader.dispose(),this.shader=t}},{key:"setProjection",value:function(t){this.projectionValues=t}},{key:"begin",value:function(){if(this.isDrawing)throw new Error("PolygonBatch is already drawing. Call PolygonBatch.end() before calling PolygonBatch.begin()");this.drawCalls=0;var t=this.shader;this.lastTexture=null,this.isDrawing=!0,t.bind(),t.setUniform4x4f(a.Shader.MVP_MATRIX,this.projectionValues),t.setUniformi("u_texture",0);var e=this.context;e.enable(e.BLEND),e.blendFuncSeparate(this.srcColorBlend,this.dstBlend,this.srcAlphaBlend,this.dstBlend)}},{key:"setBlendMode",value:function(t,e,i){this.srcColorBlend===t&&this.srcAlphaBlend===e&&this.dstBlend===i||(this.srcColorBlend=t,this.srcAlphaBlend=e,this.dstBlend=i,this.isDrawing&&(this.flush(),this.context.blendFuncSeparate(t,i,e,i)))}},{key:"drawVerticesWithOffset",value:function(e,i,n,s){for(var r=[],o=0;o<s;o++)r[o]=i[o+n];this.drawVertices(e,r,t.QUAD_TRIANGLES)}},{key:"drawVertices",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.QUAD_TRIANGLES;e!==this.lastTexture?(this.flush(),this.lastTexture=e):(this.verticesLength+i.length>this.mesh.getVertices().length||this.indicesLength+n.length>this.mesh.getIndices().length)&&this.flush();var s=this.mesh.numVertices();this.mesh.getVertices().set(i,this.verticesLength),this.verticesLength+=i.length,this.mesh.setVerticesLength(this.verticesLength);for(var r=this.mesh.getIndices(),o=this.indicesLength,a=0;a<n.length;o++,a++)r[o]=n[a]+s;this.indicesLength+=n.length,this.mesh.setIndicesLength(this.indicesLength)}},{key:"flush",value:function(){0!==this.verticesLength&&(this.lastTexture.bind(),this.mesh.draw(this.shader,this.context.TRIANGLES),this.verticesLength=0,this.indicesLength=0,this.mesh.setVerticesLength(0),this.mesh.setIndicesLength(0),this.drawCalls++)}},{key:"end",value:function(){if(!this.isDrawing)throw new Error("PolygonBatch is not drawing. Call PolygonBatch.begin() before calling PolygonBatch.end()");(this.verticesLength>0||this.indicesLength>0)&&this.flush(),this.shader.unbind(),this.lastTexture=null,this.isDrawing=!1,t.totalDrawCalls+=this.drawCalls;var e=this.context;e.disable(e.BLEND)}},{key:"getDrawCalls",value:function(){return this.drawCalls}},{key:"dispose",value:function(){this.mesh.dispose()}},{key:"setYDown",value:function(t){this.yDown=t}},{key:"draw",value:function(e,i,n,s,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,c=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,_=arguments.length>11&&void 0!==arguments[11]?arguments[11]:1,f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,d=arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,v=arguments.length>14&&void 0!==arguments[14]&&arguments[14],y=this.color;if(this.yDown){var p=_;_=d,d=p}i=i||0,n=n||0;var x=-o,g=(s=0===s?s:s||e.width)-o,b=s-o,S=-o,B=-a,w=-a,A=(r=0===r?r:r||e.height)-a,C=r-a;if(1!==h&&(x*=h,g*=h,b*=h,S*=h),1!==m&&(B*=m,w*=m,A*=m,C*=m),0!==u){var M=Math.cos(u),V=Math.sin(u),k=M*x-V*B,P=V*x+M*B,I=M*g-V*w,T=V*g+M*w,G=M*b-V*A,L=V*b+M*A,D=M*S-V*C,R=V*S+M*C;x=k,g=I,b=G,S=D,B=P,w=T,A=L,C=R}x+=i+o,g+=i+o,b+=i+o,S+=i+o,B+=n+a,w+=n+a,A+=n+a,C+=n+a;var F=c,E=_,O=f,z=d,j=O,q=E,N=F,X=z;v&&(this.yDown?(F=c,E=d,O=f,z=_,j=c,q=_,N=f,X=d):(F=f,E=_,O=c,z=d,j=f,q=d,N=c,X=_));var J=0;l[J++]=x,l[J++]=B,l[J++]=y.r,l[J++]=y.g,l[J++]=y.b,l[J++]=y.a,l[J++]=F,l[J++]=E,this.twoColorTint&&(l[J++]=0,l[J++]=0,l[J++]=0,l[J++]=0),l[J++]=g,l[J++]=w,l[J++]=y.r,l[J++]=y.g,l[J++]=y.b,l[J++]=y.a,l[J++]=j,l[J++]=q,this.twoColorTint&&(l[J++]=0,l[J++]=0,l[J++]=0,l[J++]=0),l[J++]=b,l[J++]=A,l[J++]=y.r,l[J++]=y.g,l[J++]=y.b,l[J++]=y.a,l[J++]=O,l[J++]=z,this.twoColorTint&&(l[J++]=0,l[J++]=0,l[J++]=0,l[J++]=0),l[J++]=S,l[J++]=C,l[J++]=y.r,l[J++]=y.g,l[J++]=y.b,l[J++]=y.a,l[J++]=N,l[J++]=X,this.twoColorTint&&(l[J++]=0,l[J++]=0,l[J++]=0,l[J]=0),this.drawVertices(e,l,t.QUAD_TRIANGLES)}}],[{key:"resetTotalDrawCalls",value:function(){t.totalDrawCalls=0}}]),t}();e.PolygonBatch=h,h.QUAD_TRIANGLES=[0,1,2,2,3,0],h.totalDrawCalls=0},1858:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Shader=void 0;var r=function(){function t(e,i,s){n(this,t),this.vertexShader=i,this.fragmentShader=s,this.vs=null,this.fs=null,this.program=null,this.tmp2x2=new Float32Array(4),this.tmp3x3=new Float32Array(9),this.tmp4x4=new Float32Array(16),this.vsSource=i,this.fsSource=s,this.context=e,this.compile()}return s(t,[{key:"getProgram",value:function(){return this.program}},{key:"getVertexShader",value:function(){return this.vertexShader}},{key:"getFragmentShader",value:function(){return this.fragmentShader}},{key:"getVertexShaderSource",value:function(){return this.vsSource}},{key:"getFragmentSource",value:function(){return this.fsSource}},{key:"compile",value:function(){var t=this.context;try{this.vs=this.compileShader(t.VERTEX_SHADER,this.vertexShader),this.fs=this.compileShader(t.FRAGMENT_SHADER,this.fragmentShader),this.program=this.compileProgram(this.vs,this.fs)}catch(e){throw this.dispose(),e}}},{key:"compileShader",value:function(t,e){var i=this.context,n=i.createShader(t);if(i.shaderSource(n,e),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS)){var s="Couldn't compile shader: "+i.getShaderInfoLog(n);if(i.deleteShader(n),!i.isContextLost())throw new Error(s)}return n}},{key:"compileProgram",value:function(t,e){var i=this.context,n=i.createProgram();if(i.attachShader(n,t),i.attachShader(n,e),i.linkProgram(n),!i.getProgramParameter(n,i.LINK_STATUS)){var s="Couldn't compile shader program: "+i.getProgramInfoLog(n);if(i.deleteProgram(n),!i.isContextLost())throw new Error(s)}return n}},{key:"restore",value:function(){this.compile()}},{key:"bind",value:function(){this.context.useProgram(this.program)}},{key:"unbind",value:function(){this.context.useProgram(null)}},{key:"setUniformi",value:function(t,e){this.context.uniform1i(this.getUniformLocation(t),e)}},{key:"setUniformf",value:function(t,e){this.context.uniform1f(this.getUniformLocation(t),e)}},{key:"setUniform2f",value:function(t,e,i){this.context.uniform2f(this.getUniformLocation(t),e,i)}},{key:"setUniform3f",value:function(t,e,i,n){this.context.uniform3f(this.getUniformLocation(t),e,i,n)}},{key:"setUniform4f",value:function(t,e,i,n,s){this.context.uniform4f(this.getUniformLocation(t),e,i,n,s)}},{key:"setUniform2x2f",value:function(t,e){var i=this.context;this.tmp2x2.set(e),i.uniformMatrix2fv(this.getUniformLocation(t),!1,this.tmp2x2)}},{key:"setUniform3x3f",value:function(t,e){var i=this.context;this.tmp3x3.set(e),i.uniformMatrix3fv(this.getUniformLocation(t),!1,this.tmp3x3)}},{key:"setUniform4x4f",value:function(t,e){var i=this.context;this.tmp4x4.set(e),i.uniformMatrix4fv(this.getUniformLocation(t),!1,this.tmp4x4)}},{key:"getUniformLocation",value:function(t){var e=this.context,i=e.getUniformLocation(this.program,t);if(!i&&!e.isContextLost())throw new Error("Couldn't find location for uniform ".concat(t));return i}},{key:"getAttributeLocation",value:function(t){var e=this.context,i=e.getAttribLocation(this.program,t);if(-1===i&&!e.isContextLost())throw new Error("Couldn't find location for attribute ".concat(t));return i}},{key:"dispose",value:function(){var t=this.context;this.vs&&(t.deleteShader(this.vs),this.vs=null),this.fs&&(t.deleteShader(this.fs),this.fs=null),this.program&&(t.deleteProgram(this.program),this.program=null)}}],[{key:"newColoredTextured",value:function(e){return new t(e,"\n         attribute vec4 ".concat(t.POSITION,";\n         attribute vec4 ").concat(t.COLOR,";\n         attribute vec2 ").concat(t.TEXCOORDS,";\n         uniform mat4 ").concat(t.MVP_MATRIX,";\n         varying vec4 v_color;\n         varying vec2 v_texCoords;\n \n         void main () {\n           v_color = ").concat(t.COLOR,";\n           v_texCoords = ").concat(t.TEXCOORDS,";\n           gl_Position = ").concat(t.MVP_MATRIX," * ").concat(t.POSITION,";\n         }\n       "),"\n         #ifdef GL_ES\n           #define LOWP lowp\n           precision mediump float;\n         #else\n           #define LOWP\n         #endif\n         varying LOWP vec4 v_color;\n         varying vec2 v_texCoords;\n         uniform sampler2D u_texture;\n \n         void main () {\n           gl_FragColor = v_color * texture2D(u_texture, v_texCoords);\n         }\n       ")}},{key:"newTwoColoredTextured",value:function(e){return new t(e,"\n         attribute vec4 ".concat(t.POSITION,";\n         attribute vec4 ").concat(t.COLOR,";\n         attribute vec4 ").concat(t.COLOR2,";\n         attribute vec2 ").concat(t.TEXCOORDS,";\n         uniform mat4 ").concat(t.MVP_MATRIX,";\n         varying vec4 v_light;\n         varying vec4 v_dark;\n         varying vec2 v_texCoords;\n \n         void main () {\n           v_light = ").concat(t.COLOR,";\n           v_dark = ").concat(t.COLOR2,";\n           v_texCoords = ").concat(t.TEXCOORDS,";\n           gl_Position = ").concat(t.MVP_MATRIX," * ").concat(t.POSITION,";\n         }\n       "),"\n         #ifdef GL_ES\n           #define LOWP lowp\n           precision mediump float;\n         #else\n           #define LOWP\n         #endif\n         varying LOWP vec4 v_light;\n         varying LOWP vec4 v_dark;\n         varying vec2 v_texCoords;\n         uniform sampler2D u_texture;\n \n         void main () {\n           vec4 texColor = texture2D(u_texture, v_texCoords);\n           gl_FragColor.a = texColor.a * v_light.a;\n           gl_FragColor.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n         }\n       ")}},{key:"newColored",value:function(e){return new t(e,"\n         attribute vec4 ".concat(t.POSITION,";\n         attribute vec4 ").concat(t.COLOR,";\n         uniform mat4 ").concat(t.MVP_MATRIX,";\n         varying vec4 v_color;\n \n         void main () {\n           v_color = ").concat(t.COLOR,";\n           gl_Position = ").concat(t.MVP_MATRIX," * ").concat(t.POSITION,";\n         }\n       "),"\n         #ifdef GL_ES\n           #define LOWP lowp\n           precision mediump float;\n         #else\n           #define LOWP\n         #endif\n         varying LOWP vec4 v_color;\n \n         void main () {\n           gl_FragColor = v_color;\n         }\n       ")}}]),t}();e.Shader=r,r.MVP_MATRIX="u_projTrans",r.POSITION="a_position",r.COLOR="a_color",r.COLOR2="a_color2",r.TEXCOORDS="a_texCoords",r.SAMPLER="u_texture"},2987:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.ShapeRenderer=e.ShapeType=void 0;var r,o=i(1514),a=i(1858),l=i(8606),u=i(2283);!function(t){t[t.Point=0]="Point",t[t.Line=1]="Line",t[t.Filled=4]="Filled"}(r=e.ShapeType||(e.ShapeType={}));var h=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10920;if(n(this,t),this.isDrawing=!1,this.shapeType=r.Filled,this.color=new l.Color(1,1,1,1),this.vertexIndex=0,this.tmp=new u.Vector2,this.projectionValues=new Float32Array(16),i>10920)throw new Error("Can't have more than 10920 triangles per batch: "+i);this.context=e,this.mesh=new o.Mesh(e,[new o.Position2Attribute,new o.ColorAttribute],i,0);var s=this.context;this.srcColorBlend=s.SRC_ALPHA,this.srcAlphaBlend=s.ONE,this.dstBlend=s.ONE_MINUS_SRC_ALPHA,this.shader=a.Shader.newColored(s)}return s(t,[{key:"setProjection",value:function(t){this.projectionValues=t}},{key:"begin",value:function(){if(this.isDrawing)throw new Error("ShapeRenderer.begin() has already been called");this.vertexIndex=0,this.isDrawing=!0,this.shader.bind(),this.shader.setUniform4x4f(a.Shader.MVP_MATRIX,this.projectionValues);var t=this.context;t.enable(t.BLEND),t.blendFuncSeparate(this.srcColorBlend,this.dstBlend,this.srcAlphaBlend,this.dstBlend)}},{key:"setBlendMode",value:function(t,e,i){(this.srcColorBlend=t,this.srcAlphaBlend=e,this.dstBlend=i,this.isDrawing)&&(this.flush(),this.context.blendFuncSeparate(t,i,e,i))}},{key:"setColor",value:function(t){this.color.setFromColor(t)}},{key:"setColorWith",value:function(t,e,i,n){this.color.set(t,e,i,n)}},{key:"point",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.check(r.Point,1),null===i&&(i=this.color),this.vertex(t,e,i)}},{key:"line",value:function(t,e,i,n){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.check(r.Line,2),null===s&&(s=this.color),this.vertex(t,e,s),this.vertex(i,n,s)}},{key:"triangle",value:function(t,e,i,n,s,o,a){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null;this.check(t?r.Filled:r.Line,3),null===l&&(l=this.color),null===u&&(u=this.color),null===h&&(h=this.color),t?(this.vertex(e,i,l),this.vertex(n,s,u),this.vertex(o,a,h)):(this.vertex(e,i,l),this.vertex(n,s,u),this.vertex(n,s,l),this.vertex(o,a,u),this.vertex(o,a,l),this.vertex(e,i,u))}},{key:"quad",value:function(t,e,i,n,s,o,a,l,u){var h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,m=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,c=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,_=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null;this.check(t?r.Filled:r.Line,3),null===h&&(h=this.color),null===m&&(m=this.color),null===c&&(c=this.color),null===_&&(_=this.color),t?(this.vertex(e,i,h),this.vertex(n,s,m),this.vertex(o,a,c),this.vertex(o,a,c),this.vertex(l,u,_),this.vertex(e,i,h)):(this.vertex(e,i,h),this.vertex(n,s,m),this.vertex(n,s,m),this.vertex(o,a,c),this.vertex(o,a,c),this.vertex(l,u,_),this.vertex(l,u,_),this.vertex(e,i,h))}},{key:"rect",value:function(t,e,i,n,s){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;this.quad(t,e,i,e+n,i,e+n,i+s,e,i+s,r,r,r,r)}},{key:"rectLine",value:function(t,e,i,n,s,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.check(t?r.Filled:r.Line,8),null===a&&(a=this.color);var l=this.tmp.set(s-i,e-n);l.nor(),o*=.5;var u=l.x*o,h=l.y*o;t?(this.vertex(e+u,i+h,a),this.vertex(e-u,i-h,a),this.vertex(n+u,s+h,a),this.vertex(n-u,s-h,a),this.vertex(n+u,s+h,a),this.vertex(e-u,i-h,a)):(this.vertex(e+u,i+h,a),this.vertex(e-u,i-h,a),this.vertex(n+u,s+h,a),this.vertex(n-u,s-h,a),this.vertex(n+u,s+h,a),this.vertex(e+u,i+h,a),this.vertex(n-u,s-h,a),this.vertex(e-u,i-h,a))}},{key:"x",value:function(t,e,i){this.line(t-i,e-i,t+i,e+i),this.line(t-i,e+i,t+i,e-i)}},{key:"polygon",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(i<3)throw new Error("Polygon must contain at least 3 vertices");this.check(r.Line,2*i),null===n&&(n=this.color),i<<=1;for(var s=t[e<<=1],o=t[e+1],a=e+i,l=e,u=e+i-2;l<u;l+=2){var h=t[l],m=t[l+1],c=0,_=0;l+2>=a?(c=s,_=o):(c=t[l+2],_=t[l+3]),this.vertex(h,m,n),this.vertex(c,_,n)}}},{key:"circle",value:function(t,e,i,n){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(0===o&&(o=Math.max(1,6*l.MathUtils.cbrt(n)|0)),o<=0)throw new Error("segments must be > 0.");null===s&&(s=this.color);var a=2*l.MathUtils.PI/o,u=Math.cos(a),h=Math.sin(a),m=n,c=0;if(t){this.check(r.Filled,3*o+3),o--;for(var _=0;_<o;_++){this.vertex(e,i,s),this.vertex(e+m,i+c,s);var f=m;m=u*m-h*c,c=h*f+u*c,this.vertex(e+m,i+c,s)}this.vertex(e,i,s),this.vertex(e+m,i+c,s)}else{this.check(r.Line,2*o+2);for(var d=0;d<o;d++){this.vertex(e+m,i+c,s);var v=m;m=u*m-h*c,c=h*v+u*c,this.vertex(e+m,i+c,s)}this.vertex(e+m,i+c,s)}m=n,c=0,this.vertex(e+m,i+c,s)}},{key:"curve",value:function(t,e,i,n,s,o,a,l,u){var h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null;this.check(r.Line,2*u+2),null===h&&(h=this.color);for(var m=1/u,c=m*m,_=m*m*m,f=3*m,d=3*c,v=6*c,y=6*_,p=t-2*i+s,x=e-2*n+o,g=3*(i-s)-t+a,b=3*(n-o)-e+l,S=t,B=e,w=(i-t)*f+p*d+g*_,A=(n-e)*f+x*d+b*_,C=p*v+g*y,M=x*v+b*y,V=g*y,k=b*y;u-- >0;)this.vertex(S,B,h),S+=w,B+=A,w+=C,A+=M,C+=V,M+=k,this.vertex(S,B,h);this.vertex(S,B,h),this.vertex(a,l,h)}},{key:"vertex",value:function(t,e,i){var n=this.vertexIndex,s=this.mesh.getVertices();s[n++]=t,s[n++]=e,s[n++]=i.r,s[n++]=i.g,s[n++]=i.b,s[n++]=i.a,this.vertexIndex=n}},{key:"end",value:function(){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");this.flush();var t=this.context;t.disable(t.BLEND),this.isDrawing=!1}},{key:"flush",value:function(){0!==this.vertexIndex&&(this.mesh.setVerticesLength(this.vertexIndex),this.mesh.draw(this.shader,this.shapeType),this.vertexIndex=0)}},{key:"check",value:function(t,e){if(!this.isDrawing)throw new Error("ShapeRenderer.begin() has not been called");if(this.shapeType===t){if(!(this.mesh.maxVertices()-this.mesh.numVertices()<e))return;this.flush()}else this.flush(),this.shapeType=t}},{key:"dispose",value:function(){this.mesh.dispose()}}]),t}();e.ShapeRenderer=h},5297:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Sprite=void 0;var r=i(8606),o=i(2283),a=function(){function t(e){n(this,t),this.region=e,this.dirty=!1,this.position=new o.Vector2(0,0),this.size=new o.Vector2(0,0),this.origin=new o.Vector2(0,0),this.scale=new o.Vector2(1,1),this.color=new r.Color(1,1,1,1),this.rotation=0,this.vertices=new Float32Array(48),this.bounds={x:0,y:0,width:0,height:0},this.setSize(e.width,e.height),this.setOrigin(e.width/2,e.height/2)}return s(t,[{key:"set",value:function(t){this.region=t.region,this.position.setVector(t.position),this.size.setVector(t.size),this.origin.setVector(t.origin),this.rotation=t.rotation,this.scale.setVector(t.scale),this.color.setFromColor(t.color),this.dirty=!0}},{key:"setBounds",value:function(t,e,i,n){this.setPosition(t,e),this.setSize(t,e),this.dirty=!0}},{key:"setSize",value:function(t,e){this.size.set(t,e),this.dirty=!0}},{key:"setPosition",value:function(t,e){this.position.set(t,e),this.dirty=!0}},{key:"setOriginBasedPosition",value:function(t,e){this.setPosition(t-this.origin.x,e-this.origin.y)}},{key:"setX",value:function(t){this.position.x=t,this.dirty=!0}},{key:"setY",value:function(t){this.position.y=t,this.dirty=!0}},{key:"setCenterX",value:function(t){this.setX(t-this.size.x/2)}},{key:"setCenterY",value:function(t){this.setY(t-this.size.y/2)}},{key:"setCenter",value:function(t,e){this.setPosition(t-this.size.x/2,e-this.size.y/2)}},{key:"translateX",value:function(t){this.translate(t,0)}},{key:"translateY",value:function(t){this.translate(0,t)}},{key:"translate",value:function(t,e){this.position.add(t,e),this.dirty=!0}},{key:"setColor",value:function(t){this.color.setFromColor(t),this.dirty=!0}},{key:"setAlpha",value:function(t){this.color.a=t,this.dirty=!0}},{key:"setOrigin",value:function(t,e){this.origin.set(t,e),this.dirty=!0}},{key:"setOriginCenter",value:function(){this.origin.set(this.size.x/2,this.size.y/2),this.dirty=!0}},{key:"setRotation",value:function(t){this.rotation=t,this.dirty=!0}},{key:"getRotation",value:function(){return this.rotation}},{key:"rotate",value:function(t){0!==t&&(this.rotation+=t,this.dirty=!0)}},{key:"setScale",value:function(t,e){this.scale.set(t,e),this.dirty=!0}},{key:"applyScale",value:function(t){this.scale.scale(t),this.dirty=!0}},{key:"getVertices",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.vertices,i=this.region;if(!this.dirty)return e;var n=this.position.x,s=this.position.y,r=this.size.x,o=this.size.y,a=this.origin.x,l=this.origin.y,u=this.rotation,h=this.scale.x,m=this.scale.y,c=i.u,_=i.v,f=i.u2,d=i.v2,v=this.color,y=i.rotated,p=r/i.originalWidth,x=o/i.originalHeight,g=i.width*p,b=i.height*x,S=n+i.offsetX*p;if(n=S,s=t?s+o-i.offsetY*x-b:s+i.offsetY*x,t){var B=_;_=d,d=B}var w=-a,A=(r=g)-a,C=r-a,M=-a,V=-l,k=-l,P=(o=b)-l,I=o-l;if(1!==h&&(w*=h,A*=h,C*=h,M*=h),1!==m&&(V*=m,k*=m,P*=m,I*=m),0!==u){var T=Math.cos(u),G=Math.sin(u),L=T*w-G*V,D=G*w+T*V,R=T*A-G*k,F=G*A+T*k,E=T*C-G*P,O=G*C+T*P,z=T*M-G*I,j=G*M+T*I;w=L,A=R,C=E,M=z,V=D,k=F,P=O,I=j}w+=n+a,A+=n+a,C+=n+a,M+=n+a,V+=s+l,k+=s+l,P+=s+l,I+=s+l;var q=c,N=_,X=f,J=d,W=X,U=N,H=q,Z=J;y&&(t?(q=c,N=d,X=f,J=_,W=c,U=_,H=f,Z=d):(q=f,N=_,X=c,J=d,W=f,U=d,H=c,Z=_));var Y=0;return e[Y++]=w,e[Y++]=V,e[Y++]=v.r,e[Y++]=v.g,e[Y++]=v.b,e[Y++]=v.a,e[Y++]=q,e[Y++]=N,e[Y++]=0,e[Y++]=0,e[Y++]=0,e[Y++]=0,e[Y++]=A,e[Y++]=k,e[Y++]=v.r,e[Y++]=v.g,e[Y++]=v.b,e[Y++]=v.a,e[Y++]=W,e[Y++]=U,e[Y++]=0,e[Y++]=0,e[Y++]=0,e[Y++]=0,e[Y++]=C,e[Y++]=P,e[Y++]=v.r,e[Y++]=v.g,e[Y++]=v.b,e[Y++]=v.a,e[Y++]=X,e[Y++]=J,e[Y++]=0,e[Y++]=0,e[Y++]=0,e[Y++]=0,e[Y++]=M,e[Y++]=I,e[Y++]=v.r,e[Y++]=v.g,e[Y++]=v.b,e[Y++]=v.a,e[Y++]=H,e[Y++]=Z,e[Y++]=0,e[Y++]=0,e[Y++]=0,e[Y]=0,e}},{key:"getBoundingRectangle",value:function(){var t=this.vertices,e=t[0],i=t[1],n=t[0],s=t[1];return e=(e=(e=e>t[12]?t[12]:e)>t[24]?t[24]:e)>t[36]?t[36]:e,n=(n=(n=n<t[12]?t[12]:n)<t[24]?t[24]:n)<t[36]?t[36]:n,i=(i=(i=i>t[13]?t[13]:i)>t[25]?t[25]:i)>t[37]?t[37]:i,s=(s=(s=s<t[13]?t[13]:s)<t[25]?t[25]:s)<t[37]?t[37]:s,this.bounds.x=e,this.bounds.y=i,this.bounds.width=n-e,this.bounds.height=s-i,this.bounds}},{key:"draw",value:function(t){t.drawVertices(this.region.texture,this.getVertices(t.yDown))}},{key:"drawWithAlpha",value:function(t,e){var i=this.getColor().a;this.setAlpha(i*e),this.draw(t),this.setAlpha(i)}},{key:"getX",value:function(){return this.position.x}},{key:"getY",value:function(){return this.position.y}},{key:"getWidth",value:function(){return this.size.x}},{key:"getHeight",value:function(){return this.size.y}},{key:"getOriginX",value:function(){return this.origin.x}},{key:"getOriginY",value:function(){return this.origin.y}},{key:"getScaleX",value:function(){return this.scale.x}},{key:"getScaleY",value:function(){return this.scale.y}},{key:"getColor",value:function(){return this.color}}]),t}();e.Sprite=a},7139:function(t,e,i){"use strict";var n,s=i(6690).default,r=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Texture=e.TextureWrap=e.TextureFilter=void 0,function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(n=e.TextureFilter||(e.TextureFilter={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(e.TextureWrap||(e.TextureWrap={}));var o=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s(this,t),this.texture=null,this.boundUnit=0,this.useMipMaps=!1,this.width=0,this.height=0,this._image=i,this.context=e,this.useMipMaps=n,this.restore(),this.width=i.width,this.height=i.height}return r(t,[{key:"getImage",value:function(){return this._image}},{key:"getWebGLTexture",value:function(){return this.texture}},{key:"setFilters",value:function(e,i){var n=this.context;this.bind(),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t.validateMagFilter(i))}},{key:"setWraps",value:function(t,e){var i=this.context;this.bind(),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e)}},{key:"update",value:function(e){var i=this.context;this.texture||(this.texture=this.context.createTexture()),this.bind(),t.DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL&&i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,this._image),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,e?i.LINEAR_MIPMAP_LINEAR:i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),e&&i.generateMipmap(i.TEXTURE_2D)}},{key:"restore",value:function(){this.texture=null,this.update(this.useMipMaps)}},{key:"bind",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.context;this.boundUnit=t,e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this.texture)}},{key:"unbind",value:function(){var t=this.context;t.activeTexture(t.TEXTURE0+this.boundUnit),t.bindTexture(t.TEXTURE_2D,null)}},{key:"dispose",value:function(){this.context.deleteTexture(this.texture)}}],[{key:"load",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise((function(s){var r=new Image;r.onload=function(){s(new t(e,r,n))},r.src=i}))}},{key:"validateMagFilter",value:function(t){switch(t){case n.MipMap:case n.MipMapLinearLinear:case n.MipMapLinearNearest:case n.MipMapNearestLinear:case n.MipMapNearestNearest:return n.Linear;default:return t}}}]),t}();e.Texture=o,o.DISABLE_UNPACK_PREMULTIPLIED_ALPHA_WEBGL=!1},9396:function(t,e,i){"use strict";var n=i(7061).default,s=i(7424).default,r=i(4704).default,o=i(6690).default,a=i(9728).default,l=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{l(n.next(t))}catch(e){r(e)}}function a(t){try{l(n.throw(t))}catch(e){r(e)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}l((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.TextureAtlas=void 0;var u=i(7139),h=i(859);function m(t,e){for(var i=t.split("/"),n=e.split("/"),s=[],r=0,o=i.length;r<o;r++)if(".."===i[r])s.pop();else{if("."===i[r])continue;s.push(i[r])}for(var a=0,l=n.length;a<l;a++)if(".."===n[a])s.pop();else{if("."===n[a])continue;s.push(n[a])}return s.join("/")}var c=function(){function t(e,i){o(this,t),this.pages=e,this.regions=i}return a(t,[{key:"dispose",value:function(){var t,e=r(this.pages);try{for(e.s();!(t=e.n()).done;){t.value.dispose()}}catch(i){e.e(i)}finally{e.f()}}},{key:"getPages",value:function(){return this.pages}},{key:"getRegions",value:function(){return this.regions}},{key:"findRegion",value:function(t,e){for(var i=0;i<this.regions.length;i++){var n=this.regions[i];if(n.name===t&&(void 0===e||n.index===e))return n}return null}},{key:"findRegions",value:function(t){return this.regions.filter((function(e){return e.name===t})).sort((function(t,e){return t.index-e.index}))}}],[{key:"load",value:function(e,i,r){return l(this,void 0,void 0,n().mark((function o(){var a,l,c,_,f,d,v,y,p,x,g,b,S,B,w,A,C,M,V,k,P,I,T,G,L,D,R,F,E,O,z,j,q,N,X,J,W,U,H,Z,Y;return n().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch(i).then((function(t){return t.text()}));case 2:a=n.sent,l=[],c=[],_=[],d=a.split(/\r?\n/),v=0;case 8:if(void 0!==(p=d[v])){n.next=12;break}return n.abrupt("break",16);case 12:0===p.trim().length?f=null:null===f?(x=m(i,"../".concat(p)),v++,p=d[v],y=p.split(":")[1].split(",").map((function(t){return t.trim()})),g=parseInt(y[0],10),b=parseInt(y[1],10),v++,p=d[v],y=p.split(":")[1].split(",").map((function(t){return t.trim()})),S=y[0],v++,p=d[v],y=p.split(":")[1].split(",").map((function(t){return t.trim()})),B=s(y,2),w=B[0],A=B[1],v++,p=d[v],y=p.split(":")[1].split(",").map((function(t){return t.trim()})),C=y[0],M=u.TextureWrap.ClampToEdge,V=u.TextureWrap.ClampToEdge,"x"===C?M=u.TextureWrap.Repeat:"y"===C?V=u.TextureWrap.Repeat:"xy"===C&&(M=u.TextureWrap.Repeat,V=u.TextureWrap.Repeat),f={file:x,width:g,height:b,format:S,mipMaps:"Nearest"!==w&&"Linear"!==w,min:w,max:A,direction:C,repeatX:M,repeatY:V},l.push(f)):(k=p,v++,p=d[v],y=p.split(":")[1].split(",").map((function(t){return t.trim()})),P="true"===y[0],v++,p=d[v],y=p.split(":")[1].split(",").map((function(t){return t.trim()})),I=parseInt(y[0],10),T=parseInt(y[1],10),v++,p=d[v],y=p.split(":")[1].split(",").map((function(t){return t.trim()})),G=parseInt(y[0],10),L=parseInt(y[1],10),D={name:k,rotate:P,left:I,top:T,width:G,height:L,page:f},v++,p=d[v],4===(y=p.split(":")[1].split(",").map((function(t){return t.trim()}))).length&&(D.splits=y.map((function(t){return parseInt(t,10)})),v++,p=d[v],4===(y=p.split(":")[1].split(",").map((function(t){return t.trim()}))).length&&(D.pads=y.map((function(t){return parseInt(t,10)})),v++,p=d[v],y=p.split(":")[1].split(",").map((function(t){return t.trim()})))),D.originalWidth=parseInt(y[0],10),D.originalHeight=parseInt(y[1],10),v++,p=d[v],y=p.split(":")[1].split(",").map((function(t){return t.trim()})),D.offsetX=parseInt(y[0],10),D.offsetY=parseInt(y[1],10),v++,p=d[v],y=p.split(":")[1].split(",").map((function(t){return t.trim()})),D.index=parseInt(y[0],10),_.push(D)),v++,n.next=8;break;case 16:R=0,F=l;case 17:if(!(R<F.length)){n.next=27;break}return E=F[R],n.next=21,u.Texture.load(e,E.file,r);case 21:E.texture=n.sent,E.invTexWidth=1/E.texture.width,E.invTexHeight=1/E.texture.height;case 24:R++,n.next=17;break;case 27:for(O=[],z=0,j=_;z<j.length;z++)q=j[z],N=q.left,X=q.top,J=q.rotate?q.height:q.width,W=q.rotate?q.width:q.height,U=q.page,H=U.texture,Z=U.invTexWidth,Y=U.invTexHeight,O.push(new h.TextureRegion(H,N,X,J,W,q,Z,Y,q.rotate));return n.abrupt("return",new t(c,O));case 30:case"end":return n.stop()}}),o)})))}}]),t}();e.TextureAtlas=c},859:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.TextureRegion=void 0;var r=function(){function t(e,i,s,r,o,a,l,u){var h=arguments.length>8&&void 0!==arguments[8]&&arguments[8];n(this,t),this.name=null,this.index=0,this.texture=null,this.regionX=0,this.regionY=0,this.width=0,this.height=0,this.invTexWidth=0,this.invTexHeight=0,this.originalWidth=0,this.originalHeight=0,this.offsetX=0,this.offsetY=0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.rotated=!1,l&&u||(l=1/e.width,u=1/e.height);var m=i*l,c=(s+o)*u,_=(i+r)*l,f=s*u;for(var d in this.texture=e,this.regionX=i,this.regionY=s,this.width=r,this.height=o,this.originalWidth=r,this.originalHeight=o,this.offsetX=0,this.offsetY=0,this.u=m,this.v=c,this.u2=_,this.v2=f,this.rotated=h,a)this[d]=a[d]}return s(t,[{key:"draw",value:function(t,e,i,n,s){var r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1,h=this.originalWidth,m=this.originalHeight,c=this.offsetX,_=this.offsetY,f=this.width,d=this.height,v=n/h,y=s/m,p=f*v,x=d*y,g=e+c*v,b=0;r-=g-e,o-=(b=t.yDown?i+s-_*y-x:i+_*y)-i,t.draw(this.texture,g,b,p,x,r,o,a,l,u,this.u,this.v,this.u2,this.v2,this.rotated)}}],[{key:"splitTexture",value:function(e,i,n){for(var s=e.width/i,r=e.height/n,o=[],a=0;a<n;a++)for(var l=0;l<i;l++)o.push(new t(e,l*s,a*r,s,r,{}));return o}}]),t}();e.TextureRegion=r},8606:function(t,e,i){"use strict";var n,s=i(1655).default,r=i(6389).default,o=i(6690).default,a=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.copyArray=e.createStage=e.pointInRect=e.resizeCanvas=e.createGameLoop=e.WindowedMean=e.TimeKeeper=e.Pools=e.Pool=e.Utils=e.PowOut=e.Pow=e.Interpolation=e.MathUtils=e.Color=e.StringSet=e.IntSet=e.Align=void 0;var l=function(){function t(){o(this,t)}return a(t,null,[{key:"isLeft",value:function(t){return 0!==(t&this.left)}},{key:"isRight",value:function(t){return 0!==(t&this.right)}},{key:"isTop",value:function(t){return 0!==(t&this.top)}},{key:"isBottom",value:function(t){return 0!==(t&this.bottom)}},{key:"isCenterVertical",value:function(t){return 0===(t&this.top)&&0===(t&this.bottom)}},{key:"isCenterHorizontal",value:function(t){return 0===(t&this.left)&&0===(t&this.right)}}]),t}();e.Align=l,n=l,l.center=1,l.top=2,l.bottom=4,l.left=8,l.right=16,l.topLeft=n.top|n.left,l.topRight=n.top|n.right,l.bottomLeft=n.bottom|n.left,l.bottomRight=n.bottom|n.right;var u=function(){function t(){o(this,t),this.array=new Array}return a(t,[{key:"add",value:function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e}},{key:"contains",value:function(t){return void 0!==this.array[0|t]}},{key:"remove",value:function(t){this.array[0|t]=void 0}},{key:"clear",value:function(){this.array.length=0}}]),t}();e.IntSet=u;var h=function(){function t(){o(this,t),this.entries={},this.size=0}return a(t,[{key:"add",value:function(t){var e=this.entries[t];return this.entries[t]=!0,!e&&(this.size++,!0)}},{key:"addAll",value:function(t){for(var e=this.size,i=0,n=t.length;i<n;i++)this.add(t[i]);return e!==this.size}},{key:"contains",value:function(t){return this.entries[t]}},{key:"clear",value:function(){this.entries={},this.size=0}}]),t}();e.StringSet=h;var m=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;o(this,t),this.r=e,this.g=i,this.b=n,this.a=s}return a(t,[{key:"unsafeSet",value:function(t,e,i,n){this.r=t,this.g=e,this.b=i,this.a=n}},{key:"set",value:function(t,e,i,n){return this.r=t,this.g=e,this.b=i,this.a=n,this.clamp()}},{key:"setFromColor",value:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}},{key:"setFromString",value:function(t){return t="#"===t.charAt(0)?t.substring(1):t,this.r=parseInt(t.substring(0,2),16)/255,this.g=parseInt(t.substring(2,4),16)/255,this.b=parseInt(t.substring(4,6),16)/255,this.a=8!==t.length?1:parseInt(t.substring(6,8),16)/255,this}},{key:"add",value:function(t,e,i,n){return this.r+=t,this.g+=e,this.b+=i,this.a+=n,this.clamp()}},{key:"clamp",value:function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}},{key:"toIntBits",value:function(){return 255*this.a<<24|255*this.b<<16|255*this.g<<8|255*this.r}}],[{key:"rgba8888ToColor",value:function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}},{key:"rgb888ToColor",value:function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}},{key:"fromString",value:function(e){return(new t).setFromString(e)}}]),t}();e.Color=m,m.WHITE=new m(1,1,1,1),m.RED=new m(1,0,0,1),m.GREEN=new m(0,1,0,1),m.BLUE=new m(0,0,1,1),m.MAGENTA=new m(1,0,1,1);var c=function(){function t(){o(this,t)}return a(t,null,[{key:"clamp",value:function(t,e,i){return t<e?e:t>i?i:t}},{key:"cosDeg",value:function(e){return Math.cos(e*t.degRad)}},{key:"sinDeg",value:function(e){return Math.sin(e*t.degRad)}},{key:"signum",value:function(t){return t>0?1:t<0?-1:0}},{key:"toInt",value:function(t){return t>0?Math.floor(t):Math.ceil(t)}},{key:"cbrt",value:function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}},{key:"randomTriangular",value:function(e,i){return t.randomTriangularWith(e,i,.5*(e+i))}},{key:"randomTriangularWith",value:function(t,e,i){var n=Math.random(),s=e-t;return n<=(i-t)/s?t+Math.sqrt(n*s*(i-t)):e-Math.sqrt((1-n)*s*(e-i))}},{key:"isPowerOfTwo",value:function(t){return t&&0===(t&t-1)}}]),t}();e.MathUtils=c,c.PI=3.1415927,c.PI2=2*c.PI,c.radiansToDegrees=180/c.PI,c.radDeg=c.radiansToDegrees,c.degreesToRadians=c.PI/180,c.degRad=c.degreesToRadians;var _=function(){function t(){o(this,t)}return a(t,[{key:"apply",value:function(t,e,i){return t+(e-t)*this.applyInternal(i)}}]),t}();e.Interpolation=_;var f=function(t){s(i,t);var e=r(i);function i(t){var n;return o(this,i),(n=e.call(this)).power=2,n.power=t,n}return a(i,[{key:"applyInternal",value:function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2===0?-2:2)+1}}]),i}(_);e.Pow=f;var d=function(t){s(i,t);var e=r(i);function i(){return o(this,i),e.apply(this,arguments)}return a(i,[{key:"applyInternal",value:function(t){return Math.pow(t-1,this.power)*(this.power%2===0?-1:1)+1}}]),i}(f);e.PowOut=d;var v=function(){function t(){o(this,t)}return a(t,null,[{key:"arrayCopy",value:function(t,e,i,n,s){for(var r=e,o=n;r<e+s;r++,o++)i[o]=t[r]}},{key:"arrayFill",value:function(t,e,i,n){for(var s=e;s<i;s++)t[s]=n}},{key:"setArraySize",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t.length;if(n===e)return t;if(t.length=e,n<e)for(var s=n;s<e;s++)t[s]=i;return t}},{key:"ensureArrayCapacity",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.length>=i?e:t.setArraySize(e,i,n)}},{key:"newArray",value:function(t,e){for(var i=new Array(t),n=0;n<t;n++)i[n]=e;return i}},{key:"newFloatArray",value:function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);for(var i=new Array(e),n=0;n<i.length;n++)i[n]=0;return i}},{key:"newShortArray",value:function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);for(var i=new Array(e),n=0;n<i.length;n++)i[n]=0;return i}},{key:"toFloatArray",value:function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e}},{key:"toSinglePrecision",value:function(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e}},{key:"contains",value:function(t,e){for(var i=0;i<t.length;i++)if(t[i]===e)return!0;return!1}},{key:"enumValue",value:function(t,e){return t[e[0].toUpperCase()+e.slice(1)]}}]),t}();e.Utils=v,v.SUPPORTS_TYPED_ARRAYS="undefined"!==typeof Float32Array;var y=function(){function t(e){o(this,t),this.items=new Array,this.instantiator=e||function(){return{}}}return a(t,[{key:"obtain",value:function(){return this.items.length>0?this.items.pop():this.instantiator()}},{key:"free",value:function(t){(null===t||void 0===t?void 0:t.reset)&&t.reset(),this.items.push(t)}},{key:"freeAll",value:function(t){for(var e=0;e<t.length;e++)this.free(t[e])}},{key:"clear",value:function(){this.items.length=0}}]),t}();e.Pool=y;var p=function(){function t(){o(this,t)}return a(t,null,[{key:"free",value:function(t,e){this.pools[t]&&this.pools[t].free(e)}},{key:"freeAll",value:function(t,e){this.pools[t]&&this.pools[t].freeAll(e)}},{key:"get",value:function(t,e){return this.pools[t]||(this.pools[t]=new y(e)),this.pools[t]}},{key:"set",value:function(t,e){this.pools[t]=e}},{key:"obtain",value:function(t,e){return this.get(t,e).obtain()}}]),t}();e.Pools=p,p.pools={};var x=function(){function t(){o(this,t),this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}return a(t,[{key:"update",value:function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)}}]),t}();e.TimeKeeper=x;var g=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;o(this,t),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(e)}return a(t,[{key:"hasEnoughData",value:function(){return this.addedValues>=this.values.length}},{key:"addValue",value:function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0}},{key:"getMean",value:function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0}}]),t}();e.WindowedMean=g;e.createGameLoop=function(t){var e,i=Date.now(),n=0,s=!0,r=0,o=0;function a(){if(s){var l=Date.now()-i;i=Date.now(),r++,(o+=l)>=1e3&&(n=r,r=0,o-=1e3),e=requestAnimationFrame(a),t(l/1e3)}}return a(),{isRunning:function(){return s},start:function(){s||(s=!0,a())},stop:function(){e&&cancelAnimationFrame(e),s=!1},getFps:function(){return n}}};e.resizeCanvas=function(t,e){var i=e||window.devicePixelRatio||1,n=t.clientWidth*i,s=t.clientHeight*i;return t.width===n&&t.height===s||(t.width=n,t.height=s),[n,s]};e.pointInRect=function(t,e,i,n,s,r){return t>i&&t<i+s&&e>n&&e<n+r};e.createStage=function(t){t=Object.assign(Object.assign({},{hidden:!1,info:!0}),t);var e=document.createElement("div");e.setAttribute("style","position:fixed;top:0;left:0;right:0;bottom:0;"),t.wrapperClassName&&(e.className=t.wrapperClassName),t.hidden&&(e.style.display="none");var i=document.createElement("canvas");i.setAttribute("style","width:100%;height:100%;");var n=document.createElement("div");return n.setAttribute("style","position:absolute;top:1em;left:1em;color:white"),t.info||(n.style.display="none"),e.appendChild(i),e.appendChild(n),document.body.appendChild(e),{getCanvas:function(){return i},getInfo:function(){return n},show:function(){return e.style.display="block"},hide:function(){return e.style.display="none"},cleanup:function(){return document.body.removeChild(e)}}};e.copyArray=function(t,e){for(var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.length,r=0;r<s;r++)e[i+r]=t[n+r]}},2283:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Vector2=void 0;var r=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;n(this,t),this.x=0,this.y=0,this.x=e,this.y=i}return s(t,[{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"set",value:function(t,e){return this.x=t,this.y=e,this}},{key:"setVector",value:function(t){return this.set(t.x,t.y)}},{key:"add",value:function(t,e){return this.x+=t,this.y+=e,this}},{key:"addVector",value:function(t){return this.add(t.x,t.y)}},{key:"sub",value:function(t,e){return this.add(-t,-e)}},{key:"subVector",value:function(t){return this.sub(t.x,t.y)}},{key:"scale",value:function(t){return this.x*=t,this.y*=t,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"distanceSqr",value:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSqr(t))}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"len2",value:function(){return this.x*this.x+this.y*this.y}},{key:"len",value:function(){return Math.sqrt(this.len2())}},{key:"nor",value:function(){var t=this.len();return 0!==t&&(this.x/=t,this.y/=t),this}},{key:"rotateRad",value:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.x*e-this.y*i,s=this.x*i+this.y*e;return this.x=n,this.y=s,this}},{key:"rotate",value:function(t){return this.rotateRad(t*Math.PI/180)}},{key:"cpy",value:function(){return new t(this.x,this.y)}}]),t}();e.Vector2=r},7811:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.Vector3=void 0;var r=i(4995),o=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n(this,t),this.x=0,this.y=0,this.z=0,this.x=e,this.y=i,this.z=s}return s(t,[{key:"setFrom",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"set",value:function(t,e,i){return this.x=t,this.y=e,this.z=i,this}},{key:"add",value:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}},{key:"sub",value:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}},{key:"scale",value:function(t){return this.x*=t,this.y*=t,this.z*=t,this}},{key:"normalize",value:function(){var t=this.length();return 0===t||(t=1/t,this.x*=t,this.y*=t,this.z*=t),this}},{key:"cross",value:function(t){return this.set(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}},{key:"multiply",value:function(t){var e=t.values;return this.set(this.x*e[r.M00]+this.y*e[r.M01]+this.z*e[r.M02]+e[r.M03],this.x*e[r.M10]+this.y*e[r.M11]+this.z*e[r.M12]+e[r.M13],this.x*e[r.M20]+this.y*e[r.M21]+this.z*e[r.M22]+e[r.M23])}},{key:"project",value:function(t){var e=t.values,i=1/(this.x*e[r.M30]+this.y*e[r.M31]+this.z*e[r.M32]+e[r.M33]);return this.set((this.x*e[r.M00]+this.y*e[r.M01]+this.z*e[r.M02]+e[r.M03])*i,(this.x*e[r.M10]+this.y*e[r.M11]+this.z*e[r.M12]+e[r.M13])*i,(this.x*e[r.M20]+this.y*e[r.M21]+this.z*e[r.M22]+e[r.M23])*i)}},{key:"unproject",value:function(t,e,i,n,s,r){var o=this.x,a=this.y,l=this.z;return o-=i,a=r-a-1,a-=n,t.set(2*o/s-1,2*a/r-1,2*l-1),t.project(e),t}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distance",value:function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return Math.sqrt(e*e+i*i+n*n)}}]),t}();e.Vector3=o},5533:function(t,e,i){"use strict";var n=i(4704).default,s=i(7424).default;Object.defineProperty(e,"__esModule",{value:!0}),e.createViewport=void 0;var r=i(7459),o=i(8606);e.createViewport=function(t,e,i,a){var l,u={autoUpdate:!0,pixelRatio:void 0,crop:!0};(a=Object.assign(Object.assign({},u),a)).disablePremultipliedAlpha&&(l={premultipliedAlpha:!1}),l=Object.assign(Object.assign({},l),a.contextOption);var h,m=t.getContext("webgl2",l),c=[],_=a,f=_.autoUpdate,d=_.pixelRatio,v=_.crop,y={pixelRatio:d=d||window.devicePixelRatio||1,x:0,y:0,width:e,height:i,worldWidth:e,worldHeight:i},p=(0,o.resizeCanvas)(t,d),x=s(p,2),g=x[0],b=x[1],S=new r.OrthoCamera(e,i,g,b);f&&(h=function(t){B.update()},window.addEventListener("resize",h));var B={getViewportInfo:function(){return y},getCamera:function(){return S},addCamera:function(t){c.push(t)},getContext:function(){return m},getCanvas:function(){return t},update:function(){var r=(0,o.resizeCanvas)(t,d),a=s(r,2),l=a[0],u=a[1],h=e/i,_=l/u;if(v){var f,p;h<_?(p=u,f=u*h):(f=l,p=l/h);var x=(l-f)/2,g=(u-p)/2;y.x=x,y.y=g,y.width=f,y.height=p,m.viewport(x,g,f,p),S.setPosition(e/2,i/2),S.resize(e,i,f,p);var b,B=n(c);try{for(B.s();!(b=B.n()).done;){var w=b.value;w.setPosition(e/2,i/2),w.resize(e,i,f,p)}}catch(T){B.e(T)}finally{B.f()}}else{var A,C,M,V;y.x=0,y.y=0,y.width=l,y.height=u,m.viewport(0,0,l,u),h<_?(M=-((A=(C=i)*_)-e)/2,V=0):(M=0,V=-((C=(A=e)/_)-i)/2),S.setPosition(M+A/2,V+C/2),S.resize(A,C,l,u);var k,P=n(c);try{for(P.s();!(k=P.n()).done;){var I=k.value;I.setPosition(M+A/2,V+C/2),I.resize(A,C,l,u)}}catch(T){P.e(T)}finally{P.f()}}},cleanUp:function(){h&&window.removeEventListener("resize",h)}};return f&&B.update(),B}},4411:function(t,e,i){"use strict";var n=i(6690).default,s=i(9728).default;Object.defineProperty(e,"__esModule",{value:!0}),e.ViewportInputHandler=void 0;var r=i(6964),o=i(2283),a=function(){function t(e){n(this,t),this.screenCoord=new o.Vector2,this.worldCoord=new o.Vector2,this.viewport=e,this.canvas=e.getCanvas(),this.inputHandler=new r.InputHandler(this.canvas)}return s(t,[{key:"isTouched",value:function(){return this.inputHandler.isTouched()}},{key:"cleanup",value:function(){this.inputHandler.cleanup()}},{key:"addEventListener",value:function(t,e){var i,n;this.inputHandler.addEventListener(t,(i=e,n=this.viewport,function(t,e){var s=n.getViewportInfo(),r=s.x,o=s.y,a=s.pixelRatio;i(t=t*a-r,e=e*a-o)}))}},{key:"getX",value:function(){var t=this.viewport.getViewportInfo(),e=t.x,i=t.pixelRatio;return this.inputHandler.getX()*i-e}},{key:"getY",value:function(){var t=this.viewport.getViewportInfo(),e=t.y,i=t.pixelRatio;return this.inputHandler.getY()*i-e}},{key:"getTouchedWorldCoord",value:function(t){return t||(t=this.viewport.getCamera()),this.screenCoord.set(this.getX(),this.getY()),t.unprojectVector2(this.worldCoord,this.screenCoord),this.worldCoord}}]),t}();e.ViewportInputHandler=a},2955:function(t,e,i){"use strict";var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(e,i);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,s)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),s=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||n(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),s(i(8656),e),s(i(2121),e),s(i(7581),e),s(i(3959),e),s(i(2791),e),s(i(5477),e),s(i(7459),e),s(i(6176),e),s(i(2013),e),s(i(7712),e),s(i(9045),e),s(i(6964),e),s(i(4995),e),s(i(1514),e),s(i(9699),e),s(i(1251),e),s(i(1858),e),s(i(5297),e),s(i(2987),e),s(i(7139),e),s(i(9396),e),s(i(859),e),s(i(8606),e),s(i(2283),e),s(i(7811),e),s(i(5533),e),s(i(4411),e)},3897:function(t){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n},t.exports.__esModule=!0,t.exports.default=t.exports},5372:function(t){t.exports=function(t){if(Array.isArray(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports},3405:function(t,e,i){var n=i(3897);t.exports=function(t){if(Array.isArray(t))return n(t)},t.exports.__esModule=!0,t.exports.default=t.exports},6115:function(t){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.__esModule=!0,t.exports.default=t.exports},6690:function(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},3515:function(t,e,i){var n=i(6015),s=i(9617);function r(e,i,o){return s()?(t.exports=r=Reflect.construct.bind(),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=r=function(t,e,i){var s=[null];s.push.apply(s,e);var r=new(Function.bind.apply(t,s));return i&&n(r,i.prototype),r},t.exports.__esModule=!0,t.exports.default=t.exports),r.apply(null,arguments)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},9728:function(t){function e(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},4704:function(t,e,i){var n=i(6116);t.exports=function(t,e){var i="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=n(t))||e&&t&&"number"===typeof t.length){i&&(t=i);var s=0,r=function(){};return{s:r,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,l=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){l=!0,o=t},f:function(){try{a||null==i.return||i.return()}finally{if(l)throw o}}}},t.exports.__esModule=!0,t.exports.default=t.exports},6389:function(t,e,i){var n=i(3808),s=i(9617),r=i(4993);t.exports=function(t){var e=s();return function(){var i,s=n(t);if(e){var o=n(this).constructor;i=Reflect.construct(s,arguments,o)}else i=s.apply(this,arguments);return r(this,i)}},t.exports.__esModule=!0,t.exports.default=t.exports},1588:function(t,e,i){var n=i(1753);function s(){return"undefined"!==typeof Reflect&&Reflect.get?(t.exports=s=Reflect.get.bind(),t.exports.__esModule=!0,t.exports.default=t.exports):(t.exports=s=function(t,e,i){var s=n(t,e);if(s){var r=Object.getOwnPropertyDescriptor(s,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}},t.exports.__esModule=!0,t.exports.default=t.exports),s.apply(this,arguments)}t.exports=s,t.exports.__esModule=!0,t.exports.default=t.exports},3808:function(t){function e(i){return t.exports=e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},t.exports.__esModule=!0,t.exports.default=t.exports,e(i)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},1655:function(t,e,i){var n=i(6015);t.exports=function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&n(t,e)},t.exports.__esModule=!0,t.exports.default=t.exports},9617:function(t){t.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}},t.exports.__esModule=!0,t.exports.default=t.exports},9498:function(t){t.exports=function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)},t.exports.__esModule=!0,t.exports.default=t.exports},8872:function(t){t.exports=function(t,e){var i=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var n,s,r=[],o=!0,a=!1;try{for(i=i.call(t);!(o=(n=i.next()).done)&&(r.push(n.value),!e||r.length!==e);o=!0);}catch(l){a=!0,s=l}finally{try{o||null==i.return||i.return()}finally{if(a)throw s}}return r}},t.exports.__esModule=!0,t.exports.default=t.exports},2218:function(t){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},2281:function(t){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},4993:function(t,e,i){var n=i(8698).default,s=i(6115);t.exports=function(t,e){if(e&&("object"===n(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return s(t)},t.exports.__esModule=!0,t.exports.default=t.exports},7061:function(t,e,i){var n=i(8698).default;function s(){"use strict";t.exports=s=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var e={},i=Object.prototype,r=i.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",l=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function h(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(k){h=function(t,e,i){return t[e]=i}}function m(t,e,i,n){var s=e&&e.prototype instanceof f?e:f,r=Object.create(s.prototype),o=new C(n||[]);return r._invoke=function(t,e,i){var n="suspendedStart";return function(s,r){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===s)throw r;return V()}for(i.method=s,i.arg=r;;){var o=i.delegate;if(o){var a=B(o,i);if(a){if(a===_)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var l=c(t,e,i);if("normal"===l.type){if(n=i.done?"completed":"suspendedYield",l.arg===_)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(n="completed",i.method="throw",i.arg=l.arg)}}}(t,i,o),r}function c(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(k){return{type:"throw",arg:k}}}e.wrap=m;var _={};function f(){}function d(){}function v(){}var y={};h(y,a,(function(){return this}));var p=Object.getPrototypeOf,x=p&&p(p(M([])));x&&x!==i&&r.call(x,a)&&(y=x);var g=v.prototype=f.prototype=Object.create(y);function b(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function i(s,o,a,l){var u=c(t[s],t,o);if("throw"!==u.type){var h=u.arg,m=h.value;return m&&"object"==n(m)&&r.call(m,"__await")?e.resolve(m.__await).then((function(t){i("next",t,a,l)}),(function(t){i("throw",t,a,l)})):e.resolve(m).then((function(t){h.value=t,a(h)}),(function(t){return i("throw",t,a,l)}))}l(u.arg)}var s;this._invoke=function(t,n){function r(){return new e((function(e,s){i(t,n,e,s)}))}return s=s?s.then(r,r):r()}}function B(t,e){var i=t.iterator[e.method];if(void 0===i){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,B(t,e),"throw"===e.method))return _;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return _}var n=c(i,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,_;var s=n.arg;return s?s.done?(e[t.resultName]=s.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,_):s:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,_)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function M(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(r.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:V}}function V(){return{value:void 0,done:!0}}return d.prototype=v,h(g,"constructor",v),h(v,"constructor",d),d.displayName=h(v,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,h(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},b(S.prototype),h(S.prototype,l,(function(){return this})),e.AsyncIterator=S,e.async=function(t,i,n,s,r){void 0===r&&(r=Promise);var o=new S(m(t,i,n,s),r);return e.isGeneratorFunction(i)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},b(g),h(g,u,"Generator"),h(g,a,(function(){return this})),h(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},e.values=M,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(i,n){return o.type="throw",o.arg=t,e.next=i,n&&(e.method="next",e.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],o=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var a=r.call(s,"catchLoc"),l=r.call(s,"finallyLoc");if(a&&l){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,_):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),_},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),A(i),_}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var s=n.arg;A(i)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:M(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=void 0),_}},e}t.exports=s,t.exports.__esModule=!0,t.exports.default=t.exports},6015:function(t){function e(i,n){return t.exports=e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},t.exports.__esModule=!0,t.exports.default=t.exports,e(i,n)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},7424:function(t,e,i){var n=i(5372),s=i(8872),r=i(6116),o=i(2218);t.exports=function(t,e){return n(t)||s(t,e)||r(t,e)||o()},t.exports.__esModule=!0,t.exports.default=t.exports},1753:function(t,e,i){var n=i(3808);t.exports=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=n(t)););return t},t.exports.__esModule=!0,t.exports.default=t.exports},861:function(t,e,i){var n=i(3405),s=i(9498),r=i(6116),o=i(2281);t.exports=function(t){return n(t)||s(t)||r(t)||o()},t.exports.__esModule=!0,t.exports.default=t.exports},8698:function(t){function e(i){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(i)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},6116:function(t,e,i){var n=i(3897);t.exports=function(t,e){if(t){if("string"===typeof t)return n(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,i),r.exports}!function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){e=function(){return i};var i={},n=Object.prototype,s=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function u(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(V){u=function(t,e,i){return t[e]=i}}function h(t,e,i,n){var s=e&&e.prototype instanceof _?e:_,r=Object.create(s.prototype),o=new A(n||[]);return r._invoke=function(t,e,i){var n="suspendedStart";return function(s,r){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===s)throw r;return M()}for(i.method=s,i.arg=r;;){var o=i.delegate;if(o){var a=S(o,i);if(a){if(a===c)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var l=m(t,e,i);if("normal"===l.type){if(n=i.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:i.done}}"throw"===l.type&&(n="completed",i.method="throw",i.arg=l.arg)}}}(t,i,o),r}function m(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(V){return{type:"throw",arg:V}}}i.wrap=h;var c={};function _(){}function f(){}function d(){}var v={};u(v,o,(function(){return this}));var y=Object.getPrototypeOf,p=y&&y(y(C([])));p&&p!==n&&s.call(p,o)&&(v=p);var x=d.prototype=_.prototype=Object.create(v);function g(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function b(e,i){function n(r,o,a,l){var u=m(e[r],e,o);if("throw"!==u.type){var h=u.arg,c=h.value;return c&&"object"==t(c)&&s.call(c,"__await")?i.resolve(c.__await).then((function(t){n("next",t,a,l)}),(function(t){n("throw",t,a,l)})):i.resolve(c).then((function(t){h.value=t,a(h)}),(function(t){return n("throw",t,a,l)}))}l(u.arg)}var r;this._invoke=function(t,e){function s(){return new i((function(i,s){n(t,e,i,s)}))}return r=r?r.then(s,s):s()}}function S(t,e){var i=t.iterator[e.method];if(void 0===i){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,S(t,e),"throw"===e.method))return c;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var n=m(i,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,c;var s=n.arg;return s?s.done?(e[t.resultName]=s.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,c):s:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,c)}function B(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function w(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(B,this),this.reset(!0)}function C(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(s.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:M}}function M(){return{value:void 0,done:!0}}return f.prototype=d,u(x,"constructor",d),u(d,"constructor",f),f.displayName=u(d,l,"GeneratorFunction"),i.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,u(t,l,"GeneratorFunction")),t.prototype=Object.create(x),t},i.awrap=function(t){return{__await:t}},g(b.prototype),u(b.prototype,a,(function(){return this})),i.AsyncIterator=b,i.async=function(t,e,n,s,r){void 0===r&&(r=Promise);var o=new b(h(t,e,n,s),r);return i.isGeneratorFunction(e)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},g(x),u(x,l,"Generator"),u(x,o,(function(){return this})),u(x,"toString",(function(){return"[object Generator]"})),i.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},i.values=C,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!t)for(var e in this)"t"===e.charAt(0)&&s.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function i(i,n){return o.type="throw",o.arg=t,e.next=i,n&&(e.method="next",e.arg=void 0),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n],o=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var a=s.call(r,"catchLoc"),l=s.call(r,"finallyLoc");if(a&&l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(a){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=t,o.arg=e,r?(this.method="next",this.next=r.finallyLoc,c):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),c},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),w(i),c}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var s=n.arg;w(i)}return s}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:C(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=void 0),c}},i}function n(t,e,i,n,s,r,o){try{var a=t[r](o),l=a.value}catch(u){return void i(u)}a.done?e(l):Promise.resolve(l).then(n,s)}function s(t){return function(){var e=this,i=arguments;return new Promise((function(s,r){var o=t.apply(e,i);function a(t){n(o,s,r,a,l,"next",t)}function l(t){n(o,s,r,a,l,"throw",t)}a(void 0)}))}}var r=i(2955);function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var u=a((function t(){l(this,t)}));u.WORLD_WIDTH=500,u.WORLD_HEIGHT=1e3,u.PIXEL_PER_METER=100,u.FIX_DELTA=1/60,u.PHYSIC_GRAVITY=-10,u.VELOCITY_ITERATIONS=6,u.POSITION_ITERATIONS=2,u.START_COL=9,u.TOTAL_ROWS=6,u.PALE_OFFSET=47/u.PIXEL_PER_METER,u.PALE_RADIUS=8/u.PIXEL_PER_METER,u.BALL_RADIUS=12/u.PIXEL_PER_METER,u.DELTA_RANDOM_RANGE=2/u.PIXEL_PER_METER,u.BLOCK_WIDTH=100/u.PIXEL_PER_METER,u.BLOCK_HEIGHT=30/u.PIXEL_PER_METER,u.BLOCK_SPEED=300/u.PIXEL_PER_METER,u.BALL_SPEED=200/u.PIXEL_PER_METER,u.TOTAL_BASKETS=4,u.BASKET_OFFSET=50/u.PIXEL_PER_METER,u.BASKET_WIDTH=50/u.PIXEL_PER_METER,u.BASKET_HEIGHT=20/u.PIXEL_PER_METER,u.BASKET_EDGE=5/u.PIXEL_PER_METER,u.BASKET_POSITION_Y=.2*u.WORLD_HEIGHT/u.PIXEL_PER_METER,u.ITEM_DROP_POSTION_Y=.85*u.WORLD_HEIGHT/u.PIXEL_PER_METER,u.ITEM_DROP_OFFSET_WITH_PALES=2*u.PALE_OFFSET;var h,m,c,_,f,d=i(7276),v=i(9997);function y(t,e,i,n){i&&Object.defineProperty(t,e,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function x(t,e){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},x(t,e)}function g(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&x(t,e)}function b(t){return b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},b(t)}function S(e,i){if(i&&("object"===t(i)||"function"===typeof i))return i;if(void 0!==i)throw new TypeError("Derived constructors may only return object or undefined");return p(e)}function B(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=b(t);if(e){var s=b(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return S(this,i)}}function w(t,e,i,n,s){var r={};return Object.keys(n).forEach((function(t){r[t]=n[t]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=i.slice().reverse().reduce((function(i,n){return n(t,e,i)||i}),r),s&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(s):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(t,e,r),r=null),r}var A,C,M,V,k,P,I,T,G,L,D,R,F,E,O,z,j,q,N,X,J,W,U,H,Z,Y,K,Q,$,tt,et=(h=(0,v.tB)("ball"),m=(0,v.tB)("levelState"),c=function(t){g(i,t);var e=B(i);function i(){var t;l(this,i);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return y(t=e.call.apply(e,[this].concat(s)),"ball",_,p(t)),y(t,"levelState",f,p(t)),t.ballDirection=1,t.boundLeft=void 0,t.boundRight=void 0,t}return a(i,[{key:"initialized",value:function(){this.boundRight=u.WORLD_WIDTH/u.PIXEL_PER_METER-u.BLOCK_WIDTH/2,this.boundLeft=u.BLOCK_WIDTH/2}},{key:"process",value:function(){if(!this.levelState.ballDrop){var t=this.ballDirection*u.FIX_DELTA*u.BALL_SPEED,e=this.ball.GetPosition(),i={x:e.x+t,y:e.y};(i.x<=this.boundLeft||i.x>=this.boundRight)&&(this.ballDirection*=-1,i.x=this.ballDirection>0?this.boundLeft:this.boundRight),this.ball.SetPosition(i)}}}]),i}(v.xP),_=w(c.prototype,"ball",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=w(c.prototype,"levelState",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c),it=(A=(0,v.tB)("blocks"),C=function(t){g(i,t);var e=B(i);function i(){var t;l(this,i);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return y(t=e.call.apply(e,[this].concat(s)),"blocks",M,p(t)),t.blockDirections=[1,-1],t.boundLeft=void 0,t.boundRight=void 0,t}return a(i,[{key:"initialized",value:function(){this.boundRight=u.WORLD_WIDTH/u.PIXEL_PER_METER-u.BLOCK_WIDTH/2,this.boundLeft=u.BLOCK_WIDTH/2}},{key:"process",value:function(){for(var t=0;t<this.blocks.length;t++){t>=this.blockDirections.length&&(this.blockDirections[t]=1);var e=this.blocks[t],i=this.blockDirections[t]*u.FIX_DELTA*u.BLOCK_SPEED,n=e.GetPosition(),s={x:n.x+i,y:n.y};(s.x<=this.boundLeft||s.x>=this.boundRight)&&(this.blockDirections[t]*=-1,s.x=this.blockDirections[t]>0?this.boundLeft:this.boundRight),e.SetPosition(s)}}}]),i}(v.xP),M=w(C.prototype,"blocks",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C),nt=(V=(0,v.tB)("ball"),k=(0,v.tB)("levelState"),P=(0,v.tB)("inputHandler"),I=function(t){g(i,t);var e=B(i);function i(){var t;l(this,i);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return y(t=e.call.apply(e,[this].concat(s)),"ball",T,p(t)),y(t,"levelState",G,p(t)),y(t,"inputHandler",L,p(t)),t.canTriggerJustTouched=!0,t.justTouched=!1,t}return a(i,[{key:"processDropBall",value:function(){this.justTouched&&(this.ball.SetGravityScale(1),this.levelState.ballDrop=!0)}},{key:"process",value:function(){this.levelState.ballDrop||(this.justTouched?this.justTouched=!1:this.inputHandler.isTouched()?this.canTriggerJustTouched&&(this.justTouched=!0,this.canTriggerJustTouched=!1):(this.justTouched=!1,this.canTriggerJustTouched=!0),this.processDropBall())}}]),i}(v.xP),T=w(I.prototype,"ball",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G=w(I.prototype,"levelState",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=w(I.prototype,"inputHandler",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I),st=(D=(0,v.tB)("shapeRenderer"),R=(0,v.tB)("camera"),F=(0,v.tB)("physicWorld"),E=function(t){g(i,t);var e=B(i);function i(){var t;l(this,i);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return y(t=e.call.apply(e,[this].concat(s)),"shapeRenderer",O,p(t)),y(t,"camera",z,p(t)),y(t,"physicWorld",j,p(t)),t.debugColors=new Map,t}return a(i,[{key:"initialized",value:function(){this.debugColors.set(d.b2BodyType.b2_dynamicBody,r.Color.MAGENTA),this.debugColors.set(d.b2BodyType.b2_kinematicBody,r.Color.BLUE),this.debugColors.set(d.b2BodyType.b2_staticBody,r.Color.GREEN),this.debugColors.set(d.b2BodyType.b2_unknown,r.Color.WHITE)}},{key:"process",value:function(){this.shapeRenderer.setProjection(this.camera.combined),this.shapeRenderer.begin();for(var t=this.physicWorld.GetBodyList();t;){var e=t.GetFixtureList();if(e){var i=this.debugColors.get(t.GetType()),n=e.GetType(),s=t.GetPosition();if(n===d.b2ShapeType.e_circleShape){var r=e.GetShape();this.shapeRenderer.circle(!0,s.x*u.PIXEL_PER_METER,s.y*u.PIXEL_PER_METER,r.m_radius*u.PIXEL_PER_METER,i)}else if(n===d.b2ShapeType.e_polygonShape){var o=e.GetShape();if(4===o.m_count){var a=Math.abs(o.m_vertices[0].x)+Math.abs(o.m_vertices[1].x)*u.PIXEL_PER_METER,l=Math.abs(o.m_vertices[0].y)+Math.abs(o.m_vertices[2].y)*u.PIXEL_PER_METER;this.shapeRenderer.rect(!0,s.x*u.PIXEL_PER_METER-a,s.y*u.PIXEL_PER_METER-l,2*a,2*l,i)}}}t=t.GetNext()}this.shapeRenderer.end()}}]),i}(v.xP),O=w(E.prototype,"shapeRenderer",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=w(E.prototype,"camera",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j=w(E.prototype,"physicWorld",[F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E),rt=function(t,e){var i=new d.b2BodyDef,n=t.CreateBody(i);return n.SetType(e),n},ot=function(t,e,i){var n=rt(t,e),s=new d.b2CircleShape(i);return n.CreateFixture(s,0),n},at=function(t,e,i,n){var s=rt(t,e),r=new d.b2PolygonShape;return r.SetAsBox(i.x/2,i.y/2,n),s.CreateFixture(r,0),s},lt=u.BASKET_HEIGHT+20/u.PIXEL_PER_METER,ut=(q=(0,v.tB)("blocks"),N=(0,v.tB)("paleBodies"),X=(0,v.tB)("physicWorld"),J=(0,v.tB)("baskets"),W=(0,v.tB)("ball"),U=(0,v.tB)("levelState"),H=function(t){g(i,t);var e=B(i);function i(){var t;l(this,i);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return y(t=e.call.apply(e,[this].concat(s)),"blocks",Z,p(t)),y(t,"paleBodies",Y,p(t)),y(t,"physicWorld",K,p(t)),y(t,"baskets",Q,p(t)),y(t,"balls",$,p(t)),y(t,"levelState",tt,p(t)),t}return a(i,[{key:"getRandomDelta",value:function(){var t=Math.random();return(t<.5?-1:1)*t*u.DELTA_RANDOM_RANGE}},{key:"createPaleBody",value:function(t,e){var i=u.PALE_RADIUS,n=ot(this.physicWorld,d.b2BodyType.b2_staticBody,i),s=this.getRandomDelta();n.SetPosition({x:t+s,y:e});var r=n.GetFixtureList();return r&&r.SetFriction(0),n}},{key:"createBlock",value:function(t,e){var i={x:u.BLOCK_WIDTH,y:u.BLOCK_HEIGHT},n=at(this.physicWorld,d.b2BodyType.b2_kinematicBody,i);return n.SetPosition({x:t,y:e}),n}},{key:"createBasket",value:function(t,e){var i={x:u.BASKET_WIDTH,y:u.BASKET_HEIGHT},n=at(this.physicWorld,d.b2BodyType.b2_kinematicBody,i);return n.SetPosition({x:t,y:e}),n}},{key:"getRandomBlockPosX",value:function(){return Math.random()*(u.WORLD_WIDTH-u.BLOCK_WIDTH)+u.BLOCK_WIDTH/2}},{key:"initialized",value:function(){for(var t=0;t<u.TOTAL_ROWS;t++)for(var e=t%2===0?u.START_COL:u.START_COL+1,i=0;i<e;i++){var n=u.WORLD_WIDTH/2/u.PIXEL_PER_METER-(e-1)*u.PALE_OFFSET/2,s=u.ITEM_DROP_POSTION_Y-u.ITEM_DROP_OFFSET_WITH_PALES-t*u.PALE_OFFSET,r=this.createPaleBody(n+i*u.PALE_OFFSET,s);this.paleBodies.push(r)}for(var o=u.START_COL+1,a=0;a<o;a++){var l=u.WORLD_WIDTH/2/u.PIXEL_PER_METER-(o-1)*u.PALE_OFFSET/2,h=u.ITEM_DROP_POSTION_Y-u.ITEM_DROP_OFFSET_WITH_PALES-(u.TOTAL_ROWS+1)*u.PALE_OFFSET,m=this.createPaleBody(l+a*u.PALE_OFFSET,h);this.paleBodies.push(m)}var c=u.ITEM_DROP_POSTION_Y-u.ITEM_DROP_OFFSET_WITH_PALES-u.TOTAL_ROWS*u.PALE_OFFSET,_=this.createBlock(this.getRandomBlockPosX(),c),f=this.createBlock(this.getRandomBlockPosX(),c-2*u.PALE_OFFSET);this.blocks.push(_),this.blocks.push(f);for(var v=u.WORLD_WIDTH/2/u.PIXEL_PER_METER-(u.TOTAL_BASKETS-1)*(u.BASKET_WIDTH+u.BASKET_OFFSET)/2,y=0;y<u.TOTAL_BASKETS;y++){var p=v+y*(u.BASKET_WIDTH+u.BASKET_OFFSET),x=this.createBasket(p,u.BASKET_POSITION_Y),g=x.GetFixtureList();g.SetSensor(!0),this.baskets.push(x);var b=x.GetPosition();(x=at(this.physicWorld,d.b2BodyType.b2_staticBody,{x:u.BASKET_WIDTH,y:u.BASKET_EDGE})).SetPosition({x:b.x,y:b.y-u.BASKET_HEIGHT/2-u.BASKET_EDGE}),x=at(this.physicWorld,d.b2BodyType.b2_staticBody,{x:u.BASKET_EDGE,y:lt});var S={x:b.x-u.BASKET_WIDTH/2-u.BASKET_EDGE,y:b.y+lt/2-u.BASKET_HEIGHT/2-u.BASKET_EDGE};x.SetPosition(S),(g=(x=ot(this.physicWorld,d.b2BodyType.b2_staticBody,.7*u.BASKET_EDGE)).GetFixtureList()).SetFriction(0),x.SetPosition({x:S.x,y:S.y+lt/2}),x=at(this.physicWorld,d.b2BodyType.b2_staticBody,{x:u.BASKET_EDGE,y:lt}),S.x=b.x+u.BASKET_WIDTH/2+u.BASKET_EDGE,x.SetPosition(S),(x=ot(this.physicWorld,d.b2BodyType.b2_staticBody,.7*u.BASKET_EDGE)).SetPosition({x:S.x,y:S.y+lt/2}),(g=x.GetFixtureList()).SetFriction(0)}}},{key:"process",value:function(){this.physicWorld.Step(u.FIX_DELTA,u.VELOCITY_ITERATIONS,u.POSITION_ITERATIONS)}}]),i}(v.xP),Z=w(H.prototype,"blocks",[q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y=w(H.prototype,"paleBodies",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K=w(H.prototype,"physicWorld",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q=w(H.prototype,"baskets",[J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$=w(H.prototype,"balls",[W],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tt=w(H.prototype,"levelState",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H),ht=function(){var t=s(e().mark((function t(i,n){var s,o,a,l,h,m,c,_,f,y,p,x;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=i.getContext(),o=i.getCamera(),a=new r.PolygonBatch(s,!0),l=new r.ShapeRenderer(s),h=new r.ViewportInputHandler(i),(m=new d.b2World({x:0,y:u.PHYSIC_GRAVITY})).SetAllowSleeping(!1),m.SetContinuousPhysics(!0),c=[],_=[],f=[],(y=ot(m,d.b2BodyType.b2_dynamicBody,u.BALL_RADIUS)).SetPosition({x:u.WORLD_WIDTH/u.PIXEL_PER_METER*.5,y:u.ITEM_DROP_POSTION_Y}),y.SetGravityScale(0),p={ballDrop:!1},(x=new v.q3).register("gl",s),x.register("viewport",i),x.register("camera",o),x.register("polygonBatch",a),x.register("shapeRenderer",l),x.register("assetManager",n),x.register("inputHandler",h),x.register("physicWorld",m),x.register("paleBodies",c),x.register("ball",y),x.register("blocks",_),x.register("baskets",f),x.register("levelState",p),x.addSystem(new st,!1),x.addSystem(new ut,!0),x.addSystem(new it,!0),x.addSystem(new et,!0),x.addSystem(new nt,!0),t.abrupt("return",{update:function(){a.setProjection(o.combined),x.setDelta(u.FIX_DELTA),x.processActiveSystem(),x.processPassiveSystem()},dispose:function(){h.cleanup()}});case 35:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}(),mt=function(){var t=s(e().mark((function t(){var i,n,s,o,a,l;return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=(0,r.createStage)(),n=i.getCanvas(),s=(0,r.createViewport)(n,u.WORLD_WIDTH,u.WORLD_HEIGHT),o=s.getContext(),a=new r.AssetManager(o),t.next=7,a.finishLoading();case 7:return t.next=9,ht(s,a);case 9:l=t.sent,r.Game.shared.setScreen(l),(0,r.createGameLoop)((function(t){o.clearColor(0,0,0,1),o.clear(o.COLOR_BUFFER_BIT),r.Game.shared.update(t)}));case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();mt()}()}();